var Im=Object.defineProperty;var Lm=(o,e,t)=>e in o?Im(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var g=(o,e,t)=>Lm(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();const Tl="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cmask%20id='gearCutout'%3e%3crect%20width='36'%20height='36'%20fill='white'/%3e%3ccircle%20cx='18'%20cy='18'%20r='4.17647'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3cpath%20d='M16.539%207.00653C16.8907%205.44946%2019.1093%205.44946%2019.461%207.00653C19.9933%209.36314%2022.6977%2010.4833%2024.7405%209.19335C26.0902%208.34104%2027.659%209.90982%2026.8067%2011.2595C25.5167%2013.3023%2026.6369%2016.0067%2028.9935%2016.539C30.5505%2016.8907%2030.5505%2019.1093%2028.9935%2019.461C26.6369%2019.9933%2025.5167%2022.6977%2026.8066%2024.7405C27.659%2026.0902%2026.0902%2027.659%2024.7405%2026.8066C22.6977%2025.5167%2019.9933%2026.6369%2019.461%2028.9935C19.1093%2030.5505%2016.8907%2030.5505%2016.539%2028.9935C16.0067%2026.6369%2013.3023%2025.5167%2011.2595%2026.8066C9.90982%2027.659%208.34104%2026.0902%209.19335%2024.7405C10.4833%2022.6977%209.36315%2019.9933%207.00653%2019.461C5.44946%2019.1093%205.44946%2016.8907%207.00653%2016.539C9.36314%2016.0067%2010.4833%2013.3023%209.19335%2011.2595C8.34104%209.90982%209.90982%208.34104%2011.2595%209.19335C13.3023%2010.4833%2016.0067%209.36314%2016.539%207.00653Z'%20stroke='white'%20class='svg-icon-hover'%20stroke-width='2'%20mask='url(%23gearCutout)'/%3e%3ccircle%20cx='18'%20cy='18'%20r='4.17647'%20stroke='white'%20stroke-width='2'/%3e%3c/svg%3e",Rm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M25%2014.5H11C10.4477%2014.5%2010%2014.9477%2010%2015.5V20.3377C10%2020.4452%209.98267%2020.552%209.94868%2020.654L9.0564%2023.3308C9.01909%2023.4427%208.96228%2023.5471%208.88858%2023.6393L7.21913%2025.7261C7.07728%2025.9034%207%2026.1237%207%2026.3508V29.0858C7%2029.351%207.10536%2029.6054%207.29289%2029.7929L8.20711%2030.7071C8.39464%2030.8946%208.649%2031%208.91421%2031H27.0858C27.351%2031%2027.6054%2030.8946%2027.7929%2030.7071L28.7071%2029.7929C28.8946%2029.6054%2029%2029.351%2029%2029.0858V27.5V26.3508C29%2026.1237%2028.9227%2025.9034%2028.7809%2025.7261L27.1114%2023.6393C27.0377%2023.5471%2026.9809%2023.4427%2026.9436%2023.3308L26.0513%2020.654C26.0173%2020.552%2026%2020.4452%2026%2020.3377V15.5C26%2014.9477%2025.5523%2014.5%2025%2014.5Z'%20stroke='white'%20class='svg-icon-hover'/%3e%3crect%20x='10'%20y='5.5'%20width='16'%20height='6'%20rx='0.5'%20stroke='white'%20class='svg-icon-hover'/%3e%3cpath%20d='M10.5%2011V15'%20stroke='white'/%3e%3cpath%20d='M25.5%2011V15'%20stroke='white'/%3e%3c/svg%3e",Dm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='7'%20y='8'%20width='2'%20height='28'%20transform='rotate(-45%207%208)'%20fill='white'/%3e%3crect%20x='27'%20y='7'%20width='2'%20height='28'%20transform='rotate(45%2027%207)'%20fill='white'/%3e%3c/svg%3e",Fm="data:image/svg+xml,%3csvg%20width='24'%20height='27'%20viewBox='0%200%2024%2027'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cstyle%3e%20:is(path,%20rect)%20{%20stroke:%20black;%20}%20@media%20(prefers-color-scheme:%20dark)%20{%20:is(path,%20rect)%20{%20stroke:%20white;%20}%20}%20%3c/style%3e%3cpath%20d='M19%209.5H5C4.44772%209.5%204%209.94772%204%2010.5V15.3377C4%2015.4452%203.98267%2015.552%203.94868%2015.654L3.0564%2018.3308C3.01909%2018.4427%202.96228%2018.5471%202.88858%2018.6393L1.21913%2020.7261C1.07728%2020.9034%201%2021.1237%201%2021.3508V24.0858C1%2024.351%201.10536%2024.6054%201.29289%2024.7929L2.20711%2025.7071C2.39464%2025.8946%202.649%2026%202.91421%2026H21.0858C21.351%2026%2021.6054%2025.8946%2021.7929%2025.7071L22.7071%2024.7929C22.8946%2024.6054%2023%2024.351%2023%2024.0858V22.5V21.3508C23%2021.1237%2022.9227%2020.9034%2022.7809%2020.7261L21.1114%2018.6393C21.0377%2018.5471%2020.9809%2018.4427%2020.9436%2018.3308L20.0513%2015.654C20.0173%2015.552%2020%2015.4452%2020%2015.3377V10.5C20%209.94772%2019.5523%209.5%2019%209.5Z'%20stroke='white'/%3e%3crect%20x='4'%20y='0.5'%20width='16'%20height='6'%20rx='0.5'%20stroke='white'/%3e%3cpath%20d='M4.5%206V10'%20stroke='white'/%3e%3cpath%20d='M19.5%206V10'%20stroke='white'/%3e%3c/svg%3e",Om="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='Down%20arrow'%3e%3cpath%20id='Bent%20line'%20d='M4%2013L18%2025L32%2013'%20stroke='%23DDDDDD'%20stroke-width='2'/%3e%3c/g%3e%3c/svg%3e",Um="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M24.1651%2018L7%2029.1573L7%206.84269L7%206.84269L24.1651%2018Z'%20stroke='white'%20stroke-width='2'%20class='svg-icon-hover'/%3e%3crect%20x='28'%20y='6'%20width='2'%20height='24'%20fill='white'/%3e%3c/svg%3e",Nm="/mouthful-of-dust/assets/slv_logo-DhcHiGZt.svg",Bm="/mouthful-of-dust/assets/cv_logo-DLrglkrH.svg",zm="data:image/svg+xml,%3csvg%20width='22'%20height='22'%20viewBox='0%200%2022%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15.8885%2012.2224C16.2261%2012.2224%2016.4999%2012.4962%2016.4999%2012.8337V16.4998C16.4999%2016.8373%2016.2261%2017.1111%2015.8885%2017.1111H14.6669V12.2224H15.8885Z'%20stroke='%23DDDDDD'%20stroke-width='1.22222'/%3e%3cpath%20d='M6.11157%2012.2224H7.33325V17.1111H6.11157C5.77407%2017.1111%205.50024%2016.8373%205.50024%2016.4998V12.8337C5.50024%2012.4962%205.77406%2012.2224%206.11157%2012.2224Z'%20stroke='%23DDDDDD'%20stroke-width='1.22222'/%3e%3crect%20x='16.5'%20y='14.0555'%20width='1.83333'%20height='1.22222'%20fill='%23DDDDDD'/%3e%3crect%20x='3.66663'%20y='14.0555'%20width='1.83333'%20height='1.22222'%20fill='%23DDDDDD'/%3e%3cmask%20id='path-5-inside-1_1744_3597'%20fill='white'%3e%3cpath%20d='M3.05554%2011C3.05554%206.61239%206.61239%203.05554%2011%203.05554C15.3876%203.05554%2018.9444%206.61239%2018.9444%2011V15.2778H3.05554V11Z'/%3e%3c/mask%3e%3cpath%20d='M1.83332%2011C1.83332%205.93738%205.93738%201.83332%2011%201.83332H11C16.0626%201.83332%2020.1667%205.93738%2020.1667%2011L17.7222%2011C17.7222%207.28741%2014.7126%204.27776%2011%204.27776C7.28741%204.27776%204.27776%207.28741%204.27776%2011L1.83332%2011ZM18.9444%2015.2778H3.05554H18.9444ZM1.83332%2015.2778V11C1.83332%205.93738%205.93738%201.83332%2011%201.83332L11%204.27776C7.28741%204.27776%204.27776%207.28741%204.27776%2011V15.2778H1.83332ZM11%201.83332C16.0626%201.83332%2020.1667%205.93738%2020.1667%2011V15.2778H17.7222V11C17.7222%207.28741%2014.7126%204.27776%2011%204.27776L11%201.83332Z'%20fill='%23DDDDDD'%20mask='url(%23path-5-inside-1_1744_3597)'/%3e%3c/svg%3e",Vm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5%2022C5%2022.5523%205.44772%2023%206%2023H11.5858L17.2929%2028.7071C17.4804%2028.8946%2017.7348%2029%2018%2029H19C19.5523%2029%2020%2028.5523%2020%2028V8C20%207.44772%2019.5523%207%2019%207H18C17.7348%207%2017.4804%207.10536%2017.2929%207.29289L11.5858%2013H6C5.44772%2013%205%2013.4477%205%2014V22Z'%20stroke='white'%20stroke-width='2'%20stroke-linejoin='round'%20class='svg-icon-hover'/%3e%3cpath%20d='M25%2013C25%2013%2026%2015%2026%2018C26%2021%2025%2023%2025%2023'%20stroke='white'%20stroke-width='2'/%3e%3cpath%20d='M29%2010C29%2010%2031%2013%2031%2018C31%2023%2029%2026%2029%2026'%20stroke='white'%20stroke-width='2'/%3e%3c/svg%3e",Hm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5%2022C5%2022.5523%205.44772%2023%206%2023H11.5858L17.2929%2028.7071C17.4804%2028.8946%2017.7348%2029%2018%2029H19C19.5523%2029%2020%2028.5523%2020%2028V8C20%207.44772%2019.5523%207%2019%207H18C17.7348%207%2017.4804%207.10536%2017.2929%207.29289L11.5858%2013H6C5.44772%2013%205%2013.4477%205%2014V22Z'%20stroke='white'%20stroke-width='2'%20stroke-linejoin='round'%20class='svg-icon-hover'/%3e%3crect%20x='26'%20y='6'%20width='2'%20height='33'%20transform='rotate(45%2026%206)'%20fill='white'/%3e%3c/svg%3e",Gm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='11'%20y='6'%20width='2'%20height='24'%20fill='white'/%3e%3crect%20x='23'%20y='6'%20width='2'%20height='24'%20fill='white'/%3e%3c/svg%3e",Wm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='State=Play'%3e%3cpath%20id='Triangle'%20d='M27.1651%2018L10%2029.1573L10%206.84269L10%206.84269L27.1651%2018Z'%20stroke='white'%20stroke-width='2'/%3e%3c/g%3e%3c/svg%3e",jm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20opacity='0.9'%3e%3cpath%20d='M18%208C20.6954%208%2023.3124%208.90747%2025.4291%2010.5762C27.5459%2012.2449%2029.0392%2014.5777%2029.6684%2017.1987C30.2977%2019.8196%2030.0262%2022.5761%2028.8977%2025.0239C27.7693%2027.4718%2025.8495%2029.4684%2023.4479%2030.6921C21.0462%2031.9158%2018.3025%2032.2953%2015.6589%2031.7694C13.0153%2031.2436%2010.6257%2029.843%208.87513%2027.7934C7.12459%2025.7438%206.11507%2023.1645%206.00925%2020.4711C5.90343%2017.7778%206.70747%2015.1272%208.2918%2012.9466L9.90983%2014.1221C8.58955%2015.9394%207.91953%2018.1481%208.00771%2020.3926C8.09589%2022.6371%208.93716%2024.7865%2010.3959%2026.4945C11.8547%2028.2025%2013.8461%2029.3696%2016.0491%2029.8079C18.2521%2030.2461%2020.5385%2029.9298%2022.5399%2028.9101C24.5413%2027.8903%2026.141%2026.2265%2027.0814%2024.1866C28.0218%2022.1467%2028.2481%2019.8497%2027.7237%2017.6655C27.1993%2015.4814%2025.9549%2013.5374%2024.1909%2012.1468C22.427%2010.7562%2020.2462%2010%2018%2010V8Z'%20fill='white'/%3e%3crect%20x='14'%20y='8'%20width='4'%20height='2'%20fill='white'/%3e%3cpath%20d='M20%203L14%209L20%2015'%20stroke='white'%20stroke-width='2'/%3e%3c/g%3e%3c/svg%3e",qm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M30%206V24H24V29.9551L16.6143%2024.2109L16.3428%2024H6V6H30Z'%20stroke='white'%20stroke-width='2'%20class='svg-icon-hover'/%3e%3crect%20x='11'%20y='17'%20width='14'%20height='2'%20fill='white'/%3e%3crect%20x='11'%20y='12'%20width='14'%20height='2'%20fill='white'/%3e%3c/svg%3e",Xm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M30%206V24H24V29.9551L16.6143%2024.2109L16.3428%2024H6V6H30Z'%20stroke='white'%20stroke-width='2'%20class='svg-icon-hover'/%3e%3crect%20x='29.1'%20y='0.0999985'%20width='2'%20height='37'%20transform='rotate(40%2029.1%200.0999985)'%20fill='white'/%3e%3c/svg%3e",$m="data:image/svg+xml,%3csvg%20width='42'%20height='36'%20viewBox='0%200%2042%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1%2017.9976C1%2021.7331%201.81736%2025.0642%203.08953%2027.4254C4.38348%2029.8269%206.00401%2031%207.54438%2031H34.4556C35.996%2031%2037.6165%2029.8269%2038.9105%2027.4254C40.1826%2025.0642%2041%2021.7331%2041%2017.9976C41%2014.2646%2040.1827%2010.9347%2038.9105%208.57413C37.6166%206.17311%2035.996%205%2034.4556%205H7.54438C6.00396%205%204.38343%206.17311%203.08949%208.57413C1.81732%2010.9347%201%2014.2646%201%2017.9976Z'%20stroke='white'%20stroke-width='2'/%3e%3cpath%20d='M32.9724%2013H32.6412H32.0192H31.688C33.138%2014.442%2033.9741%2016.4171%2033.9741%2018.469C33.9741%2020.2906%2033.3198%2022.0315%2032.1606%2023.4128H32.4918H33.0572H33.3925C34.4225%2021.9951%2035.0001%2020.2583%2035.0001%2018.469C35.0001%2016.4535%2034.2649%2014.5147%2032.9724%2013Z'%20fill='white'/%3e%3cpath%20d='M30.3452%2013H30.014H29.392H29.0608C30.5108%2014.442%2031.3469%2016.4171%2031.3469%2018.469C31.3469%2020.2906%2030.6926%2022.0315%2029.5334%2023.4128H29.8646H30.43H30.7572C31.7953%2021.9951%2032.3729%2020.2583%2032.3729%2018.469C32.3729%2016.4535%2031.6377%2014.5147%2030.3452%2013Z'%20fill='white'/%3e%3cpath%20d='M27.718%2013H27.3868H26.7567H26.4336C27.8836%2014.442%2028.7116%2016.4171%2028.7116%2018.469C28.7116%2020.2906%2028.0573%2022.0315%2026.9062%2023.4128H27.2374H27.7988H28.13C29.1681%2021.9951%2029.7376%2020.2583%2029.7376%2018.469C29.7376%2016.4535%2029.0105%2014.5147%2027.718%2013Z'%20fill='white'/%3e%3cpath%20d='M21.3522%2015.4533C22.8911%2015.4533%2024.1311%2016.7014%2024.1311%2018.2322C24.1311%2019.7671%2022.8911%2021.0152%2021.3522%2021.0152H20.6251V15.4533H21.3522ZM21.6349%2023.4467C24.5148%2023.4467%2026.8575%2021.1081%2026.8575%2018.2322C26.8575%2015.3443%2024.539%2013.0097%2021.6591%2013.0097H21.6268H18.4319V23.4507H21.6349'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M15.0661%2023.4526H17.3522V13.0075H14.4966L7%2023.4526H10.3565L11.237%2022.0713H15.0661V23.4526ZM12.6729%2019.8946H15.0802V16.1544L12.6729%2019.8946Z'%20fill='white'/%3e%3c/svg%3e",Ym="data:image/svg+xml,%3csvg%20width='42'%20height='36'%20viewBox='0%200%2042%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1%2017.9976C1%2021.7331%201.81736%2025.0642%203.08953%2027.4254C4.38348%2029.8269%206.00401%2031%207.54438%2031H34.4556C35.996%2031%2037.6165%2029.8269%2038.9105%2027.4254C40.1826%2025.0642%2041%2021.7331%2041%2017.9976C41%2014.2646%2040.1827%2010.9347%2038.9105%208.57413C37.6166%206.17311%2035.996%205%2034.4556%205H7.54438C6.00396%205%204.38343%206.17311%203.08949%208.57413C1.81732%2010.9347%201%2014.2646%201%2017.9976Z'%20fill='white'%20fill-opacity='0.2'%20stroke='white'%20stroke-width='2'/%3e%3cpath%20d='M32.9723%2013H32.6411H32.0191H31.6879C33.1379%2014.442%2033.974%2016.4171%2033.974%2018.4689C33.974%2020.2906%2033.3197%2022.0314%2032.1604%2023.4128H32.4916H33.0571H33.3924C34.4223%2021.9951%2034.9999%2020.2583%2034.9999%2018.4689C34.9999%2016.4534%2034.2648%2014.5147%2032.9723%2013Z'%20fill='white'/%3e%3cpath%20d='M30.3451%2013H30.0139H29.3919H29.0607C30.5107%2014.442%2031.3468%2016.4171%2031.3468%2018.4689C31.3468%2020.2906%2030.6925%2022.0314%2029.5332%2023.4128H29.8645H30.4299H30.7571C31.7951%2021.9951%2032.3727%2020.2583%2032.3727%2018.4689C32.3727%2016.4534%2031.6376%2014.5147%2030.3451%2013Z'%20fill='white'/%3e%3cpath%20d='M27.718%2013H27.3868H26.7567H26.4336C27.8836%2014.442%2028.7116%2016.4171%2028.7116%2018.4689C28.7116%2020.2906%2028.0573%2022.0314%2026.9062%2023.4128H27.2374H27.7988H28.13C29.1681%2021.9951%2029.7376%2020.2583%2029.7376%2018.4689C29.7376%2016.4534%2029.0105%2014.5147%2027.718%2013Z'%20fill='white'/%3e%3cpath%20d='M21.3522%2015.4533C22.8911%2015.4533%2024.1311%2016.7014%2024.1311%2018.2322C24.1311%2019.7671%2022.8911%2021.0152%2021.3522%2021.0152H20.6251V15.4533H21.3522ZM21.6349%2023.4467C24.5148%2023.4467%2026.8575%2021.1081%2026.8575%2018.2322C26.8575%2015.3443%2024.539%2013.0097%2021.6591%2013.0097H21.6268H18.4319V23.4507H21.6349'%20fill='white'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M15.0661%2023.4526H17.3522V13.0075H14.4966L7%2023.4526H10.3565L11.237%2022.0713H15.0661V23.4526ZM12.6729%2019.8947H15.0802V16.1544L12.6729%2019.8947Z'%20fill='white'/%3e%3c/svg%3e",Zm="data:image/svg+xml,%3csvg%20width='42'%20height='36'%20viewBox='0%200%2042%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1%2017.9976C1%2021.7331%201.81736%2025.0642%203.08953%2027.4254C4.38348%2029.8269%206.00401%2031%207.54438%2031H34.4556C35.996%2031%2037.6165%2029.8269%2038.9105%2027.4254C40.1826%2025.0642%2041%2021.7331%2041%2017.9976C41%2014.2646%2040.1827%2010.9347%2038.9105%208.57413C37.6166%206.17311%2035.996%205%2034.4556%205H7.54438C6.00396%205%204.38343%206.17311%203.08949%208.57413C1.81732%2010.9347%201%2014.2646%201%2017.9976Z'%20stroke='white'%20stroke-width='2'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M0%2017.9976C0%2025.7333%203.37636%2032%207.54438%2032H34.4556C38.6236%2032%2042%2025.7333%2042%2017.9976C42%2010.2667%2038.6236%204%2034.4556%204H7.54438C3.37636%204%200%2010.2667%200%2017.9976ZM34.3044%2012H34.683C36.1601%2013.7311%2037.0003%2015.9468%2037.0003%2018.2503C37.0003%2020.2952%2036.3402%2022.2802%2035.163%2023.9004H34.7799H34.1336H33.7551C35.0799%2022.3217%2035.8278%2020.3322%2035.8278%2018.2503C35.8278%2015.9053%2034.8722%2013.648%2033.215%2012H33.5935H34.3044ZM31.6804%2012H31.3019H30.591H30.2125C31.8697%2013.648%2032.8252%2015.9053%2032.8252%2018.2503C32.8252%2020.3322%2032.0774%2022.3217%2030.7526%2023.9004H31.1311H31.7774H32.1513C33.3376%2022.2802%2033.9977%2020.2952%2033.9977%2018.2503C33.9977%2015.9468%2033.1576%2013.7311%2031.6804%2012ZM28.2995%2012H28.678C30.1552%2013.7311%2030.9861%2015.9468%2030.9861%2018.2503C30.9861%2020.2952%2030.3352%2022.2802%2029.1489%2023.9004H28.7703H28.1287H27.7502C29.0658%2022.3217%2029.8136%2020.3322%2029.8136%2018.2503C29.8136%2015.9053%2028.8673%2013.648%2027.2101%2012H27.5794H28.2995ZM21.4024%2014.8038C23.1611%2014.8038%2024.5783%2016.2302%2024.5783%2017.9797C24.5783%2019.7339%2023.1611%2021.1603%2021.4024%2021.1603H20.5715V14.8038H21.4024ZM21.7255%2023.9392C25.0168%2023.9392%2027.6942%2021.2664%2027.6942%2017.9797C27.6942%2014.6792%2025.0445%2012.011%2021.7532%2012.011H21.7163H18.0649V23.9438H21.7255V23.9392ZM16.8312%2023.946H14.2185V22.3672H9.84235L8.83603%2023.946H5L13.5676%2012.0086H16.8312V23.946ZM14.2345%2019.8797H11.4832L14.2345%2015.6051V19.8797Z'%20fill='white'/%3e%3c/svg%3e",Km="data:image/svg+xml,%3csvg%20width='42'%20height='36'%20viewBox='0%200%2042%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1%2017.9976C1%2021.7331%201.81736%2025.0642%203.08953%2027.4254C4.38348%2029.8269%206.00401%2031%207.54438%2031H34.4556C35.996%2031%2037.6165%2029.8269%2038.9105%2027.4254C40.1826%2025.0642%2041%2021.7331%2041%2017.9976C41%2014.2646%2040.1827%2010.9347%2038.9105%208.57413C37.6166%206.17311%2035.996%205%2034.4556%205H7.54438C6.00396%205%204.38343%206.17311%203.08949%208.57413C1.81732%2010.9347%201%2014.2646%201%2017.9976Z'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='17'%20y='12'%20width='2'%20height='12'%20fill='white'/%3e%3crect%20x='23'%20y='12'%20width='2'%20height='12'%20fill='white'/%3e%3c/svg%3e",Qm="data:image/svg+xml,%3csvg%20width='42'%20height='36'%20viewBox='0%200%2042%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1%2017.9976C1%2021.7331%201.81736%2025.0642%203.08953%2027.4254C4.38348%2029.8269%206.00401%2031%207.54438%2031H34.4556C35.996%2031%2037.6165%2029.8269%2038.9105%2027.4254C40.1826%2025.0642%2041%2021.7331%2041%2017.9976C41%2014.2646%2040.1827%2010.9347%2038.9105%208.57413C37.6166%206.17311%2035.996%205%2034.4556%205H7.54438C6.00396%205%204.38343%206.17311%203.08949%208.57413C1.81732%2010.9347%201%2014.2646%201%2017.9976Z'%20fill='white'%20fill-opacity='0.2'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='17'%20y='12'%20width='2'%20height='12'%20fill='white'/%3e%3crect%20x='23'%20y='12'%20width='2'%20height='12'%20fill='white'/%3e%3c/svg%3e",Jm="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='5'%20y='26'%20width='26'%20height='2'%20fill='white'/%3e%3crect%20x='5'%20y='17'%20width='26'%20height='2'%20fill='white'/%3e%3crect%20x='5'%20y='8'%20width='26'%20height='2'%20fill='white'/%3e%3c/svg%3e",eg="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M23%204L11%2018L23%2032'%20stroke='white'%20stroke-opacity='0.9'%20stroke-width='2'/%3e%3c/svg%3e",tg="data:image/svg+xml,%3csvg%20width='17'%20height='16'%20viewBox='0%200%2017%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20id='Solo%20Icon'%3e%3ccircle%20id='Ellipse%206'%20cx='8.5'%20cy='8'%20r='6'%20stroke='white'%20stroke-width='2'/%3e%3c/g%3e%3c/svg%3e",ig="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.18837%2013.9031L12.8832%209.28624C13.8542%208.70364%2013.8542%207.29637%2012.8832%206.71376L5.18837%202.09686C4.18859%201.49699%202.91663%202.21715%202.91663%203.3831L2.91663%2012.6169C2.91663%2013.7828%204.18859%2014.503%205.18837%2013.9031Z'%20stroke='white'%20stroke-width='2'/%3e%3c/svg%3e",ng="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='18'%20cy='18'%20r='14'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='17'%20y='16'%20width='2'%20height='9'%20fill='white'/%3e%3crect%20x='17'%20y='11'%20width='2'%20height='2'%20fill='white'/%3e%3c/svg%3e",sg="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29%2018H7M7%2018L18%207M7%2018L18%2029'%20stroke='white'%20stroke-width='2'/%3e%3c/svg%3e",ag="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='5'%20y='12'%20width='20'%20height='16'%20rx='3'%20stroke='white'%20stroke-width='2'/%3e%3cpath%20d='M30%2015L34.2428%2012.4543C34.576%2012.2544%2035%2012.4944%2035%2012.8831V27.1169C35%2027.5056%2034.576%2027.7456%2034.2428%2027.5457L30%2025M30%2015V25M30%2015H24M30%2025H24'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='1'%20y='14'%20width='4'%20height='6'%20rx='1'%20stroke='white'%20stroke-width='2'/%3e%3cpath%20d='M10%206C9.44772%206%209%206.44772%209%207C9%207.55228%209.44772%208%2010%208V6ZM19.7764%207.55279L20.6708%207.10557L19.7764%207.55279ZM10%208H18.882V6H10V8ZM18.882%208L21.1056%2012.4472L22.8944%2011.5528L20.6708%207.10557L18.882%208ZM18.882%208L20.6708%207.10557C20.332%206.428%2019.6395%206%2018.882%206V8Z'%20fill='white'/%3e%3c/svg%3e",rg="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M21.167%202.8071V20.393L10.7529%2030.8071H2.5V2.8071H21.167Z'%20stroke='white'%20stroke-width='2'%20class='svg-icon-hover'/%3e%3cpath%20d='M11.1666%2030.8071V20.8071H21.1666'%20stroke='white'%20stroke-width='2'/%3e%3cpath%20d='M26.6042%2015.38C28.1391%2015.38%2029.6503%2015.7586%2031.0039%2016.4821C32.3575%2017.2056%2033.5119%2018.2518%2034.3646%2019.528C35.2173%2020.8042%2035.7422%2022.271%2035.8926%2023.7985C36.043%2025.326%2035.8145%2026.867%2035.2271%2028.2851C34.6397%2029.7031%2033.7117%2030.9544%2032.5252%2031.9281C31.3387%2032.9018%2029.9304%2033.5679%2028.4251%2033.8673C26.9197%2034.1668%2025.3637%2034.0903%2023.8949%2033.6448C22.4261%2033.1992%2021.0899%2032.3983%2020.0045%2031.313L21.4189%2029.8987C22.2716%2030.7514%2023.3215%2031.3807%2024.4755%2031.7308C25.6295%2032.0809%2026.8521%2032.1409%2028.0348%2031.9056C29.2176%2031.6704%2030.3241%2031.147%2031.2563%2030.382C32.1886%2029.6169%2032.9177%2028.6338%2033.3792%2027.5196C33.8407%2026.4055%2034.0203%2025.1947%2033.9021%2023.9946C33.7839%2022.7944%2033.3715%2021.642%2032.7015%2020.6392C32.0315%2019.6365%2031.1246%2018.8145%2030.0611%2018.246C28.9975%2017.6776%2027.8102%2017.3802%2026.6042%2017.3802V15.38Z'%20fill='white'/%3e%3crect%20x='18.1666'%20y='29.4738'%20width='2'%20height='2.66667'%20transform='rotate(-45%2018.1666%2029.4738)'%20fill='white'/%3e%3cpath%20d='M24.2137%2028.536L18.5569%2028.536L18.5569%2034.1929'%20stroke='white'%20stroke-width='2'/%3e%3c/svg%3e",og="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.773%202.8071V20.393L25.1871%2030.8071H33.44V2.8071H14.773Z'%20stroke='white'%20stroke-width='2'%20class='svg-icon-hover'/%3e%3cpath%20d='M9.3358%2015.38C7.80092%2015.38%206.28973%2015.7585%204.93609%2016.4821C3.58245%2017.2056%202.42814%2018.2518%201.57541%2019.528C0.722681%2020.8042%200.197849%2022.271%200.0474052%2023.7985C-0.103039%2025.326%200.125547%2026.867%200.712919%2028.2851C1.30029%2029.7031%202.22832%2030.9544%203.41479%2031.9281C4.60126%2032.9018%206.00957%2033.5679%207.51495%2033.8673C9.02033%2034.1668%2010.5763%2034.0903%2012.0451%2033.6448C13.5139%2033.1992%2014.8501%2032.3983%2015.9355%2031.313L14.5211%2029.8987C13.6684%2030.7514%2012.6185%2031.3807%2011.4645%2031.7308C10.3105%2032.0809%209.08794%2032.1409%207.90516%2031.9056C6.72238%2031.6704%205.61588%2031.147%204.68366%2030.382C3.75145%2029.6169%203.0223%2028.6338%202.5608%2027.5196C2.0993%2026.4055%201.9197%2025.1947%202.03791%2023.9946C2.15611%2022.7944%202.56847%2021.6419%203.23846%2020.6392C3.90845%2019.6365%204.81539%2018.8145%205.87895%2018.246C6.9425%2017.6776%208.12984%2017.3801%209.3358%2017.3801V15.38Z'%20fill='white'/%3e%3cpath%20d='M5.61048%2013.0366L10.5095%2015.865L7.68103%2020.764'%20stroke='white'%20stroke-width='2'/%3e%3c/svg%3e",lg="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cmask%20id='textOverlayCutout'%3e%3crect%20width='100%25'%20height='100%25'%20fill='white'/%3e%3cpath%20d='M24.4885%2024.3333H22.3619L21.3179%2021.6653H14.9959L13.9519%2024.3333H11.8252L16.9485%2011.438H19.3652L24.4885%2024.3333ZM20.7572%2019.9447L18.1472%2013.12L15.5565%2019.9447H20.7572Z'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3cpath%20d='M7.5629%207.42238H5.08496V28.539H7.29358V31.0169H28.6795V28.539H30.942V7.42238H28.6795V4.89055H7.5629V7.42238Z'%20class='svg-icon-hover'%20mask='url(%23textOverlayCutout)'/%3e%3crect%20x='28.6666'%20y='28.6667'%20width='4.66667'%20height='4.66667'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='2.66663'%20y='28.6667'%20width='4.66667'%20height='4.66667'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='28.6666'%20y='2.66667'%20width='4.66667'%20height='4.66667'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='2.66663'%20y='2.66667'%20width='4.66667'%20height='4.66667'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='4'%20y='7.66667'%20width='2'%20height='20.6667'%20fill='white'/%3e%3crect%20x='8'%20y='30'%20width='20.6667'%20height='2'%20fill='white'/%3e%3crect%20x='30'%20y='7.66667'%20width='2'%20height='20.6667'%20fill='white'/%3e%3crect%20x='8'%20y='4'%20width='20.6667'%20height='2'%20fill='white'/%3e%3cpath%20d='M24.4885%2024.3333H22.3619L21.3179%2021.6653H14.9959L13.9519%2024.3333H11.8252L16.9485%2011.438H19.3652L24.4885%2024.3333ZM20.7572%2019.9447L18.1472%2013.12L15.5565%2019.9447H20.7572Z'%20fill='white'%20class='svg-icon-hover-overlay'/%3e%3c/svg%3e",cg="/mouthful-of-dust/assets/award-aaa-CXEnsooA.svg",hg="/mouthful-of-dust/assets/award-agda-BiWfQfFa.svg",ug="/mouthful-of-dust/assets/award-c2-BrwHnMH6.svg",dg="/mouthful-of-dust/assets/award-gd-gZsZh-yl.svg",fg="/mouthful-of-dust/assets/award-him-CiWa-12n.svg",pg="/mouthful-of-dust/assets/award-vpda-DHIgwhin.svg",mg="/mouthful-of-dust/assets/award-w3-DNx_ZqVP.svg",Jf=(o,e)=>{document.querySelectorAll(`.${o}`).forEach(t=>{t.src=e})},ei=async(o,e)=>{try{const i=await(await fetch(e)).text();document.querySelectorAll(`.${o}`).forEach(n=>{const s=document.createElement("div");s.innerHTML=i;const a=s.querySelector("svg");a&&(Array.from(n.attributes).forEach(r=>{r.name!=="src"&&a.setAttribute(r.name,r.value)}),n.parentNode.replaceChild(a,n))})}catch(t){console.error("Failed to load SVG:",t)}};ei("icon-gear",Tl);ei("icon-helmet",Rm);ei("icon-close",Dm);ei("icon-arrow",Om);ei("icon-skip",Um);Jf("icon-slv-logo",Nm);Jf("icon-cv-logo",Bm);ei("icon-headphones-sm",zm);ei("icon-sound-state-on",Vm);ei("icon-sound-state-off",Hm);ei("icon-pause",Gm);ei("icon-play",Wm);ei("icon-replay",jm);ei("icon-caption-inactive",qm);ei("icon-caption-active",Xm);ei("icon-ad-inactive",$m);ei("icon-ad-hover",Ym);ei("icon-ad-active",Zm);ei("icon-ad-pause",Km);ei("icon-ad-pause-hover",Qm);ei("icon-hamburger",Jm);ei("icon-chevron-large",eg);ei("icon-manual",tg);ei("icon-cinema",ig);ei("icon-info",ng);ei("icon-back",sg);ei("icon-camera",ag);ei("icon-text-overlay",lg);ei("icon-letter-flip",rg);ei("icon-letter-flip-back",og);ei("award-aaa",cg);ei("award-agda",hg);ei("award-c2",ug);ei("award-gd",dg);ei("award-him",fg);ei("award-vpda",pg);ei("award-w3",mg);document.getElementById("favicon-link").href=Fm;const gg="modulepreload",yg=function(o){return"/mouthful-of-dust/"+o},cu={},ep=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));n=Promise.all(t.map(r=>{if(r=yg(r),r in cu)return;cu[r]=!0;const l=r.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${c}`))return;const h=document.createElement("link");if(h.rel=l?"stylesheet":gg,l||(h.as="script",h.crossOrigin=""),h.href=r,a&&h.setAttribute("nonce",a),document.head.appendChild(h),l)return new Promise((d,f)=>{h.addEventListener("load",d),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})}))}return n.then(()=>e()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Oh="164",ir={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},nr={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},vg=0,hu=1,bg=2,tp=1,wg=2,Os=3,zn=0,hn=1,Ai=2,Vs=0,Cr=1,uu=2,du=3,fu=4,_g=5,Ba=100,Mg=101,xg=102,Sg=103,Ag=104,Tg=200,Eg=201,Cg=202,Pg=203,ph=204,mh=205,kg=206,Ig=207,Lg=208,Rg=209,Dg=210,Fg=211,Og=212,Ug=213,Ng=214,Bg=0,zg=1,Vg=2,Ll=3,Hg=4,Gg=5,Wg=6,jg=7,ip=0,qg=1,Xg=2,pa=0,np=1,sp=2,ap=3,Rl=4,$g=5,rp=6,op=7,pu="attached",Yg="detached",lp=300,Fr=301,Or=302,Dl=303,gh=304,Kl=306,Ur=1e3,ws=1001,Fl=1002,ln=1003,cp=1004,uo=1005,wi=1006,El=1007,is=1008,ma=1009,Zg=1010,Kg=1011,hp=1012,up=1013,Nr=1014,Tn=1015,Bs=1016,dp=1017,fp=1018,Po=1020,Qg=35902,Jg=1021,e0=1022,Bn=1023,t0=1024,i0=1025,Pr=1026,So=1027,pp=1028,mp=1029,n0=1030,gp=1031,yp=1033,uc=33776,dc=33777,fc=33778,pc=33779,mu=35840,gu=35841,yu=35842,vu=35843,bu=36196,wu=37492,_u=37496,Mu=37808,xu=37809,Su=37810,Au=37811,Tu=37812,Eu=37813,Cu=37814,Pu=37815,ku=37816,Iu=37817,Lu=37818,Ru=37819,Du=37820,Fu=37821,mc=36492,Ou=36494,Uu=36495,s0=36283,Nu=36284,Bu=36285,zu=36286,Cl=2200,a0=2201,r0=2202,Ao=2300,Br=2301,gc=2302,Sr=2400,Ar=2401,Ol=2402,Uh=2500,o0=2501,l0=0,vp=1,yh=2,c0=3200,bp=3201,wp=0,h0=1,da="",rn="srgb",Vi="srgb-linear",Nh="display-p3",Ql="display-p3-linear",Ul="linear",yi="srgb",Nl="rec709",Bl="p3",sr=7680,Vu=519,u0=512,d0=513,f0=514,_p=515,p0=516,m0=517,g0=518,y0=519,vh=35044,US=35048,Hu="300 es",zs=2e3,zl=2001;class ya{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const s=n.indexOf(t);s!==-1&&n.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const n=i.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,e);e.target=null}}}const Yi=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Gu=1234567;const kr=Math.PI/180,zr=180/Math.PI;function ss(){const o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Yi[o&255]+Yi[o>>8&255]+Yi[o>>16&255]+Yi[o>>24&255]+"-"+Yi[e&255]+Yi[e>>8&255]+"-"+Yi[e>>16&15|64]+Yi[e>>24&255]+"-"+Yi[t&63|128]+Yi[t>>8&255]+"-"+Yi[t>>16&255]+Yi[t>>24&255]+Yi[i&255]+Yi[i>>8&255]+Yi[i>>16&255]+Yi[i>>24&255]).toLowerCase()}function Ti(o,e,t){return Math.max(e,Math.min(t,o))}function Bh(o,e){return(o%e+e)%e}function v0(o,e,t,i,n){return i+(o-e)*(n-i)/(t-e)}function b0(o,e,t){return o!==e?(t-o)/(e-o):0}function go(o,e,t){return(1-t)*o+t*e}function w0(o,e,t,i){return go(o,e,1-Math.exp(-t*i))}function _0(o,e=1){return e-Math.abs(Bh(o,e*2)-e)}function M0(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*(3-2*o))}function x0(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*o*(o*(o*6-15)+10))}function S0(o,e){return o+Math.floor(Math.random()*(e-o+1))}function A0(o,e){return o+Math.random()*(e-o)}function T0(o){return o*(.5-Math.random())}function E0(o){o!==void 0&&(Gu=o);let e=Gu+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function C0(o){return o*kr}function P0(o){return o*zr}function k0(o){return(o&o-1)===0&&o!==0}function I0(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function L0(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function R0(o,e,t,i,n){const s=Math.cos,a=Math.sin,r=s(t/2),l=a(t/2),c=s((e+i)/2),h=a((e+i)/2),d=s((e-i)/2),f=a((e-i)/2),p=s((i-e)/2),b=a((i-e)/2);switch(n){case"XYX":o.set(r*h,l*d,l*f,r*c);break;case"YZY":o.set(l*f,r*h,l*d,r*c);break;case"ZXZ":o.set(l*d,l*f,r*h,r*c);break;case"XZX":o.set(r*h,l*b,l*p,r*c);break;case"YXY":o.set(l*p,r*h,l*b,r*c);break;case"ZYZ":o.set(l*b,l*p,r*h,r*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function ts(o,e){switch(e.constructor){case Float32Array:return o;case Uint32Array:return o/4294967295;case Uint16Array:return o/65535;case Uint8Array:return o/255;case Int32Array:return Math.max(o/2147483647,-1);case Int16Array:return Math.max(o/32767,-1);case Int8Array:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}function hi(o,e){switch(e.constructor){case Float32Array:return o;case Uint32Array:return Math.round(o*4294967295);case Uint16Array:return Math.round(o*65535);case Uint8Array:return Math.round(o*255);case Int32Array:return Math.round(o*2147483647);case Int16Array:return Math.round(o*32767);case Int8Array:return Math.round(o*127);default:throw new Error("Invalid component type.")}}const Et={DEG2RAD:kr,RAD2DEG:zr,generateUUID:ss,clamp:Ti,euclideanModulo:Bh,mapLinear:v0,inverseLerp:b0,lerp:go,damp:w0,pingpong:_0,smoothstep:M0,smootherstep:x0,randInt:S0,randFloat:A0,randFloatSpread:T0,seededRandom:E0,degToRad:C0,radToDeg:P0,isPowerOfTwo:k0,ceilPowerOfTwo:I0,floorPowerOfTwo:L0,setQuaternionFromProperEuler:R0,normalize:hi,denormalize:ts};class et{constructor(e=0,t=0){et.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ti(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*i-a*n+e.x,this.y=s*n+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Wt{constructor(e,t,i,n,s,a,r,l,c){Wt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,n,s,a,r,l,c)}set(e,t,i,n,s,a,r,l,c){const h=this.elements;return h[0]=e,h[1]=n,h[2]=r,h[3]=t,h[4]=s,h[5]=l,h[6]=i,h[7]=a,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,a=i[0],r=i[3],l=i[6],c=i[1],h=i[4],d=i[7],f=i[2],p=i[5],b=i[8],_=n[0],y=n[3],v=n[6],S=n[1],A=n[4],E=n[7],O=n[2],R=n[5],k=n[8];return s[0]=a*_+r*S+l*O,s[3]=a*y+r*A+l*R,s[6]=a*v+r*E+l*k,s[1]=c*_+h*S+d*O,s[4]=c*y+h*A+d*R,s[7]=c*v+h*E+d*k,s[2]=f*_+p*S+b*O,s[5]=f*y+p*A+b*R,s[8]=f*v+p*E+b*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],r=e[5],l=e[6],c=e[7],h=e[8];return t*a*h-t*r*c-i*s*h+i*r*l+n*s*c-n*a*l}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],r=e[5],l=e[6],c=e[7],h=e[8],d=h*a-r*c,f=r*l-h*s,p=c*s-a*l,b=t*d+i*f+n*p;if(b===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/b;return e[0]=d*_,e[1]=(n*c-h*i)*_,e[2]=(r*i-n*a)*_,e[3]=f*_,e[4]=(h*t-n*l)*_,e[5]=(n*s-r*t)*_,e[6]=p*_,e[7]=(i*l-c*t)*_,e[8]=(a*t-i*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,s,a,r){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*a+c*r)+a+e,-n*c,n*l,-n*(-c*a+l*r)+r+t,0,0,1),this}scale(e,t){return this.premultiply(yc.makeScale(e,t)),this}rotate(e){return this.premultiply(yc.makeRotation(-e)),this}translate(e,t){return this.premultiply(yc.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const yc=new Wt;function Mp(o){for(let e=o.length-1;e>=0;--e)if(o[e]>=65535)return!0;return!1}function To(o){return document.createElementNS("http://www.w3.org/1999/xhtml",o)}function D0(){const o=To("canvas");return o.style.display="block",o}const Wu={};function xp(o){o in Wu||(Wu[o]=!0,console.warn(o))}const ju=new Wt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),qu=new Wt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),zo={[Vi]:{transfer:Ul,primaries:Nl,toReference:o=>o,fromReference:o=>o},[rn]:{transfer:yi,primaries:Nl,toReference:o=>o.convertSRGBToLinear(),fromReference:o=>o.convertLinearToSRGB()},[Ql]:{transfer:Ul,primaries:Bl,toReference:o=>o.applyMatrix3(qu),fromReference:o=>o.applyMatrix3(ju)},[Nh]:{transfer:yi,primaries:Bl,toReference:o=>o.convertSRGBToLinear().applyMatrix3(qu),fromReference:o=>o.applyMatrix3(ju).convertLinearToSRGB()}},F0=new Set([Vi,Ql]),si={enabled:!0,_workingColorSpace:Vi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(o){if(!F0.has(o))throw new Error(`Unsupported working color space, "${o}".`);this._workingColorSpace=o},convert:function(o,e,t){if(this.enabled===!1||e===t||!e||!t)return o;const i=zo[e].toReference,n=zo[t].fromReference;return n(i(o))},fromWorkingColorSpace:function(o,e){return this.convert(o,this._workingColorSpace,e)},toWorkingColorSpace:function(o,e){return this.convert(o,e,this._workingColorSpace)},getPrimaries:function(o){return zo[o].primaries},getTransfer:function(o){return o===da?Ul:zo[o].transfer}};function Ir(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function vc(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}let ar;class O0{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{ar===void 0&&(ar=To("canvas")),ar.width=e.width,ar.height=e.height;const i=ar.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=ar}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=To("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const n=i.getImageData(0,0,e.width,e.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=Ir(s[a]/255)*255;return i.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Ir(t[i]/255)*255):t[i]=Ir(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let U0=0;class Sp{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:U0++}),this.uuid=ss(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,r=n.length;a<r;a++)n[a].isDataTexture?s.push(bc(n[a].image)):s.push(bc(n[a]))}else s=bc(n);i.url=s}return t||(e.images[this.uuid]=i),i}}function bc(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?O0.getDataURL(o):o.data?{data:Array.from(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let N0=0;class Fi extends ya{constructor(e=Fi.DEFAULT_IMAGE,t=Fi.DEFAULT_MAPPING,i=ws,n=ws,s=wi,a=is,r=Bn,l=ma,c=Fi.DEFAULT_ANISOTROPY,h=da){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:N0++}),this.uuid=ss(),this.name="",this.source=new Sp(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=r,this.internalFormat=null,this.type=l,this.offset=new et(0,0),this.repeat=new et(1,1),this.center=new et(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lp)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ur:e.x=e.x-Math.floor(e.x);break;case ws:e.x=e.x<0?0:1;break;case Fl:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ur:e.y=e.y-Math.floor(e.y);break;case ws:e.y=e.y<0?0:1;break;case Fl:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Fi.DEFAULT_IMAGE=null;Fi.DEFAULT_MAPPING=lp;Fi.DEFAULT_ANISOTROPY=1;class ui{constructor(e=0,t=0,i=0,n=1){ui.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*n+a[12]*s,this.y=a[1]*t+a[5]*i+a[9]*n+a[13]*s,this.z=a[2]*t+a[6]*i+a[10]*n+a[14]*s,this.w=a[3]*t+a[7]*i+a[11]*n+a[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,s;const l=e.elements,c=l[0],h=l[4],d=l[8],f=l[1],p=l[5],b=l[9],_=l[2],y=l[6],v=l[10];if(Math.abs(h-f)<.01&&Math.abs(d-_)<.01&&Math.abs(b-y)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+_)<.1&&Math.abs(b+y)<.1&&Math.abs(c+p+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const A=(c+1)/2,E=(p+1)/2,O=(v+1)/2,R=(h+f)/4,k=(d+_)/4,U=(b+y)/4;return A>E&&A>O?A<.01?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(A),n=R/i,s=k/i):E>O?E<.01?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(E),i=R/n,s=U/n):O<.01?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(O),i=k/s,n=U/s),this.set(i,n,s,t),this}let S=Math.sqrt((y-b)*(y-b)+(d-_)*(d-_)+(f-h)*(f-h));return Math.abs(S)<.001&&(S=1),this.x=(y-b)/S,this.y=(d-_)/S,this.z=(f-h)/S,this.w=Math.acos((c+p+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class B0 extends ya{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ui(0,0,e,t),this.scissorTest=!1,this.viewport=new ui(0,0,e,t);const n={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:wi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Fi(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const a=i.count;for(let r=0;r<a;r++)this.textures[r]=s.clone(),this.textures[r].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=e,this.textures[n].image.height=t,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,n=e.textures.length;i<n;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Sp(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Hs extends B0{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class Ap extends Fi{constructor(e=null,t=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=ln,this.minFilter=ln,this.wrapR=ws,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class z0 extends Fi{constructor(e=null,t=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=ln,this.minFilter=ln,this.wrapR=ws,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ai{constructor(e=0,t=0,i=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,s,a,r){let l=i[n+0],c=i[n+1],h=i[n+2],d=i[n+3];const f=s[a+0],p=s[a+1],b=s[a+2],_=s[a+3];if(r===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(r===1){e[t+0]=f,e[t+1]=p,e[t+2]=b,e[t+3]=_;return}if(d!==_||l!==f||c!==p||h!==b){let y=1-r;const v=l*f+c*p+h*b+d*_,S=v>=0?1:-1,A=1-v*v;if(A>Number.EPSILON){const O=Math.sqrt(A),R=Math.atan2(O,v*S);y=Math.sin(y*R)/O,r=Math.sin(r*R)/O}const E=r*S;if(l=l*y+f*E,c=c*y+p*E,h=h*y+b*E,d=d*y+_*E,y===1-r){const O=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=O,c*=O,h*=O,d*=O}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,n,s,a){const r=i[n],l=i[n+1],c=i[n+2],h=i[n+3],d=s[a],f=s[a+1],p=s[a+2],b=s[a+3];return e[t]=r*b+h*d+l*p-c*f,e[t+1]=l*b+h*f+c*d-r*p,e[t+2]=c*b+h*p+r*f-l*d,e[t+3]=h*b-r*d-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,n=e._y,s=e._z,a=e._order,r=Math.cos,l=Math.sin,c=r(i/2),h=r(n/2),d=r(s/2),f=l(i/2),p=l(n/2),b=l(s/2);switch(a){case"XYZ":this._x=f*h*d+c*p*b,this._y=c*p*d-f*h*b,this._z=c*h*b+f*p*d,this._w=c*h*d-f*p*b;break;case"YXZ":this._x=f*h*d+c*p*b,this._y=c*p*d-f*h*b,this._z=c*h*b-f*p*d,this._w=c*h*d+f*p*b;break;case"ZXY":this._x=f*h*d-c*p*b,this._y=c*p*d+f*h*b,this._z=c*h*b+f*p*d,this._w=c*h*d-f*p*b;break;case"ZYX":this._x=f*h*d-c*p*b,this._y=c*p*d+f*h*b,this._z=c*h*b-f*p*d,this._w=c*h*d+f*p*b;break;case"YZX":this._x=f*h*d+c*p*b,this._y=c*p*d+f*h*b,this._z=c*h*b-f*p*d,this._w=c*h*d-f*p*b;break;case"XZY":this._x=f*h*d-c*p*b,this._y=c*p*d-f*h*b,this._z=c*h*b+f*p*d,this._w=c*h*d+f*p*b;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],s=t[8],a=t[1],r=t[5],l=t[9],c=t[2],h=t[6],d=t[10],f=i+r+d;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-l)*p,this._y=(s-c)*p,this._z=(a-n)*p}else if(i>r&&i>d){const p=2*Math.sqrt(1+i-r-d);this._w=(h-l)/p,this._x=.25*p,this._y=(n+a)/p,this._z=(s+c)/p}else if(r>d){const p=2*Math.sqrt(1+r-i-d);this._w=(s-c)/p,this._x=(n+a)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+d-i-r);this._w=(a-n)/p,this._x=(s+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ti(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,s=e._z,a=e._w,r=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+a*r+n*c-s*l,this._y=n*h+a*l+s*r-i*c,this._z=s*h+a*c+i*l-n*r,this._w=a*h-i*r-n*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,n=this._y,s=this._z,a=this._w;let r=a*e._w+i*e._x+n*e._y+s*e._z;if(r<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,r=-r):this.copy(e),r>=1)return this._w=a,this._x=i,this._y=n,this._z=s,this;const l=1-r*r;if(l<=Number.EPSILON){const p=1-t;return this._w=p*a+t*this._w,this._x=p*i+t*this._x,this._y=p*n+t*this._y,this._z=p*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,r),d=Math.sin((1-t)*h)/c,f=Math.sin(t*h)/c;return this._w=a*d+this._w*f,this._x=i*d+this._x*f,this._y=n*d+this._y*f,this._z=s*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(n*Math.sin(e),n*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class D{constructor(e=0,t=0,i=0){D.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Xu.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Xu.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*n,this.y=s[1]*t+s[4]*i+s[7]*n,this.z=s[2]*t+s[5]*i+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=e.elements,a=1/(s[3]*t+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*n+s[12])*a,this.y=(s[1]*t+s[5]*i+s[9]*n+s[13])*a,this.z=(s[2]*t+s[6]*i+s[10]*n+s[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,s=e.x,a=e.y,r=e.z,l=e.w,c=2*(a*n-r*i),h=2*(r*t-s*n),d=2*(s*i-a*t);return this.x=t+l*c+a*d-r*h,this.y=i+l*h+r*c-s*d,this.z=n+l*d+s*h-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n,this.y=s[1]*t+s[5]*i+s[9]*n,this.z=s[2]*t+s[6]*i+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,s=e.z,a=t.x,r=t.y,l=t.z;return this.x=n*l-s*r,this.y=s*a-i*l,this.z=i*r-n*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return wc.copy(this).projectOnVector(e),this.sub(wc)}reflect(e){return this.sub(wc.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Ti(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const wc=new D,Xu=new ai;class Hn{constructor(e=new D(1/0,1/0,1/0),t=new D(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Qn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Qn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Qn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,r=s.count;a<r;a++)e.isMesh===!0?e.getVertexPosition(a,Qn):Qn.fromBufferAttribute(s,a),Qn.applyMatrix4(e.matrixWorld),this.expandByPoint(Qn);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Vo.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Vo.copy(i.boundingBox)),Vo.applyMatrix4(e.matrixWorld),this.union(Vo)}const n=e.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Qn),Qn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(to),Ho.subVectors(this.max,to),rr.subVectors(e.a,to),or.subVectors(e.b,to),lr.subVectors(e.c,to),ea.subVectors(or,rr),ta.subVectors(lr,or),Pa.subVectors(rr,lr);let t=[0,-ea.z,ea.y,0,-ta.z,ta.y,0,-Pa.z,Pa.y,ea.z,0,-ea.x,ta.z,0,-ta.x,Pa.z,0,-Pa.x,-ea.y,ea.x,0,-ta.y,ta.x,0,-Pa.y,Pa.x,0];return!_c(t,rr,or,lr,Ho)||(t=[1,0,0,0,1,0,0,0,1],!_c(t,rr,or,lr,Ho))?!1:(Go.crossVectors(ea,ta),t=[Go.x,Go.y,Go.z],_c(t,rr,or,lr,Ho))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Qn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Qn).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ks[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ks[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ks[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ks[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ks[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ks[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ks[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ks[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ks),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ks=[new D,new D,new D,new D,new D,new D,new D,new D],Qn=new D,Vo=new Hn,rr=new D,or=new D,lr=new D,ea=new D,ta=new D,Pa=new D,to=new D,Ho=new D,Go=new D,ka=new D;function _c(o,e,t,i,n){for(let s=0,a=o.length-3;s<=a;s+=3){ka.fromArray(o,s);const r=n.x*Math.abs(ka.x)+n.y*Math.abs(ka.y)+n.z*Math.abs(ka.z),l=e.dot(ka),c=t.dot(ka),h=i.dot(ka);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>r)return!1}return!0}const V0=new Hn,io=new D,Mc=new D;class rs{constructor(e=new D,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):V0.setFromPoints(e).getCenter(i);let n=0;for(let s=0,a=e.length;s<a;s++)n=Math.max(n,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;io.subVectors(e,this.center);const t=io.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),n=(i-this.radius)*.5;this.center.addScaledVector(io,n/i),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Mc.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(io.copy(e.center).add(Mc)),this.expandByPoint(io.copy(e.center).sub(Mc))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Is=new D,xc=new D,Wo=new D,ia=new D,Sc=new D,jo=new D,Ac=new D;class _s{constructor(e=new D,t=new D(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Is)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Is.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Is.copy(this.origin).addScaledVector(this.direction,t),Is.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){xc.copy(e).add(t).multiplyScalar(.5),Wo.copy(t).sub(e).normalize(),ia.copy(this.origin).sub(xc);const s=e.distanceTo(t)*.5,a=-this.direction.dot(Wo),r=ia.dot(this.direction),l=-ia.dot(Wo),c=ia.lengthSq(),h=Math.abs(1-a*a);let d,f,p,b;if(h>0)if(d=a*l-r,f=a*r-l,b=s*h,d>=0)if(f>=-b)if(f<=b){const _=1/h;d*=_,f*=_,p=d*(d+a*f+2*r)+f*(a*d+f+2*l)+c}else f=s,d=Math.max(0,-(a*f+r)),p=-d*d+f*(f+2*l)+c;else f=-s,d=Math.max(0,-(a*f+r)),p=-d*d+f*(f+2*l)+c;else f<=-b?(d=Math.max(0,-(-a*s+r)),f=d>0?-s:Math.min(Math.max(-s,-l),s),p=-d*d+f*(f+2*l)+c):f<=b?(d=0,f=Math.min(Math.max(-s,-l),s),p=f*(f+2*l)+c):(d=Math.max(0,-(a*s+r)),f=d>0?s:Math.min(Math.max(-s,-l),s),p=-d*d+f*(f+2*l)+c);else f=a>0?-s:s,d=Math.max(0,-(a*f+r)),p=-d*d+f*(f+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,d),n&&n.copy(xc).addScaledVector(Wo,f),p}intersectSphere(e,t){Is.subVectors(e.center,this.origin);const i=Is.dot(this.direction),n=Is.dot(Is)-i*i,s=e.radius*e.radius;if(n>s)return null;const a=Math.sqrt(s-n),r=i-a,l=i+a;return l<0?null:r<0?this.at(l,t):this.at(r,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,s,a,r,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,f=this.origin;return c>=0?(i=(e.min.x-f.x)*c,n=(e.max.x-f.x)*c):(i=(e.max.x-f.x)*c,n=(e.min.x-f.x)*c),h>=0?(s=(e.min.y-f.y)*h,a=(e.max.y-f.y)*h):(s=(e.max.y-f.y)*h,a=(e.min.y-f.y)*h),i>a||s>n||((s>i||isNaN(i))&&(i=s),(a<n||isNaN(n))&&(n=a),d>=0?(r=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(r=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),i>l||r>n)||((r>i||i!==i)&&(i=r),(l<n||n!==n)&&(n=l),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return this.intersectBox(e,Is)!==null}intersectTriangle(e,t,i,n,s){Sc.subVectors(t,e),jo.subVectors(i,e),Ac.crossVectors(Sc,jo);let a=this.direction.dot(Ac),r;if(a>0){if(n)return null;r=1}else if(a<0)r=-1,a=-a;else return null;ia.subVectors(this.origin,e);const l=r*this.direction.dot(jo.crossVectors(ia,jo));if(l<0)return null;const c=r*this.direction.dot(Sc.cross(ia));if(c<0||l+c>a)return null;const h=-r*ia.dot(Ac);return h<0?null:this.at(h/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ft{constructor(e,t,i,n,s,a,r,l,c,h,d,f,p,b,_,y){Ft.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,n,s,a,r,l,c,h,d,f,p,b,_,y)}set(e,t,i,n,s,a,r,l,c,h,d,f,p,b,_,y){const v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=n,v[1]=s,v[5]=a,v[9]=r,v[13]=l,v[2]=c,v[6]=h,v[10]=d,v[14]=f,v[3]=p,v[7]=b,v[11]=_,v[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ft().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/cr.setFromMatrixColumn(e,0).length(),s=1/cr.setFromMatrixColumn(e,1).length(),a=1/cr.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,n=e.y,s=e.z,a=Math.cos(i),r=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(s),d=Math.sin(s);if(e.order==="XYZ"){const f=a*h,p=a*d,b=r*h,_=r*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=p+b*c,t[5]=f-_*c,t[9]=-r*l,t[2]=_-f*c,t[6]=b+p*c,t[10]=a*l}else if(e.order==="YXZ"){const f=l*h,p=l*d,b=c*h,_=c*d;t[0]=f+_*r,t[4]=b*r-p,t[8]=a*c,t[1]=a*d,t[5]=a*h,t[9]=-r,t[2]=p*r-b,t[6]=_+f*r,t[10]=a*l}else if(e.order==="ZXY"){const f=l*h,p=l*d,b=c*h,_=c*d;t[0]=f-_*r,t[4]=-a*d,t[8]=b+p*r,t[1]=p+b*r,t[5]=a*h,t[9]=_-f*r,t[2]=-a*c,t[6]=r,t[10]=a*l}else if(e.order==="ZYX"){const f=a*h,p=a*d,b=r*h,_=r*d;t[0]=l*h,t[4]=b*c-p,t[8]=f*c+_,t[1]=l*d,t[5]=_*c+f,t[9]=p*c-b,t[2]=-c,t[6]=r*l,t[10]=a*l}else if(e.order==="YZX"){const f=a*l,p=a*c,b=r*l,_=r*c;t[0]=l*h,t[4]=_-f*d,t[8]=b*d+p,t[1]=d,t[5]=a*h,t[9]=-r*h,t[2]=-c*h,t[6]=p*d+b,t[10]=f-_*d}else if(e.order==="XZY"){const f=a*l,p=a*c,b=r*l,_=r*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=f*d+_,t[5]=a*h,t[9]=p*d-b,t[2]=b*d-p,t[6]=r*h,t[10]=_*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(H0,e,G0)}lookAt(e,t,i){const n=this.elements;return wn.subVectors(e,t),wn.lengthSq()===0&&(wn.z=1),wn.normalize(),na.crossVectors(i,wn),na.lengthSq()===0&&(Math.abs(i.z)===1?wn.x+=1e-4:wn.z+=1e-4,wn.normalize(),na.crossVectors(i,wn)),na.normalize(),qo.crossVectors(wn,na),n[0]=na.x,n[4]=qo.x,n[8]=wn.x,n[1]=na.y,n[5]=qo.y,n[9]=wn.y,n[2]=na.z,n[6]=qo.z,n[10]=wn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,a=i[0],r=i[4],l=i[8],c=i[12],h=i[1],d=i[5],f=i[9],p=i[13],b=i[2],_=i[6],y=i[10],v=i[14],S=i[3],A=i[7],E=i[11],O=i[15],R=n[0],k=n[4],U=n[8],C=n[12],T=n[1],Z=n[5],z=n[9],B=n[13],V=n[2],Y=n[6],J=n[10],Te=n[14],ge=n[3],fe=n[7],he=n[11],Q=n[15];return s[0]=a*R+r*T+l*V+c*ge,s[4]=a*k+r*Z+l*Y+c*fe,s[8]=a*U+r*z+l*J+c*he,s[12]=a*C+r*B+l*Te+c*Q,s[1]=h*R+d*T+f*V+p*ge,s[5]=h*k+d*Z+f*Y+p*fe,s[9]=h*U+d*z+f*J+p*he,s[13]=h*C+d*B+f*Te+p*Q,s[2]=b*R+_*T+y*V+v*ge,s[6]=b*k+_*Z+y*Y+v*fe,s[10]=b*U+_*z+y*J+v*he,s[14]=b*C+_*B+y*Te+v*Q,s[3]=S*R+A*T+E*V+O*ge,s[7]=S*k+A*Z+E*Y+O*fe,s[11]=S*U+A*z+E*J+O*he,s[15]=S*C+A*B+E*Te+O*Q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],s=e[12],a=e[1],r=e[5],l=e[9],c=e[13],h=e[2],d=e[6],f=e[10],p=e[14],b=e[3],_=e[7],y=e[11],v=e[15];return b*(+s*l*d-n*c*d-s*r*f+i*c*f+n*r*p-i*l*p)+_*(+t*l*p-t*c*f+s*a*f-n*a*p+n*c*h-s*l*h)+y*(+t*c*d-t*r*p-s*a*d+i*a*p+s*r*h-i*c*h)+v*(-n*r*h-t*l*d+t*r*f+n*a*d-i*a*f+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],a=e[4],r=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],b=e[12],_=e[13],y=e[14],v=e[15],S=d*y*c-_*f*c+_*l*p-r*y*p-d*l*v+r*f*v,A=b*f*c-h*y*c-b*l*p+a*y*p+h*l*v-a*f*v,E=h*_*c-b*d*c+b*r*p-a*_*p-h*r*v+a*d*v,O=b*d*l-h*_*l-b*r*f+a*_*f+h*r*y-a*d*y,R=t*S+i*A+n*E+s*O;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const k=1/R;return e[0]=S*k,e[1]=(_*f*s-d*y*s-_*n*p+i*y*p+d*n*v-i*f*v)*k,e[2]=(r*y*s-_*l*s+_*n*c-i*y*c-r*n*v+i*l*v)*k,e[3]=(d*l*s-r*f*s-d*n*c+i*f*c+r*n*p-i*l*p)*k,e[4]=A*k,e[5]=(h*y*s-b*f*s+b*n*p-t*y*p-h*n*v+t*f*v)*k,e[6]=(b*l*s-a*y*s-b*n*c+t*y*c+a*n*v-t*l*v)*k,e[7]=(a*f*s-h*l*s+h*n*c-t*f*c-a*n*p+t*l*p)*k,e[8]=E*k,e[9]=(b*d*s-h*_*s-b*i*p+t*_*p+h*i*v-t*d*v)*k,e[10]=(a*_*s-b*r*s+b*i*c-t*_*c-a*i*v+t*r*v)*k,e[11]=(h*r*s-a*d*s-h*i*c+t*d*c+a*i*p-t*r*p)*k,e[12]=O*k,e[13]=(h*_*n-b*d*n+b*i*f-t*_*f-h*i*y+t*d*y)*k,e[14]=(b*r*n-a*_*n-b*i*l+t*_*l+a*i*y-t*r*y)*k,e[15]=(a*d*n-h*r*n+h*i*l-t*d*l-a*i*f+t*r*f)*k,this}scale(e){const t=this.elements,i=e.x,n=e.y,s=e.z;return t[0]*=i,t[4]*=n,t[8]*=s,t[1]*=i,t[5]*=n,t[9]*=s,t[2]*=i,t[6]*=n,t[10]*=s,t[3]*=i,t[7]*=n,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),s=1-i,a=e.x,r=e.y,l=e.z,c=s*a,h=s*r;return this.set(c*a+i,c*r-n*l,c*l+n*r,0,c*r+n*l,h*r+i,h*l-n*a,0,c*l-n*r,h*l+n*a,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,s,a){return this.set(1,i,s,0,e,1,a,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,s=t._x,a=t._y,r=t._z,l=t._w,c=s+s,h=a+a,d=r+r,f=s*c,p=s*h,b=s*d,_=a*h,y=a*d,v=r*d,S=l*c,A=l*h,E=l*d,O=i.x,R=i.y,k=i.z;return n[0]=(1-(_+v))*O,n[1]=(p+E)*O,n[2]=(b-A)*O,n[3]=0,n[4]=(p-E)*R,n[5]=(1-(f+v))*R,n[6]=(y+S)*R,n[7]=0,n[8]=(b+A)*k,n[9]=(y-S)*k,n[10]=(1-(f+_))*k,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let s=cr.set(n[0],n[1],n[2]).length();const a=cr.set(n[4],n[5],n[6]).length(),r=cr.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],Jn.copy(this);const c=1/s,h=1/a,d=1/r;return Jn.elements[0]*=c,Jn.elements[1]*=c,Jn.elements[2]*=c,Jn.elements[4]*=h,Jn.elements[5]*=h,Jn.elements[6]*=h,Jn.elements[8]*=d,Jn.elements[9]*=d,Jn.elements[10]*=d,t.setFromRotationMatrix(Jn),i.x=s,i.y=a,i.z=r,this}makePerspective(e,t,i,n,s,a,r=zs){const l=this.elements,c=2*s/(t-e),h=2*s/(i-n),d=(t+e)/(t-e),f=(i+n)/(i-n);let p,b;if(r===zs)p=-(a+s)/(a-s),b=-2*a*s/(a-s);else if(r===zl)p=-a/(a-s),b=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+r);return l[0]=c,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=h,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=b,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,n,s,a,r=zs){const l=this.elements,c=1/(t-e),h=1/(i-n),d=1/(a-s),f=(t+e)*c,p=(i+n)*h;let b,_;if(r===zs)b=(a+s)*d,_=-2*d;else if(r===zl)b=s*d,_=-1*d;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+r);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=_,l[14]=-b,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const cr=new D,Jn=new Ft,H0=new D(0,0,0),G0=new D(1,1,1),na=new D,qo=new D,wn=new D,$u=new Ft,Yu=new ai;class vn{constructor(e=0,t=0,i=0,n=vn.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,s=n[0],a=n[4],r=n[8],l=n[1],c=n[5],h=n[9],d=n[2],f=n[6],p=n[10];switch(t){case"XYZ":this._y=Math.asin(Ti(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ti(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(r,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ti(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Ti(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Ti(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(r,p));break;case"XZY":this._z=Math.asin(-Ti(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(r,s)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return $u.makeRotationFromQuaternion(e),this.setFromRotationMatrix($u,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Yu.setFromEuler(this),this.setFromQuaternion(Yu,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vn.DEFAULT_ORDER="XYZ";class zh{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let W0=0;const Zu=new D,hr=new ai,Ls=new Ft,Xo=new D,no=new D,j0=new D,q0=new ai,Ku=new D(1,0,0),Qu=new D(0,1,0),Ju=new D(0,0,1),ed={type:"added"},X0={type:"removed"},ur={type:"childadded",child:null},Tc={type:"childremoved",child:null};class ri extends ya{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:W0++}),this.uuid=ss(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ri.DEFAULT_UP.clone();const e=new D,t=new vn,i=new ai,n=new D(1,1,1);function s(){i.setFromEuler(t,!1)}function a(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Ft},normalMatrix:{value:new Wt}}),this.matrix=new Ft,this.matrixWorld=new Ft,this.matrixAutoUpdate=ri.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ri.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new zh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return hr.setFromAxisAngle(e,t),this.quaternion.multiply(hr),this}rotateOnWorldAxis(e,t){return hr.setFromAxisAngle(e,t),this.quaternion.premultiply(hr),this}rotateX(e){return this.rotateOnAxis(Ku,e)}rotateY(e){return this.rotateOnAxis(Qu,e)}rotateZ(e){return this.rotateOnAxis(Ju,e)}translateOnAxis(e,t){return Zu.copy(e).applyQuaternion(this.quaternion),this.position.add(Zu.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Ku,e)}translateY(e){return this.translateOnAxis(Qu,e)}translateZ(e){return this.translateOnAxis(Ju,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ls.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Xo.copy(e):Xo.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),no.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ls.lookAt(no,Xo,this.up):Ls.lookAt(Xo,no,this.up),this.quaternion.setFromRotationMatrix(Ls),n&&(Ls.extractRotation(n.matrixWorld),hr.setFromRotationMatrix(Ls),this.quaternion.premultiply(hr.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(ed),ur.child=e,this.dispatchEvent(ur),ur.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(X0),Tc.child=e,this.dispatchEvent(Tc),Tc.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ls.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ls.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ls),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(ed),ur.child=e,this.dispatchEvent(ur),ur.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const a=this.children[i].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(no,e,j0),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(no,q0,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++){const s=t[i];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const r=n[s];r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(r=>({boxInitialized:r.boxInitialized,boxMin:r.box.min.toArray(),boxMax:r.box.max.toArray(),sphereInitialized:r.sphereInitialized,sphereRadius:r.sphere.radius,sphereCenter:r.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(r,l){return r[l.uuid]===void 0&&(r[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const r=this.geometry.parameters;if(r!==void 0&&r.shapes!==void 0){const l=r.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const d=l[c];s(e.shapes,d)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const r=[];for(let l=0,c=this.material.length;l<c;l++)r.push(s(e.materials,this.material[l]));n.material=r}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let r=0;r<this.children.length;r++)n.children.push(this.children[r].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let r=0;r<this.animations.length;r++){const l=this.animations[r];n.animations.push(s(e.animations,l))}}if(t){const r=a(e.geometries),l=a(e.materials),c=a(e.textures),h=a(e.images),d=a(e.shapes),f=a(e.skeletons),p=a(e.animations),b=a(e.nodes);r.length>0&&(i.geometries=r),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),f.length>0&&(i.skeletons=f),p.length>0&&(i.animations=p),b.length>0&&(i.nodes=b)}return i.object=n,i;function a(r){const l=[];for(const c in r){const h=r[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const n=e.children[i];this.add(n.clone())}return this}}ri.DEFAULT_UP=new D(0,1,0);ri.DEFAULT_MATRIX_AUTO_UPDATE=!0;ri.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const es=new D,Rs=new D,Ec=new D,Ds=new D,dr=new D,fr=new D,td=new D,Cc=new D,Pc=new D,kc=new D;class On{constructor(e=new D,t=new D,i=new D){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),es.subVectors(e,t),n.cross(es);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(e,t,i,n,s){es.subVectors(n,t),Rs.subVectors(i,t),Ec.subVectors(e,t);const a=es.dot(es),r=es.dot(Rs),l=es.dot(Ec),c=Rs.dot(Rs),h=Rs.dot(Ec),d=a*c-r*r;if(d===0)return s.set(0,0,0),null;const f=1/d,p=(c*l-r*h)*f,b=(a*h-r*l)*f;return s.set(1-p-b,b,p)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,Ds)===null?!1:Ds.x>=0&&Ds.y>=0&&Ds.x+Ds.y<=1}static getInterpolation(e,t,i,n,s,a,r,l){return this.getBarycoord(e,t,i,n,Ds)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Ds.x),l.addScaledVector(a,Ds.y),l.addScaledVector(r,Ds.z),l)}static isFrontFacing(e,t,i,n){return es.subVectors(i,t),Rs.subVectors(e,t),es.cross(Rs).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return es.subVectors(this.c,this.b),Rs.subVectors(this.a,this.b),es.cross(Rs).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return On.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return On.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,n,s){return On.getInterpolation(e,this.a,this.b,this.c,t,i,n,s)}containsPoint(e){return On.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return On.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,s=this.c;let a,r;dr.subVectors(n,i),fr.subVectors(s,i),Cc.subVectors(e,i);const l=dr.dot(Cc),c=fr.dot(Cc);if(l<=0&&c<=0)return t.copy(i);Pc.subVectors(e,n);const h=dr.dot(Pc),d=fr.dot(Pc);if(h>=0&&d<=h)return t.copy(n);const f=l*d-h*c;if(f<=0&&l>=0&&h<=0)return a=l/(l-h),t.copy(i).addScaledVector(dr,a);kc.subVectors(e,s);const p=dr.dot(kc),b=fr.dot(kc);if(b>=0&&p<=b)return t.copy(s);const _=p*c-l*b;if(_<=0&&c>=0&&b<=0)return r=c/(c-b),t.copy(i).addScaledVector(fr,r);const y=h*b-p*d;if(y<=0&&d-h>=0&&p-b>=0)return td.subVectors(s,n),r=(d-h)/(d-h+(p-b)),t.copy(n).addScaledVector(td,r);const v=1/(y+_+f);return a=_*v,r=f*v,t.copy(i).addScaledVector(dr,a).addScaledVector(fr,r)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Tp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},sa={h:0,s:0,l:0},$o={h:0,s:0,l:0};function Ic(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}class Dt{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=rn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,si.toWorkingColorSpace(this,t),this}setRGB(e,t,i,n=si.workingColorSpace){return this.r=e,this.g=t,this.b=i,si.toWorkingColorSpace(this,n),this}setHSL(e,t,i,n=si.workingColorSpace){if(e=Bh(e,1),t=Ti(t,0,1),i=Ti(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,a=2*i-s;this.r=Ic(a,s,e+1/3),this.g=Ic(a,s,e),this.b=Ic(a,s,e-1/3)}return si.toWorkingColorSpace(this,n),this}setStyle(e,t=rn){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=n[1],r=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=rn){const i=Tp[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ir(e.r),this.g=Ir(e.g),this.b=Ir(e.b),this}copyLinearToSRGB(e){return this.r=vc(e.r),this.g=vc(e.g),this.b=vc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=rn){return si.fromWorkingColorSpace(Zi.copy(this),e),Math.round(Ti(Zi.r*255,0,255))*65536+Math.round(Ti(Zi.g*255,0,255))*256+Math.round(Ti(Zi.b*255,0,255))}getHexString(e=rn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=si.workingColorSpace){si.fromWorkingColorSpace(Zi.copy(this),t);const i=Zi.r,n=Zi.g,s=Zi.b,a=Math.max(i,n,s),r=Math.min(i,n,s);let l,c;const h=(r+a)/2;if(r===a)l=0,c=0;else{const d=a-r;switch(c=h<=.5?d/(a+r):d/(2-a-r),a){case i:l=(n-s)/d+(n<s?6:0);break;case n:l=(s-i)/d+2;break;case s:l=(i-n)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=si.workingColorSpace){return si.fromWorkingColorSpace(Zi.copy(this),t),e.r=Zi.r,e.g=Zi.g,e.b=Zi.b,e}getStyle(e=rn){si.fromWorkingColorSpace(Zi.copy(this),e);const t=Zi.r,i=Zi.g,n=Zi.b;return e!==rn?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(n*255)})`}offsetHSL(e,t,i){return this.getHSL(sa),this.setHSL(sa.h+e,sa.s+t,sa.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(sa),e.getHSL($o);const i=go(sa.h,$o.h,t),n=go(sa.s,$o.s,t),s=go(sa.l,$o.l,t);return this.setHSL(i,n,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,n=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*n,this.g=s[1]*t+s[4]*i+s[7]*n,this.b=s[2]*t+s[5]*i+s[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Zi=new Dt;Dt.NAMES=Tp;let $0=0;class Vn extends ya{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$0++}),this.uuid=ss(),this.name="",this.type="Material",this.blending=Cr,this.side=zn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ph,this.blendDst=mh,this.blendEquation=Ba,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Dt(0,0,0),this.blendAlpha=0,this.depthFunc=Ll,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Vu,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sr,this.stencilZFail=sr,this.stencilZPass=sr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const n=this[t];if(n===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Cr&&(i.blending=this.blending),this.side!==zn&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==ph&&(i.blendSrc=this.blendSrc),this.blendDst!==mh&&(i.blendDst=this.blendDst),this.blendEquation!==Ba&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Ll&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Vu&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==sr&&(i.stencilFail=this.stencilFail),this.stencilZFail!==sr&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==sr&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function n(s){const a=[];for(const r in s){const l=s[r];delete l.metadata,a.push(l)}return a}if(t){const s=n(e.textures),a=n(e.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const n=t.length;i=new Array(n);for(let s=0;s!==n;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class qt extends Vn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Dt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vn,this.combine=ip,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ns=Y0();function Y0(){const o=new ArrayBuffer(4),e=new Float32Array(o),t=new Uint32Array(o),i=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,n[l]=24,n[l|256]=24):(i[l]=31744,i[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),r=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,s[l]=c|h}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(r[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:r}}function Z0(o){Math.abs(o)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),o=Ti(o,-65504,65504),Ns.floatView[0]=o;const e=Ns.uint32View[0],t=e>>23&511;return Ns.baseTable[t]+((e&8388607)>>Ns.shiftTable[t])}function K0(o){const e=o>>10;return Ns.uint32View[0]=Ns.mantissaTable[Ns.offsetTable[e]+(o&1023)]+Ns.exponentTable[e],Ns.floatView[0]}const Yo={toHalfFloat:Z0,fromHalfFloat:K0},ki=new D,Zo=new et;class Ei{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=vh,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Tn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return xp("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Zo.fromBufferAttribute(this,t),Zo.applyMatrix3(e),this.setXY(t,Zo.x,Zo.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.applyMatrix3(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.applyMatrix4(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.applyNormalMatrix(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.transformDirection(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=ts(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=hi(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ts(t,this.array)),t}setX(e,t){return this.normalized&&(t=hi(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ts(t,this.array)),t}setY(e,t){return this.normalized&&(t=hi(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ts(t,this.array)),t}setZ(e,t){return this.normalized&&(t=hi(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ts(t,this.array)),t}setW(e,t){return this.normalized&&(t=hi(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=hi(t,this.array),i=hi(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=hi(t,this.array),i=hi(i,this.array),n=hi(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,s){return e*=this.itemSize,this.normalized&&(t=hi(t,this.array),i=hi(i,this.array),n=hi(n,this.array),s=hi(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==vh&&(e.usage=this.usage),e}}class Ep extends Ei{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Cp extends Ei{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class xi extends Ei{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Q0=0;const Dn=new Ft,Lc=new ri,pr=new D,_n=new Hn,so=new Hn,zi=new D;class fi extends ya{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Q0++}),this.uuid=ss(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Mp(e)?Cp:Ep)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new Wt().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Dn.makeRotationFromQuaternion(e),this.applyMatrix4(Dn),this}rotateX(e){return Dn.makeRotationX(e),this.applyMatrix4(Dn),this}rotateY(e){return Dn.makeRotationY(e),this.applyMatrix4(Dn),this}rotateZ(e){return Dn.makeRotationZ(e),this.applyMatrix4(Dn),this}translate(e,t,i){return Dn.makeTranslation(e,t,i),this.applyMatrix4(Dn),this}scale(e,t,i){return Dn.makeScale(e,t,i),this.applyMatrix4(Dn),this}lookAt(e){return Lc.lookAt(e),Lc.updateMatrix(),this.applyMatrix4(Lc.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pr).negate(),this.translate(pr.x,pr.y,pr.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new xi(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Hn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new D(-1/0,-1/0,-1/0),new D(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){const s=t[i];_n.setFromBufferAttribute(s),this.morphTargetsRelative?(zi.addVectors(this.boundingBox.min,_n.min),this.boundingBox.expandByPoint(zi),zi.addVectors(this.boundingBox.max,_n.max),this.boundingBox.expandByPoint(zi)):(this.boundingBox.expandByPoint(_n.min),this.boundingBox.expandByPoint(_n.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new rs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new D,1/0);return}if(e){const i=this.boundingSphere.center;if(_n.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const r=t[s];so.setFromBufferAttribute(r),this.morphTargetsRelative?(zi.addVectors(_n.min,so.min),_n.expandByPoint(zi),zi.addVectors(_n.max,so.max),_n.expandByPoint(zi)):(_n.expandByPoint(so.min),_n.expandByPoint(so.max))}_n.getCenter(i);let n=0;for(let s=0,a=e.count;s<a;s++)zi.fromBufferAttribute(e,s),n=Math.max(n,i.distanceToSquared(zi));if(t)for(let s=0,a=t.length;s<a;s++){const r=t[s],l=this.morphTargetsRelative;for(let c=0,h=r.count;c<h;c++)zi.fromBufferAttribute(r,c),l&&(pr.fromBufferAttribute(e,c),zi.add(pr)),n=Math.max(n,i.distanceToSquared(zi))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,n=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ei(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),r=[],l=[];for(let U=0;U<i.count;U++)r[U]=new D,l[U]=new D;const c=new D,h=new D,d=new D,f=new et,p=new et,b=new et,_=new D,y=new D;function v(U,C,T){c.fromBufferAttribute(i,U),h.fromBufferAttribute(i,C),d.fromBufferAttribute(i,T),f.fromBufferAttribute(s,U),p.fromBufferAttribute(s,C),b.fromBufferAttribute(s,T),h.sub(c),d.sub(c),p.sub(f),b.sub(f);const Z=1/(p.x*b.y-b.x*p.y);isFinite(Z)&&(_.copy(h).multiplyScalar(b.y).addScaledVector(d,-p.y).multiplyScalar(Z),y.copy(d).multiplyScalar(p.x).addScaledVector(h,-b.x).multiplyScalar(Z),r[U].add(_),r[C].add(_),r[T].add(_),l[U].add(y),l[C].add(y),l[T].add(y))}let S=this.groups;S.length===0&&(S=[{start:0,count:e.count}]);for(let U=0,C=S.length;U<C;++U){const T=S[U],Z=T.start,z=T.count;for(let B=Z,V=Z+z;B<V;B+=3)v(e.getX(B+0),e.getX(B+1),e.getX(B+2))}const A=new D,E=new D,O=new D,R=new D;function k(U){O.fromBufferAttribute(n,U),R.copy(O);const C=r[U];A.copy(C),A.sub(O.multiplyScalar(O.dot(C))).normalize(),E.crossVectors(R,C);const Z=E.dot(l[U])<0?-1:1;a.setXYZW(U,A.x,A.y,A.z,Z)}for(let U=0,C=S.length;U<C;++U){const T=S[U],Z=T.start,z=T.count;for(let B=Z,V=Z+z;B<V;B+=3)k(e.getX(B+0)),k(e.getX(B+1)),k(e.getX(B+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ei(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let f=0,p=i.count;f<p;f++)i.setXYZ(f,0,0,0);const n=new D,s=new D,a=new D,r=new D,l=new D,c=new D,h=new D,d=new D;if(e)for(let f=0,p=e.count;f<p;f+=3){const b=e.getX(f+0),_=e.getX(f+1),y=e.getX(f+2);n.fromBufferAttribute(t,b),s.fromBufferAttribute(t,_),a.fromBufferAttribute(t,y),h.subVectors(a,s),d.subVectors(n,s),h.cross(d),r.fromBufferAttribute(i,b),l.fromBufferAttribute(i,_),c.fromBufferAttribute(i,y),r.add(h),l.add(h),c.add(h),i.setXYZ(b,r.x,r.y,r.z),i.setXYZ(_,l.x,l.y,l.z),i.setXYZ(y,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)n.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),a.fromBufferAttribute(t,f+2),h.subVectors(a,s),d.subVectors(n,s),h.cross(d),i.setXYZ(f+0,h.x,h.y,h.z),i.setXYZ(f+1,h.x,h.y,h.z),i.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)zi.fromBufferAttribute(e,t),zi.normalize(),e.setXYZ(t,zi.x,zi.y,zi.z)}toNonIndexed(){function e(r,l){const c=r.array,h=r.itemSize,d=r.normalized,f=new c.constructor(l.length*h);let p=0,b=0;for(let _=0,y=l.length;_<y;_++){r.isInterleavedBufferAttribute?p=l[_]*r.data.stride+r.offset:p=l[_]*h;for(let v=0;v<h;v++)f[b++]=c[p++]}return new Ei(f,h,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new fi,i=this.index.array,n=this.attributes;for(const r in n){const l=n[r],c=e(l,i);t.setAttribute(r,c)}const s=this.morphAttributes;for(const r in s){const l=[],c=s[r];for(let h=0,d=c.length;h<d;h++){const f=c[h],p=e(f,i);l.push(p)}t.morphAttributes[r]=l}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let r=0,l=a.length;r<l;r++){const c=a[r];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let d=0,f=c.length;d<f;d++){const p=c[d];h.push(p.toJSON(e.data))}h.length>0&&(n[l]=h,s=!0)}s&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const r=this.boundingSphere;return r!==null&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const n=e.attributes;for(const c in n){const h=n[c];this.setAttribute(c,h.clone(t))}const s=e.morphAttributes;for(const c in s){const h=[],d=s[c];for(let f=0,p=d.length;f<p;f++)h.push(d[f].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,h=a.length;c<h;c++){const d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}const r=e.boundingBox;r!==null&&(this.boundingBox=r.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const id=new Ft,Ia=new _s,Ko=new rs,nd=new D,mr=new D,gr=new D,yr=new D,Rc=new D,Qo=new D,Jo=new et,el=new et,tl=new et,sd=new D,ad=new D,rd=new D,il=new D,nl=new D;class It extends ri{constructor(e=new fi,t=new qt){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}getVertexPosition(e,t){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(n,e);const r=this.morphTargetInfluences;if(s&&r){Qo.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const h=r[l],d=s[l];h!==0&&(Rc.fromBufferAttribute(d,e),a?Qo.addScaledVector(Rc,h):Qo.addScaledVector(Rc.sub(t),h))}t.add(Qo)}return t}raycast(e,t){const i=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Ko.copy(i.boundingSphere),Ko.applyMatrix4(s),Ia.copy(e.ray).recast(e.near),!(Ko.containsPoint(Ia.origin)===!1&&(Ia.intersectSphere(Ko,nd)===null||Ia.origin.distanceToSquared(nd)>(e.far-e.near)**2))&&(id.copy(s).invert(),Ia.copy(e.ray).applyMatrix4(id),!(i.boundingBox!==null&&Ia.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Ia)))}_computeIntersections(e,t,i){let n;const s=this.geometry,a=this.material,r=s.index,l=s.attributes.position,c=s.attributes.uv,h=s.attributes.uv1,d=s.attributes.normal,f=s.groups,p=s.drawRange;if(r!==null)if(Array.isArray(a))for(let b=0,_=f.length;b<_;b++){const y=f[b],v=a[y.materialIndex],S=Math.max(y.start,p.start),A=Math.min(r.count,Math.min(y.start+y.count,p.start+p.count));for(let E=S,O=A;E<O;E+=3){const R=r.getX(E),k=r.getX(E+1),U=r.getX(E+2);n=sl(this,v,e,i,c,h,d,R,k,U),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=y.materialIndex,t.push(n))}}else{const b=Math.max(0,p.start),_=Math.min(r.count,p.start+p.count);for(let y=b,v=_;y<v;y+=3){const S=r.getX(y),A=r.getX(y+1),E=r.getX(y+2);n=sl(this,a,e,i,c,h,d,S,A,E),n&&(n.faceIndex=Math.floor(y/3),t.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let b=0,_=f.length;b<_;b++){const y=f[b],v=a[y.materialIndex],S=Math.max(y.start,p.start),A=Math.min(l.count,Math.min(y.start+y.count,p.start+p.count));for(let E=S,O=A;E<O;E+=3){const R=E,k=E+1,U=E+2;n=sl(this,v,e,i,c,h,d,R,k,U),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=y.materialIndex,t.push(n))}}else{const b=Math.max(0,p.start),_=Math.min(l.count,p.start+p.count);for(let y=b,v=_;y<v;y+=3){const S=y,A=y+1,E=y+2;n=sl(this,a,e,i,c,h,d,S,A,E),n&&(n.faceIndex=Math.floor(y/3),t.push(n))}}}}function J0(o,e,t,i,n,s,a,r){let l;if(e.side===hn?l=i.intersectTriangle(a,s,n,!0,r):l=i.intersectTriangle(n,s,a,e.side===zn,r),l===null)return null;nl.copy(r),nl.applyMatrix4(o.matrixWorld);const c=t.ray.origin.distanceTo(nl);return c<t.near||c>t.far?null:{distance:c,point:nl.clone(),object:o}}function sl(o,e,t,i,n,s,a,r,l,c){o.getVertexPosition(r,mr),o.getVertexPosition(l,gr),o.getVertexPosition(c,yr);const h=J0(o,e,t,i,mr,gr,yr,il);if(h){n&&(Jo.fromBufferAttribute(n,r),el.fromBufferAttribute(n,l),tl.fromBufferAttribute(n,c),h.uv=On.getInterpolation(il,mr,gr,yr,Jo,el,tl,new et)),s&&(Jo.fromBufferAttribute(s,r),el.fromBufferAttribute(s,l),tl.fromBufferAttribute(s,c),h.uv1=On.getInterpolation(il,mr,gr,yr,Jo,el,tl,new et)),a&&(sd.fromBufferAttribute(a,r),ad.fromBufferAttribute(a,l),rd.fromBufferAttribute(a,c),h.normal=On.getInterpolation(il,mr,gr,yr,sd,ad,rd,new D),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const d={a:r,b:l,c,normal:new D,materialIndex:0};On.getNormal(mr,gr,yr,d.normal),h.face=d}return h}class va extends fi{constructor(e=1,t=1,i=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:s,depthSegments:a};const r=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],h=[],d=[];let f=0,p=0;b("z","y","x",-1,-1,i,t,e,a,s,0),b("z","y","x",1,-1,i,t,-e,a,s,1),b("x","z","y",1,1,e,i,t,n,a,2),b("x","z","y",1,-1,e,i,-t,n,a,3),b("x","y","z",1,-1,e,t,i,n,s,4),b("x","y","z",-1,-1,e,t,-i,n,s,5),this.setIndex(l),this.setAttribute("position",new xi(c,3)),this.setAttribute("normal",new xi(h,3)),this.setAttribute("uv",new xi(d,2));function b(_,y,v,S,A,E,O,R,k,U,C){const T=E/k,Z=O/U,z=E/2,B=O/2,V=R/2,Y=k+1,J=U+1;let Te=0,ge=0;const fe=new D;for(let he=0;he<J;he++){const Q=he*Z-B;for(let pe=0;pe<Y;pe++){const ve=pe*T-z;fe[_]=ve*S,fe[y]=Q*A,fe[v]=V,c.push(fe.x,fe.y,fe.z),fe[_]=0,fe[y]=0,fe[v]=R>0?1:-1,h.push(fe.x,fe.y,fe.z),d.push(pe/k),d.push(1-he/U),Te+=1}}for(let he=0;he<U;he++)for(let Q=0;Q<k;Q++){const pe=f+Q+Y*he,ve=f+Q+Y*(he+1),K=f+(Q+1)+Y*(he+1),se=f+(Q+1)+Y*he;l.push(pe,ve,se),l.push(ve,K,se),ge+=6}r.addGroup(p,ge,C),p+=ge,f+=Te}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new va(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Vr(o){const e={};for(const t in o){e[t]={};for(const i in o[t]){const n=o[t][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=n.clone():Array.isArray(n)?e[t][i]=n.slice():e[t][i]=n}}return e}function an(o){const e={};for(let t=0;t<o.length;t++){const i=Vr(o[t]);for(const n in i)e[n]=i[n]}return e}function ey(o){const e=[];for(let t=0;t<o.length;t++)e.push(o[t].clone());return e}function Pp(o){const e=o.getRenderTarget();return e===null?o.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:si.workingColorSpace}const Jl={clone:Vr,merge:an};var ty=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,iy=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class as extends Vn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ty,this.fragmentShader=iy,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Vr(e.uniforms),this.uniformsGroups=ey(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?t.uniforms[n]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[n]={type:"m4",value:a.toArray()}:t.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const n in this.extensions)this.extensions[n]===!0&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}let kp=class extends ri{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ft,this.projectionMatrix=new Ft,this.projectionMatrixInverse=new Ft,this.coordinateSystem=zs}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const aa=new D,od=new et,ld=new et;class on extends kp{constructor(e=50,t=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=zr*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(kr*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return zr*2*Math.atan(Math.tan(kr*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){aa.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(aa.x,aa.y).multiplyScalar(-e/aa.z),aa.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(aa.x,aa.y).multiplyScalar(-e/aa.z)}getViewSize(e,t){return this.getViewBounds(e,od,ld),t.subVectors(ld,od)}setViewOffset(e,t,i,n,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(kr*.5*this.fov)/this.zoom,i=2*t,n=this.aspect*i,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,t-=a.offsetY*i/c,n*=a.width/l,i*=a.height/c}const r=this.filmOffset;r!==0&&(s+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const vr=-90,br=1;class ny extends ri{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new on(vr,br,e,t);n.layers=this.layers,this.add(n);const s=new on(vr,br,e,t);s.layers=this.layers,this.add(s);const a=new on(vr,br,e,t);a.layers=this.layers,this.add(a);const r=new on(vr,br,e,t);r.layers=this.layers,this.add(r);const l=new on(vr,br,e,t);l.layers=this.layers,this.add(l);const c=new on(vr,br,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,n,s,a,r,l]=t;for(const c of t)this.remove(c);if(e===zs)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),r.up.set(0,1,0),r.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===zl)i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),r.up.set(0,-1,0),r.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,r,l,c,h]=this.children,d=e.getRenderTarget(),f=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),b=e.xr.enabled;e.xr.enabled=!1;const _=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,n),e.render(t,s),e.setRenderTarget(i,1,n),e.render(t,a),e.setRenderTarget(i,2,n),e.render(t,r),e.setRenderTarget(i,3,n),e.render(t,l),e.setRenderTarget(i,4,n),e.render(t,c),i.texture.generateMipmaps=_,e.setRenderTarget(i,5,n),e.render(t,h),e.setRenderTarget(d,f,p),e.xr.enabled=b,i.texture.needsPMREMUpdate=!0}}class Ip extends Fi{constructor(e,t,i,n,s,a,r,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:Fr,super(e,t,i,n,s,a,r,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class sy extends Hs{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new Ip(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:wi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new va(5,5,5),s=new as({name:"CubemapFromEquirect",uniforms:Vr(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:hn,blending:Vs});s.uniforms.tEquirect.value=t;const a=new It(n,s),r=t.minFilter;return t.minFilter===is&&(t.minFilter=wi),new ny(1,10,this).update(e,a),t.minFilter=r,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,n){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,n);e.setRenderTarget(s)}}const Dc=new D,ay=new D,ry=new Wt;class ha{constructor(e=new D(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=Dc.subVectors(i,t).cross(ay.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(Dc),n=this.normal.dot(i);if(n===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||ry.getNormalMatrix(e),n=this.coplanarPoint(Dc).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const La=new rs,al=new D;class Vh{constructor(e=new ha,t=new ha,i=new ha,n=new ha,s=new ha,a=new ha){this.planes=[e,t,i,n,s,a]}set(e,t,i,n,s,a){const r=this.planes;return r[0].copy(e),r[1].copy(t),r[2].copy(i),r[3].copy(n),r[4].copy(s),r[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=zs){const i=this.planes,n=e.elements,s=n[0],a=n[1],r=n[2],l=n[3],c=n[4],h=n[5],d=n[6],f=n[7],p=n[8],b=n[9],_=n[10],y=n[11],v=n[12],S=n[13],A=n[14],E=n[15];if(i[0].setComponents(l-s,f-c,y-p,E-v).normalize(),i[1].setComponents(l+s,f+c,y+p,E+v).normalize(),i[2].setComponents(l+a,f+h,y+b,E+S).normalize(),i[3].setComponents(l-a,f-h,y-b,E-S).normalize(),i[4].setComponents(l-r,f-d,y-_,E-A).normalize(),t===zs)i[5].setComponents(l+r,f+d,y+_,E+A).normalize();else if(t===zl)i[5].setComponents(r,d,_,A).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),La.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),La.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(La)}intersectsSprite(e){return La.center.set(0,0,0),La.radius=.7071067811865476,La.applyMatrix4(e.matrixWorld),this.intersectsSphere(La)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if(al.x=n.normal.x>0?e.max.x:e.min.x,al.y=n.normal.y>0?e.max.y:e.min.y,al.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(al)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Lp(){let o=null,e=!1,t=null,i=null;function n(s,a){t(s,a),i=o.requestAnimationFrame(n)}return{start:function(){e!==!0&&t!==null&&(i=o.requestAnimationFrame(n),e=!0)},stop:function(){o.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){o=s}}}function oy(o){const e=new WeakMap;function t(r,l){const c=r.array,h=r.usage,d=c.byteLength,f=o.createBuffer();o.bindBuffer(l,f),o.bufferData(l,c,h),r.onUploadCallback();let p;if(c instanceof Float32Array)p=o.FLOAT;else if(c instanceof Uint16Array)r.isFloat16BufferAttribute?p=o.HALF_FLOAT:p=o.UNSIGNED_SHORT;else if(c instanceof Int16Array)p=o.SHORT;else if(c instanceof Uint32Array)p=o.UNSIGNED_INT;else if(c instanceof Int32Array)p=o.INT;else if(c instanceof Int8Array)p=o.BYTE;else if(c instanceof Uint8Array)p=o.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)p=o.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:f,type:p,bytesPerElement:c.BYTES_PER_ELEMENT,version:r.version,size:d}}function i(r,l,c){const h=l.array,d=l._updateRange,f=l.updateRanges;if(o.bindBuffer(c,r),d.count===-1&&f.length===0&&o.bufferSubData(c,0,h),f.length!==0){for(let p=0,b=f.length;p<b;p++){const _=f[p];o.bufferSubData(c,_.start*h.BYTES_PER_ELEMENT,h,_.start,_.count)}l.clearUpdateRanges()}d.count!==-1&&(o.bufferSubData(c,d.offset*h.BYTES_PER_ELEMENT,h,d.offset,d.count),d.count=-1),l.onUploadCallback()}function n(r){return r.isInterleavedBufferAttribute&&(r=r.data),e.get(r)}function s(r){r.isInterleavedBufferAttribute&&(r=r.data);const l=e.get(r);l&&(o.deleteBuffer(l.buffer),e.delete(r))}function a(r,l){if(r.isGLBufferAttribute){const h=e.get(r);(!h||h.version<r.version)&&e.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version});return}r.isInterleavedBufferAttribute&&(r=r.data);const c=e.get(r);if(c===void 0)e.set(r,t(r,l));else if(c.version<r.version){if(c.size!==r.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,r,l),c.version=r.version}}return{get:n,remove:s,update:a}}class ba extends fi{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const s=e/2,a=t/2,r=Math.floor(i),l=Math.floor(n),c=r+1,h=l+1,d=e/r,f=t/l,p=[],b=[],_=[],y=[];for(let v=0;v<h;v++){const S=v*f-a;for(let A=0;A<c;A++){const E=A*d-s;b.push(E,-S,0),_.push(0,0,1),y.push(A/r),y.push(1-v/l)}}for(let v=0;v<l;v++)for(let S=0;S<r;S++){const A=S+c*v,E=S+c*(v+1),O=S+1+c*(v+1),R=S+1+c*v;p.push(A,E,R),p.push(E,O,R)}this.setIndex(p),this.setAttribute("position",new xi(b,3)),this.setAttribute("normal",new xi(_,3)),this.setAttribute("uv",new xi(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ba(e.width,e.height,e.widthSegments,e.heightSegments)}}var ly=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,cy=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,hy=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,uy=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,dy=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,fy=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,py=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,my=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,gy=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,yy=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,vy=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,by=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,wy=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,_y=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,My=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,xy=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Sy=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Ay=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Ty=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Ey=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Cy=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Py=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,ky=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Iy=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Ly=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Ry=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Dy=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Fy=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Oy=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Uy=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Ny="gl_FragColor = linearToOutputTexel( gl_FragColor );",By=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,zy=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Vy=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Hy=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Gy=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Wy=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,jy=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,qy=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Xy=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,$y=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Yy=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Zy=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Ky=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Qy=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Jy=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,ev=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,tv=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,iv=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,nv=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,sv=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,av=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,rv=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ov=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lv=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,cv=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,hv=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,uv=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,dv=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,fv=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,pv=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,mv=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,gv=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,yv=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,vv=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,bv=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,wv=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,_v=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Mv=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,xv=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Sv=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Av=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Tv=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Ev=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Cv=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Pv=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,kv=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Iv=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Lv=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Rv=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Dv=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Fv=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Ov=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Uv=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Nv=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Bv=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,zv=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Vv=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Hv=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Gv=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,Wv=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,jv=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,qv=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Xv=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,$v=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Yv=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Zv=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Kv=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Qv=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Jv=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,e1=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,t1=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,i1=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,n1=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,s1=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,a1=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,r1=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const o1=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,l1=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,c1=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,h1=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,u1=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,d1=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,f1=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,p1=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,m1=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,g1=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,y1=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,v1=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,b1=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,w1=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,_1=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,M1=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,x1=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,S1=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,A1=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,T1=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,E1=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,C1=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,P1=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,k1=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,I1=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,L1=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,R1=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,D1=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,F1=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,O1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,U1=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,N1=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,B1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,z1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,jt={alphahash_fragment:ly,alphahash_pars_fragment:cy,alphamap_fragment:hy,alphamap_pars_fragment:uy,alphatest_fragment:dy,alphatest_pars_fragment:fy,aomap_fragment:py,aomap_pars_fragment:my,batching_pars_vertex:gy,batching_vertex:yy,begin_vertex:vy,beginnormal_vertex:by,bsdfs:wy,iridescence_fragment:_y,bumpmap_pars_fragment:My,clipping_planes_fragment:xy,clipping_planes_pars_fragment:Sy,clipping_planes_pars_vertex:Ay,clipping_planes_vertex:Ty,color_fragment:Ey,color_pars_fragment:Cy,color_pars_vertex:Py,color_vertex:ky,common:Iy,cube_uv_reflection_fragment:Ly,defaultnormal_vertex:Ry,displacementmap_pars_vertex:Dy,displacementmap_vertex:Fy,emissivemap_fragment:Oy,emissivemap_pars_fragment:Uy,colorspace_fragment:Ny,colorspace_pars_fragment:By,envmap_fragment:zy,envmap_common_pars_fragment:Vy,envmap_pars_fragment:Hy,envmap_pars_vertex:Gy,envmap_physical_pars_fragment:ev,envmap_vertex:Wy,fog_vertex:jy,fog_pars_vertex:qy,fog_fragment:Xy,fog_pars_fragment:$y,gradientmap_pars_fragment:Yy,lightmap_pars_fragment:Zy,lights_lambert_fragment:Ky,lights_lambert_pars_fragment:Qy,lights_pars_begin:Jy,lights_toon_fragment:tv,lights_toon_pars_fragment:iv,lights_phong_fragment:nv,lights_phong_pars_fragment:sv,lights_physical_fragment:av,lights_physical_pars_fragment:rv,lights_fragment_begin:ov,lights_fragment_maps:lv,lights_fragment_end:cv,logdepthbuf_fragment:hv,logdepthbuf_pars_fragment:uv,logdepthbuf_pars_vertex:dv,logdepthbuf_vertex:fv,map_fragment:pv,map_pars_fragment:mv,map_particle_fragment:gv,map_particle_pars_fragment:yv,metalnessmap_fragment:vv,metalnessmap_pars_fragment:bv,morphinstance_vertex:wv,morphcolor_vertex:_v,morphnormal_vertex:Mv,morphtarget_pars_vertex:xv,morphtarget_vertex:Sv,normal_fragment_begin:Av,normal_fragment_maps:Tv,normal_pars_fragment:Ev,normal_pars_vertex:Cv,normal_vertex:Pv,normalmap_pars_fragment:kv,clearcoat_normal_fragment_begin:Iv,clearcoat_normal_fragment_maps:Lv,clearcoat_pars_fragment:Rv,iridescence_pars_fragment:Dv,opaque_fragment:Fv,packing:Ov,premultiplied_alpha_fragment:Uv,project_vertex:Nv,dithering_fragment:Bv,dithering_pars_fragment:zv,roughnessmap_fragment:Vv,roughnessmap_pars_fragment:Hv,shadowmap_pars_fragment:Gv,shadowmap_pars_vertex:Wv,shadowmap_vertex:jv,shadowmask_pars_fragment:qv,skinbase_vertex:Xv,skinning_pars_vertex:$v,skinning_vertex:Yv,skinnormal_vertex:Zv,specularmap_fragment:Kv,specularmap_pars_fragment:Qv,tonemapping_fragment:Jv,tonemapping_pars_fragment:e1,transmission_fragment:t1,transmission_pars_fragment:i1,uv_pars_fragment:n1,uv_pars_vertex:s1,uv_vertex:a1,worldpos_vertex:r1,background_vert:o1,background_frag:l1,backgroundCube_vert:c1,backgroundCube_frag:h1,cube_vert:u1,cube_frag:d1,depth_vert:f1,depth_frag:p1,distanceRGBA_vert:m1,distanceRGBA_frag:g1,equirect_vert:y1,equirect_frag:v1,linedashed_vert:b1,linedashed_frag:w1,meshbasic_vert:_1,meshbasic_frag:M1,meshlambert_vert:x1,meshlambert_frag:S1,meshmatcap_vert:A1,meshmatcap_frag:T1,meshnormal_vert:E1,meshnormal_frag:C1,meshphong_vert:P1,meshphong_frag:k1,meshphysical_vert:I1,meshphysical_frag:L1,meshtoon_vert:R1,meshtoon_frag:D1,points_vert:F1,points_frag:O1,shadow_vert:U1,shadow_frag:N1,sprite_vert:B1,sprite_frag:z1},yt={common:{diffuse:{value:new Dt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Wt},alphaMap:{value:null},alphaMapTransform:{value:new Wt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Wt}},envmap:{envMap:{value:null},envMapRotation:{value:new Wt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Wt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Wt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Wt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Wt},normalScale:{value:new et(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Wt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Wt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Wt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Wt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Dt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Dt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Wt},alphaTest:{value:0},uvTransform:{value:new Wt}},sprite:{diffuse:{value:new Dt(16777215)},opacity:{value:1},center:{value:new et(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Wt},alphaMap:{value:null},alphaMapTransform:{value:new Wt},alphaTest:{value:0}}},bs={basic:{uniforms:an([yt.common,yt.specularmap,yt.envmap,yt.aomap,yt.lightmap,yt.fog]),vertexShader:jt.meshbasic_vert,fragmentShader:jt.meshbasic_frag},lambert:{uniforms:an([yt.common,yt.specularmap,yt.envmap,yt.aomap,yt.lightmap,yt.emissivemap,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.fog,yt.lights,{emissive:{value:new Dt(0)}}]),vertexShader:jt.meshlambert_vert,fragmentShader:jt.meshlambert_frag},phong:{uniforms:an([yt.common,yt.specularmap,yt.envmap,yt.aomap,yt.lightmap,yt.emissivemap,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.fog,yt.lights,{emissive:{value:new Dt(0)},specular:{value:new Dt(1118481)},shininess:{value:30}}]),vertexShader:jt.meshphong_vert,fragmentShader:jt.meshphong_frag},standard:{uniforms:an([yt.common,yt.envmap,yt.aomap,yt.lightmap,yt.emissivemap,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.roughnessmap,yt.metalnessmap,yt.fog,yt.lights,{emissive:{value:new Dt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:jt.meshphysical_vert,fragmentShader:jt.meshphysical_frag},toon:{uniforms:an([yt.common,yt.aomap,yt.lightmap,yt.emissivemap,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.gradientmap,yt.fog,yt.lights,{emissive:{value:new Dt(0)}}]),vertexShader:jt.meshtoon_vert,fragmentShader:jt.meshtoon_frag},matcap:{uniforms:an([yt.common,yt.bumpmap,yt.normalmap,yt.displacementmap,yt.fog,{matcap:{value:null}}]),vertexShader:jt.meshmatcap_vert,fragmentShader:jt.meshmatcap_frag},points:{uniforms:an([yt.points,yt.fog]),vertexShader:jt.points_vert,fragmentShader:jt.points_frag},dashed:{uniforms:an([yt.common,yt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:jt.linedashed_vert,fragmentShader:jt.linedashed_frag},depth:{uniforms:an([yt.common,yt.displacementmap]),vertexShader:jt.depth_vert,fragmentShader:jt.depth_frag},normal:{uniforms:an([yt.common,yt.bumpmap,yt.normalmap,yt.displacementmap,{opacity:{value:1}}]),vertexShader:jt.meshnormal_vert,fragmentShader:jt.meshnormal_frag},sprite:{uniforms:an([yt.sprite,yt.fog]),vertexShader:jt.sprite_vert,fragmentShader:jt.sprite_frag},background:{uniforms:{uvTransform:{value:new Wt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:jt.background_vert,fragmentShader:jt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Wt}},vertexShader:jt.backgroundCube_vert,fragmentShader:jt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:jt.cube_vert,fragmentShader:jt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:jt.equirect_vert,fragmentShader:jt.equirect_frag},distanceRGBA:{uniforms:an([yt.common,yt.displacementmap,{referencePosition:{value:new D},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:jt.distanceRGBA_vert,fragmentShader:jt.distanceRGBA_frag},shadow:{uniforms:an([yt.lights,yt.fog,{color:{value:new Dt(0)},opacity:{value:1}}]),vertexShader:jt.shadow_vert,fragmentShader:jt.shadow_frag}};bs.physical={uniforms:an([bs.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Wt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Wt},clearcoatNormalScale:{value:new et(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Wt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Wt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Wt},sheen:{value:0},sheenColor:{value:new Dt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Wt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Wt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Wt},transmissionSamplerSize:{value:new et},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Wt},attenuationDistance:{value:0},attenuationColor:{value:new Dt(0)},specularColor:{value:new Dt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Wt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Wt},anisotropyVector:{value:new et},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Wt}}]),vertexShader:jt.meshphysical_vert,fragmentShader:jt.meshphysical_frag};const rl={r:0,b:0,g:0},Ra=new vn,V1=new Ft;function H1(o,e,t,i,n,s,a){const r=new Dt(0);let l=s===!0?0:1,c,h,d=null,f=0,p=null;function b(S){let A=S.isScene===!0?S.background:null;return A&&A.isTexture&&(A=(S.backgroundBlurriness>0?t:e).get(A)),A}function _(S){let A=!1;const E=b(S);E===null?v(r,l):E&&E.isColor&&(v(E,1),A=!0);const O=o.xr.getEnvironmentBlendMode();O==="additive"?i.buffers.color.setClear(0,0,0,1,a):O==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,a),(o.autoClear||A)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil)}function y(S,A){const E=b(A);E&&(E.isCubeTexture||E.mapping===Kl)?(h===void 0&&(h=new It(new va(1,1,1),new as({name:"BackgroundCubeMaterial",uniforms:Vr(bs.backgroundCube.uniforms),vertexShader:bs.backgroundCube.vertexShader,fragmentShader:bs.backgroundCube.fragmentShader,side:hn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(O,R,k){this.matrixWorld.copyPosition(k.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),Ra.copy(A.backgroundRotation),Ra.x*=-1,Ra.y*=-1,Ra.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(Ra.y*=-1,Ra.z*=-1),h.material.uniforms.envMap.value=E,h.material.uniforms.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=A.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(V1.makeRotationFromEuler(Ra)),h.material.toneMapped=si.getTransfer(E.colorSpace)!==yi,(d!==E||f!==E.version||p!==o.toneMapping)&&(h.material.needsUpdate=!0,d=E,f=E.version,p=o.toneMapping),h.layers.enableAll(),S.unshift(h,h.geometry,h.material,0,0,null)):E&&E.isTexture&&(c===void 0&&(c=new It(new ba(2,2),new as({name:"BackgroundMaterial",uniforms:Vr(bs.background.uniforms),vertexShader:bs.background.vertexShader,fragmentShader:bs.background.fragmentShader,side:zn,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=E,c.material.uniforms.backgroundIntensity.value=A.backgroundIntensity,c.material.toneMapped=si.getTransfer(E.colorSpace)!==yi,E.matrixAutoUpdate===!0&&E.updateMatrix(),c.material.uniforms.uvTransform.value.copy(E.matrix),(d!==E||f!==E.version||p!==o.toneMapping)&&(c.material.needsUpdate=!0,d=E,f=E.version,p=o.toneMapping),c.layers.enableAll(),S.unshift(c,c.geometry,c.material,0,0,null))}function v(S,A){S.getRGB(rl,Pp(o)),i.buffers.color.setClear(rl.r,rl.g,rl.b,A,a)}return{getClearColor:function(){return r},setClearColor:function(S,A=1){r.set(S),l=A,v(r,l)},getClearAlpha:function(){return l},setClearAlpha:function(S){l=S,v(r,l)},render:_,addToRenderList:y}}function G1(o,e){const t=o.getParameter(o.MAX_VERTEX_ATTRIBS),i={},n=f(null);let s=n,a=!1;function r(T,Z,z,B,V){let Y=!1;const J=d(B,z,Z);s!==J&&(s=J,c(s.object)),Y=p(T,B,z,V),Y&&b(T,B,z,V),V!==null&&e.update(V,o.ELEMENT_ARRAY_BUFFER),(Y||a)&&(a=!1,E(T,Z,z,B),V!==null&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e.get(V).buffer))}function l(){return o.createVertexArray()}function c(T){return o.bindVertexArray(T)}function h(T){return o.deleteVertexArray(T)}function d(T,Z,z){const B=z.wireframe===!0;let V=i[T.id];V===void 0&&(V={},i[T.id]=V);let Y=V[Z.id];Y===void 0&&(Y={},V[Z.id]=Y);let J=Y[B];return J===void 0&&(J=f(l()),Y[B]=J),J}function f(T){const Z=[],z=[],B=[];for(let V=0;V<t;V++)Z[V]=0,z[V]=0,B[V]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Z,enabledAttributes:z,attributeDivisors:B,object:T,attributes:{},index:null}}function p(T,Z,z,B){const V=s.attributes,Y=Z.attributes;let J=0;const Te=z.getAttributes();for(const ge in Te)if(Te[ge].location>=0){const he=V[ge];let Q=Y[ge];if(Q===void 0&&(ge==="instanceMatrix"&&T.instanceMatrix&&(Q=T.instanceMatrix),ge==="instanceColor"&&T.instanceColor&&(Q=T.instanceColor)),he===void 0||he.attribute!==Q||Q&&he.data!==Q.data)return!0;J++}return s.attributesNum!==J||s.index!==B}function b(T,Z,z,B){const V={},Y=Z.attributes;let J=0;const Te=z.getAttributes();for(const ge in Te)if(Te[ge].location>=0){let he=Y[ge];he===void 0&&(ge==="instanceMatrix"&&T.instanceMatrix&&(he=T.instanceMatrix),ge==="instanceColor"&&T.instanceColor&&(he=T.instanceColor));const Q={};Q.attribute=he,he&&he.data&&(Q.data=he.data),V[ge]=Q,J++}s.attributes=V,s.attributesNum=J,s.index=B}function _(){const T=s.newAttributes;for(let Z=0,z=T.length;Z<z;Z++)T[Z]=0}function y(T){v(T,0)}function v(T,Z){const z=s.newAttributes,B=s.enabledAttributes,V=s.attributeDivisors;z[T]=1,B[T]===0&&(o.enableVertexAttribArray(T),B[T]=1),V[T]!==Z&&(o.vertexAttribDivisor(T,Z),V[T]=Z)}function S(){const T=s.newAttributes,Z=s.enabledAttributes;for(let z=0,B=Z.length;z<B;z++)Z[z]!==T[z]&&(o.disableVertexAttribArray(z),Z[z]=0)}function A(T,Z,z,B,V,Y,J){J===!0?o.vertexAttribIPointer(T,Z,z,V,Y):o.vertexAttribPointer(T,Z,z,B,V,Y)}function E(T,Z,z,B){_();const V=B.attributes,Y=z.getAttributes(),J=Z.defaultAttributeValues;for(const Te in Y){const ge=Y[Te];if(ge.location>=0){let fe=V[Te];if(fe===void 0&&(Te==="instanceMatrix"&&T.instanceMatrix&&(fe=T.instanceMatrix),Te==="instanceColor"&&T.instanceColor&&(fe=T.instanceColor)),fe!==void 0){const he=fe.normalized,Q=fe.itemSize,pe=e.get(fe);if(pe===void 0)continue;const ve=pe.buffer,K=pe.type,se=pe.bytesPerElement,Ee=K===o.INT||K===o.UNSIGNED_INT||fe.gpuType===up;if(fe.isInterleavedBufferAttribute){const me=fe.data,Oe=me.stride,Ze=fe.offset;if(me.isInstancedInterleavedBuffer){for(let le=0;le<ge.locationSize;le++)v(ge.location+le,me.meshPerAttribute);T.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=me.meshPerAttribute*me.count)}else for(let le=0;le<ge.locationSize;le++)y(ge.location+le);o.bindBuffer(o.ARRAY_BUFFER,ve);for(let le=0;le<ge.locationSize;le++)A(ge.location+le,Q/ge.locationSize,K,he,Oe*se,(Ze+Q/ge.locationSize*le)*se,Ee)}else{if(fe.isInstancedBufferAttribute){for(let me=0;me<ge.locationSize;me++)v(ge.location+me,fe.meshPerAttribute);T.isInstancedMesh!==!0&&B._maxInstanceCount===void 0&&(B._maxInstanceCount=fe.meshPerAttribute*fe.count)}else for(let me=0;me<ge.locationSize;me++)y(ge.location+me);o.bindBuffer(o.ARRAY_BUFFER,ve);for(let me=0;me<ge.locationSize;me++)A(ge.location+me,Q/ge.locationSize,K,he,Q*se,Q/ge.locationSize*me*se,Ee)}}else if(J!==void 0){const he=J[Te];if(he!==void 0)switch(he.length){case 2:o.vertexAttrib2fv(ge.location,he);break;case 3:o.vertexAttrib3fv(ge.location,he);break;case 4:o.vertexAttrib4fv(ge.location,he);break;default:o.vertexAttrib1fv(ge.location,he)}}}}S()}function O(){U();for(const T in i){const Z=i[T];for(const z in Z){const B=Z[z];for(const V in B)h(B[V].object),delete B[V];delete Z[z]}delete i[T]}}function R(T){if(i[T.id]===void 0)return;const Z=i[T.id];for(const z in Z){const B=Z[z];for(const V in B)h(B[V].object),delete B[V];delete Z[z]}delete i[T.id]}function k(T){for(const Z in i){const z=i[Z];if(z[T.id]===void 0)continue;const B=z[T.id];for(const V in B)h(B[V].object),delete B[V];delete z[T.id]}}function U(){C(),a=!0,s!==n&&(s=n,c(s.object))}function C(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:r,reset:U,resetDefaultState:C,dispose:O,releaseStatesOfGeometry:R,releaseStatesOfProgram:k,initAttributes:_,enableAttribute:y,disableUnusedAttributes:S}}function W1(o,e,t){let i;function n(c){i=c}function s(c,h){o.drawArrays(i,c,h),t.update(h,i,1)}function a(c,h,d){d!==0&&(o.drawArraysInstanced(i,c,h,d),t.update(h,i,d))}function r(c,h,d){if(d===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<d;p++)this.render(c[p],h[p]);else{f.multiDrawArraysWEBGL(i,c,0,h,0,d);let p=0;for(let b=0;b<d;b++)p+=h[b];t.update(p,i,1)}}function l(c,h,d,f){if(d===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let b=0;b<c.length;b++)a(c[b],h[b],f[b]);else{p.multiDrawArraysInstancedWEBGL(i,c,0,h,0,f,0,d);let b=0;for(let _=0;_<d;_++)b+=h[_];for(let _=0;_<f.length;_++)t.update(b,i,f[_])}}this.setMode=n,this.render=s,this.renderInstances=a,this.renderMultiDraw=r,this.renderMultiDrawInstances=l}function j1(o,e,t,i){let n;function s(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");n=o.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function a(R){return!(R!==Bn&&i.convert(R)!==o.getParameter(o.IMPLEMENTATION_COLOR_READ_FORMAT))}function r(R){const k=R===Bs&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(R!==ma&&i.convert(R)!==o.getParameter(o.IMPLEMENTATION_COLOR_READ_TYPE)&&R!==Tn&&!k)}function l(R){if(R==="highp"){if(o.getShaderPrecisionFormat(o.VERTEX_SHADER,o.HIGH_FLOAT).precision>0&&o.getShaderPrecisionFormat(o.FRAGMENT_SHADER,o.HIGH_FLOAT).precision>0)return"highp";R="mediump"}return R==="mediump"&&o.getShaderPrecisionFormat(o.VERTEX_SHADER,o.MEDIUM_FLOAT).precision>0&&o.getShaderPrecisionFormat(o.FRAGMENT_SHADER,o.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const h=l(c);h!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const d=t.logarithmicDepthBuffer===!0,f=o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS),p=o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS),b=o.getParameter(o.MAX_TEXTURE_SIZE),_=o.getParameter(o.MAX_CUBE_MAP_TEXTURE_SIZE),y=o.getParameter(o.MAX_VERTEX_ATTRIBS),v=o.getParameter(o.MAX_VERTEX_UNIFORM_VECTORS),S=o.getParameter(o.MAX_VARYING_VECTORS),A=o.getParameter(o.MAX_FRAGMENT_UNIFORM_VECTORS),E=p>0,O=o.getParameter(o.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:r,precision:c,logarithmicDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:b,maxCubemapSize:_,maxAttributes:y,maxVertexUniforms:v,maxVaryings:S,maxFragmentUniforms:A,vertexTextures:E,maxSamples:O}}function q1(o){const e=this;let t=null,i=0,n=!1,s=!1;const a=new ha,r=new Wt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){const p=d.length!==0||f||i!==0||n;return n=f,i=d.length,p},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(d,f){t=h(d,f,0)},this.setState=function(d,f,p){const b=d.clippingPlanes,_=d.clipIntersection,y=d.clipShadows,v=o.get(d);if(!n||b===null||b.length===0||s&&!y)s?h(null):c();else{const S=s?0:i,A=S*4;let E=v.clippingState||null;l.value=E,E=h(b,f,A,p);for(let O=0;O!==A;++O)E[O]=t[O];v.clippingState=E,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=S}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(d,f,p,b){const _=d!==null?d.length:0;let y=null;if(_!==0){if(y=l.value,b!==!0||y===null){const v=p+_*4,S=f.matrixWorldInverse;r.getNormalMatrix(S),(y===null||y.length<v)&&(y=new Float32Array(v));for(let A=0,E=p;A!==_;++A,E+=4)a.copy(d[A]).applyMatrix4(S,r),a.normal.toArray(y,E),y[E+3]=a.constant}l.value=y,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,y}}function X1(o){let e=new WeakMap;function t(a,r){return r===Dl?a.mapping=Fr:r===gh&&(a.mapping=Or),a}function i(a){if(a&&a.isTexture){const r=a.mapping;if(r===Dl||r===gh)if(e.has(a)){const l=e.get(a).texture;return t(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new sy(l.height);return c.fromEquirectangularTexture(o,a),e.set(a,c),a.addEventListener("dispose",n),t(c.texture,a.mapping)}else return null}}return a}function n(a){const r=a.target;r.removeEventListener("dispose",n);const l=e.get(r);l!==void 0&&(e.delete(r),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class ec extends kp{constructor(e=-1,t=1,i=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-e,a=i+e,r=n+t,l=n-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,r-=h*this.view.offsetY,l=r-h*this.view.height}this.projectionMatrix.makeOrthographic(s,a,r,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Tr=4,cd=[.125,.215,.35,.446,.526,.582],za=20,Fc=new ec,hd=new Dt;let Oc=null,Uc=0,Nc=0,Bc=!1;const Ua=(1+Math.sqrt(5))/2,wr=1/Ua,ud=[new D(-Ua,wr,0),new D(Ua,wr,0),new D(-wr,0,Ua),new D(wr,0,Ua),new D(0,Ua,-wr),new D(0,Ua,wr),new D(-1,1,-1),new D(1,1,-1),new D(-1,1,1),new D(1,1,1)];class dd{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){Oc=this._renderer.getRenderTarget(),Uc=this._renderer.getActiveCubeFace(),Nc=this._renderer.getActiveMipmapLevel(),Bc=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,n,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=md(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=pd(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Oc,Uc,Nc),this._renderer.xr.enabled=Bc,e.scissorTest=!1,ol(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Fr||e.mapping===Or?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Oc=this._renderer.getRenderTarget(),Uc=this._renderer.getActiveCubeFace(),Nc=this._renderer.getActiveMipmapLevel(),Bc=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:wi,minFilter:wi,generateMipmaps:!1,type:Bs,format:Bn,colorSpace:Vi,depthBuffer:!1},n=fd(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=fd(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=$1(s)),this._blurMaterial=Y1(s,e,t)}return n}_compileMaterial(e){const t=new It(this._lodPlanes[0],e);this._renderer.compile(t,Fc)}_sceneToCubeUV(e,t,i,n){const r=new on(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(hd),h.toneMapping=pa,h.autoClear=!1;const p=new qt({name:"PMREM.Background",side:hn,depthWrite:!1,depthTest:!1}),b=new It(new va,p);let _=!1;const y=e.background;y?y.isColor&&(p.color.copy(y),e.background=null,_=!0):(p.color.copy(hd),_=!0);for(let v=0;v<6;v++){const S=v%3;S===0?(r.up.set(0,l[v],0),r.lookAt(c[v],0,0)):S===1?(r.up.set(0,0,l[v]),r.lookAt(0,c[v],0)):(r.up.set(0,l[v],0),r.lookAt(0,0,c[v]));const A=this._cubeSize;ol(n,S*A,v>2?A:0,A,A),h.setRenderTarget(n),_&&h.render(b,r),h.render(e,r)}b.geometry.dispose(),b.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=y}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===Fr||e.mapping===Or;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=md()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=pd());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new It(this._lodPlanes[0],s),r=s.uniforms;r.envMap.value=e;const l=this._cubeSize;ol(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(a,Fc)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),r=ud[(n-s-1)%ud.length];this._blur(e,s-1,s,a,r)}t.autoClear=i}_blur(e,t,i,n,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,n,"latitudinal",s),this._halfBlur(a,e,i,i,n,"longitudinal",s)}_halfBlur(e,t,i,n,s,a,r){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new It(this._lodPlanes[n],c),f=c.uniforms,p=this._sizeLods[i]-1,b=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*za-1),_=s/b,y=isFinite(s)?1+Math.floor(h*_):za;y>za&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${za}`);const v=[];let S=0;for(let k=0;k<za;++k){const U=k/_,C=Math.exp(-U*U/2);v.push(C),k===0?S+=C:k<y&&(S+=2*C)}for(let k=0;k<v.length;k++)v[k]=v[k]/S;f.envMap.value=e.texture,f.samples.value=y,f.weights.value=v,f.latitudinal.value=a==="latitudinal",r&&(f.poleAxis.value=r);const{_lodMax:A}=this;f.dTheta.value=b,f.mipInt.value=A-i;const E=this._sizeLods[n],O=3*E*(n>A-Tr?n-A+Tr:0),R=4*(this._cubeSize-E);ol(t,O,R,3*E,2*E),l.setRenderTarget(t),l.render(d,Fc)}}function $1(o){const e=[],t=[],i=[];let n=o;const s=o-Tr+1+cd.length;for(let a=0;a<s;a++){const r=Math.pow(2,n);t.push(r);let l=1/r;a>o-Tr?l=cd[a-o+Tr-1]:a===0&&(l=0),i.push(l);const c=1/(r-2),h=-c,d=1+c,f=[h,h,d,h,d,d,h,h,d,d,h,d],p=6,b=6,_=3,y=2,v=1,S=new Float32Array(_*b*p),A=new Float32Array(y*b*p),E=new Float32Array(v*b*p);for(let R=0;R<p;R++){const k=R%3*2/3-1,U=R>2?0:-1,C=[k,U,0,k+2/3,U,0,k+2/3,U+1,0,k,U,0,k+2/3,U+1,0,k,U+1,0];S.set(C,_*b*R),A.set(f,y*b*R);const T=[R,R,R,R,R,R];E.set(T,v*b*R)}const O=new fi;O.setAttribute("position",new Ei(S,_)),O.setAttribute("uv",new Ei(A,y)),O.setAttribute("faceIndex",new Ei(E,v)),e.push(O),n>Tr&&n--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function fd(o,e,t){const i=new Hs(o,e,t);return i.texture.mapping=Kl,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function ol(o,e,t,i,n){o.viewport.set(e,t,i,n),o.scissor.set(e,t,i,n)}function Y1(o,e,t){const i=new Float32Array(za),n=new D(0,1,0);return new as({name:"SphericalGaussianBlur",defines:{n:za,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${o}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Hh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Vs,depthTest:!1,depthWrite:!1})}function pd(){return new as({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Hh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Vs,depthTest:!1,depthWrite:!1})}function md(){return new as({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Hh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Vs,depthTest:!1,depthWrite:!1})}function Hh(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Z1(o){let e=new WeakMap,t=null;function i(r){if(r&&r.isTexture){const l=r.mapping,c=l===Dl||l===gh,h=l===Fr||l===Or;if(c||h){let d=e.get(r);const f=d!==void 0?d.texture.pmremVersion:0;if(r.isRenderTargetTexture&&r.pmremVersion!==f)return t===null&&(t=new dd(o)),d=c?t.fromEquirectangular(r,d):t.fromCubemap(r,d),d.texture.pmremVersion=r.pmremVersion,e.set(r,d),d.texture;if(d!==void 0)return d.texture;{const p=r.image;return c&&p&&p.height>0||h&&p&&n(p)?(t===null&&(t=new dd(o)),d=c?t.fromEquirectangular(r):t.fromCubemap(r),d.texture.pmremVersion=r.pmremVersion,e.set(r,d),r.addEventListener("dispose",s),d.texture):null}}}return r}function n(r){let l=0;const c=6;for(let h=0;h<c;h++)r[h]!==void 0&&l++;return l===c}function s(r){const l=r.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:a}}function K1(o){const e={};function t(i){if(e[i]!==void 0)return e[i];let n;switch(i){case"WEBGL_depth_texture":n=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=o.getExtension(i)}return e[i]=n,n}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const n=t(i);return n===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),n}}}function Q1(o,e,t,i){const n={},s=new WeakMap;function a(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const b in f.attributes)e.remove(f.attributes[b]);for(const b in f.morphAttributes){const _=f.morphAttributes[b];for(let y=0,v=_.length;y<v;y++)e.remove(_[y])}f.removeEventListener("dispose",a),delete n[f.id];const p=s.get(f);p&&(e.remove(p),s.delete(f)),i.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function r(d,f){return n[f.id]===!0||(f.addEventListener("dispose",a),n[f.id]=!0,t.memory.geometries++),f}function l(d){const f=d.attributes;for(const b in f)e.update(f[b],o.ARRAY_BUFFER);const p=d.morphAttributes;for(const b in p){const _=p[b];for(let y=0,v=_.length;y<v;y++)e.update(_[y],o.ARRAY_BUFFER)}}function c(d){const f=[],p=d.index,b=d.attributes.position;let _=0;if(p!==null){const S=p.array;_=p.version;for(let A=0,E=S.length;A<E;A+=3){const O=S[A+0],R=S[A+1],k=S[A+2];f.push(O,R,R,k,k,O)}}else if(b!==void 0){const S=b.array;_=b.version;for(let A=0,E=S.length/3-1;A<E;A+=3){const O=A+0,R=A+1,k=A+2;f.push(O,R,R,k,k,O)}}else return;const y=new(Mp(f)?Cp:Ep)(f,1);y.version=_;const v=s.get(d);v&&e.remove(v),s.set(d,y)}function h(d){const f=s.get(d);if(f){const p=d.index;p!==null&&f.version<p.version&&c(d)}else c(d);return s.get(d)}return{get:r,update:l,getWireframeAttribute:h}}function J1(o,e,t){let i;function n(f){i=f}let s,a;function r(f){s=f.type,a=f.bytesPerElement}function l(f,p){o.drawElements(i,p,s,f*a),t.update(p,i,1)}function c(f,p,b){b!==0&&(o.drawElementsInstanced(i,p,s,f*a,b),t.update(p,i,b))}function h(f,p,b){if(b===0)return;const _=e.get("WEBGL_multi_draw");if(_===null)for(let y=0;y<b;y++)this.render(f[y]/a,p[y]);else{_.multiDrawElementsWEBGL(i,p,0,s,f,0,b);let y=0;for(let v=0;v<b;v++)y+=p[v];t.update(y,i,1)}}function d(f,p,b,_){if(b===0)return;const y=e.get("WEBGL_multi_draw");if(y===null)for(let v=0;v<f.length;v++)c(f[v]/a,p[v],_[v]);else{y.multiDrawElementsInstancedWEBGL(i,p,0,s,f,0,_,0,b);let v=0;for(let S=0;S<b;S++)v+=p[S];for(let S=0;S<_.length;S++)t.update(v,i,_[S])}}this.setMode=n,this.setIndex=r,this.render=l,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=d}function e2(o){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,r){switch(t.calls++,a){case o.TRIANGLES:t.triangles+=r*(s/3);break;case o.LINES:t.lines+=r*(s/2);break;case o.LINE_STRIP:t.lines+=r*(s-1);break;case o.LINE_LOOP:t.lines+=r*s;break;case o.POINTS:t.points+=r*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:n,update:i}}function t2(o,e,t){const i=new WeakMap,n=new ui;function s(a,r,l){const c=a.morphTargetInfluences,h=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,d=h!==void 0?h.length:0;let f=i.get(r);if(f===void 0||f.count!==d){let C=function(){k.dispose(),i.delete(r),r.removeEventListener("dispose",C)};f!==void 0&&f.texture.dispose();const p=r.morphAttributes.position!==void 0,b=r.morphAttributes.normal!==void 0,_=r.morphAttributes.color!==void 0,y=r.morphAttributes.position||[],v=r.morphAttributes.normal||[],S=r.morphAttributes.color||[];let A=0;p===!0&&(A=1),b===!0&&(A=2),_===!0&&(A=3);let E=r.attributes.position.count*A,O=1;E>e.maxTextureSize&&(O=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const R=new Float32Array(E*O*4*d),k=new Ap(R,E,O,d);k.type=Tn,k.needsUpdate=!0;const U=A*4;for(let T=0;T<d;T++){const Z=y[T],z=v[T],B=S[T],V=E*O*4*T;for(let Y=0;Y<Z.count;Y++){const J=Y*U;p===!0&&(n.fromBufferAttribute(Z,Y),R[V+J+0]=n.x,R[V+J+1]=n.y,R[V+J+2]=n.z,R[V+J+3]=0),b===!0&&(n.fromBufferAttribute(z,Y),R[V+J+4]=n.x,R[V+J+5]=n.y,R[V+J+6]=n.z,R[V+J+7]=0),_===!0&&(n.fromBufferAttribute(B,Y),R[V+J+8]=n.x,R[V+J+9]=n.y,R[V+J+10]=n.z,R[V+J+11]=B.itemSize===4?n.w:1)}}f={count:d,texture:k,size:new et(E,O)},i.set(r,f),r.addEventListener("dispose",C)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(o,"morphTexture",a.morphTexture,t);else{let p=0;for(let _=0;_<c.length;_++)p+=c[_];const b=r.morphTargetsRelative?1:1-p;l.getUniforms().setValue(o,"morphTargetBaseInfluence",b),l.getUniforms().setValue(o,"morphTargetInfluences",c)}l.getUniforms().setValue(o,"morphTargetsTexture",f.texture,t),l.getUniforms().setValue(o,"morphTargetsTextureSize",f.size)}return{update:s}}function i2(o,e,t,i){let n=new WeakMap;function s(l){const c=i.render.frame,h=l.geometry,d=e.get(l,h);if(n.get(d)!==c&&(e.update(d),n.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",r)===!1&&l.addEventListener("dispose",r),n.get(l)!==c&&(t.update(l.instanceMatrix,o.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,o.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;n.get(f)!==c&&(f.update(),n.set(f,c))}return d}function a(){n=new WeakMap}function r(l){const c=l.target;c.removeEventListener("dispose",r),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:a}}class Rp extends Fi{constructor(e,t,i,n,s,a,r,l,c,h){if(h=h!==void 0?h:Pr,h!==Pr&&h!==So)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Pr&&(i=Nr),i===void 0&&h===So&&(i=Po),super(null,n,s,a,r,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=r!==void 0?r:ln,this.minFilter=l!==void 0?l:ln,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const Dp=new Fi,Fp=new Rp(1,1);Fp.compareFunction=_p;const Op=new Ap,Up=new z0,Np=new Ip,gd=[],yd=[],vd=new Float32Array(16),bd=new Float32Array(9),wd=new Float32Array(4);function Wr(o,e,t){const i=o[0];if(i<=0||i>0)return o;const n=e*t;let s=gd[n];if(s===void 0&&(s=new Float32Array(n),gd[n]=s),e!==0){i.toArray(s,0);for(let a=1,r=0;a!==e;++a)r+=t,o[a].toArray(s,r)}return s}function Oi(o,e){if(o.length!==e.length)return!1;for(let t=0,i=o.length;t<i;t++)if(o[t]!==e[t])return!1;return!0}function Ui(o,e){for(let t=0,i=e.length;t<i;t++)o[t]=e[t]}function tc(o,e){let t=yd[e];t===void 0&&(t=new Int32Array(e),yd[e]=t);for(let i=0;i!==e;++i)t[i]=o.allocateTextureUnit();return t}function n2(o,e){const t=this.cache;t[0]!==e&&(o.uniform1f(this.addr,e),t[0]=e)}function s2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Oi(t,e))return;o.uniform2fv(this.addr,e),Ui(t,e)}}function a2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(o.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Oi(t,e))return;o.uniform3fv(this.addr,e),Ui(t,e)}}function r2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Oi(t,e))return;o.uniform4fv(this.addr,e),Ui(t,e)}}function o2(o,e){const t=this.cache,i=e.elements;if(i===void 0){if(Oi(t,e))return;o.uniformMatrix2fv(this.addr,!1,e),Ui(t,e)}else{if(Oi(t,i))return;wd.set(i),o.uniformMatrix2fv(this.addr,!1,wd),Ui(t,i)}}function l2(o,e){const t=this.cache,i=e.elements;if(i===void 0){if(Oi(t,e))return;o.uniformMatrix3fv(this.addr,!1,e),Ui(t,e)}else{if(Oi(t,i))return;bd.set(i),o.uniformMatrix3fv(this.addr,!1,bd),Ui(t,i)}}function c2(o,e){const t=this.cache,i=e.elements;if(i===void 0){if(Oi(t,e))return;o.uniformMatrix4fv(this.addr,!1,e),Ui(t,e)}else{if(Oi(t,i))return;vd.set(i),o.uniformMatrix4fv(this.addr,!1,vd),Ui(t,i)}}function h2(o,e){const t=this.cache;t[0]!==e&&(o.uniform1i(this.addr,e),t[0]=e)}function u2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Oi(t,e))return;o.uniform2iv(this.addr,e),Ui(t,e)}}function d2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Oi(t,e))return;o.uniform3iv(this.addr,e),Ui(t,e)}}function f2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Oi(t,e))return;o.uniform4iv(this.addr,e),Ui(t,e)}}function p2(o,e){const t=this.cache;t[0]!==e&&(o.uniform1ui(this.addr,e),t[0]=e)}function m2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Oi(t,e))return;o.uniform2uiv(this.addr,e),Ui(t,e)}}function g2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Oi(t,e))return;o.uniform3uiv(this.addr,e),Ui(t,e)}}function y2(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Oi(t,e))return;o.uniform4uiv(this.addr,e),Ui(t,e)}}function v2(o,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(o.uniform1i(this.addr,n),i[0]=n);const s=this.type===o.SAMPLER_2D_SHADOW?Fp:Dp;t.setTexture2D(e||s,n)}function b2(o,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(o.uniform1i(this.addr,n),i[0]=n),t.setTexture3D(e||Up,n)}function w2(o,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(o.uniform1i(this.addr,n),i[0]=n),t.setTextureCube(e||Np,n)}function _2(o,e,t){const i=this.cache,n=t.allocateTextureUnit();i[0]!==n&&(o.uniform1i(this.addr,n),i[0]=n),t.setTexture2DArray(e||Op,n)}function M2(o){switch(o){case 5126:return n2;case 35664:return s2;case 35665:return a2;case 35666:return r2;case 35674:return o2;case 35675:return l2;case 35676:return c2;case 5124:case 35670:return h2;case 35667:case 35671:return u2;case 35668:case 35672:return d2;case 35669:case 35673:return f2;case 5125:return p2;case 36294:return m2;case 36295:return g2;case 36296:return y2;case 35678:case 36198:case 36298:case 36306:case 35682:return v2;case 35679:case 36299:case 36307:return b2;case 35680:case 36300:case 36308:case 36293:return w2;case 36289:case 36303:case 36311:case 36292:return _2}}function x2(o,e){o.uniform1fv(this.addr,e)}function S2(o,e){const t=Wr(e,this.size,2);o.uniform2fv(this.addr,t)}function A2(o,e){const t=Wr(e,this.size,3);o.uniform3fv(this.addr,t)}function T2(o,e){const t=Wr(e,this.size,4);o.uniform4fv(this.addr,t)}function E2(o,e){const t=Wr(e,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function C2(o,e){const t=Wr(e,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function P2(o,e){const t=Wr(e,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function k2(o,e){o.uniform1iv(this.addr,e)}function I2(o,e){o.uniform2iv(this.addr,e)}function L2(o,e){o.uniform3iv(this.addr,e)}function R2(o,e){o.uniform4iv(this.addr,e)}function D2(o,e){o.uniform1uiv(this.addr,e)}function F2(o,e){o.uniform2uiv(this.addr,e)}function O2(o,e){o.uniform3uiv(this.addr,e)}function U2(o,e){o.uniform4uiv(this.addr,e)}function N2(o,e,t){const i=this.cache,n=e.length,s=tc(t,n);Oi(i,s)||(o.uniform1iv(this.addr,s),Ui(i,s));for(let a=0;a!==n;++a)t.setTexture2D(e[a]||Dp,s[a])}function B2(o,e,t){const i=this.cache,n=e.length,s=tc(t,n);Oi(i,s)||(o.uniform1iv(this.addr,s),Ui(i,s));for(let a=0;a!==n;++a)t.setTexture3D(e[a]||Up,s[a])}function z2(o,e,t){const i=this.cache,n=e.length,s=tc(t,n);Oi(i,s)||(o.uniform1iv(this.addr,s),Ui(i,s));for(let a=0;a!==n;++a)t.setTextureCube(e[a]||Np,s[a])}function V2(o,e,t){const i=this.cache,n=e.length,s=tc(t,n);Oi(i,s)||(o.uniform1iv(this.addr,s),Ui(i,s));for(let a=0;a!==n;++a)t.setTexture2DArray(e[a]||Op,s[a])}function H2(o){switch(o){case 5126:return x2;case 35664:return S2;case 35665:return A2;case 35666:return T2;case 35674:return E2;case 35675:return C2;case 35676:return P2;case 5124:case 35670:return k2;case 35667:case 35671:return I2;case 35668:case 35672:return L2;case 35669:case 35673:return R2;case 5125:return D2;case 36294:return F2;case 36295:return O2;case 36296:return U2;case 35678:case 36198:case 36298:case 36306:case 35682:return N2;case 35679:case 36299:case 36307:return B2;case 35680:case 36300:case 36308:case 36293:return z2;case 36289:case 36303:case 36311:case 36292:return V2}}class G2{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=M2(t.type)}}class W2{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=H2(t.type)}}class j2{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const r=n[s];r.setValue(e,t[r.id],i)}}}const zc=/(\w+)(\])?(\[|\.)?/g;function _d(o,e){o.seq.push(e),o.map[e.id]=e}function q2(o,e,t){const i=o.name,n=i.length;for(zc.lastIndex=0;;){const s=zc.exec(i),a=zc.lastIndex;let r=s[1];const l=s[2]==="]",c=s[3];if(l&&(r=r|0),c===void 0||c==="["&&a+2===n){_d(t,c===void 0?new G2(r,o,e):new W2(r,o,e));break}else{let d=t.map[r];d===void 0&&(d=new j2(r),_d(t,d)),t=d}}}class Pl{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const s=e.getActiveUniform(t,n),a=e.getUniformLocation(t,s.name);q2(s,a,this)}}setValue(e,t,i,n){const s=this.map[t];s!==void 0&&s.setValue(e,i,n)}setOptional(e,t,i){const n=t[i];n!==void 0&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let s=0,a=t.length;s!==a;++s){const r=t[s],l=i[r.id];l.needsUpdate!==!1&&r.setValue(e,l.value,n)}}static seqWithValue(e,t){const i=[];for(let n=0,s=e.length;n!==s;++n){const a=e[n];a.id in t&&i.push(a)}return i}}function Md(o,e,t){const i=o.createShader(e);return o.shaderSource(i,t),o.compileShader(i),i}const X2=37297;let $2=0;function Y2(o,e){const t=o.split(`
`),i=[],n=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=n;a<s;a++){const r=a+1;i.push(`${r===e?">":" "} ${r}: ${t[a]}`)}return i.join(`
`)}function Z2(o){const e=si.getPrimaries(si.workingColorSpace),t=si.getPrimaries(o);let i;switch(e===t?i="":e===Bl&&t===Nl?i="LinearDisplayP3ToLinearSRGB":e===Nl&&t===Bl&&(i="LinearSRGBToLinearDisplayP3"),o){case Vi:case Ql:return[i,"LinearTransferOETF"];case rn:case Nh:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",o),[i,"LinearTransferOETF"]}}function xd(o,e,t){const i=o.getShaderParameter(e,o.COMPILE_STATUS),n=o.getShaderInfoLog(e).trim();if(i&&n==="")return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const a=parseInt(s[1]);return t.toUpperCase()+`

`+n+`

`+Y2(o.getShaderSource(e),a)}else return n}function K2(o,e){const t=Z2(e);return`vec4 ${o}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function Q2(o,e){let t;switch(e){case np:t="Linear";break;case sp:t="Reinhard";break;case ap:t="OptimizedCineon";break;case Rl:t="ACESFilmic";break;case rp:t="AgX";break;case op:t="Neutral";break;case $g:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+o+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function J2(o){return[o.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",o.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(fo).join(`
`)}function eb(o){const e=[];for(const t in o){const i=o[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function tb(o,e){const t={},i=o.getProgramParameter(e,o.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const s=o.getActiveAttrib(e,n),a=s.name;let r=1;s.type===o.FLOAT_MAT2&&(r=2),s.type===o.FLOAT_MAT3&&(r=3),s.type===o.FLOAT_MAT4&&(r=4),t[a]={type:s.type,location:o.getAttribLocation(e,a),locationSize:r}}return t}function fo(o){return o!==""}function Sd(o,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return o.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ad(o,e){return o.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ib=/^[ \t]*#include +<([\w\d./]+)>/gm;function bh(o){return o.replace(ib,sb)}const nb=new Map;function sb(o,e){let t=jt[e];if(t===void 0){const i=nb.get(e);if(i!==void 0)t=jt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return bh(t)}const ab=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Td(o){return o.replace(ab,rb)}function rb(o,e,t,i){let n="";for(let s=parseInt(e);s<parseInt(t);s++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function Ed(o){let e=`precision ${o.precision} float;
	precision ${o.precision} int;
	precision ${o.precision} sampler2D;
	precision ${o.precision} samplerCube;
	precision ${o.precision} sampler3D;
	precision ${o.precision} sampler2DArray;
	precision ${o.precision} sampler2DShadow;
	precision ${o.precision} samplerCubeShadow;
	precision ${o.precision} sampler2DArrayShadow;
	precision ${o.precision} isampler2D;
	precision ${o.precision} isampler3D;
	precision ${o.precision} isamplerCube;
	precision ${o.precision} isampler2DArray;
	precision ${o.precision} usampler2D;
	precision ${o.precision} usampler3D;
	precision ${o.precision} usamplerCube;
	precision ${o.precision} usampler2DArray;
	`;return o.precision==="highp"?e+=`
#define HIGH_PRECISION`:o.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function ob(o){let e="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===tp?e="SHADOWMAP_TYPE_PCF":o.shadowMapType===wg?e="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===Os&&(e="SHADOWMAP_TYPE_VSM"),e}function lb(o){let e="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case Fr:case Or:e="ENVMAP_TYPE_CUBE";break;case Kl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function cb(o){let e="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case Or:e="ENVMAP_MODE_REFRACTION";break}return e}function hb(o){let e="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case ip:e="ENVMAP_BLENDING_MULTIPLY";break;case qg:e="ENVMAP_BLENDING_MIX";break;case Xg:e="ENVMAP_BLENDING_ADD";break}return e}function ub(o){const e=o.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function db(o,e,t,i){const n=o.getContext(),s=t.defines;let a=t.vertexShader,r=t.fragmentShader;const l=ob(t),c=lb(t),h=cb(t),d=hb(t),f=ub(t),p=J2(t),b=eb(s),_=n.createProgram();let y,v,S=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b].filter(fo).join(`
`),y.length>0&&(y+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b].filter(fo).join(`
`),v.length>0&&(v+=`
`)):(y=[Ed(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(fo).join(`
`),v=[Ed(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==pa?"#define TONE_MAPPING":"",t.toneMapping!==pa?jt.tonemapping_pars_fragment:"",t.toneMapping!==pa?Q2("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",jt.colorspace_pars_fragment,K2("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(fo).join(`
`)),a=bh(a),a=Sd(a,t),a=Ad(a,t),r=bh(r),r=Sd(r,t),r=Ad(r,t),a=Td(a),r=Td(r),t.isRawShaderMaterial!==!0&&(S=`#version 300 es
`,y=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+y,v=["#define varying in",t.glslVersion===Hu?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Hu?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const A=S+y+a,E=S+v+r,O=Md(n,n.VERTEX_SHADER,A),R=Md(n,n.FRAGMENT_SHADER,E);n.attachShader(_,O),n.attachShader(_,R),t.index0AttributeName!==void 0?n.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&n.bindAttribLocation(_,0,"position"),n.linkProgram(_);function k(Z){if(o.debug.checkShaderErrors){const z=n.getProgramInfoLog(_).trim(),B=n.getShaderInfoLog(O).trim(),V=n.getShaderInfoLog(R).trim();let Y=!0,J=!0;if(n.getProgramParameter(_,n.LINK_STATUS)===!1)if(Y=!1,typeof o.debug.onShaderError=="function")o.debug.onShaderError(n,_,O,R);else{const Te=xd(n,O,"vertex"),ge=xd(n,R,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(_,n.VALIDATE_STATUS)+`

Material Name: `+Z.name+`
Material Type: `+Z.type+`

Program Info Log: `+z+`
`+Te+`
`+ge)}else z!==""?console.warn("THREE.WebGLProgram: Program Info Log:",z):(B===""||V==="")&&(J=!1);J&&(Z.diagnostics={runnable:Y,programLog:z,vertexShader:{log:B,prefix:y},fragmentShader:{log:V,prefix:v}})}n.deleteShader(O),n.deleteShader(R),U=new Pl(n,_),C=tb(n,_)}let U;this.getUniforms=function(){return U===void 0&&k(this),U};let C;this.getAttributes=function(){return C===void 0&&k(this),C};let T=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return T===!1&&(T=n.getProgramParameter(_,X2)),T},this.destroy=function(){i.releaseStatesOfProgram(this),n.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=$2++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=O,this.fragmentShader=R,this}let fb=0;class pb{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new mb(e),t.set(e,i)),i}}class mb{constructor(e){this.id=fb++,this.code=e,this.usedTimes=0}}function gb(o,e,t,i,n,s,a){const r=new zh,l=new pb,c=new Set,h=[],d=n.logarithmicDepthBuffer,f=n.vertexTextures;let p=n.precision;const b={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(C){return c.add(C),C===0?"uv":`uv${C}`}function y(C,T,Z,z,B){const V=z.fog,Y=B.geometry,J=C.isMeshStandardMaterial?z.environment:null,Te=(C.isMeshStandardMaterial?t:e).get(C.envMap||J),ge=Te&&Te.mapping===Kl?Te.image.height:null,fe=b[C.type];C.precision!==null&&(p=n.getMaxPrecision(C.precision),p!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",p,"instead."));const he=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,Q=he!==void 0?he.length:0;let pe=0;Y.morphAttributes.position!==void 0&&(pe=1),Y.morphAttributes.normal!==void 0&&(pe=2),Y.morphAttributes.color!==void 0&&(pe=3);let ve,K,se,Ee;if(fe){const St=bs[fe];ve=St.vertexShader,K=St.fragmentShader}else ve=C.vertexShader,K=C.fragmentShader,l.update(C),se=l.getVertexShaderID(C),Ee=l.getFragmentShaderID(C);const me=o.getRenderTarget(),Oe=B.isInstancedMesh===!0,Ze=B.isBatchedMesh===!0,le=!!C.map,ke=!!C.matcap,Fe=!!Te,ht=!!C.aoMap,at=!!C.lightMap,Ke=!!C.bumpMap,tt=!!C.normalMap,lt=!!C.displacementMap,qe=!!C.emissiveMap,X=!!C.metalnessMap,F=!!C.roughnessMap,re=C.anisotropy>0,Ie=C.clearcoat>0,ce=C.dispersion>0,Se=C.iridescence>0,Ge=C.sheen>0,$e=C.transmission>0,Qe=re&&!!C.anisotropyMap,je=Ie&&!!C.clearcoatMap,ze=Ie&&!!C.clearcoatNormalMap,st=Ie&&!!C.clearcoatRoughnessMap,pt=Se&&!!C.iridescenceMap,dt=Se&&!!C.iridescenceThicknessMap,rt=Ge&&!!C.sheenColorMap,it=Ge&&!!C.sheenRoughnessMap,mt=!!C.specularMap,Mt=!!C.specularColorMap,wt=!!C.specularIntensityMap,L=$e&&!!C.transmissionMap,ye=$e&&!!C.thicknessMap,_e=!!C.gradientMap,Ue=!!C.alphaMap,Xe=C.alphaTest>0,Pt=!!C.alphaHash,bt=!!C.extensions;let _t=pa;C.toneMapped&&(me===null||me.isXRRenderTarget===!0)&&(_t=o.toneMapping);const Ot={shaderID:fe,shaderType:C.type,shaderName:C.name,vertexShader:ve,fragmentShader:K,defines:C.defines,customVertexShaderID:se,customFragmentShaderID:Ee,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:p,batching:Ze,instancing:Oe,instancingColor:Oe&&B.instanceColor!==null,instancingMorph:Oe&&B.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:me===null?o.outputColorSpace:me.isXRRenderTarget===!0?me.texture.colorSpace:Vi,alphaToCoverage:!!C.alphaToCoverage,map:le,matcap:ke,envMap:Fe,envMapMode:Fe&&Te.mapping,envMapCubeUVHeight:ge,aoMap:ht,lightMap:at,bumpMap:Ke,normalMap:tt,displacementMap:f&&lt,emissiveMap:qe,normalMapObjectSpace:tt&&C.normalMapType===h0,normalMapTangentSpace:tt&&C.normalMapType===wp,metalnessMap:X,roughnessMap:F,anisotropy:re,anisotropyMap:Qe,clearcoat:Ie,clearcoatMap:je,clearcoatNormalMap:ze,clearcoatRoughnessMap:st,dispersion:ce,iridescence:Se,iridescenceMap:pt,iridescenceThicknessMap:dt,sheen:Ge,sheenColorMap:rt,sheenRoughnessMap:it,specularMap:mt,specularColorMap:Mt,specularIntensityMap:wt,transmission:$e,transmissionMap:L,thicknessMap:ye,gradientMap:_e,opaque:C.transparent===!1&&C.blending===Cr&&C.alphaToCoverage===!1,alphaMap:Ue,alphaTest:Xe,alphaHash:Pt,combine:C.combine,mapUv:le&&_(C.map.channel),aoMapUv:ht&&_(C.aoMap.channel),lightMapUv:at&&_(C.lightMap.channel),bumpMapUv:Ke&&_(C.bumpMap.channel),normalMapUv:tt&&_(C.normalMap.channel),displacementMapUv:lt&&_(C.displacementMap.channel),emissiveMapUv:qe&&_(C.emissiveMap.channel),metalnessMapUv:X&&_(C.metalnessMap.channel),roughnessMapUv:F&&_(C.roughnessMap.channel),anisotropyMapUv:Qe&&_(C.anisotropyMap.channel),clearcoatMapUv:je&&_(C.clearcoatMap.channel),clearcoatNormalMapUv:ze&&_(C.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:st&&_(C.clearcoatRoughnessMap.channel),iridescenceMapUv:pt&&_(C.iridescenceMap.channel),iridescenceThicknessMapUv:dt&&_(C.iridescenceThicknessMap.channel),sheenColorMapUv:rt&&_(C.sheenColorMap.channel),sheenRoughnessMapUv:it&&_(C.sheenRoughnessMap.channel),specularMapUv:mt&&_(C.specularMap.channel),specularColorMapUv:Mt&&_(C.specularColorMap.channel),specularIntensityMapUv:wt&&_(C.specularIntensityMap.channel),transmissionMapUv:L&&_(C.transmissionMap.channel),thicknessMapUv:ye&&_(C.thicknessMap.channel),alphaMapUv:Ue&&_(C.alphaMap.channel),vertexTangents:!!Y.attributes.tangent&&(tt||re),vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,pointsUvs:B.isPoints===!0&&!!Y.attributes.uv&&(le||Ue),fog:!!V,useFog:C.fog===!0,fogExp2:!!V&&V.isFogExp2,flatShading:C.flatShading===!0,sizeAttenuation:C.sizeAttenuation===!0,logarithmicDepthBuffer:d,skinning:B.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:Q,morphTextureStride:pe,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numSpotLightMaps:T.spotLightMap.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numSpotLightShadowsWithMaps:T.numSpotLightShadowsWithMaps,numLightProbes:T.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:C.dithering,shadowMapEnabled:o.shadowMap.enabled&&Z.length>0,shadowMapType:o.shadowMap.type,toneMapping:_t,useLegacyLights:o._useLegacyLights,decodeVideoTexture:le&&C.map.isVideoTexture===!0&&si.getTransfer(C.map.colorSpace)===yi,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===Ai,flipSided:C.side===hn,useDepthPacking:C.depthPacking>=0,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionClipCullDistance:bt&&C.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:bt&&C.extensions.multiDraw===!0&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:C.customProgramCacheKey()};return Ot.vertexUv1s=c.has(1),Ot.vertexUv2s=c.has(2),Ot.vertexUv3s=c.has(3),c.clear(),Ot}function v(C){const T=[];if(C.shaderID?T.push(C.shaderID):(T.push(C.customVertexShaderID),T.push(C.customFragmentShaderID)),C.defines!==void 0)for(const Z in C.defines)T.push(Z),T.push(C.defines[Z]);return C.isRawShaderMaterial===!1&&(S(T,C),A(T,C),T.push(o.outputColorSpace)),T.push(C.customProgramCacheKey),T.join()}function S(C,T){C.push(T.precision),C.push(T.outputColorSpace),C.push(T.envMapMode),C.push(T.envMapCubeUVHeight),C.push(T.mapUv),C.push(T.alphaMapUv),C.push(T.lightMapUv),C.push(T.aoMapUv),C.push(T.bumpMapUv),C.push(T.normalMapUv),C.push(T.displacementMapUv),C.push(T.emissiveMapUv),C.push(T.metalnessMapUv),C.push(T.roughnessMapUv),C.push(T.anisotropyMapUv),C.push(T.clearcoatMapUv),C.push(T.clearcoatNormalMapUv),C.push(T.clearcoatRoughnessMapUv),C.push(T.iridescenceMapUv),C.push(T.iridescenceThicknessMapUv),C.push(T.sheenColorMapUv),C.push(T.sheenRoughnessMapUv),C.push(T.specularMapUv),C.push(T.specularColorMapUv),C.push(T.specularIntensityMapUv),C.push(T.transmissionMapUv),C.push(T.thicknessMapUv),C.push(T.combine),C.push(T.fogExp2),C.push(T.sizeAttenuation),C.push(T.morphTargetsCount),C.push(T.morphAttributeCount),C.push(T.numDirLights),C.push(T.numPointLights),C.push(T.numSpotLights),C.push(T.numSpotLightMaps),C.push(T.numHemiLights),C.push(T.numRectAreaLights),C.push(T.numDirLightShadows),C.push(T.numPointLightShadows),C.push(T.numSpotLightShadows),C.push(T.numSpotLightShadowsWithMaps),C.push(T.numLightProbes),C.push(T.shadowMapType),C.push(T.toneMapping),C.push(T.numClippingPlanes),C.push(T.numClipIntersection),C.push(T.depthPacking)}function A(C,T){r.disableAll(),T.supportsVertexTextures&&r.enable(0),T.instancing&&r.enable(1),T.instancingColor&&r.enable(2),T.instancingMorph&&r.enable(3),T.matcap&&r.enable(4),T.envMap&&r.enable(5),T.normalMapObjectSpace&&r.enable(6),T.normalMapTangentSpace&&r.enable(7),T.clearcoat&&r.enable(8),T.iridescence&&r.enable(9),T.alphaTest&&r.enable(10),T.vertexColors&&r.enable(11),T.vertexAlphas&&r.enable(12),T.vertexUv1s&&r.enable(13),T.vertexUv2s&&r.enable(14),T.vertexUv3s&&r.enable(15),T.vertexTangents&&r.enable(16),T.anisotropy&&r.enable(17),T.alphaHash&&r.enable(18),T.batching&&r.enable(19),T.dispersion&&r.enable(20),C.push(r.mask),r.disableAll(),T.fog&&r.enable(0),T.useFog&&r.enable(1),T.flatShading&&r.enable(2),T.logarithmicDepthBuffer&&r.enable(3),T.skinning&&r.enable(4),T.morphTargets&&r.enable(5),T.morphNormals&&r.enable(6),T.morphColors&&r.enable(7),T.premultipliedAlpha&&r.enable(8),T.shadowMapEnabled&&r.enable(9),T.useLegacyLights&&r.enable(10),T.doubleSided&&r.enable(11),T.flipSided&&r.enable(12),T.useDepthPacking&&r.enable(13),T.dithering&&r.enable(14),T.transmission&&r.enable(15),T.sheen&&r.enable(16),T.opaque&&r.enable(17),T.pointsUvs&&r.enable(18),T.decodeVideoTexture&&r.enable(19),T.alphaToCoverage&&r.enable(20),C.push(r.mask)}function E(C){const T=b[C.type];let Z;if(T){const z=bs[T];Z=Jl.clone(z.uniforms)}else Z=C.uniforms;return Z}function O(C,T){let Z;for(let z=0,B=h.length;z<B;z++){const V=h[z];if(V.cacheKey===T){Z=V,++Z.usedTimes;break}}return Z===void 0&&(Z=new db(o,T,C,s),h.push(Z)),Z}function R(C){if(--C.usedTimes===0){const T=h.indexOf(C);h[T]=h[h.length-1],h.pop(),C.destroy()}}function k(C){l.remove(C)}function U(){l.dispose()}return{getParameters:y,getProgramCacheKey:v,getUniforms:E,acquireProgram:O,releaseProgram:R,releaseShaderCache:k,programs:h,dispose:U}}function yb(){let o=new WeakMap;function e(s){let a=o.get(s);return a===void 0&&(a={},o.set(s,a)),a}function t(s){o.delete(s)}function i(s,a,r){o.get(s)[a]=r}function n(){o=new WeakMap}return{get:e,remove:t,update:i,dispose:n}}function vb(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.material.id!==e.material.id?o.material.id-e.material.id:o.z!==e.z?o.z-e.z:o.id-e.id}function Cd(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.z!==e.z?e.z-o.z:o.id-e.id}function Pd(){const o=[];let e=0;const t=[],i=[],n=[];function s(){e=0,t.length=0,i.length=0,n.length=0}function a(d,f,p,b,_,y){let v=o[e];return v===void 0?(v={id:d.id,object:d,geometry:f,material:p,groupOrder:b,renderOrder:d.renderOrder,z:_,group:y},o[e]=v):(v.id=d.id,v.object=d,v.geometry=f,v.material=p,v.groupOrder=b,v.renderOrder=d.renderOrder,v.z=_,v.group=y),e++,v}function r(d,f,p,b,_,y){const v=a(d,f,p,b,_,y);p.transmission>0?i.push(v):p.transparent===!0?n.push(v):t.push(v)}function l(d,f,p,b,_,y){const v=a(d,f,p,b,_,y);p.transmission>0?i.unshift(v):p.transparent===!0?n.unshift(v):t.unshift(v)}function c(d,f){t.length>1&&t.sort(d||vb),i.length>1&&i.sort(f||Cd),n.length>1&&n.sort(f||Cd)}function h(){for(let d=e,f=o.length;d<f;d++){const p=o[d];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:n,init:s,push:r,unshift:l,finish:h,sort:c}}function bb(){let o=new WeakMap;function e(i,n){const s=o.get(i);let a;return s===void 0?(a=new Pd,o.set(i,[a])):n>=s.length?(a=new Pd,s.push(a)):a=s[n],a}function t(){o=new WeakMap}return{get:e,dispose:t}}function wb(){const o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new D,color:new Dt};break;case"SpotLight":t={position:new D,direction:new D,color:new Dt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new D,color:new Dt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new D,skyColor:new Dt,groundColor:new Dt};break;case"RectAreaLight":t={color:new Dt,position:new D,halfWidth:new D,halfHeight:new D};break}return o[e.id]=t,t}}}function _b(){const o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new et};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new et};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new et,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[e.id]=t,t}}}let Mb=0;function xb(o,e){return(e.castShadow?2:0)-(o.castShadow?2:0)+(e.map?1:0)-(o.map?1:0)}function Sb(o){const e=new wb,t=_b(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new D);const n=new D,s=new Ft,a=new Ft;function r(c,h){let d=0,f=0,p=0;for(let Z=0;Z<9;Z++)i.probe[Z].set(0,0,0);let b=0,_=0,y=0,v=0,S=0,A=0,E=0,O=0,R=0,k=0,U=0;c.sort(xb);const C=h===!0?Math.PI:1;for(let Z=0,z=c.length;Z<z;Z++){const B=c[Z],V=B.color,Y=B.intensity,J=B.distance,Te=B.shadow&&B.shadow.map?B.shadow.map.texture:null;if(B.isAmbientLight)d+=V.r*Y*C,f+=V.g*Y*C,p+=V.b*Y*C;else if(B.isLightProbe){for(let ge=0;ge<9;ge++)i.probe[ge].addScaledVector(B.sh.coefficients[ge],Y);U++}else if(B.isDirectionalLight){const ge=e.get(B);if(ge.color.copy(B.color).multiplyScalar(B.intensity*C),B.castShadow){const fe=B.shadow,he=t.get(B);he.shadowBias=fe.bias,he.shadowNormalBias=fe.normalBias,he.shadowRadius=fe.radius,he.shadowMapSize=fe.mapSize,i.directionalShadow[b]=he,i.directionalShadowMap[b]=Te,i.directionalShadowMatrix[b]=B.shadow.matrix,A++}i.directional[b]=ge,b++}else if(B.isSpotLight){const ge=e.get(B);ge.position.setFromMatrixPosition(B.matrixWorld),ge.color.copy(V).multiplyScalar(Y*C),ge.distance=J,ge.coneCos=Math.cos(B.angle),ge.penumbraCos=Math.cos(B.angle*(1-B.penumbra)),ge.decay=B.decay,i.spot[y]=ge;const fe=B.shadow;if(B.map&&(i.spotLightMap[R]=B.map,R++,fe.updateMatrices(B),B.castShadow&&k++),i.spotLightMatrix[y]=fe.matrix,B.castShadow){const he=t.get(B);he.shadowBias=fe.bias,he.shadowNormalBias=fe.normalBias,he.shadowRadius=fe.radius,he.shadowMapSize=fe.mapSize,i.spotShadow[y]=he,i.spotShadowMap[y]=Te,O++}y++}else if(B.isRectAreaLight){const ge=e.get(B);ge.color.copy(V).multiplyScalar(Y),ge.halfWidth.set(B.width*.5,0,0),ge.halfHeight.set(0,B.height*.5,0),i.rectArea[v]=ge,v++}else if(B.isPointLight){const ge=e.get(B);if(ge.color.copy(B.color).multiplyScalar(B.intensity*C),ge.distance=B.distance,ge.decay=B.decay,B.castShadow){const fe=B.shadow,he=t.get(B);he.shadowBias=fe.bias,he.shadowNormalBias=fe.normalBias,he.shadowRadius=fe.radius,he.shadowMapSize=fe.mapSize,he.shadowCameraNear=fe.camera.near,he.shadowCameraFar=fe.camera.far,i.pointShadow[_]=he,i.pointShadowMap[_]=Te,i.pointShadowMatrix[_]=B.shadow.matrix,E++}i.point[_]=ge,_++}else if(B.isHemisphereLight){const ge=e.get(B);ge.skyColor.copy(B.color).multiplyScalar(Y*C),ge.groundColor.copy(B.groundColor).multiplyScalar(Y*C),i.hemi[S]=ge,S++}}v>0&&(o.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=yt.LTC_FLOAT_1,i.rectAreaLTC2=yt.LTC_FLOAT_2):(i.rectAreaLTC1=yt.LTC_HALF_1,i.rectAreaLTC2=yt.LTC_HALF_2)),i.ambient[0]=d,i.ambient[1]=f,i.ambient[2]=p;const T=i.hash;(T.directionalLength!==b||T.pointLength!==_||T.spotLength!==y||T.rectAreaLength!==v||T.hemiLength!==S||T.numDirectionalShadows!==A||T.numPointShadows!==E||T.numSpotShadows!==O||T.numSpotMaps!==R||T.numLightProbes!==U)&&(i.directional.length=b,i.spot.length=y,i.rectArea.length=v,i.point.length=_,i.hemi.length=S,i.directionalShadow.length=A,i.directionalShadowMap.length=A,i.pointShadow.length=E,i.pointShadowMap.length=E,i.spotShadow.length=O,i.spotShadowMap.length=O,i.directionalShadowMatrix.length=A,i.pointShadowMatrix.length=E,i.spotLightMatrix.length=O+R-k,i.spotLightMap.length=R,i.numSpotLightShadowsWithMaps=k,i.numLightProbes=U,T.directionalLength=b,T.pointLength=_,T.spotLength=y,T.rectAreaLength=v,T.hemiLength=S,T.numDirectionalShadows=A,T.numPointShadows=E,T.numSpotShadows=O,T.numSpotMaps=R,T.numLightProbes=U,i.version=Mb++)}function l(c,h){let d=0,f=0,p=0,b=0,_=0;const y=h.matrixWorldInverse;for(let v=0,S=c.length;v<S;v++){const A=c[v];if(A.isDirectionalLight){const E=i.directional[d];E.direction.setFromMatrixPosition(A.matrixWorld),n.setFromMatrixPosition(A.target.matrixWorld),E.direction.sub(n),E.direction.transformDirection(y),d++}else if(A.isSpotLight){const E=i.spot[p];E.position.setFromMatrixPosition(A.matrixWorld),E.position.applyMatrix4(y),E.direction.setFromMatrixPosition(A.matrixWorld),n.setFromMatrixPosition(A.target.matrixWorld),E.direction.sub(n),E.direction.transformDirection(y),p++}else if(A.isRectAreaLight){const E=i.rectArea[b];E.position.setFromMatrixPosition(A.matrixWorld),E.position.applyMatrix4(y),a.identity(),s.copy(A.matrixWorld),s.premultiply(y),a.extractRotation(s),E.halfWidth.set(A.width*.5,0,0),E.halfHeight.set(0,A.height*.5,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),b++}else if(A.isPointLight){const E=i.point[f];E.position.setFromMatrixPosition(A.matrixWorld),E.position.applyMatrix4(y),f++}else if(A.isHemisphereLight){const E=i.hemi[_];E.direction.setFromMatrixPosition(A.matrixWorld),E.direction.transformDirection(y),_++}}}return{setup:r,setupView:l,state:i}}function kd(o){const e=new Sb(o),t=[],i=[];function n(h){c.camera=h,t.length=0,i.length=0}function s(h){t.push(h)}function a(h){i.push(h)}function r(h){e.setup(t,h)}function l(h){e.setupView(t,h)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:n,state:c,setupLights:r,setupLightsView:l,pushLight:s,pushShadow:a}}function Ab(o){let e=new WeakMap;function t(n,s=0){const a=e.get(n);let r;return a===void 0?(r=new kd(o),e.set(n,[r])):s>=a.length?(r=new kd(o),a.push(r)):r=a[s],r}function i(){e=new WeakMap}return{get:t,dispose:i}}class Bp extends Vn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=c0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class zp extends Vn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const Tb=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Eb=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Cb(o,e,t){let i=new Vh;const n=new et,s=new et,a=new ui,r=new Bp({depthPacking:bp}),l=new zp,c={},h=t.maxTextureSize,d={[zn]:hn,[hn]:zn,[Ai]:Ai},f=new as({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new et},radius:{value:4}},vertexShader:Tb,fragmentShader:Eb}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const b=new fi;b.setAttribute("position",new Ei(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new It(b,f),y=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=tp;let v=this.type;this.render=function(R,k,U){if(y.enabled===!1||y.autoUpdate===!1&&y.needsUpdate===!1||R.length===0)return;const C=o.getRenderTarget(),T=o.getActiveCubeFace(),Z=o.getActiveMipmapLevel(),z=o.state;z.setBlending(Vs),z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);const B=v!==Os&&this.type===Os,V=v===Os&&this.type!==Os;for(let Y=0,J=R.length;Y<J;Y++){const Te=R[Y],ge=Te.shadow;if(ge===void 0){console.warn("THREE.WebGLShadowMap:",Te,"has no shadow.");continue}if(ge.autoUpdate===!1&&ge.needsUpdate===!1)continue;n.copy(ge.mapSize);const fe=ge.getFrameExtents();if(n.multiply(fe),s.copy(ge.mapSize),(n.x>h||n.y>h)&&(n.x>h&&(s.x=Math.floor(h/fe.x),n.x=s.x*fe.x,ge.mapSize.x=s.x),n.y>h&&(s.y=Math.floor(h/fe.y),n.y=s.y*fe.y,ge.mapSize.y=s.y)),ge.map===null||B===!0||V===!0){const Q=this.type!==Os?{minFilter:ln,magFilter:ln}:{};ge.map!==null&&ge.map.dispose(),ge.map=new Hs(n.x,n.y,Q),ge.map.texture.name=Te.name+".shadowMap",ge.camera.updateProjectionMatrix()}o.setRenderTarget(ge.map),o.clear();const he=ge.getViewportCount();for(let Q=0;Q<he;Q++){const pe=ge.getViewport(Q);a.set(s.x*pe.x,s.y*pe.y,s.x*pe.z,s.y*pe.w),z.viewport(a),ge.updateMatrices(Te,Q),i=ge.getFrustum(),E(k,U,ge.camera,Te,this.type)}ge.isPointLightShadow!==!0&&this.type===Os&&S(ge,U),ge.needsUpdate=!1}v=this.type,y.needsUpdate=!1,o.setRenderTarget(C,T,Z)};function S(R,k){const U=e.update(_);f.defines.VSM_SAMPLES!==R.blurSamples&&(f.defines.VSM_SAMPLES=R.blurSamples,p.defines.VSM_SAMPLES=R.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),R.mapPass===null&&(R.mapPass=new Hs(n.x,n.y)),f.uniforms.shadow_pass.value=R.map.texture,f.uniforms.resolution.value=R.mapSize,f.uniforms.radius.value=R.radius,o.setRenderTarget(R.mapPass),o.clear(),o.renderBufferDirect(k,null,U,f,_,null),p.uniforms.shadow_pass.value=R.mapPass.texture,p.uniforms.resolution.value=R.mapSize,p.uniforms.radius.value=R.radius,o.setRenderTarget(R.map),o.clear(),o.renderBufferDirect(k,null,U,p,_,null)}function A(R,k,U,C){let T=null;const Z=U.isPointLight===!0?R.customDistanceMaterial:R.customDepthMaterial;if(Z!==void 0)T=Z;else if(T=U.isPointLight===!0?l:r,o.localClippingEnabled&&k.clipShadows===!0&&Array.isArray(k.clippingPlanes)&&k.clippingPlanes.length!==0||k.displacementMap&&k.displacementScale!==0||k.alphaMap&&k.alphaTest>0||k.map&&k.alphaTest>0){const z=T.uuid,B=k.uuid;let V=c[z];V===void 0&&(V={},c[z]=V);let Y=V[B];Y===void 0&&(Y=T.clone(),V[B]=Y,k.addEventListener("dispose",O)),T=Y}if(T.visible=k.visible,T.wireframe=k.wireframe,C===Os?T.side=k.shadowSide!==null?k.shadowSide:k.side:T.side=k.shadowSide!==null?k.shadowSide:d[k.side],T.alphaMap=k.alphaMap,T.alphaTest=k.alphaTest,T.map=k.map,T.clipShadows=k.clipShadows,T.clippingPlanes=k.clippingPlanes,T.clipIntersection=k.clipIntersection,T.displacementMap=k.displacementMap,T.displacementScale=k.displacementScale,T.displacementBias=k.displacementBias,T.wireframeLinewidth=k.wireframeLinewidth,T.linewidth=k.linewidth,U.isPointLight===!0&&T.isMeshDistanceMaterial===!0){const z=o.properties.get(T);z.light=U}return T}function E(R,k,U,C,T){if(R.visible===!1)return;if(R.layers.test(k.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&T===Os)&&(!R.frustumCulled||i.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,R.matrixWorld);const B=e.update(R),V=R.material;if(Array.isArray(V)){const Y=B.groups;for(let J=0,Te=Y.length;J<Te;J++){const ge=Y[J],fe=V[ge.materialIndex];if(fe&&fe.visible){const he=A(R,fe,C,T);R.onBeforeShadow(o,R,k,U,B,he,ge),o.renderBufferDirect(U,null,B,he,R,ge),R.onAfterShadow(o,R,k,U,B,he,ge)}}}else if(V.visible){const Y=A(R,V,C,T);R.onBeforeShadow(o,R,k,U,B,Y,null),o.renderBufferDirect(U,null,B,Y,R,null),R.onAfterShadow(o,R,k,U,B,Y,null)}}const z=R.children;for(let B=0,V=z.length;B<V;B++)E(z[B],k,U,C,T)}function O(R){R.target.removeEventListener("dispose",O);for(const U in c){const C=c[U],T=R.target.uuid;T in C&&(C[T].dispose(),delete C[T])}}}function Pb(o){function e(){let L=!1;const ye=new ui;let _e=null;const Ue=new ui(0,0,0,0);return{setMask:function(Xe){_e!==Xe&&!L&&(o.colorMask(Xe,Xe,Xe,Xe),_e=Xe)},setLocked:function(Xe){L=Xe},setClear:function(Xe,Pt,bt,_t,Ot){Ot===!0&&(Xe*=_t,Pt*=_t,bt*=_t),ye.set(Xe,Pt,bt,_t),Ue.equals(ye)===!1&&(o.clearColor(Xe,Pt,bt,_t),Ue.copy(ye))},reset:function(){L=!1,_e=null,Ue.set(-1,0,0,0)}}}function t(){let L=!1,ye=null,_e=null,Ue=null;return{setTest:function(Xe){Xe?Ee(o.DEPTH_TEST):me(o.DEPTH_TEST)},setMask:function(Xe){ye!==Xe&&!L&&(o.depthMask(Xe),ye=Xe)},setFunc:function(Xe){if(_e!==Xe){switch(Xe){case Bg:o.depthFunc(o.NEVER);break;case zg:o.depthFunc(o.ALWAYS);break;case Vg:o.depthFunc(o.LESS);break;case Ll:o.depthFunc(o.LEQUAL);break;case Hg:o.depthFunc(o.EQUAL);break;case Gg:o.depthFunc(o.GEQUAL);break;case Wg:o.depthFunc(o.GREATER);break;case jg:o.depthFunc(o.NOTEQUAL);break;default:o.depthFunc(o.LEQUAL)}_e=Xe}},setLocked:function(Xe){L=Xe},setClear:function(Xe){Ue!==Xe&&(o.clearDepth(Xe),Ue=Xe)},reset:function(){L=!1,ye=null,_e=null,Ue=null}}}function i(){let L=!1,ye=null,_e=null,Ue=null,Xe=null,Pt=null,bt=null,_t=null,Ot=null;return{setTest:function(St){L||(St?Ee(o.STENCIL_TEST):me(o.STENCIL_TEST))},setMask:function(St){ye!==St&&!L&&(o.stencilMask(St),ye=St)},setFunc:function(St,At,Lt){(_e!==St||Ue!==At||Xe!==Lt)&&(o.stencilFunc(St,At,Lt),_e=St,Ue=At,Xe=Lt)},setOp:function(St,At,Lt){(Pt!==St||bt!==At||_t!==Lt)&&(o.stencilOp(St,At,Lt),Pt=St,bt=At,_t=Lt)},setLocked:function(St){L=St},setClear:function(St){Ot!==St&&(o.clearStencil(St),Ot=St)},reset:function(){L=!1,ye=null,_e=null,Ue=null,Xe=null,Pt=null,bt=null,_t=null,Ot=null}}}const n=new e,s=new t,a=new i,r=new WeakMap,l=new WeakMap;let c={},h={},d=new WeakMap,f=[],p=null,b=!1,_=null,y=null,v=null,S=null,A=null,E=null,O=null,R=new Dt(0,0,0),k=0,U=!1,C=null,T=null,Z=null,z=null,B=null;const V=o.getParameter(o.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Y=!1,J=0;const Te=o.getParameter(o.VERSION);Te.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(Te)[1]),Y=J>=1):Te.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(Te)[1]),Y=J>=2);let ge=null,fe={};const he=o.getParameter(o.SCISSOR_BOX),Q=o.getParameter(o.VIEWPORT),pe=new ui().fromArray(he),ve=new ui().fromArray(Q);function K(L,ye,_e,Ue){const Xe=new Uint8Array(4),Pt=o.createTexture();o.bindTexture(L,Pt),o.texParameteri(L,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(L,o.TEXTURE_MAG_FILTER,o.NEAREST);for(let bt=0;bt<_e;bt++)L===o.TEXTURE_3D||L===o.TEXTURE_2D_ARRAY?o.texImage3D(ye,0,o.RGBA,1,1,Ue,0,o.RGBA,o.UNSIGNED_BYTE,Xe):o.texImage2D(ye+bt,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,Xe);return Pt}const se={};se[o.TEXTURE_2D]=K(o.TEXTURE_2D,o.TEXTURE_2D,1),se[o.TEXTURE_CUBE_MAP]=K(o.TEXTURE_CUBE_MAP,o.TEXTURE_CUBE_MAP_POSITIVE_X,6),se[o.TEXTURE_2D_ARRAY]=K(o.TEXTURE_2D_ARRAY,o.TEXTURE_2D_ARRAY,1,1),se[o.TEXTURE_3D]=K(o.TEXTURE_3D,o.TEXTURE_3D,1,1),n.setClear(0,0,0,1),s.setClear(1),a.setClear(0),Ee(o.DEPTH_TEST),s.setFunc(Ll),Ke(!1),tt(hu),Ee(o.CULL_FACE),ht(Vs);function Ee(L){c[L]!==!0&&(o.enable(L),c[L]=!0)}function me(L){c[L]!==!1&&(o.disable(L),c[L]=!1)}function Oe(L,ye){return h[L]!==ye?(o.bindFramebuffer(L,ye),h[L]=ye,L===o.DRAW_FRAMEBUFFER&&(h[o.FRAMEBUFFER]=ye),L===o.FRAMEBUFFER&&(h[o.DRAW_FRAMEBUFFER]=ye),!0):!1}function Ze(L,ye){let _e=f,Ue=!1;if(L){_e=d.get(ye),_e===void 0&&(_e=[],d.set(ye,_e));const Xe=L.textures;if(_e.length!==Xe.length||_e[0]!==o.COLOR_ATTACHMENT0){for(let Pt=0,bt=Xe.length;Pt<bt;Pt++)_e[Pt]=o.COLOR_ATTACHMENT0+Pt;_e.length=Xe.length,Ue=!0}}else _e[0]!==o.BACK&&(_e[0]=o.BACK,Ue=!0);Ue&&o.drawBuffers(_e)}function le(L){return p!==L?(o.useProgram(L),p=L,!0):!1}const ke={[Ba]:o.FUNC_ADD,[Mg]:o.FUNC_SUBTRACT,[xg]:o.FUNC_REVERSE_SUBTRACT};ke[Sg]=o.MIN,ke[Ag]=o.MAX;const Fe={[Tg]:o.ZERO,[Eg]:o.ONE,[Cg]:o.SRC_COLOR,[ph]:o.SRC_ALPHA,[Dg]:o.SRC_ALPHA_SATURATE,[Lg]:o.DST_COLOR,[kg]:o.DST_ALPHA,[Pg]:o.ONE_MINUS_SRC_COLOR,[mh]:o.ONE_MINUS_SRC_ALPHA,[Rg]:o.ONE_MINUS_DST_COLOR,[Ig]:o.ONE_MINUS_DST_ALPHA,[Fg]:o.CONSTANT_COLOR,[Og]:o.ONE_MINUS_CONSTANT_COLOR,[Ug]:o.CONSTANT_ALPHA,[Ng]:o.ONE_MINUS_CONSTANT_ALPHA};function ht(L,ye,_e,Ue,Xe,Pt,bt,_t,Ot,St){if(L===Vs){b===!0&&(me(o.BLEND),b=!1);return}if(b===!1&&(Ee(o.BLEND),b=!0),L!==_g){if(L!==_||St!==U){if((y!==Ba||A!==Ba)&&(o.blendEquation(o.FUNC_ADD),y=Ba,A=Ba),St)switch(L){case Cr:o.blendFuncSeparate(o.ONE,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);break;case uu:o.blendFunc(o.ONE,o.ONE);break;case du:o.blendFuncSeparate(o.ZERO,o.ONE_MINUS_SRC_COLOR,o.ZERO,o.ONE);break;case fu:o.blendFuncSeparate(o.ZERO,o.SRC_COLOR,o.ZERO,o.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",L);break}else switch(L){case Cr:o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);break;case uu:o.blendFunc(o.SRC_ALPHA,o.ONE);break;case du:o.blendFuncSeparate(o.ZERO,o.ONE_MINUS_SRC_COLOR,o.ZERO,o.ONE);break;case fu:o.blendFunc(o.ZERO,o.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",L);break}v=null,S=null,E=null,O=null,R.set(0,0,0),k=0,_=L,U=St}return}Xe=Xe||ye,Pt=Pt||_e,bt=bt||Ue,(ye!==y||Xe!==A)&&(o.blendEquationSeparate(ke[ye],ke[Xe]),y=ye,A=Xe),(_e!==v||Ue!==S||Pt!==E||bt!==O)&&(o.blendFuncSeparate(Fe[_e],Fe[Ue],Fe[Pt],Fe[bt]),v=_e,S=Ue,E=Pt,O=bt),(_t.equals(R)===!1||Ot!==k)&&(o.blendColor(_t.r,_t.g,_t.b,Ot),R.copy(_t),k=Ot),_=L,U=!1}function at(L,ye){L.side===Ai?me(o.CULL_FACE):Ee(o.CULL_FACE);let _e=L.side===hn;ye&&(_e=!_e),Ke(_e),L.blending===Cr&&L.transparent===!1?ht(Vs):ht(L.blending,L.blendEquation,L.blendSrc,L.blendDst,L.blendEquationAlpha,L.blendSrcAlpha,L.blendDstAlpha,L.blendColor,L.blendAlpha,L.premultipliedAlpha),s.setFunc(L.depthFunc),s.setTest(L.depthTest),s.setMask(L.depthWrite),n.setMask(L.colorWrite);const Ue=L.stencilWrite;a.setTest(Ue),Ue&&(a.setMask(L.stencilWriteMask),a.setFunc(L.stencilFunc,L.stencilRef,L.stencilFuncMask),a.setOp(L.stencilFail,L.stencilZFail,L.stencilZPass)),qe(L.polygonOffset,L.polygonOffsetFactor,L.polygonOffsetUnits),L.alphaToCoverage===!0?Ee(o.SAMPLE_ALPHA_TO_COVERAGE):me(o.SAMPLE_ALPHA_TO_COVERAGE)}function Ke(L){C!==L&&(L?o.frontFace(o.CW):o.frontFace(o.CCW),C=L)}function tt(L){L!==vg?(Ee(o.CULL_FACE),L!==T&&(L===hu?o.cullFace(o.BACK):L===bg?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK))):me(o.CULL_FACE),T=L}function lt(L){L!==Z&&(Y&&o.lineWidth(L),Z=L)}function qe(L,ye,_e){L?(Ee(o.POLYGON_OFFSET_FILL),(z!==ye||B!==_e)&&(o.polygonOffset(ye,_e),z=ye,B=_e)):me(o.POLYGON_OFFSET_FILL)}function X(L){L?Ee(o.SCISSOR_TEST):me(o.SCISSOR_TEST)}function F(L){L===void 0&&(L=o.TEXTURE0+V-1),ge!==L&&(o.activeTexture(L),ge=L)}function re(L,ye,_e){_e===void 0&&(ge===null?_e=o.TEXTURE0+V-1:_e=ge);let Ue=fe[_e];Ue===void 0&&(Ue={type:void 0,texture:void 0},fe[_e]=Ue),(Ue.type!==L||Ue.texture!==ye)&&(ge!==_e&&(o.activeTexture(_e),ge=_e),o.bindTexture(L,ye||se[L]),Ue.type=L,Ue.texture=ye)}function Ie(){const L=fe[ge];L!==void 0&&L.type!==void 0&&(o.bindTexture(L.type,null),L.type=void 0,L.texture=void 0)}function ce(){try{o.compressedTexImage2D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Se(){try{o.compressedTexImage3D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Ge(){try{o.texSubImage2D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function $e(){try{o.texSubImage3D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function Qe(){try{o.compressedTexSubImage2D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function je(){try{o.compressedTexSubImage3D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function ze(){try{o.texStorage2D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function st(){try{o.texStorage3D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function pt(){try{o.texImage2D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function dt(){try{o.texImage3D.apply(o,arguments)}catch(L){console.error("THREE.WebGLState:",L)}}function rt(L){pe.equals(L)===!1&&(o.scissor(L.x,L.y,L.z,L.w),pe.copy(L))}function it(L){ve.equals(L)===!1&&(o.viewport(L.x,L.y,L.z,L.w),ve.copy(L))}function mt(L,ye){let _e=l.get(ye);_e===void 0&&(_e=new WeakMap,l.set(ye,_e));let Ue=_e.get(L);Ue===void 0&&(Ue=o.getUniformBlockIndex(ye,L.name),_e.set(L,Ue))}function Mt(L,ye){const Ue=l.get(ye).get(L);r.get(ye)!==Ue&&(o.uniformBlockBinding(ye,Ue,L.__bindingPointIndex),r.set(ye,Ue))}function wt(){o.disable(o.BLEND),o.disable(o.CULL_FACE),o.disable(o.DEPTH_TEST),o.disable(o.POLYGON_OFFSET_FILL),o.disable(o.SCISSOR_TEST),o.disable(o.STENCIL_TEST),o.disable(o.SAMPLE_ALPHA_TO_COVERAGE),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ONE,o.ZERO),o.blendFuncSeparate(o.ONE,o.ZERO,o.ONE,o.ZERO),o.blendColor(0,0,0,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(o.LESS),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(o.ALWAYS,0,4294967295),o.stencilOp(o.KEEP,o.KEEP,o.KEEP),o.clearStencil(0),o.cullFace(o.BACK),o.frontFace(o.CCW),o.polygonOffset(0,0),o.activeTexture(o.TEXTURE0),o.bindFramebuffer(o.FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,null),o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),c={},ge=null,fe={},h={},d=new WeakMap,f=[],p=null,b=!1,_=null,y=null,v=null,S=null,A=null,E=null,O=null,R=new Dt(0,0,0),k=0,U=!1,C=null,T=null,Z=null,z=null,B=null,pe.set(0,0,o.canvas.width,o.canvas.height),ve.set(0,0,o.canvas.width,o.canvas.height),n.reset(),s.reset(),a.reset()}return{buffers:{color:n,depth:s,stencil:a},enable:Ee,disable:me,bindFramebuffer:Oe,drawBuffers:Ze,useProgram:le,setBlending:ht,setMaterial:at,setFlipSided:Ke,setCullFace:tt,setLineWidth:lt,setPolygonOffset:qe,setScissorTest:X,activeTexture:F,bindTexture:re,unbindTexture:Ie,compressedTexImage2D:ce,compressedTexImage3D:Se,texImage2D:pt,texImage3D:dt,updateUBOMapping:mt,uniformBlockBinding:Mt,texStorage2D:ze,texStorage3D:st,texSubImage2D:Ge,texSubImage3D:$e,compressedTexSubImage2D:Qe,compressedTexSubImage3D:je,scissor:rt,viewport:it,reset:wt}}function kb(o,e,t,i,n,s,a){const r=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new et,h=new WeakMap;let d;const f=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(X,F){return p?new OffscreenCanvas(X,F):To("canvas")}function _(X,F,re){let Ie=1;const ce=qe(X);if((ce.width>re||ce.height>re)&&(Ie=re/Math.max(ce.width,ce.height)),Ie<1)if(typeof HTMLImageElement<"u"&&X instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&X instanceof ImageBitmap||typeof VideoFrame<"u"&&X instanceof VideoFrame){const Se=Math.floor(Ie*ce.width),Ge=Math.floor(Ie*ce.height);d===void 0&&(d=b(Se,Ge));const $e=F?b(Se,Ge):d;return $e.width=Se,$e.height=Ge,$e.getContext("2d").drawImage(X,0,0,Se,Ge),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ce.width+"x"+ce.height+") to ("+Se+"x"+Ge+")."),$e}else return"data"in X&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ce.width+"x"+ce.height+")."),X;return X}function y(X){return X.generateMipmaps&&X.minFilter!==ln&&X.minFilter!==wi}function v(X){o.generateMipmap(X)}function S(X,F,re,Ie,ce=!1){if(X!==null){if(o[X]!==void 0)return o[X];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+X+"'")}let Se=F;if(F===o.RED&&(re===o.FLOAT&&(Se=o.R32F),re===o.HALF_FLOAT&&(Se=o.R16F),re===o.UNSIGNED_BYTE&&(Se=o.R8)),F===o.RED_INTEGER&&(re===o.UNSIGNED_BYTE&&(Se=o.R8UI),re===o.UNSIGNED_SHORT&&(Se=o.R16UI),re===o.UNSIGNED_INT&&(Se=o.R32UI),re===o.BYTE&&(Se=o.R8I),re===o.SHORT&&(Se=o.R16I),re===o.INT&&(Se=o.R32I)),F===o.RG&&(re===o.FLOAT&&(Se=o.RG32F),re===o.HALF_FLOAT&&(Se=o.RG16F),re===o.UNSIGNED_BYTE&&(Se=o.RG8)),F===o.RG_INTEGER&&(re===o.UNSIGNED_BYTE&&(Se=o.RG8UI),re===o.UNSIGNED_SHORT&&(Se=o.RG16UI),re===o.UNSIGNED_INT&&(Se=o.RG32UI),re===o.BYTE&&(Se=o.RG8I),re===o.SHORT&&(Se=o.RG16I),re===o.INT&&(Se=o.RG32I)),F===o.RGB&&re===o.UNSIGNED_INT_5_9_9_9_REV&&(Se=o.RGB9_E5),F===o.RGBA){const Ge=ce?Ul:si.getTransfer(Ie);re===o.FLOAT&&(Se=o.RGBA32F),re===o.HALF_FLOAT&&(Se=o.RGBA16F),re===o.UNSIGNED_BYTE&&(Se=Ge===yi?o.SRGB8_ALPHA8:o.RGBA8),re===o.UNSIGNED_SHORT_4_4_4_4&&(Se=o.RGBA4),re===o.UNSIGNED_SHORT_5_5_5_1&&(Se=o.RGB5_A1)}return(Se===o.R16F||Se===o.R32F||Se===o.RG16F||Se===o.RG32F||Se===o.RGBA16F||Se===o.RGBA32F)&&e.get("EXT_color_buffer_float"),Se}function A(X,F){return y(X)===!0||X.isFramebufferTexture&&X.minFilter!==ln&&X.minFilter!==wi?Math.log2(Math.max(F.width,F.height))+1:X.mipmaps!==void 0&&X.mipmaps.length>0?X.mipmaps.length:X.isCompressedTexture&&Array.isArray(X.image)?F.mipmaps.length:1}function E(X){const F=X.target;F.removeEventListener("dispose",E),R(F),F.isVideoTexture&&h.delete(F)}function O(X){const F=X.target;F.removeEventListener("dispose",O),U(F)}function R(X){const F=i.get(X);if(F.__webglInit===void 0)return;const re=X.source,Ie=f.get(re);if(Ie){const ce=Ie[F.__cacheKey];ce.usedTimes--,ce.usedTimes===0&&k(X),Object.keys(Ie).length===0&&f.delete(re)}i.remove(X)}function k(X){const F=i.get(X);o.deleteTexture(F.__webglTexture);const re=X.source,Ie=f.get(re);delete Ie[F.__cacheKey],a.memory.textures--}function U(X){const F=i.get(X);if(X.depthTexture&&X.depthTexture.dispose(),X.isWebGLCubeRenderTarget)for(let Ie=0;Ie<6;Ie++){if(Array.isArray(F.__webglFramebuffer[Ie]))for(let ce=0;ce<F.__webglFramebuffer[Ie].length;ce++)o.deleteFramebuffer(F.__webglFramebuffer[Ie][ce]);else o.deleteFramebuffer(F.__webglFramebuffer[Ie]);F.__webglDepthbuffer&&o.deleteRenderbuffer(F.__webglDepthbuffer[Ie])}else{if(Array.isArray(F.__webglFramebuffer))for(let Ie=0;Ie<F.__webglFramebuffer.length;Ie++)o.deleteFramebuffer(F.__webglFramebuffer[Ie]);else o.deleteFramebuffer(F.__webglFramebuffer);if(F.__webglDepthbuffer&&o.deleteRenderbuffer(F.__webglDepthbuffer),F.__webglMultisampledFramebuffer&&o.deleteFramebuffer(F.__webglMultisampledFramebuffer),F.__webglColorRenderbuffer)for(let Ie=0;Ie<F.__webglColorRenderbuffer.length;Ie++)F.__webglColorRenderbuffer[Ie]&&o.deleteRenderbuffer(F.__webglColorRenderbuffer[Ie]);F.__webglDepthRenderbuffer&&o.deleteRenderbuffer(F.__webglDepthRenderbuffer)}const re=X.textures;for(let Ie=0,ce=re.length;Ie<ce;Ie++){const Se=i.get(re[Ie]);Se.__webglTexture&&(o.deleteTexture(Se.__webglTexture),a.memory.textures--),i.remove(re[Ie])}i.remove(X)}let C=0;function T(){C=0}function Z(){const X=C;return X>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+X+" texture units while this GPU supports only "+n.maxTextures),C+=1,X}function z(X){const F=[];return F.push(X.wrapS),F.push(X.wrapT),F.push(X.wrapR||0),F.push(X.magFilter),F.push(X.minFilter),F.push(X.anisotropy),F.push(X.internalFormat),F.push(X.format),F.push(X.type),F.push(X.generateMipmaps),F.push(X.premultiplyAlpha),F.push(X.flipY),F.push(X.unpackAlignment),F.push(X.colorSpace),F.join()}function B(X,F){const re=i.get(X);if(X.isVideoTexture&&tt(X),X.isRenderTargetTexture===!1&&X.version>0&&re.__version!==X.version){const Ie=X.image;if(Ie===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ie.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{pe(re,X,F);return}}t.bindTexture(o.TEXTURE_2D,re.__webglTexture,o.TEXTURE0+F)}function V(X,F){const re=i.get(X);if(X.version>0&&re.__version!==X.version){pe(re,X,F);return}t.bindTexture(o.TEXTURE_2D_ARRAY,re.__webglTexture,o.TEXTURE0+F)}function Y(X,F){const re=i.get(X);if(X.version>0&&re.__version!==X.version){pe(re,X,F);return}t.bindTexture(o.TEXTURE_3D,re.__webglTexture,o.TEXTURE0+F)}function J(X,F){const re=i.get(X);if(X.version>0&&re.__version!==X.version){ve(re,X,F);return}t.bindTexture(o.TEXTURE_CUBE_MAP,re.__webglTexture,o.TEXTURE0+F)}const Te={[Ur]:o.REPEAT,[ws]:o.CLAMP_TO_EDGE,[Fl]:o.MIRRORED_REPEAT},ge={[ln]:o.NEAREST,[cp]:o.NEAREST_MIPMAP_NEAREST,[uo]:o.NEAREST_MIPMAP_LINEAR,[wi]:o.LINEAR,[El]:o.LINEAR_MIPMAP_NEAREST,[is]:o.LINEAR_MIPMAP_LINEAR},fe={[u0]:o.NEVER,[y0]:o.ALWAYS,[d0]:o.LESS,[_p]:o.LEQUAL,[f0]:o.EQUAL,[g0]:o.GEQUAL,[p0]:o.GREATER,[m0]:o.NOTEQUAL};function he(X,F){if(F.type===Tn&&e.has("OES_texture_float_linear")===!1&&(F.magFilter===wi||F.magFilter===El||F.magFilter===uo||F.magFilter===is||F.minFilter===wi||F.minFilter===El||F.minFilter===uo||F.minFilter===is)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),o.texParameteri(X,o.TEXTURE_WRAP_S,Te[F.wrapS]),o.texParameteri(X,o.TEXTURE_WRAP_T,Te[F.wrapT]),(X===o.TEXTURE_3D||X===o.TEXTURE_2D_ARRAY)&&o.texParameteri(X,o.TEXTURE_WRAP_R,Te[F.wrapR]),o.texParameteri(X,o.TEXTURE_MAG_FILTER,ge[F.magFilter]),o.texParameteri(X,o.TEXTURE_MIN_FILTER,ge[F.minFilter]),F.compareFunction&&(o.texParameteri(X,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE),o.texParameteri(X,o.TEXTURE_COMPARE_FUNC,fe[F.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(F.magFilter===ln||F.minFilter!==uo&&F.minFilter!==is||F.type===Tn&&e.has("OES_texture_float_linear")===!1)return;if(F.anisotropy>1||i.get(F).__currentAnisotropy){const re=e.get("EXT_texture_filter_anisotropic");o.texParameterf(X,re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F.anisotropy,n.getMaxAnisotropy())),i.get(F).__currentAnisotropy=F.anisotropy}}}function Q(X,F){let re=!1;X.__webglInit===void 0&&(X.__webglInit=!0,F.addEventListener("dispose",E));const Ie=F.source;let ce=f.get(Ie);ce===void 0&&(ce={},f.set(Ie,ce));const Se=z(F);if(Se!==X.__cacheKey){ce[Se]===void 0&&(ce[Se]={texture:o.createTexture(),usedTimes:0},a.memory.textures++,re=!0),ce[Se].usedTimes++;const Ge=ce[X.__cacheKey];Ge!==void 0&&(ce[X.__cacheKey].usedTimes--,Ge.usedTimes===0&&k(F)),X.__cacheKey=Se,X.__webglTexture=ce[Se].texture}return re}function pe(X,F,re){let Ie=o.TEXTURE_2D;(F.isDataArrayTexture||F.isCompressedArrayTexture)&&(Ie=o.TEXTURE_2D_ARRAY),F.isData3DTexture&&(Ie=o.TEXTURE_3D);const ce=Q(X,F),Se=F.source;t.bindTexture(Ie,X.__webglTexture,o.TEXTURE0+re);const Ge=i.get(Se);if(Se.version!==Ge.__version||ce===!0){t.activeTexture(o.TEXTURE0+re);const $e=si.getPrimaries(si.workingColorSpace),Qe=F.colorSpace===da?null:si.getPrimaries(F.colorSpace),je=F.colorSpace===da||$e===Qe?o.NONE:o.BROWSER_DEFAULT_WEBGL;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,F.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,F.unpackAlignment),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,je);let ze=_(F.image,!1,n.maxTextureSize);ze=lt(F,ze);const st=s.convert(F.format,F.colorSpace),pt=s.convert(F.type);let dt=S(F.internalFormat,st,pt,F.colorSpace,F.isVideoTexture);he(Ie,F);let rt;const it=F.mipmaps,mt=F.isVideoTexture!==!0,Mt=Ge.__version===void 0||ce===!0,wt=Se.dataReady,L=A(F,ze);if(F.isDepthTexture)dt=o.DEPTH_COMPONENT16,F.type===Tn?dt=o.DEPTH_COMPONENT32F:F.type===Nr?dt=o.DEPTH_COMPONENT24:F.type===Po&&(dt=o.DEPTH24_STENCIL8),Mt&&(mt?t.texStorage2D(o.TEXTURE_2D,1,dt,ze.width,ze.height):t.texImage2D(o.TEXTURE_2D,0,dt,ze.width,ze.height,0,st,pt,null));else if(F.isDataTexture)if(it.length>0){mt&&Mt&&t.texStorage2D(o.TEXTURE_2D,L,dt,it[0].width,it[0].height);for(let ye=0,_e=it.length;ye<_e;ye++)rt=it[ye],mt?wt&&t.texSubImage2D(o.TEXTURE_2D,ye,0,0,rt.width,rt.height,st,pt,rt.data):t.texImage2D(o.TEXTURE_2D,ye,dt,rt.width,rt.height,0,st,pt,rt.data);F.generateMipmaps=!1}else mt?(Mt&&t.texStorage2D(o.TEXTURE_2D,L,dt,ze.width,ze.height),wt&&t.texSubImage2D(o.TEXTURE_2D,0,0,0,ze.width,ze.height,st,pt,ze.data)):t.texImage2D(o.TEXTURE_2D,0,dt,ze.width,ze.height,0,st,pt,ze.data);else if(F.isCompressedTexture)if(F.isCompressedArrayTexture){mt&&Mt&&t.texStorage3D(o.TEXTURE_2D_ARRAY,L,dt,it[0].width,it[0].height,ze.depth);for(let ye=0,_e=it.length;ye<_e;ye++)rt=it[ye],F.format!==Bn?st!==null?mt?wt&&t.compressedTexSubImage3D(o.TEXTURE_2D_ARRAY,ye,0,0,0,rt.width,rt.height,ze.depth,st,rt.data,0,0):t.compressedTexImage3D(o.TEXTURE_2D_ARRAY,ye,dt,rt.width,rt.height,ze.depth,0,rt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):mt?wt&&t.texSubImage3D(o.TEXTURE_2D_ARRAY,ye,0,0,0,rt.width,rt.height,ze.depth,st,pt,rt.data):t.texImage3D(o.TEXTURE_2D_ARRAY,ye,dt,rt.width,rt.height,ze.depth,0,st,pt,rt.data)}else{mt&&Mt&&t.texStorage2D(o.TEXTURE_2D,L,dt,it[0].width,it[0].height);for(let ye=0,_e=it.length;ye<_e;ye++)rt=it[ye],F.format!==Bn?st!==null?mt?wt&&t.compressedTexSubImage2D(o.TEXTURE_2D,ye,0,0,rt.width,rt.height,st,rt.data):t.compressedTexImage2D(o.TEXTURE_2D,ye,dt,rt.width,rt.height,0,rt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):mt?wt&&t.texSubImage2D(o.TEXTURE_2D,ye,0,0,rt.width,rt.height,st,pt,rt.data):t.texImage2D(o.TEXTURE_2D,ye,dt,rt.width,rt.height,0,st,pt,rt.data)}else if(F.isDataArrayTexture)mt?(Mt&&t.texStorage3D(o.TEXTURE_2D_ARRAY,L,dt,ze.width,ze.height,ze.depth),wt&&t.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,0,ze.width,ze.height,ze.depth,st,pt,ze.data)):t.texImage3D(o.TEXTURE_2D_ARRAY,0,dt,ze.width,ze.height,ze.depth,0,st,pt,ze.data);else if(F.isData3DTexture)mt?(Mt&&t.texStorage3D(o.TEXTURE_3D,L,dt,ze.width,ze.height,ze.depth),wt&&t.texSubImage3D(o.TEXTURE_3D,0,0,0,0,ze.width,ze.height,ze.depth,st,pt,ze.data)):t.texImage3D(o.TEXTURE_3D,0,dt,ze.width,ze.height,ze.depth,0,st,pt,ze.data);else if(F.isFramebufferTexture){if(Mt)if(mt)t.texStorage2D(o.TEXTURE_2D,L,dt,ze.width,ze.height);else{let ye=ze.width,_e=ze.height;for(let Ue=0;Ue<L;Ue++)t.texImage2D(o.TEXTURE_2D,Ue,dt,ye,_e,0,st,pt,null),ye>>=1,_e>>=1}}else if(it.length>0){if(mt&&Mt){const ye=qe(it[0]);t.texStorage2D(o.TEXTURE_2D,L,dt,ye.width,ye.height)}for(let ye=0,_e=it.length;ye<_e;ye++)rt=it[ye],mt?wt&&t.texSubImage2D(o.TEXTURE_2D,ye,0,0,st,pt,rt):t.texImage2D(o.TEXTURE_2D,ye,dt,st,pt,rt);F.generateMipmaps=!1}else if(mt){if(Mt){const ye=qe(ze);t.texStorage2D(o.TEXTURE_2D,L,dt,ye.width,ye.height)}wt&&t.texSubImage2D(o.TEXTURE_2D,0,0,0,st,pt,ze)}else t.texImage2D(o.TEXTURE_2D,0,dt,st,pt,ze);y(F)&&v(Ie),Ge.__version=Se.version,F.onUpdate&&F.onUpdate(F)}X.__version=F.version}function ve(X,F,re){if(F.image.length!==6)return;const Ie=Q(X,F),ce=F.source;t.bindTexture(o.TEXTURE_CUBE_MAP,X.__webglTexture,o.TEXTURE0+re);const Se=i.get(ce);if(ce.version!==Se.__version||Ie===!0){t.activeTexture(o.TEXTURE0+re);const Ge=si.getPrimaries(si.workingColorSpace),$e=F.colorSpace===da?null:si.getPrimaries(F.colorSpace),Qe=F.colorSpace===da||Ge===$e?o.NONE:o.BROWSER_DEFAULT_WEBGL;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,F.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,F.unpackAlignment),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qe);const je=F.isCompressedTexture||F.image[0].isCompressedTexture,ze=F.image[0]&&F.image[0].isDataTexture,st=[];for(let _e=0;_e<6;_e++)!je&&!ze?st[_e]=_(F.image[_e],!0,n.maxCubemapSize):st[_e]=ze?F.image[_e].image:F.image[_e],st[_e]=lt(F,st[_e]);const pt=st[0],dt=s.convert(F.format,F.colorSpace),rt=s.convert(F.type),it=S(F.internalFormat,dt,rt,F.colorSpace),mt=F.isVideoTexture!==!0,Mt=Se.__version===void 0||Ie===!0,wt=ce.dataReady;let L=A(F,pt);he(o.TEXTURE_CUBE_MAP,F);let ye;if(je){mt&&Mt&&t.texStorage2D(o.TEXTURE_CUBE_MAP,L,it,pt.width,pt.height);for(let _e=0;_e<6;_e++){ye=st[_e].mipmaps;for(let Ue=0;Ue<ye.length;Ue++){const Xe=ye[Ue];F.format!==Bn?dt!==null?mt?wt&&t.compressedTexSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ue,0,0,Xe.width,Xe.height,dt,Xe.data):t.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ue,it,Xe.width,Xe.height,0,Xe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):mt?wt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ue,0,0,Xe.width,Xe.height,dt,rt,Xe.data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ue,it,Xe.width,Xe.height,0,dt,rt,Xe.data)}}}else{if(ye=F.mipmaps,mt&&Mt){ye.length>0&&L++;const _e=qe(st[0]);t.texStorage2D(o.TEXTURE_CUBE_MAP,L,it,_e.width,_e.height)}for(let _e=0;_e<6;_e++)if(ze){mt?wt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,0,0,st[_e].width,st[_e].height,dt,rt,st[_e].data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,it,st[_e].width,st[_e].height,0,dt,rt,st[_e].data);for(let Ue=0;Ue<ye.length;Ue++){const Pt=ye[Ue].image[_e].image;mt?wt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ue+1,0,0,Pt.width,Pt.height,dt,rt,Pt.data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ue+1,it,Pt.width,Pt.height,0,dt,rt,Pt.data)}}else{mt?wt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,0,0,dt,rt,st[_e]):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,it,dt,rt,st[_e]);for(let Ue=0;Ue<ye.length;Ue++){const Xe=ye[Ue];mt?wt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ue+1,0,0,dt,rt,Xe.image[_e]):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+_e,Ue+1,it,dt,rt,Xe.image[_e])}}}y(F)&&v(o.TEXTURE_CUBE_MAP),Se.__version=ce.version,F.onUpdate&&F.onUpdate(F)}X.__version=F.version}function K(X,F,re,Ie,ce,Se){const Ge=s.convert(re.format,re.colorSpace),$e=s.convert(re.type),Qe=S(re.internalFormat,Ge,$e,re.colorSpace);if(!i.get(F).__hasExternalTextures){const ze=Math.max(1,F.width>>Se),st=Math.max(1,F.height>>Se);ce===o.TEXTURE_3D||ce===o.TEXTURE_2D_ARRAY?t.texImage3D(ce,Se,Qe,ze,st,F.depth,0,Ge,$e,null):t.texImage2D(ce,Se,Qe,ze,st,0,Ge,$e,null)}t.bindFramebuffer(o.FRAMEBUFFER,X),Ke(F)?r.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,Ie,ce,i.get(re).__webglTexture,0,at(F)):(ce===o.TEXTURE_2D||ce>=o.TEXTURE_CUBE_MAP_POSITIVE_X&&ce<=o.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&o.framebufferTexture2D(o.FRAMEBUFFER,Ie,ce,i.get(re).__webglTexture,Se),t.bindFramebuffer(o.FRAMEBUFFER,null)}function se(X,F,re){if(o.bindRenderbuffer(o.RENDERBUFFER,X),F.depthBuffer&&!F.stencilBuffer){let Ie=o.DEPTH_COMPONENT24;if(re||Ke(F)){const ce=F.depthTexture;ce&&ce.isDepthTexture&&(ce.type===Tn?Ie=o.DEPTH_COMPONENT32F:ce.type===Nr&&(Ie=o.DEPTH_COMPONENT24));const Se=at(F);Ke(F)?r.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,Se,Ie,F.width,F.height):o.renderbufferStorageMultisample(o.RENDERBUFFER,Se,Ie,F.width,F.height)}else o.renderbufferStorage(o.RENDERBUFFER,Ie,F.width,F.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,X)}else if(F.depthBuffer&&F.stencilBuffer){const Ie=at(F);re&&Ke(F)===!1?o.renderbufferStorageMultisample(o.RENDERBUFFER,Ie,o.DEPTH24_STENCIL8,F.width,F.height):Ke(F)?r.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,Ie,o.DEPTH24_STENCIL8,F.width,F.height):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,F.width,F.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,X)}else{const Ie=F.textures;for(let ce=0;ce<Ie.length;ce++){const Se=Ie[ce],Ge=s.convert(Se.format,Se.colorSpace),$e=s.convert(Se.type),Qe=S(Se.internalFormat,Ge,$e,Se.colorSpace),je=at(F);re&&Ke(F)===!1?o.renderbufferStorageMultisample(o.RENDERBUFFER,je,Qe,F.width,F.height):Ke(F)?r.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,je,Qe,F.width,F.height):o.renderbufferStorage(o.RENDERBUFFER,Qe,F.width,F.height)}}o.bindRenderbuffer(o.RENDERBUFFER,null)}function Ee(X,F){if(F&&F.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(o.FRAMEBUFFER,X),!(F.depthTexture&&F.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(F.depthTexture).__webglTexture||F.depthTexture.image.width!==F.width||F.depthTexture.image.height!==F.height)&&(F.depthTexture.image.width=F.width,F.depthTexture.image.height=F.height,F.depthTexture.needsUpdate=!0),B(F.depthTexture,0);const Ie=i.get(F.depthTexture).__webglTexture,ce=at(F);if(F.depthTexture.format===Pr)Ke(F)?r.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,Ie,0,ce):o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,Ie,0);else if(F.depthTexture.format===So)Ke(F)?r.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,Ie,0,ce):o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,Ie,0);else throw new Error("Unknown depthTexture format")}function me(X){const F=i.get(X),re=X.isWebGLCubeRenderTarget===!0;if(X.depthTexture&&!F.__autoAllocateDepthBuffer){if(re)throw new Error("target.depthTexture not supported in Cube render targets");Ee(F.__webglFramebuffer,X)}else if(re){F.__webglDepthbuffer=[];for(let Ie=0;Ie<6;Ie++)t.bindFramebuffer(o.FRAMEBUFFER,F.__webglFramebuffer[Ie]),F.__webglDepthbuffer[Ie]=o.createRenderbuffer(),se(F.__webglDepthbuffer[Ie],X,!1)}else t.bindFramebuffer(o.FRAMEBUFFER,F.__webglFramebuffer),F.__webglDepthbuffer=o.createRenderbuffer(),se(F.__webglDepthbuffer,X,!1);t.bindFramebuffer(o.FRAMEBUFFER,null)}function Oe(X,F,re){const Ie=i.get(X);F!==void 0&&K(Ie.__webglFramebuffer,X,X.texture,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,0),re!==void 0&&me(X)}function Ze(X){const F=X.texture,re=i.get(X),Ie=i.get(F);X.addEventListener("dispose",O);const ce=X.textures,Se=X.isWebGLCubeRenderTarget===!0,Ge=ce.length>1;if(Ge||(Ie.__webglTexture===void 0&&(Ie.__webglTexture=o.createTexture()),Ie.__version=F.version,a.memory.textures++),Se){re.__webglFramebuffer=[];for(let $e=0;$e<6;$e++)if(F.mipmaps&&F.mipmaps.length>0){re.__webglFramebuffer[$e]=[];for(let Qe=0;Qe<F.mipmaps.length;Qe++)re.__webglFramebuffer[$e][Qe]=o.createFramebuffer()}else re.__webglFramebuffer[$e]=o.createFramebuffer()}else{if(F.mipmaps&&F.mipmaps.length>0){re.__webglFramebuffer=[];for(let $e=0;$e<F.mipmaps.length;$e++)re.__webglFramebuffer[$e]=o.createFramebuffer()}else re.__webglFramebuffer=o.createFramebuffer();if(Ge)for(let $e=0,Qe=ce.length;$e<Qe;$e++){const je=i.get(ce[$e]);je.__webglTexture===void 0&&(je.__webglTexture=o.createTexture(),a.memory.textures++)}if(X.samples>0&&Ke(X)===!1){re.__webglMultisampledFramebuffer=o.createFramebuffer(),re.__webglColorRenderbuffer=[],t.bindFramebuffer(o.FRAMEBUFFER,re.__webglMultisampledFramebuffer);for(let $e=0;$e<ce.length;$e++){const Qe=ce[$e];re.__webglColorRenderbuffer[$e]=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,re.__webglColorRenderbuffer[$e]);const je=s.convert(Qe.format,Qe.colorSpace),ze=s.convert(Qe.type),st=S(Qe.internalFormat,je,ze,Qe.colorSpace,X.isXRRenderTarget===!0),pt=at(X);o.renderbufferStorageMultisample(o.RENDERBUFFER,pt,st,X.width,X.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+$e,o.RENDERBUFFER,re.__webglColorRenderbuffer[$e])}o.bindRenderbuffer(o.RENDERBUFFER,null),X.depthBuffer&&(re.__webglDepthRenderbuffer=o.createRenderbuffer(),se(re.__webglDepthRenderbuffer,X,!0)),t.bindFramebuffer(o.FRAMEBUFFER,null)}}if(Se){t.bindTexture(o.TEXTURE_CUBE_MAP,Ie.__webglTexture),he(o.TEXTURE_CUBE_MAP,F);for(let $e=0;$e<6;$e++)if(F.mipmaps&&F.mipmaps.length>0)for(let Qe=0;Qe<F.mipmaps.length;Qe++)K(re.__webglFramebuffer[$e][Qe],X,F,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+$e,Qe);else K(re.__webglFramebuffer[$e],X,F,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+$e,0);y(F)&&v(o.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ge){for(let $e=0,Qe=ce.length;$e<Qe;$e++){const je=ce[$e],ze=i.get(je);t.bindTexture(o.TEXTURE_2D,ze.__webglTexture),he(o.TEXTURE_2D,je),K(re.__webglFramebuffer,X,je,o.COLOR_ATTACHMENT0+$e,o.TEXTURE_2D,0),y(je)&&v(o.TEXTURE_2D)}t.unbindTexture()}else{let $e=o.TEXTURE_2D;if((X.isWebGL3DRenderTarget||X.isWebGLArrayRenderTarget)&&($e=X.isWebGL3DRenderTarget?o.TEXTURE_3D:o.TEXTURE_2D_ARRAY),t.bindTexture($e,Ie.__webglTexture),he($e,F),F.mipmaps&&F.mipmaps.length>0)for(let Qe=0;Qe<F.mipmaps.length;Qe++)K(re.__webglFramebuffer[Qe],X,F,o.COLOR_ATTACHMENT0,$e,Qe);else K(re.__webglFramebuffer,X,F,o.COLOR_ATTACHMENT0,$e,0);y(F)&&v($e),t.unbindTexture()}X.depthBuffer&&me(X)}function le(X){const F=X.textures;for(let re=0,Ie=F.length;re<Ie;re++){const ce=F[re];if(y(ce)){const Se=X.isWebGLCubeRenderTarget?o.TEXTURE_CUBE_MAP:o.TEXTURE_2D,Ge=i.get(ce).__webglTexture;t.bindTexture(Se,Ge),v(Se),t.unbindTexture()}}}const ke=[],Fe=[];function ht(X){if(X.samples>0){if(Ke(X)===!1){const F=X.textures,re=X.width,Ie=X.height;let ce=o.COLOR_BUFFER_BIT;const Se=X.stencilBuffer?o.DEPTH_STENCIL_ATTACHMENT:o.DEPTH_ATTACHMENT,Ge=i.get(X),$e=F.length>1;if($e)for(let Qe=0;Qe<F.length;Qe++)t.bindFramebuffer(o.FRAMEBUFFER,Ge.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+Qe,o.RENDERBUFFER,null),t.bindFramebuffer(o.FRAMEBUFFER,Ge.__webglFramebuffer),o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0+Qe,o.TEXTURE_2D,null,0);t.bindFramebuffer(o.READ_FRAMEBUFFER,Ge.__webglMultisampledFramebuffer),t.bindFramebuffer(o.DRAW_FRAMEBUFFER,Ge.__webglFramebuffer);for(let Qe=0;Qe<F.length;Qe++){if(X.resolveDepthBuffer&&(X.depthBuffer&&(ce|=o.DEPTH_BUFFER_BIT),X.stencilBuffer&&X.resolveStencilBuffer&&(ce|=o.STENCIL_BUFFER_BIT)),$e){o.framebufferRenderbuffer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,Ge.__webglColorRenderbuffer[Qe]);const je=i.get(F[Qe]).__webglTexture;o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,je,0)}o.blitFramebuffer(0,0,re,Ie,0,0,re,Ie,ce,o.NEAREST),l===!0&&(ke.length=0,Fe.length=0,ke.push(o.COLOR_ATTACHMENT0+Qe),X.depthBuffer&&X.resolveDepthBuffer===!1&&(ke.push(Se),Fe.push(Se),o.invalidateFramebuffer(o.DRAW_FRAMEBUFFER,Fe)),o.invalidateFramebuffer(o.READ_FRAMEBUFFER,ke))}if(t.bindFramebuffer(o.READ_FRAMEBUFFER,null),t.bindFramebuffer(o.DRAW_FRAMEBUFFER,null),$e)for(let Qe=0;Qe<F.length;Qe++){t.bindFramebuffer(o.FRAMEBUFFER,Ge.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+Qe,o.RENDERBUFFER,Ge.__webglColorRenderbuffer[Qe]);const je=i.get(F[Qe]).__webglTexture;t.bindFramebuffer(o.FRAMEBUFFER,Ge.__webglFramebuffer),o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0+Qe,o.TEXTURE_2D,je,0)}t.bindFramebuffer(o.DRAW_FRAMEBUFFER,Ge.__webglMultisampledFramebuffer)}else if(X.depthBuffer&&X.resolveDepthBuffer===!1&&l){const F=X.stencilBuffer?o.DEPTH_STENCIL_ATTACHMENT:o.DEPTH_ATTACHMENT;o.invalidateFramebuffer(o.DRAW_FRAMEBUFFER,[F])}}}function at(X){return Math.min(n.maxSamples,X.samples)}function Ke(X){const F=i.get(X);return X.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&F.__useRenderToTexture!==!1}function tt(X){const F=a.render.frame;h.get(X)!==F&&(h.set(X,F),X.update())}function lt(X,F){const re=X.colorSpace,Ie=X.format,ce=X.type;return X.isCompressedTexture===!0||X.isVideoTexture===!0||re!==Vi&&re!==da&&(si.getTransfer(re)===yi?(Ie!==Bn||ce!==ma)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",re)),F}function qe(X){return typeof HTMLImageElement<"u"&&X instanceof HTMLImageElement?(c.width=X.naturalWidth||X.width,c.height=X.naturalHeight||X.height):typeof VideoFrame<"u"&&X instanceof VideoFrame?(c.width=X.displayWidth,c.height=X.displayHeight):(c.width=X.width,c.height=X.height),c}this.allocateTextureUnit=Z,this.resetTextureUnits=T,this.setTexture2D=B,this.setTexture2DArray=V,this.setTexture3D=Y,this.setTextureCube=J,this.rebindTextures=Oe,this.setupRenderTarget=Ze,this.updateRenderTargetMipmap=le,this.updateMultisampleRenderTarget=ht,this.setupDepthRenderbuffer=me,this.setupFrameBufferTexture=K,this.useMultisampledRTT=Ke}function Ib(o,e){function t(i,n=da){let s;const a=si.getTransfer(n);if(i===ma)return o.UNSIGNED_BYTE;if(i===dp)return o.UNSIGNED_SHORT_4_4_4_4;if(i===fp)return o.UNSIGNED_SHORT_5_5_5_1;if(i===Qg)return o.UNSIGNED_INT_5_9_9_9_REV;if(i===Zg)return o.BYTE;if(i===Kg)return o.SHORT;if(i===hp)return o.UNSIGNED_SHORT;if(i===up)return o.INT;if(i===Nr)return o.UNSIGNED_INT;if(i===Tn)return o.FLOAT;if(i===Bs)return o.HALF_FLOAT;if(i===Jg)return o.ALPHA;if(i===e0)return o.RGB;if(i===Bn)return o.RGBA;if(i===t0)return o.LUMINANCE;if(i===i0)return o.LUMINANCE_ALPHA;if(i===Pr)return o.DEPTH_COMPONENT;if(i===So)return o.DEPTH_STENCIL;if(i===pp)return o.RED;if(i===mp)return o.RED_INTEGER;if(i===n0)return o.RG;if(i===gp)return o.RG_INTEGER;if(i===yp)return o.RGBA_INTEGER;if(i===uc||i===dc||i===fc||i===pc)if(a===yi)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===uc)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===dc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===fc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===pc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===uc)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===dc)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===fc)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===pc)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===mu||i===gu||i===yu||i===vu)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===mu)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===gu)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===yu)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===vu)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===bu||i===wu||i===_u)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===bu||i===wu)return a===yi?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===_u)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Mu||i===xu||i===Su||i===Au||i===Tu||i===Eu||i===Cu||i===Pu||i===ku||i===Iu||i===Lu||i===Ru||i===Du||i===Fu)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===Mu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===xu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Su)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Au)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Tu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Eu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Cu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Pu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===ku)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Iu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Lu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Ru)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Du)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Fu)return a===yi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===mc||i===Ou||i===Uu)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===mc)return a===yi?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Ou)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Uu)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===s0||i===Nu||i===Bu||i===zu)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===mc)return s.COMPRESSED_RED_RGTC1_EXT;if(i===Nu)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===Bu)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===zu)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Po?o.UNSIGNED_INT_24_8:o[i]!==void 0?o[i]:null}return{convert:t}}class Lb extends on{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class cn extends ri{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Rb={type:"move"};class Vc{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new cn,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new cn,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new D,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new D),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new cn,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new D,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new D),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let n=null,s=null,a=null;const r=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const _ of e.hand.values()){const y=t.getJointPose(_,i),v=this._getHandJoint(c,_);y!==null&&(v.matrix.fromArray(y.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=y.radius),v.visible=y!==null}const h=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=h.position.distanceTo(d.position),p=.02,b=.005;c.inputState.pinching&&f>p+b?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=p-b&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));r!==null&&(n=t.getPose(e.targetRaySpace,i),n===null&&s!==null&&(n=s),n!==null&&(r.matrix.fromArray(n.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.matrixWorldNeedsUpdate=!0,n.linearVelocity?(r.hasLinearVelocity=!0,r.linearVelocity.copy(n.linearVelocity)):r.hasLinearVelocity=!1,n.angularVelocity?(r.hasAngularVelocity=!0,r.angularVelocity.copy(n.angularVelocity)):r.hasAngularVelocity=!1,this.dispatchEvent(Rb)))}return r!==null&&(r.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new cn;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const Db=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Fb=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Ob{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const n=new Fi,s=e.properties.get(n);s.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=n}}render(e,t){if(this.texture!==null){if(this.mesh===null){const i=t.cameras[0].viewport,n=new as({vertexShader:Db,fragmentShader:Fb,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new It(new ba(20,20),n)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class Ub extends ya{constructor(e,t){super();const i=this;let n=null,s=1,a=null,r="local-floor",l=1,c=null,h=null,d=null,f=null,p=null,b=null;const _=new Ob,y=t.getContextAttributes();let v=null,S=null;const A=[],E=[],O=new et;let R=null;const k=new on;k.layers.enable(1),k.viewport=new ui;const U=new on;U.layers.enable(2),U.viewport=new ui;const C=[k,U],T=new Lb;T.layers.enable(1),T.layers.enable(2);let Z=null,z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let se=A[K];return se===void 0&&(se=new Vc,A[K]=se),se.getTargetRaySpace()},this.getControllerGrip=function(K){let se=A[K];return se===void 0&&(se=new Vc,A[K]=se),se.getGripSpace()},this.getHand=function(K){let se=A[K];return se===void 0&&(se=new Vc,A[K]=se),se.getHandSpace()};function B(K){const se=E.indexOf(K.inputSource);if(se===-1)return;const Ee=A[se];Ee!==void 0&&(Ee.update(K.inputSource,K.frame,c||a),Ee.dispatchEvent({type:K.type,data:K.inputSource}))}function V(){n.removeEventListener("select",B),n.removeEventListener("selectstart",B),n.removeEventListener("selectend",B),n.removeEventListener("squeeze",B),n.removeEventListener("squeezestart",B),n.removeEventListener("squeezeend",B),n.removeEventListener("end",V),n.removeEventListener("inputsourceschange",Y);for(let K=0;K<A.length;K++){const se=E[K];se!==null&&(E[K]=null,A[K].disconnect(se))}Z=null,z=null,_.reset(),e.setRenderTarget(v),p=null,f=null,d=null,n=null,S=null,ve.stop(),i.isPresenting=!1,e.setPixelRatio(R),e.setSize(O.width,O.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(K){s=K,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){r=K,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(K){c=K},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return d},this.getFrame=function(){return b},this.getSession=function(){return n},this.setSession=async function(K){if(n=K,n!==null){if(v=e.getRenderTarget(),n.addEventListener("select",B),n.addEventListener("selectstart",B),n.addEventListener("selectend",B),n.addEventListener("squeeze",B),n.addEventListener("squeezestart",B),n.addEventListener("squeezeend",B),n.addEventListener("end",V),n.addEventListener("inputsourceschange",Y),y.xrCompatible!==!0&&await t.makeXRCompatible(),R=e.getPixelRatio(),e.getSize(O),n.renderState.layers===void 0){const se={antialias:y.antialias,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(n,t,se),n.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),S=new Hs(p.framebufferWidth,p.framebufferHeight,{format:Bn,type:ma,colorSpace:e.outputColorSpace,stencilBuffer:y.stencil})}else{let se=null,Ee=null,me=null;y.depth&&(me=y.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,se=y.stencil?So:Pr,Ee=y.stencil?Po:Nr);const Oe={colorFormat:t.RGBA8,depthFormat:me,scaleFactor:s};d=new XRWebGLBinding(n,t),f=d.createProjectionLayer(Oe),n.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),S=new Hs(f.textureWidth,f.textureHeight,{format:Bn,type:ma,depthTexture:new Rp(f.textureWidth,f.textureHeight,Ee,void 0,void 0,void 0,void 0,void 0,void 0,se),stencilBuffer:y.stencil,colorSpace:e.outputColorSpace,samples:y.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1})}S.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(r),ve.setContext(n),ve.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode};function Y(K){for(let se=0;se<K.removed.length;se++){const Ee=K.removed[se],me=E.indexOf(Ee);me>=0&&(E[me]=null,A[me].disconnect(Ee))}for(let se=0;se<K.added.length;se++){const Ee=K.added[se];let me=E.indexOf(Ee);if(me===-1){for(let Ze=0;Ze<A.length;Ze++)if(Ze>=E.length){E.push(Ee),me=Ze;break}else if(E[Ze]===null){E[Ze]=Ee,me=Ze;break}if(me===-1)break}const Oe=A[me];Oe&&Oe.connect(Ee)}}const J=new D,Te=new D;function ge(K,se,Ee){J.setFromMatrixPosition(se.matrixWorld),Te.setFromMatrixPosition(Ee.matrixWorld);const me=J.distanceTo(Te),Oe=se.projectionMatrix.elements,Ze=Ee.projectionMatrix.elements,le=Oe[14]/(Oe[10]-1),ke=Oe[14]/(Oe[10]+1),Fe=(Oe[9]+1)/Oe[5],ht=(Oe[9]-1)/Oe[5],at=(Oe[8]-1)/Oe[0],Ke=(Ze[8]+1)/Ze[0],tt=le*at,lt=le*Ke,qe=me/(-at+Ke),X=qe*-at;se.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(X),K.translateZ(qe),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert();const F=le+qe,re=ke+qe,Ie=tt-X,ce=lt+(me-X),Se=Fe*ke/re*F,Ge=ht*ke/re*F;K.projectionMatrix.makePerspective(Ie,ce,Se,Ge,F,re),K.projectionMatrixInverse.copy(K.projectionMatrix).invert()}function fe(K,se){se===null?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices(se.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(n===null)return;_.texture!==null&&(K.near=_.depthNear,K.far=_.depthFar),T.near=U.near=k.near=K.near,T.far=U.far=k.far=K.far,(Z!==T.near||z!==T.far)&&(n.updateRenderState({depthNear:T.near,depthFar:T.far}),Z=T.near,z=T.far,k.near=Z,k.far=z,U.near=Z,U.far=z,k.updateProjectionMatrix(),U.updateProjectionMatrix(),K.updateProjectionMatrix());const se=K.parent,Ee=T.cameras;fe(T,se);for(let me=0;me<Ee.length;me++)fe(Ee[me],se);Ee.length===2?ge(T,k,U):T.projectionMatrix.copy(k.projectionMatrix),he(K,T,se)};function he(K,se,Ee){Ee===null?K.matrix.copy(se.matrixWorld):(K.matrix.copy(Ee.matrixWorld),K.matrix.invert(),K.matrix.multiply(se.matrixWorld)),K.matrix.decompose(K.position,K.quaternion,K.scale),K.updateMatrixWorld(!0),K.projectionMatrix.copy(se.projectionMatrix),K.projectionMatrixInverse.copy(se.projectionMatrixInverse),K.isPerspectiveCamera&&(K.fov=zr*2*Math.atan(1/K.projectionMatrix.elements[5]),K.zoom=1)}this.getCamera=function(){return T},this.getFoveation=function(){if(!(f===null&&p===null))return l},this.setFoveation=function(K){l=K,f!==null&&(f.fixedFoveation=K),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=K)},this.hasDepthSensing=function(){return _.texture!==null};let Q=null;function pe(K,se){if(h=se.getViewerPose(c||a),b=se,h!==null){const Ee=h.views;p!==null&&(e.setRenderTargetFramebuffer(S,p.framebuffer),e.setRenderTarget(S));let me=!1;Ee.length!==T.cameras.length&&(T.cameras.length=0,me=!0);for(let Ze=0;Ze<Ee.length;Ze++){const le=Ee[Ze];let ke=null;if(p!==null)ke=p.getViewport(le);else{const ht=d.getViewSubImage(f,le);ke=ht.viewport,Ze===0&&(e.setRenderTargetTextures(S,ht.colorTexture,f.ignoreDepthValues?void 0:ht.depthStencilTexture),e.setRenderTarget(S))}let Fe=C[Ze];Fe===void 0&&(Fe=new on,Fe.layers.enable(Ze),Fe.viewport=new ui,C[Ze]=Fe),Fe.matrix.fromArray(le.transform.matrix),Fe.matrix.decompose(Fe.position,Fe.quaternion,Fe.scale),Fe.projectionMatrix.fromArray(le.projectionMatrix),Fe.projectionMatrixInverse.copy(Fe.projectionMatrix).invert(),Fe.viewport.set(ke.x,ke.y,ke.width,ke.height),Ze===0&&(T.matrix.copy(Fe.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),me===!0&&T.cameras.push(Fe)}const Oe=n.enabledFeatures;if(Oe&&Oe.includes("depth-sensing")){const Ze=d.getDepthInformation(Ee[0]);Ze&&Ze.isValid&&Ze.texture&&_.init(e,Ze,n.renderState)}}for(let Ee=0;Ee<A.length;Ee++){const me=E[Ee],Oe=A[Ee];me!==null&&Oe!==void 0&&Oe.update(me,se,c||a)}_.render(e,T),Q&&Q(K,se),se.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:se}),b=null}const ve=new Lp;ve.setAnimationLoop(pe),this.setAnimationLoop=function(K){Q=K},this.dispose=function(){}}}const Da=new vn,Nb=new Ft;function Bb(o,e){function t(y,v){y.matrixAutoUpdate===!0&&y.updateMatrix(),v.value.copy(y.matrix)}function i(y,v){v.color.getRGB(y.fogColor.value,Pp(o)),v.isFog?(y.fogNear.value=v.near,y.fogFar.value=v.far):v.isFogExp2&&(y.fogDensity.value=v.density)}function n(y,v,S,A,E){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(y,v):v.isMeshToonMaterial?(s(y,v),d(y,v)):v.isMeshPhongMaterial?(s(y,v),h(y,v)):v.isMeshStandardMaterial?(s(y,v),f(y,v),v.isMeshPhysicalMaterial&&p(y,v,E)):v.isMeshMatcapMaterial?(s(y,v),b(y,v)):v.isMeshDepthMaterial?s(y,v):v.isMeshDistanceMaterial?(s(y,v),_(y,v)):v.isMeshNormalMaterial?s(y,v):v.isLineBasicMaterial?(a(y,v),v.isLineDashedMaterial&&r(y,v)):v.isPointsMaterial?l(y,v,S,A):v.isSpriteMaterial?c(y,v):v.isShadowMaterial?(y.color.value.copy(v.color),y.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function s(y,v){y.opacity.value=v.opacity,v.color&&y.diffuse.value.copy(v.color),v.emissive&&y.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(y.map.value=v.map,t(v.map,y.mapTransform)),v.alphaMap&&(y.alphaMap.value=v.alphaMap,t(v.alphaMap,y.alphaMapTransform)),v.bumpMap&&(y.bumpMap.value=v.bumpMap,t(v.bumpMap,y.bumpMapTransform),y.bumpScale.value=v.bumpScale,v.side===hn&&(y.bumpScale.value*=-1)),v.normalMap&&(y.normalMap.value=v.normalMap,t(v.normalMap,y.normalMapTransform),y.normalScale.value.copy(v.normalScale),v.side===hn&&y.normalScale.value.negate()),v.displacementMap&&(y.displacementMap.value=v.displacementMap,t(v.displacementMap,y.displacementMapTransform),y.displacementScale.value=v.displacementScale,y.displacementBias.value=v.displacementBias),v.emissiveMap&&(y.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,y.emissiveMapTransform)),v.specularMap&&(y.specularMap.value=v.specularMap,t(v.specularMap,y.specularMapTransform)),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest);const S=e.get(v),A=S.envMap,E=S.envMapRotation;if(A&&(y.envMap.value=A,Da.copy(E),Da.x*=-1,Da.y*=-1,Da.z*=-1,A.isCubeTexture&&A.isRenderTargetTexture===!1&&(Da.y*=-1,Da.z*=-1),y.envMapRotation.value.setFromMatrix4(Nb.makeRotationFromEuler(Da)),y.flipEnvMap.value=A.isCubeTexture&&A.isRenderTargetTexture===!1?-1:1,y.reflectivity.value=v.reflectivity,y.ior.value=v.ior,y.refractionRatio.value=v.refractionRatio),v.lightMap){y.lightMap.value=v.lightMap;const O=o._useLegacyLights===!0?Math.PI:1;y.lightMapIntensity.value=v.lightMapIntensity*O,t(v.lightMap,y.lightMapTransform)}v.aoMap&&(y.aoMap.value=v.aoMap,y.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,y.aoMapTransform))}function a(y,v){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,v.map&&(y.map.value=v.map,t(v.map,y.mapTransform))}function r(y,v){y.dashSize.value=v.dashSize,y.totalSize.value=v.dashSize+v.gapSize,y.scale.value=v.scale}function l(y,v,S,A){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,y.size.value=v.size*S,y.scale.value=A*.5,v.map&&(y.map.value=v.map,t(v.map,y.uvTransform)),v.alphaMap&&(y.alphaMap.value=v.alphaMap,t(v.alphaMap,y.alphaMapTransform)),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest)}function c(y,v){y.diffuse.value.copy(v.color),y.opacity.value=v.opacity,y.rotation.value=v.rotation,v.map&&(y.map.value=v.map,t(v.map,y.mapTransform)),v.alphaMap&&(y.alphaMap.value=v.alphaMap,t(v.alphaMap,y.alphaMapTransform)),v.alphaTest>0&&(y.alphaTest.value=v.alphaTest)}function h(y,v){y.specular.value.copy(v.specular),y.shininess.value=Math.max(v.shininess,1e-4)}function d(y,v){v.gradientMap&&(y.gradientMap.value=v.gradientMap)}function f(y,v){y.metalness.value=v.metalness,v.metalnessMap&&(y.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,y.metalnessMapTransform)),y.roughness.value=v.roughness,v.roughnessMap&&(y.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,y.roughnessMapTransform)),v.envMap&&(y.envMapIntensity.value=v.envMapIntensity)}function p(y,v,S){y.ior.value=v.ior,v.sheen>0&&(y.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),y.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(y.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,y.sheenColorMapTransform)),v.sheenRoughnessMap&&(y.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,y.sheenRoughnessMapTransform))),v.clearcoat>0&&(y.clearcoat.value=v.clearcoat,y.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(y.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,y.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(y.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,y.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(y.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,y.clearcoatNormalMapTransform),y.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===hn&&y.clearcoatNormalScale.value.negate())),v.dispersion>0&&(y.dispersion.value=v.dispersion),v.iridescence>0&&(y.iridescence.value=v.iridescence,y.iridescenceIOR.value=v.iridescenceIOR,y.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],y.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(y.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,y.iridescenceMapTransform)),v.iridescenceThicknessMap&&(y.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,y.iridescenceThicknessMapTransform))),v.transmission>0&&(y.transmission.value=v.transmission,y.transmissionSamplerMap.value=S.texture,y.transmissionSamplerSize.value.set(S.width,S.height),v.transmissionMap&&(y.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,y.transmissionMapTransform)),y.thickness.value=v.thickness,v.thicknessMap&&(y.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,y.thicknessMapTransform)),y.attenuationDistance.value=v.attenuationDistance,y.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(y.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(y.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,y.anisotropyMapTransform))),y.specularIntensity.value=v.specularIntensity,y.specularColor.value.copy(v.specularColor),v.specularColorMap&&(y.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,y.specularColorMapTransform)),v.specularIntensityMap&&(y.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,y.specularIntensityMapTransform))}function b(y,v){v.matcap&&(y.matcap.value=v.matcap)}function _(y,v){const S=e.get(v).light;y.referencePosition.value.setFromMatrixPosition(S.matrixWorld),y.nearDistance.value=S.shadow.camera.near,y.farDistance.value=S.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:n}}function zb(o,e,t,i){let n={},s={},a=[];const r=o.getParameter(o.MAX_UNIFORM_BUFFER_BINDINGS);function l(S,A){const E=A.program;i.uniformBlockBinding(S,E)}function c(S,A){let E=n[S.id];E===void 0&&(b(S),E=h(S),n[S.id]=E,S.addEventListener("dispose",y));const O=A.program;i.updateUBOMapping(S,O);const R=e.render.frame;s[S.id]!==R&&(f(S),s[S.id]=R)}function h(S){const A=d();S.__bindingPointIndex=A;const E=o.createBuffer(),O=S.__size,R=S.usage;return o.bindBuffer(o.UNIFORM_BUFFER,E),o.bufferData(o.UNIFORM_BUFFER,O,R),o.bindBuffer(o.UNIFORM_BUFFER,null),o.bindBufferBase(o.UNIFORM_BUFFER,A,E),E}function d(){for(let S=0;S<r;S++)if(a.indexOf(S)===-1)return a.push(S),S;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(S){const A=n[S.id],E=S.uniforms,O=S.__cache;o.bindBuffer(o.UNIFORM_BUFFER,A);for(let R=0,k=E.length;R<k;R++){const U=Array.isArray(E[R])?E[R]:[E[R]];for(let C=0,T=U.length;C<T;C++){const Z=U[C];if(p(Z,R,C,O)===!0){const z=Z.__offset,B=Array.isArray(Z.value)?Z.value:[Z.value];let V=0;for(let Y=0;Y<B.length;Y++){const J=B[Y],Te=_(J);typeof J=="number"||typeof J=="boolean"?(Z.__data[0]=J,o.bufferSubData(o.UNIFORM_BUFFER,z+V,Z.__data)):J.isMatrix3?(Z.__data[0]=J.elements[0],Z.__data[1]=J.elements[1],Z.__data[2]=J.elements[2],Z.__data[3]=0,Z.__data[4]=J.elements[3],Z.__data[5]=J.elements[4],Z.__data[6]=J.elements[5],Z.__data[7]=0,Z.__data[8]=J.elements[6],Z.__data[9]=J.elements[7],Z.__data[10]=J.elements[8],Z.__data[11]=0):(J.toArray(Z.__data,V),V+=Te.storage/Float32Array.BYTES_PER_ELEMENT)}o.bufferSubData(o.UNIFORM_BUFFER,z,Z.__data)}}}o.bindBuffer(o.UNIFORM_BUFFER,null)}function p(S,A,E,O){const R=S.value,k=A+"_"+E;if(O[k]===void 0)return typeof R=="number"||typeof R=="boolean"?O[k]=R:O[k]=R.clone(),!0;{const U=O[k];if(typeof R=="number"||typeof R=="boolean"){if(U!==R)return O[k]=R,!0}else if(U.equals(R)===!1)return U.copy(R),!0}return!1}function b(S){const A=S.uniforms;let E=0;const O=16;for(let k=0,U=A.length;k<U;k++){const C=Array.isArray(A[k])?A[k]:[A[k]];for(let T=0,Z=C.length;T<Z;T++){const z=C[T],B=Array.isArray(z.value)?z.value:[z.value];for(let V=0,Y=B.length;V<Y;V++){const J=B[V],Te=_(J),ge=E%O;ge!==0&&O-ge<Te.boundary&&(E+=O-ge),z.__data=new Float32Array(Te.storage/Float32Array.BYTES_PER_ELEMENT),z.__offset=E,E+=Te.storage}}}const R=E%O;return R>0&&(E+=O-R),S.__size=E,S.__cache={},this}function _(S){const A={boundary:0,storage:0};return typeof S=="number"||typeof S=="boolean"?(A.boundary=4,A.storage=4):S.isVector2?(A.boundary=8,A.storage=8):S.isVector3||S.isColor?(A.boundary=16,A.storage=12):S.isVector4?(A.boundary=16,A.storage=16):S.isMatrix3?(A.boundary=48,A.storage=48):S.isMatrix4?(A.boundary=64,A.storage=64):S.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",S),A}function y(S){const A=S.target;A.removeEventListener("dispose",y);const E=a.indexOf(A.__bindingPointIndex);a.splice(E,1),o.deleteBuffer(n[A.id]),delete n[A.id],delete s[A.id]}function v(){for(const S in n)o.deleteBuffer(n[S]);a=[],n={},s={}}return{bind:l,update:c,dispose:v}}class Vb{constructor(e={}){const{canvas:t=D0(),context:i=null,depth:n=!0,stencil:s=!1,alpha:a=!1,antialias:r=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:d=!1}=e;this.isWebGLRenderer=!0;let f;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=i.getContextAttributes().alpha}else f=a;const p=new Uint32Array(4),b=new Int32Array(4);let _=null,y=null;const v=[],S=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=rn,this._useLegacyLights=!1,this.toneMapping=pa,this.toneMappingExposure=1;const A=this;let E=!1,O=0,R=0,k=null,U=-1,C=null;const T=new ui,Z=new ui;let z=null;const B=new Dt(0);let V=0,Y=t.width,J=t.height,Te=1,ge=null,fe=null;const he=new ui(0,0,Y,J),Q=new ui(0,0,Y,J);let pe=!1;const ve=new Vh;let K=!1,se=!1;const Ee=new Ft,me=new D,Oe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ze(){return k===null?Te:1}let le=i;function ke(j,Me){return t.getContext(j,Me)}try{const j={alpha:!0,depth:n,stencil:s,antialias:r,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Oh}`),t.addEventListener("webglcontextlost",L,!1),t.addEventListener("webglcontextrestored",ye,!1),t.addEventListener("webglcontextcreationerror",_e,!1),le===null){const Me="webgl2";if(le=ke(Me,j),le===null)throw ke(Me)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(j){throw console.error("THREE.WebGLRenderer: "+j.message),j}let Fe,ht,at,Ke,tt,lt,qe,X,F,re,Ie,ce,Se,Ge,$e,Qe,je,ze,st,pt,dt,rt,it,mt;function Mt(){Fe=new K1(le),Fe.init(),rt=new Ib(le,Fe),ht=new j1(le,Fe,e,rt),at=new Pb(le),Ke=new e2(le),tt=new yb,lt=new kb(le,Fe,at,tt,ht,rt,Ke),qe=new X1(A),X=new Z1(A),F=new oy(le),it=new G1(le,F),re=new Q1(le,F,Ke,it),Ie=new i2(le,re,F,Ke),st=new t2(le,ht,lt),Qe=new q1(tt),ce=new gb(A,qe,X,Fe,ht,it,Qe),Se=new Bb(A,tt),Ge=new bb,$e=new Ab(Fe),ze=new H1(A,qe,X,at,Ie,f,l),je=new Cb(A,Ie,ht),mt=new zb(le,Ke,ht,at),pt=new W1(le,Fe,Ke),dt=new J1(le,Fe,Ke),Ke.programs=ce.programs,A.capabilities=ht,A.extensions=Fe,A.properties=tt,A.renderLists=Ge,A.shadowMap=je,A.state=at,A.info=Ke}Mt();const wt=new Ub(A,le);this.xr=wt,this.getContext=function(){return le},this.getContextAttributes=function(){return le.getContextAttributes()},this.forceContextLoss=function(){const j=Fe.get("WEBGL_lose_context");j&&j.loseContext()},this.forceContextRestore=function(){const j=Fe.get("WEBGL_lose_context");j&&j.restoreContext()},this.getPixelRatio=function(){return Te},this.setPixelRatio=function(j){j!==void 0&&(Te=j,this.setSize(Y,J,!1))},this.getSize=function(j){return j.set(Y,J)},this.setSize=function(j,Me,De=!0){if(wt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Y=j,J=Me,t.width=Math.floor(j*Te),t.height=Math.floor(Me*Te),De===!0&&(t.style.width=j+"px",t.style.height=Me+"px"),this.setViewport(0,0,j,Me)},this.getDrawingBufferSize=function(j){return j.set(Y*Te,J*Te).floor()},this.setDrawingBufferSize=function(j,Me,De){Y=j,J=Me,Te=De,t.width=Math.floor(j*De),t.height=Math.floor(Me*De),this.setViewport(0,0,j,Me)},this.getCurrentViewport=function(j){return j.copy(T)},this.getViewport=function(j){return j.copy(he)},this.setViewport=function(j,Me,De,Re){j.isVector4?he.set(j.x,j.y,j.z,j.w):he.set(j,Me,De,Re),at.viewport(T.copy(he).multiplyScalar(Te).round())},this.getScissor=function(j){return j.copy(Q)},this.setScissor=function(j,Me,De,Re){j.isVector4?Q.set(j.x,j.y,j.z,j.w):Q.set(j,Me,De,Re),at.scissor(Z.copy(Q).multiplyScalar(Te).round())},this.getScissorTest=function(){return pe},this.setScissorTest=function(j){at.setScissorTest(pe=j)},this.setOpaqueSort=function(j){ge=j},this.setTransparentSort=function(j){fe=j},this.getClearColor=function(j){return j.copy(ze.getClearColor())},this.setClearColor=function(){ze.setClearColor.apply(ze,arguments)},this.getClearAlpha=function(){return ze.getClearAlpha()},this.setClearAlpha=function(){ze.setClearAlpha.apply(ze,arguments)},this.clear=function(j=!0,Me=!0,De=!0){let Re=0;if(j){let Le=!1;if(k!==null){const gt=k.texture.format;Le=gt===yp||gt===gp||gt===mp}if(Le){const gt=k.texture.type,vt=gt===ma||gt===Nr||gt===hp||gt===Po||gt===dp||gt===fp,xt=ze.getClearColor(),ut=ze.getClearAlpha(),Nt=xt.r,nt=xt.g,Bt=xt.b;vt?(p[0]=Nt,p[1]=nt,p[2]=Bt,p[3]=ut,le.clearBufferuiv(le.COLOR,0,p)):(b[0]=Nt,b[1]=nt,b[2]=Bt,b[3]=ut,le.clearBufferiv(le.COLOR,0,b))}else Re|=le.COLOR_BUFFER_BIT}Me&&(Re|=le.DEPTH_BUFFER_BIT),De&&(Re|=le.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),le.clear(Re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",L,!1),t.removeEventListener("webglcontextrestored",ye,!1),t.removeEventListener("webglcontextcreationerror",_e,!1),Ge.dispose(),$e.dispose(),tt.dispose(),qe.dispose(),X.dispose(),Ie.dispose(),it.dispose(),mt.dispose(),ce.dispose(),wt.dispose(),wt.removeEventListener("sessionstart",St),wt.removeEventListener("sessionend",At),Lt.stop()};function L(j){j.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),E=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),E=!1;const j=Ke.autoReset,Me=je.enabled,De=je.autoUpdate,Re=je.needsUpdate,Le=je.type;Mt(),Ke.autoReset=j,je.enabled=Me,je.autoUpdate=De,je.needsUpdate=Re,je.type=Le}function _e(j){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",j.statusMessage)}function Ue(j){const Me=j.target;Me.removeEventListener("dispose",Ue),Xe(Me)}function Xe(j){Pt(j),tt.remove(j)}function Pt(j){const Me=tt.get(j).programs;Me!==void 0&&(Me.forEach(function(De){ce.releaseProgram(De)}),j.isShaderMaterial&&ce.releaseShaderCache(j))}this.renderBufferDirect=function(j,Me,De,Re,Le,gt){Me===null&&(Me=Oe);const vt=Le.isMesh&&Le.matrixWorld.determinant()<0,xt=Qi(j,Me,De,Re,Le);at.setMaterial(Re,vt);let ut=De.index,Nt=1;if(Re.wireframe===!0){if(ut=re.getWireframeAttribute(De),ut===void 0)return;Nt=2}const nt=De.drawRange,Bt=De.attributes.position;let _i=nt.start*Nt,vi=(nt.start+nt.count)*Nt;gt!==null&&(_i=Math.max(_i,gt.start*Nt),vi=Math.min(vi,(gt.start+gt.count)*Nt)),ut!==null?(_i=Math.max(_i,0),vi=Math.min(vi,ut.count)):Bt!=null&&(_i=Math.max(_i,0),vi=Math.min(vi,Bt.count));const Pi=vi-_i;if(Pi<0||Pi===1/0)return;it.setup(Le,Re,xt,De,ut);let dn,Zt=pt;if(ut!==null&&(dn=F.get(ut),Zt=dt,Zt.setIndex(dn)),Le.isMesh)Re.wireframe===!0?(at.setLineWidth(Re.wireframeLinewidth*Ze()),Zt.setMode(le.LINES)):Zt.setMode(le.TRIANGLES);else if(Le.isLine){let Ut=Re.linewidth;Ut===void 0&&(Ut=1),at.setLineWidth(Ut*Ze()),Le.isLineSegments?Zt.setMode(le.LINES):Le.isLineLoop?Zt.setMode(le.LINE_LOOP):Zt.setMode(le.LINE_STRIP)}else Le.isPoints?Zt.setMode(le.POINTS):Le.isSprite&&Zt.setMode(le.TRIANGLES);if(Le.isBatchedMesh)Le._multiDrawInstances!==null?Zt.renderMultiDrawInstances(Le._multiDrawStarts,Le._multiDrawCounts,Le._multiDrawCount,Le._multiDrawInstances):Zt.renderMultiDraw(Le._multiDrawStarts,Le._multiDrawCounts,Le._multiDrawCount);else if(Le.isInstancedMesh)Zt.renderInstances(_i,Pi,Le.count);else if(De.isInstancedBufferGeometry){const Ut=De._maxInstanceCount!==void 0?De._maxInstanceCount:1/0,Cn=Math.min(De.instanceCount,Ut);Zt.renderInstances(_i,Pi,Cn)}else Zt.render(_i,Pi)};function bt(j,Me,De){j.transparent===!0&&j.side===Ai&&j.forceSinglePass===!1?(j.side=hn,j.needsUpdate=!0,Ki(j,Me,De),j.side=zn,j.needsUpdate=!0,Ki(j,Me,De),j.side=Ai):Ki(j,Me,De)}this.compile=function(j,Me,De=null){De===null&&(De=j),y=$e.get(De),y.init(Me),S.push(y),De.traverseVisible(function(Le){Le.isLight&&Le.layers.test(Me.layers)&&(y.pushLight(Le),Le.castShadow&&y.pushShadow(Le))}),j!==De&&j.traverseVisible(function(Le){Le.isLight&&Le.layers.test(Me.layers)&&(y.pushLight(Le),Le.castShadow&&y.pushShadow(Le))}),y.setupLights(A._useLegacyLights);const Re=new Set;return j.traverse(function(Le){const gt=Le.material;if(gt)if(Array.isArray(gt))for(let vt=0;vt<gt.length;vt++){const xt=gt[vt];bt(xt,De,Le),Re.add(xt)}else bt(gt,De,Le),Re.add(gt)}),S.pop(),y=null,Re},this.compileAsync=function(j,Me,De=null){const Re=this.compile(j,Me,De);return new Promise(Le=>{function gt(){if(Re.forEach(function(vt){tt.get(vt).currentProgram.isReady()&&Re.delete(vt)}),Re.size===0){Le(j);return}setTimeout(gt,10)}Fe.get("KHR_parallel_shader_compile")!==null?gt():setTimeout(gt,10)})};let _t=null;function Ot(j){_t&&_t(j)}function St(){Lt.stop()}function At(){Lt.start()}const Lt=new Lp;Lt.setAnimationLoop(Ot),typeof self<"u"&&Lt.setContext(self),this.setAnimationLoop=function(j){_t=j,wt.setAnimationLoop(j),j===null?Lt.stop():Lt.start()},wt.addEventListener("sessionstart",St),wt.addEventListener("sessionend",At),this.render=function(j,Me){if(Me!==void 0&&Me.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(E===!0)return;j.matrixWorldAutoUpdate===!0&&j.updateMatrixWorld(),Me.parent===null&&Me.matrixWorldAutoUpdate===!0&&Me.updateMatrixWorld(),wt.enabled===!0&&wt.isPresenting===!0&&(wt.cameraAutoUpdate===!0&&wt.updateCamera(Me),Me=wt.getCamera()),j.isScene===!0&&j.onBeforeRender(A,j,Me,k),y=$e.get(j,S.length),y.init(Me),S.push(y),Ee.multiplyMatrices(Me.projectionMatrix,Me.matrixWorldInverse),ve.setFromProjectionMatrix(Ee),se=this.localClippingEnabled,K=Qe.init(this.clippingPlanes,se),_=Ge.get(j,v.length),_.init(),v.push(_),pi(j,Me,0,A.sortObjects),_.finish(),A.sortObjects===!0&&_.sort(ge,fe);const De=wt.enabled===!1||wt.isPresenting===!1||wt.hasDepthSensing()===!1;De&&ze.addToRenderList(_,j),this.info.render.frame++,K===!0&&Qe.beginShadows();const Re=y.state.shadowsArray;je.render(Re,j,Me),K===!0&&Qe.endShadows(),this.info.autoReset===!0&&this.info.reset();const Le=_.opaque,gt=_.transmissive;if(y.setupLights(A._useLegacyLights),Me.isArrayCamera){const vt=Me.cameras;if(gt.length>0)for(let xt=0,ut=vt.length;xt<ut;xt++){const Nt=vt[xt];Qt(Le,gt,j,Nt)}De&&ze.render(j);for(let xt=0,ut=vt.length;xt<ut;xt++){const Nt=vt[xt];ii(_,j,Nt,Nt.viewport)}}else gt.length>0&&Qt(Le,gt,j,Me),De&&ze.render(j),ii(_,j,Me);k!==null&&(lt.updateMultisampleRenderTarget(k),lt.updateRenderTargetMipmap(k)),j.isScene===!0&&j.onAfterRender(A,j,Me),it.resetDefaultState(),U=-1,C=null,S.pop(),S.length>0?(y=S[S.length-1],K===!0&&Qe.setGlobalState(A.clippingPlanes,y.state.camera)):y=null,v.pop(),v.length>0?_=v[v.length-1]:_=null};function pi(j,Me,De,Re){if(j.visible===!1)return;if(j.layers.test(Me.layers)){if(j.isGroup)De=j.renderOrder;else if(j.isLOD)j.autoUpdate===!0&&j.update(Me);else if(j.isLight)y.pushLight(j),j.castShadow&&y.pushShadow(j);else if(j.isSprite){if(!j.frustumCulled||ve.intersectsSprite(j)){Re&&me.setFromMatrixPosition(j.matrixWorld).applyMatrix4(Ee);const vt=Ie.update(j),xt=j.material;xt.visible&&_.push(j,vt,xt,De,me.z,null)}}else if((j.isMesh||j.isLine||j.isPoints)&&(!j.frustumCulled||ve.intersectsObject(j))){const vt=Ie.update(j),xt=j.material;if(Re&&(j.boundingSphere!==void 0?(j.boundingSphere===null&&j.computeBoundingSphere(),me.copy(j.boundingSphere.center)):(vt.boundingSphere===null&&vt.computeBoundingSphere(),me.copy(vt.boundingSphere.center)),me.applyMatrix4(j.matrixWorld).applyMatrix4(Ee)),Array.isArray(xt)){const ut=vt.groups;for(let Nt=0,nt=ut.length;Nt<nt;Nt++){const Bt=ut[Nt],_i=xt[Bt.materialIndex];_i&&_i.visible&&_.push(j,vt,_i,De,me.z,Bt)}}else xt.visible&&_.push(j,vt,xt,De,me.z,null)}}const gt=j.children;for(let vt=0,xt=gt.length;vt<xt;vt++)pi(gt[vt],Me,De,Re)}function ii(j,Me,De,Re){const Le=j.opaque,gt=j.transmissive,vt=j.transparent;y.setupLightsView(De),K===!0&&Qe.setGlobalState(A.clippingPlanes,De),Re&&at.viewport(T.copy(Re)),Le.length>0&&mi(Le,Me,De),gt.length>0&&mi(gt,Me,De),vt.length>0&&mi(vt,Me,De),at.buffers.depth.setTest(!0),at.buffers.depth.setMask(!0),at.buffers.color.setMask(!0),at.setPolygonOffset(!1)}function Qt(j,Me,De,Re){if((De.isScene===!0?De.overrideMaterial:null)!==null)return;y.state.transmissionRenderTarget[Re.id]===void 0&&(y.state.transmissionRenderTarget[Re.id]=new Hs(1,1,{generateMipmaps:!0,type:Fe.has("EXT_color_buffer_half_float")||Fe.has("EXT_color_buffer_float")?Bs:ma,minFilter:is,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const gt=y.state.transmissionRenderTarget[Re.id],vt=Re.viewport||T;gt.setSize(vt.z,vt.w);const xt=A.getRenderTarget();A.setRenderTarget(gt),A.getClearColor(B),V=A.getClearAlpha(),V<1&&A.setClearColor(16777215,.5),A.clear();const ut=A.toneMapping;A.toneMapping=pa;const Nt=Re.viewport;if(Re.viewport!==void 0&&(Re.viewport=void 0),y.setupLightsView(Re),K===!0&&Qe.setGlobalState(A.clippingPlanes,Re),mi(j,De,Re),lt.updateMultisampleRenderTarget(gt),lt.updateRenderTargetMipmap(gt),Fe.has("WEBGL_multisampled_render_to_texture")===!1){let nt=!1;for(let Bt=0,_i=Me.length;Bt<_i;Bt++){const vi=Me[Bt],Pi=vi.object,dn=vi.geometry,Zt=vi.material,Ut=vi.group;if(Zt.side===Ai&&Pi.layers.test(Re.layers)){const Cn=Zt.side;Zt.side=hn,Zt.needsUpdate=!0,Ri(Pi,De,Re,dn,Zt,Ut),Zt.side=Cn,Zt.needsUpdate=!0,nt=!0}}nt===!0&&(lt.updateMultisampleRenderTarget(gt),lt.updateRenderTargetMipmap(gt))}A.setRenderTarget(xt),A.setClearColor(B,V),Nt!==void 0&&(Re.viewport=Nt),A.toneMapping=ut}function mi(j,Me,De){const Re=Me.isScene===!0?Me.overrideMaterial:null;for(let Le=0,gt=j.length;Le<gt;Le++){const vt=j[Le],xt=vt.object,ut=vt.geometry,Nt=Re===null?vt.material:Re,nt=vt.group;xt.layers.test(De.layers)&&Ri(xt,Me,De,ut,Nt,nt)}}function Ri(j,Me,De,Re,Le,gt){j.onBeforeRender(A,Me,De,Re,Le,gt),j.modelViewMatrix.multiplyMatrices(De.matrixWorldInverse,j.matrixWorld),j.normalMatrix.getNormalMatrix(j.modelViewMatrix),Le.onBeforeRender(A,Me,De,Re,j,gt),Le.transparent===!0&&Le.side===Ai&&Le.forceSinglePass===!1?(Le.side=hn,Le.needsUpdate=!0,A.renderBufferDirect(De,Me,Re,Le,j,gt),Le.side=zn,Le.needsUpdate=!0,A.renderBufferDirect(De,Me,Re,Le,j,gt),Le.side=Ai):A.renderBufferDirect(De,Me,Re,Le,j,gt),j.onAfterRender(A,Me,De,Re,Le,gt)}function Ki(j,Me,De){Me.isScene!==!0&&(Me=Oe);const Re=tt.get(j),Le=y.state.lights,gt=y.state.shadowsArray,vt=Le.state.version,xt=ce.getParameters(j,Le.state,gt,Me,De),ut=ce.getProgramCacheKey(xt);let Nt=Re.programs;Re.environment=j.isMeshStandardMaterial?Me.environment:null,Re.fog=Me.fog,Re.envMap=(j.isMeshStandardMaterial?X:qe).get(j.envMap||Re.environment),Re.envMapRotation=Re.environment!==null&&j.envMap===null?Me.environmentRotation:j.envMapRotation,Nt===void 0&&(j.addEventListener("dispose",Ue),Nt=new Map,Re.programs=Nt);let nt=Nt.get(ut);if(nt!==void 0){if(Re.currentProgram===nt&&Re.lightsStateVersion===vt)return un(j,xt),nt}else xt.uniforms=ce.getUniforms(j),j.onBuild(De,xt,A),j.onBeforeCompile(xt,A),nt=ce.acquireProgram(xt,ut),Nt.set(ut,nt),Re.uniforms=xt.uniforms;const Bt=Re.uniforms;return(!j.isShaderMaterial&&!j.isRawShaderMaterial||j.clipping===!0)&&(Bt.clippingPlanes=Qe.uniform),un(j,xt),Re.needsLights=gi(j),Re.lightsStateVersion=vt,Re.needsLights&&(Bt.ambientLightColor.value=Le.state.ambient,Bt.lightProbe.value=Le.state.probe,Bt.directionalLights.value=Le.state.directional,Bt.directionalLightShadows.value=Le.state.directionalShadow,Bt.spotLights.value=Le.state.spot,Bt.spotLightShadows.value=Le.state.spotShadow,Bt.rectAreaLights.value=Le.state.rectArea,Bt.ltc_1.value=Le.state.rectAreaLTC1,Bt.ltc_2.value=Le.state.rectAreaLTC2,Bt.pointLights.value=Le.state.point,Bt.pointLightShadows.value=Le.state.pointShadow,Bt.hemisphereLights.value=Le.state.hemi,Bt.directionalShadowMap.value=Le.state.directionalShadowMap,Bt.directionalShadowMatrix.value=Le.state.directionalShadowMatrix,Bt.spotShadowMap.value=Le.state.spotShadowMap,Bt.spotLightMatrix.value=Le.state.spotLightMatrix,Bt.spotLightMap.value=Le.state.spotLightMap,Bt.pointShadowMap.value=Le.state.pointShadowMap,Bt.pointShadowMatrix.value=Le.state.pointShadowMatrix),Re.currentProgram=nt,Re.uniformsList=null,nt}function En(j){if(j.uniformsList===null){const Me=j.currentProgram.getUniforms();j.uniformsList=Pl.seqWithValue(Me.seq,j.uniforms)}return j.uniformsList}function un(j,Me){const De=tt.get(j);De.outputColorSpace=Me.outputColorSpace,De.batching=Me.batching,De.instancing=Me.instancing,De.instancingColor=Me.instancingColor,De.instancingMorph=Me.instancingMorph,De.skinning=Me.skinning,De.morphTargets=Me.morphTargets,De.morphNormals=Me.morphNormals,De.morphColors=Me.morphColors,De.morphTargetsCount=Me.morphTargetsCount,De.numClippingPlanes=Me.numClippingPlanes,De.numIntersection=Me.numClipIntersection,De.vertexAlphas=Me.vertexAlphas,De.vertexTangents=Me.vertexTangents,De.toneMapping=Me.toneMapping}function Qi(j,Me,De,Re,Le){Me.isScene!==!0&&(Me=Oe),lt.resetTextureUnits();const gt=Me.fog,vt=Re.isMeshStandardMaterial?Me.environment:null,xt=k===null?A.outputColorSpace:k.isXRRenderTarget===!0?k.texture.colorSpace:Vi,ut=(Re.isMeshStandardMaterial?X:qe).get(Re.envMap||vt),Nt=Re.vertexColors===!0&&!!De.attributes.color&&De.attributes.color.itemSize===4,nt=!!De.attributes.tangent&&(!!Re.normalMap||Re.anisotropy>0),Bt=!!De.morphAttributes.position,_i=!!De.morphAttributes.normal,vi=!!De.morphAttributes.color;let Pi=pa;Re.toneMapped&&(k===null||k.isXRRenderTarget===!0)&&(Pi=A.toneMapping);const dn=De.morphAttributes.position||De.morphAttributes.normal||De.morphAttributes.color,Zt=dn!==void 0?dn.length:0,Ut=tt.get(Re),Cn=y.state.lights;if(K===!0&&(se===!0||j!==C)){const Di=j===C&&Re.id===U;Qe.setState(Re,j,Di)}let li=!1;Re.version===Ut.__version?(Ut.needsLights&&Ut.lightsStateVersion!==Cn.state.version||Ut.outputColorSpace!==xt||Le.isBatchedMesh&&Ut.batching===!1||!Le.isBatchedMesh&&Ut.batching===!0||Le.isInstancedMesh&&Ut.instancing===!1||!Le.isInstancedMesh&&Ut.instancing===!0||Le.isSkinnedMesh&&Ut.skinning===!1||!Le.isSkinnedMesh&&Ut.skinning===!0||Le.isInstancedMesh&&Ut.instancingColor===!0&&Le.instanceColor===null||Le.isInstancedMesh&&Ut.instancingColor===!1&&Le.instanceColor!==null||Le.isInstancedMesh&&Ut.instancingMorph===!0&&Le.morphTexture===null||Le.isInstancedMesh&&Ut.instancingMorph===!1&&Le.morphTexture!==null||Ut.envMap!==ut||Re.fog===!0&&Ut.fog!==gt||Ut.numClippingPlanes!==void 0&&(Ut.numClippingPlanes!==Qe.numPlanes||Ut.numIntersection!==Qe.numIntersection)||Ut.vertexAlphas!==Nt||Ut.vertexTangents!==nt||Ut.morphTargets!==Bt||Ut.morphNormals!==_i||Ut.morphColors!==vi||Ut.toneMapping!==Pi||Ut.morphTargetsCount!==Zt)&&(li=!0):(li=!0,Ut.__version=Re.version);let Ji=Ut.currentProgram;li===!0&&(Ji=Ki(Re,Me,Le));let Ws=!1,Gn=!1,As=!1;const Mi=Ji.getUniforms(),en=Ut.uniforms;if(at.useProgram(Ji.program)&&(Ws=!0,Gn=!0,As=!0),Re.id!==U&&(U=Re.id,Gn=!0),Ws||C!==j){Mi.setValue(le,"projectionMatrix",j.projectionMatrix),Mi.setValue(le,"viewMatrix",j.matrixWorldInverse);const Di=Mi.map.cameraPosition;Di!==void 0&&Di.setValue(le,me.setFromMatrixPosition(j.matrixWorld)),ht.logarithmicDepthBuffer&&Mi.setValue(le,"logDepthBufFC",2/(Math.log(j.far+1)/Math.LN2)),(Re.isMeshPhongMaterial||Re.isMeshToonMaterial||Re.isMeshLambertMaterial||Re.isMeshBasicMaterial||Re.isMeshStandardMaterial||Re.isShaderMaterial)&&Mi.setValue(le,"isOrthographic",j.isOrthographicCamera===!0),C!==j&&(C=j,Gn=!0,As=!0)}if(Le.isSkinnedMesh){Mi.setOptional(le,Le,"bindMatrix"),Mi.setOptional(le,Le,"bindMatrixInverse");const Di=Le.skeleton;Di&&(Di.boneTexture===null&&Di.computeBoneTexture(),Mi.setValue(le,"boneTexture",Di.boneTexture,lt))}Le.isBatchedMesh&&(Mi.setOptional(le,Le,"batchingTexture"),Mi.setValue(le,"batchingTexture",Le._matricesTexture,lt));const Ni=De.morphAttributes;if((Ni.position!==void 0||Ni.normal!==void 0||Ni.color!==void 0)&&st.update(Le,De,Ji),(Gn||Ut.receiveShadow!==Le.receiveShadow)&&(Ut.receiveShadow=Le.receiveShadow,Mi.setValue(le,"receiveShadow",Le.receiveShadow)),Re.isMeshGouraudMaterial&&Re.envMap!==null&&(en.envMap.value=ut,en.flipEnvMap.value=ut.isCubeTexture&&ut.isRenderTargetTexture===!1?-1:1),Re.isMeshStandardMaterial&&Re.envMap===null&&Me.environment!==null&&(en.envMapIntensity.value=Me.environmentIntensity),Gn&&(Mi.setValue(le,"toneMappingExposure",A.toneMappingExposure),Ut.needsLights&&ft(en,As),gt&&Re.fog===!0&&Se.refreshFogUniforms(en,gt),Se.refreshMaterialUniforms(en,Re,Te,J,y.state.transmissionRenderTarget[j.id]),Pl.upload(le,En(Ut),en,lt)),Re.isShaderMaterial&&Re.uniformsNeedUpdate===!0&&(Pl.upload(le,En(Ut),en,lt),Re.uniformsNeedUpdate=!1),Re.isSpriteMaterial&&Mi.setValue(le,"center",Le.center),Mi.setValue(le,"modelViewMatrix",Le.modelViewMatrix),Mi.setValue(le,"normalMatrix",Le.normalMatrix),Mi.setValue(le,"modelMatrix",Le.matrixWorld),Re.isShaderMaterial||Re.isRawShaderMaterial){const Di=Re.uniformsGroups;for(let Ts=0,os=Di.length;Ts<os;Ts++){const ji=Di[Ts];mt.update(ji,Ji),mt.bind(ji,Ji)}}return Ji}function ft(j,Me){j.ambientLightColor.needsUpdate=Me,j.lightProbe.needsUpdate=Me,j.directionalLights.needsUpdate=Me,j.directionalLightShadows.needsUpdate=Me,j.pointLights.needsUpdate=Me,j.pointLightShadows.needsUpdate=Me,j.spotLights.needsUpdate=Me,j.spotLightShadows.needsUpdate=Me,j.rectAreaLights.needsUpdate=Me,j.hemisphereLights.needsUpdate=Me}function gi(j){return j.isMeshLambertMaterial||j.isMeshToonMaterial||j.isMeshPhongMaterial||j.isMeshStandardMaterial||j.isShadowMaterial||j.isShaderMaterial&&j.lights===!0}this.getActiveCubeFace=function(){return O},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return k},this.setRenderTargetTextures=function(j,Me,De){tt.get(j.texture).__webglTexture=Me,tt.get(j.depthTexture).__webglTexture=De;const Re=tt.get(j);Re.__hasExternalTextures=!0,Re.__autoAllocateDepthBuffer=De===void 0,Re.__autoAllocateDepthBuffer||Fe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Re.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(j,Me){const De=tt.get(j);De.__webglFramebuffer=Me,De.__useDefaultFramebuffer=Me===void 0},this.setRenderTarget=function(j,Me=0,De=0){k=j,O=Me,R=De;let Re=!0,Le=null,gt=!1,vt=!1;if(j){const ut=tt.get(j);ut.__useDefaultFramebuffer!==void 0?(at.bindFramebuffer(le.FRAMEBUFFER,null),Re=!1):ut.__webglFramebuffer===void 0?lt.setupRenderTarget(j):ut.__hasExternalTextures&&lt.rebindTextures(j,tt.get(j.texture).__webglTexture,tt.get(j.depthTexture).__webglTexture);const Nt=j.texture;(Nt.isData3DTexture||Nt.isDataArrayTexture||Nt.isCompressedArrayTexture)&&(vt=!0);const nt=tt.get(j).__webglFramebuffer;j.isWebGLCubeRenderTarget?(Array.isArray(nt[Me])?Le=nt[Me][De]:Le=nt[Me],gt=!0):j.samples>0&&lt.useMultisampledRTT(j)===!1?Le=tt.get(j).__webglMultisampledFramebuffer:Array.isArray(nt)?Le=nt[De]:Le=nt,T.copy(j.viewport),Z.copy(j.scissor),z=j.scissorTest}else T.copy(he).multiplyScalar(Te).floor(),Z.copy(Q).multiplyScalar(Te).floor(),z=pe;if(at.bindFramebuffer(le.FRAMEBUFFER,Le)&&Re&&at.drawBuffers(j,Le),at.viewport(T),at.scissor(Z),at.setScissorTest(z),gt){const ut=tt.get(j.texture);le.framebufferTexture2D(le.FRAMEBUFFER,le.COLOR_ATTACHMENT0,le.TEXTURE_CUBE_MAP_POSITIVE_X+Me,ut.__webglTexture,De)}else if(vt){const ut=tt.get(j.texture),Nt=Me||0;le.framebufferTextureLayer(le.FRAMEBUFFER,le.COLOR_ATTACHMENT0,ut.__webglTexture,De||0,Nt)}U=-1},this.readRenderTargetPixels=function(j,Me,De,Re,Le,gt,vt){if(!(j&&j.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let xt=tt.get(j).__webglFramebuffer;if(j.isWebGLCubeRenderTarget&&vt!==void 0&&(xt=xt[vt]),xt){at.bindFramebuffer(le.FRAMEBUFFER,xt);try{const ut=j.texture,Nt=ut.format,nt=ut.type;if(!ht.textureFormatReadable(Nt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!ht.textureTypeReadable(nt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Me>=0&&Me<=j.width-Re&&De>=0&&De<=j.height-Le&&le.readPixels(Me,De,Re,Le,rt.convert(Nt),rt.convert(nt),gt)}finally{const ut=k!==null?tt.get(k).__webglFramebuffer:null;at.bindFramebuffer(le.FRAMEBUFFER,ut)}}},this.copyFramebufferToTexture=function(j,Me,De=0){const Re=Math.pow(2,-De),Le=Math.floor(Me.image.width*Re),gt=Math.floor(Me.image.height*Re);lt.setTexture2D(Me,0),le.copyTexSubImage2D(le.TEXTURE_2D,De,0,0,j.x,j.y,Le,gt),at.unbindTexture()},this.copyTextureToTexture=function(j,Me,De,Re=0){const Le=Me.image.width,gt=Me.image.height,vt=rt.convert(De.format),xt=rt.convert(De.type);lt.setTexture2D(De,0),le.pixelStorei(le.UNPACK_FLIP_Y_WEBGL,De.flipY),le.pixelStorei(le.UNPACK_PREMULTIPLY_ALPHA_WEBGL,De.premultiplyAlpha),le.pixelStorei(le.UNPACK_ALIGNMENT,De.unpackAlignment),Me.isDataTexture?le.texSubImage2D(le.TEXTURE_2D,Re,j.x,j.y,Le,gt,vt,xt,Me.image.data):Me.isCompressedTexture?le.compressedTexSubImage2D(le.TEXTURE_2D,Re,j.x,j.y,Me.mipmaps[0].width,Me.mipmaps[0].height,vt,Me.mipmaps[0].data):le.texSubImage2D(le.TEXTURE_2D,Re,j.x,j.y,vt,xt,Me.image),Re===0&&De.generateMipmaps&&le.generateMipmap(le.TEXTURE_2D),at.unbindTexture()},this.copyTextureToTexture3D=function(j,Me,De,Re,Le=0){const gt=j.max.x-j.min.x,vt=j.max.y-j.min.y,xt=j.max.z-j.min.z,ut=rt.convert(Re.format),Nt=rt.convert(Re.type);let nt;if(Re.isData3DTexture)lt.setTexture3D(Re,0),nt=le.TEXTURE_3D;else if(Re.isDataArrayTexture||Re.isCompressedArrayTexture)lt.setTexture2DArray(Re,0),nt=le.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}le.pixelStorei(le.UNPACK_FLIP_Y_WEBGL,Re.flipY),le.pixelStorei(le.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Re.premultiplyAlpha),le.pixelStorei(le.UNPACK_ALIGNMENT,Re.unpackAlignment);const Bt=le.getParameter(le.UNPACK_ROW_LENGTH),_i=le.getParameter(le.UNPACK_IMAGE_HEIGHT),vi=le.getParameter(le.UNPACK_SKIP_PIXELS),Pi=le.getParameter(le.UNPACK_SKIP_ROWS),dn=le.getParameter(le.UNPACK_SKIP_IMAGES),Zt=De.isCompressedTexture?De.mipmaps[Le]:De.image;le.pixelStorei(le.UNPACK_ROW_LENGTH,Zt.width),le.pixelStorei(le.UNPACK_IMAGE_HEIGHT,Zt.height),le.pixelStorei(le.UNPACK_SKIP_PIXELS,j.min.x),le.pixelStorei(le.UNPACK_SKIP_ROWS,j.min.y),le.pixelStorei(le.UNPACK_SKIP_IMAGES,j.min.z),De.isDataTexture||De.isData3DTexture?le.texSubImage3D(nt,Le,Me.x,Me.y,Me.z,gt,vt,xt,ut,Nt,Zt.data):Re.isCompressedArrayTexture?le.compressedTexSubImage3D(nt,Le,Me.x,Me.y,Me.z,gt,vt,xt,ut,Zt.data):le.texSubImage3D(nt,Le,Me.x,Me.y,Me.z,gt,vt,xt,ut,Nt,Zt),le.pixelStorei(le.UNPACK_ROW_LENGTH,Bt),le.pixelStorei(le.UNPACK_IMAGE_HEIGHT,_i),le.pixelStorei(le.UNPACK_SKIP_PIXELS,vi),le.pixelStorei(le.UNPACK_SKIP_ROWS,Pi),le.pixelStorei(le.UNPACK_SKIP_IMAGES,dn),Le===0&&Re.generateMipmaps&&le.generateMipmap(nt),at.unbindTexture()},this.initTexture=function(j){j.isCubeTexture?lt.setTextureCube(j,0):j.isData3DTexture?lt.setTexture3D(j,0):j.isDataArrayTexture||j.isCompressedArrayTexture?lt.setTexture2DArray(j,0):lt.setTexture2D(j,0),at.unbindTexture()},this.resetState=function(){O=0,R=0,k=null,at.reset(),it.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return zs}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Nh?"display-p3":"srgb",t.unpackColorSpace=si.workingColorSpace===Ql?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class Id extends ri{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new vn,this.environmentIntensity=1,this.environmentRotation=new vn,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Hb{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=vh,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=ss()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return xp("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,s=this.stride;n<s;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ss()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ss()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const sn=new D;class Gh{constructor(e,t,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)sn.fromBufferAttribute(this,t),sn.applyMatrix4(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)sn.fromBufferAttribute(this,t),sn.applyNormalMatrix(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)sn.fromBufferAttribute(this,t),sn.transformDirection(e),this.setXYZ(t,sn.x,sn.y,sn.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=ts(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=hi(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=hi(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=hi(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=hi(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=hi(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ts(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ts(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ts(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ts(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=hi(t,this.array),i=hi(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=hi(t,this.array),i=hi(i,this.array),n=hi(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=hi(t,this.array),i=hi(i,this.array),n=hi(n,this.array),s=hi(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[n+s])}return new Ei(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Gh(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const n=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Ld=new D,Rd=new ui,Dd=new ui,Gb=new D,Fd=new Ft,ll=new D,Hc=new rs,Od=new Ft,Gc=new _s;class Eo extends It{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=pu,this.bindMatrix=new Ft,this.bindMatrixInverse=new Ft,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Hn),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,ll),this.boundingBox.expandByPoint(ll)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new rs),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,ll),this.boundingSphere.expandByPoint(ll)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,n=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Hc.copy(this.boundingSphere),Hc.applyMatrix4(n),e.ray.intersectsSphere(Hc)!==!1&&(Od.copy(n).invert(),Gc.copy(e.ray).applyMatrix4(Od),!(this.boundingBox!==null&&Gc.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,Gc)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ui,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===pu?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Yg?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,n=this.geometry;Rd.fromBufferAttribute(n.attributes.skinIndex,e),Dd.fromBufferAttribute(n.attributes.skinWeight,e),Ld.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=Dd.getComponent(s);if(a!==0){const r=Rd.getComponent(s);Fd.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),t.addScaledVector(Gb.copy(Ld).applyMatrix4(Fd),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Vp extends ri{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Wh extends Fi{constructor(e=null,t=1,i=1,n,s,a,r,l,c=ln,h=ln,d,f){super(null,a,r,l,c,h,n,s,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ud=new Ft,Wb=new Ft;let jb=class Hp{constructor(e=[],t=[]){this.uuid=ss(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,n=this.bones.length;i<n;i++)this.boneInverses.push(new Ft)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Ft;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const r=e[s]?e[s].matrixWorld:Wb;Ud.multiplyMatrices(r,t[s]),Ud.toArray(i,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new Hp(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Wh(t,e,e,Bn,Tn);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const s=e.bones[i];let a=t[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new Vp),this.bones.push(a),this.boneInverses.push(new Ft().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,s=t.length;n<s;n++){const a=t[n];e.bones.push(a.uuid);const r=i[n];e.boneInverses.push(r.toArray())}return e}};class Vl extends Ei{constructor(e,t,i,n=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const _r=new Ft,Nd=new Ft,cl=[],Bd=new Hn,qb=new Ft,ao=new It,ro=new rs;class Xb extends It{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Vl(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<i;n++)this.setMatrixAt(n,qb)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Hn),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,_r),Bd.copy(e.boundingBox).applyMatrix4(_r),this.boundingBox.union(Bd)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new rs),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,_r),ro.copy(e.boundingSphere).applyMatrix4(_r),this.boundingSphere.union(ro)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,n=this.morphTexture.source.data.data,s=i.length+1,a=e*s+1;for(let r=0;r<i.length;r++)i[r]=n[a+r]}raycast(e,t){const i=this.matrixWorld,n=this.count;if(ao.geometry=this.geometry,ao.material=this.material,ao.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ro.copy(this.boundingSphere),ro.applyMatrix4(i),e.ray.intersectsSphere(ro)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,_r),Nd.multiplyMatrices(i,_r),ao.matrixWorld=Nd,ao.raycast(e,cl);for(let a=0,r=cl.length;a<r;a++){const l=cl[a];l.instanceId=s,l.object=this,t.push(l)}cl.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Vl(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,n=i.length+1;this.morphTexture===null&&(this.morphTexture=new Wh(new Float32Array(n*this.count),n,this.count,pp,Tn));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<i.length;c++)a+=i[c];const r=this.geometry.morphTargetsRelative?1:1-a,l=n*e;s[l]=r,s.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class yn extends Vn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Dt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Hl=new D,Gl=new D,zd=new Ft,oo=new _s,hl=new rs,Wc=new D,Vd=new D;class Mn extends ri{constructor(e=new fi,t=new yn){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let n=1,s=t.count;n<s;n++)Hl.fromBufferAttribute(t,n-1),Gl.fromBufferAttribute(t,n),i[n]=i[n-1],i[n]+=Hl.distanceTo(Gl);e.setAttribute("lineDistance",new xi(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),hl.copy(i.boundingSphere),hl.applyMatrix4(n),hl.radius+=s,e.ray.intersectsSphere(hl)===!1)return;zd.copy(n).invert(),oo.copy(e.ray).applyMatrix4(zd);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=r*r,c=this.isLineSegments?2:1,h=i.index,f=i.attributes.position;if(h!==null){const p=Math.max(0,a.start),b=Math.min(h.count,a.start+a.count);for(let _=p,y=b-1;_<y;_+=c){const v=h.getX(_),S=h.getX(_+1),A=ul(this,e,oo,l,v,S);A&&t.push(A)}if(this.isLineLoop){const _=h.getX(b-1),y=h.getX(p),v=ul(this,e,oo,l,_,y);v&&t.push(v)}}else{const p=Math.max(0,a.start),b=Math.min(f.count,a.start+a.count);for(let _=p,y=b-1;_<y;_+=c){const v=ul(this,e,oo,l,_,_+1);v&&t.push(v)}if(this.isLineLoop){const _=ul(this,e,oo,l,b-1,p);_&&t.push(_)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}}function ul(o,e,t,i,n,s){const a=o.geometry.attributes.position;if(Hl.fromBufferAttribute(a,n),Gl.fromBufferAttribute(a,s),t.distanceSqToSegment(Hl,Gl,Wc,Vd)>i)return;Wc.applyMatrix4(o.matrixWorld);const l=e.ray.origin.distanceTo(Wc);if(!(l<e.near||l>e.far))return{distance:l,point:Vd.clone().applyMatrix4(o.matrixWorld),index:n,face:null,faceIndex:null,object:o}}const Hd=new D,Gd=new D;class Wl extends Mn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let n=0,s=t.count;n<s;n+=2)Hd.fromBufferAttribute(t,n),Gd.fromBufferAttribute(t,n+1),i[n]=n===0?0:i[n-1],i[n+1]=i[n]+Hd.distanceTo(Gd);e.setAttribute("lineDistance",new xi(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $b extends Mn{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Gp extends Vn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Dt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Wd=new Ft,wh=new _s,dl=new rs,fl=new D;class Yb extends ri{constructor(e=new fi,t=new Gp){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Points.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),dl.copy(i.boundingSphere),dl.applyMatrix4(n),dl.radius+=s,e.ray.intersectsSphere(dl)===!1)return;Wd.copy(n).invert(),wh.copy(e.ray).applyMatrix4(Wd);const r=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=r*r,c=i.index,d=i.attributes.position;if(c!==null){const f=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let b=f,_=p;b<_;b++){const y=c.getX(b);fl.fromBufferAttribute(d,y),jd(fl,y,l,n,e,t,this)}}else{const f=Math.max(0,a.start),p=Math.min(d.count,a.start+a.count);for(let b=f,_=p;b<_;b++)fl.fromBufferAttribute(d,b),jd(fl,b,l,n,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const n=t[i[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const r=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=s}}}}}function jd(o,e,t,i,n,s,a){const r=wh.distanceSqToPoint(o);if(r<t){const l=new D;wh.closestPointToPoint(o,l),l.applyMatrix4(i);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(r),point:l,index:e,face:null,object:a})}}class Ms{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)i=this.getPoint(a/e),s+=i.distanceTo(n),t.push(s),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const s=i.length;let a;t?a=t:a=e*i[s-1];let r=0,l=s-1,c;for(;r<=l;)if(n=Math.floor(r+(l-r)/2),c=i[n]-a,c<0)r=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,i[n]===a)return n/(s-1);const h=i[n],f=i[n+1]-h,p=(a-h)/f;return(n+p)/(s-1)}getTangent(e,t){let n=e-1e-4,s=e+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),r=this.getPoint(s),l=t||(a.isVector2?new et:new D);return l.copy(r).sub(a).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new D,n=[],s=[],a=[],r=new D,l=new Ft;for(let p=0;p<=e;p++){const b=p/e;n[p]=this.getTangentAt(b,new D)}s[0]=new D,a[0]=new D;let c=Number.MAX_VALUE;const h=Math.abs(n[0].x),d=Math.abs(n[0].y),f=Math.abs(n[0].z);h<=c&&(c=h,i.set(1,0,0)),d<=c&&(c=d,i.set(0,1,0)),f<=c&&i.set(0,0,1),r.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],r),a[0].crossVectors(n[0],s[0]);for(let p=1;p<=e;p++){if(s[p]=s[p-1].clone(),a[p]=a[p-1].clone(),r.crossVectors(n[p-1],n[p]),r.length()>Number.EPSILON){r.normalize();const b=Math.acos(Ti(n[p-1].dot(n[p]),-1,1));s[p].applyMatrix4(l.makeRotationAxis(r,b))}a[p].crossVectors(n[p],s[p])}if(t===!0){let p=Math.acos(Ti(s[0].dot(s[e]),-1,1));p/=e,n[0].dot(r.crossVectors(s[0],s[e]))>0&&(p=-p);for(let b=1;b<=e;b++)s[b].applyMatrix4(l.makeRotationAxis(n[b],p*b)),a[b].crossVectors(n[b],s[b])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class jh extends Ms{constructor(e=0,t=0,i=1,n=1,s=0,a=Math.PI*2,r=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=r,this.aRotation=l}getPoint(e,t=new et){const i=t,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const r=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(r),c=this.aY+this.yRadius*Math.sin(r);if(this.aRotation!==0){const h=Math.cos(this.aRotation),d=Math.sin(this.aRotation),f=l-this.aX,p=c-this.aY;l=f*h-p*d+this.aX,c=f*d+p*h+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Zb extends jh{constructor(e,t,i,n,s,a){super(e,t,i,i,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function qh(){let o=0,e=0,t=0,i=0;function n(s,a,r,l){o=s,e=r,t=-3*s+3*a-2*r-l,i=2*s-2*a+r+l}return{initCatmullRom:function(s,a,r,l,c){n(a,r,c*(r-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,r,l,c,h,d){let f=(a-s)/c-(r-s)/(c+h)+(r-a)/h,p=(r-a)/h-(l-a)/(h+d)+(l-r)/d;f*=h,p*=h,n(a,r,f,p)},calc:function(s){const a=s*s,r=a*s;return o+e*s+t*a+i*r}}}const pl=new D,jc=new qh,qc=new qh,Xc=new qh;class po extends Ms{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new D){const i=t,n=this.points,s=n.length,a=(s-(this.closed?0:1))*e;let r=Math.floor(a),l=a-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/s)+1)*s:l===0&&r===s-1&&(r=s-2,l=1);let c,h;this.closed||r>0?c=n[(r-1)%s]:(pl.subVectors(n[0],n[1]).add(n[0]),c=pl);const d=n[r%s],f=n[(r+1)%s];if(this.closed||r+2<s?h=n[(r+2)%s]:(pl.subVectors(n[s-1],n[s-2]).add(n[s-1]),h=pl),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let b=Math.pow(c.distanceToSquared(d),p),_=Math.pow(d.distanceToSquared(f),p),y=Math.pow(f.distanceToSquared(h),p);_<1e-4&&(_=1),b<1e-4&&(b=_),y<1e-4&&(y=_),jc.initNonuniformCatmullRom(c.x,d.x,f.x,h.x,b,_,y),qc.initNonuniformCatmullRom(c.y,d.y,f.y,h.y,b,_,y),Xc.initNonuniformCatmullRom(c.z,d.z,f.z,h.z,b,_,y)}else this.curveType==="catmullrom"&&(jc.initCatmullRom(c.x,d.x,f.x,h.x,this.tension),qc.initCatmullRom(c.y,d.y,f.y,h.y,this.tension),Xc.initCatmullRom(c.z,d.z,f.z,h.z,this.tension));return i.set(jc.calc(l),qc.calc(l),Xc.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new D().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function qd(o,e,t,i,n){const s=(i-e)*.5,a=(n-t)*.5,r=o*o,l=o*r;return(2*t-2*i+s+a)*l+(-3*t+3*i-2*s-a)*r+s*o+t}function Kb(o,e){const t=1-o;return t*t*e}function Qb(o,e){return 2*(1-o)*o*e}function Jb(o,e){return o*o*e}function yo(o,e,t,i){return Kb(o,e)+Qb(o,t)+Jb(o,i)}function ew(o,e){const t=1-o;return t*t*t*e}function tw(o,e){const t=1-o;return 3*t*t*o*e}function iw(o,e){return 3*(1-o)*o*o*e}function nw(o,e){return o*o*o*e}function vo(o,e,t,i,n){return ew(o,e)+tw(o,t)+iw(o,i)+nw(o,n)}class Wp extends Ms{constructor(e=new et,t=new et,i=new et,n=new et){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new et){const i=t,n=this.v0,s=this.v1,a=this.v2,r=this.v3;return i.set(vo(e,n.x,s.x,a.x,r.x),vo(e,n.y,s.y,a.y,r.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class sw extends Ms{constructor(e=new D,t=new D,i=new D,n=new D){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new D){const i=t,n=this.v0,s=this.v1,a=this.v2,r=this.v3;return i.set(vo(e,n.x,s.x,a.x,r.x),vo(e,n.y,s.y,a.y,r.y),vo(e,n.z,s.z,a.z,r.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class jp extends Ms{constructor(e=new et,t=new et){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new et){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new et){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class aw extends Ms{constructor(e=new D,t=new D){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new D){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new D){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class qp extends Ms{constructor(e=new et,t=new et,i=new et){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new et){const i=t,n=this.v0,s=this.v1,a=this.v2;return i.set(yo(e,n.x,s.x,a.x),yo(e,n.y,s.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class rw extends Ms{constructor(e=new D,t=new D,i=new D){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new D){const i=t,n=this.v0,s=this.v1,a=this.v2;return i.set(yo(e,n.x,s.x,a.x),yo(e,n.y,s.y,a.y),yo(e,n.z,s.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Xp extends Ms{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new et){const i=t,n=this.points,s=(n.length-1)*e,a=Math.floor(s),r=s-a,l=n[a===0?a:a-1],c=n[a],h=n[a>n.length-2?n.length-1:a+1],d=n[a>n.length-3?n.length-1:a+2];return i.set(qd(r,l.x,c.x,h.x,d.x),qd(r,l.y,c.y,h.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const n=e.points[t];this.points.push(new et().fromArray(n))}return this}}var Xd=Object.freeze({__proto__:null,ArcCurve:Zb,CatmullRomCurve3:po,CubicBezierCurve:Wp,CubicBezierCurve3:sw,EllipseCurve:jh,LineCurve:jp,LineCurve3:aw,QuadraticBezierCurve:qp,QuadraticBezierCurve3:rw,SplineCurve:Xp});class ow extends Ms{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Xd[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=i){const a=n[s]-i,r=this.curves[s],l=r.getLength(),c=l===0?0:1-a/l;return r.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],r=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(r);for(let c=0;c<l.length;c++){const h=l[c];i&&i.equals(h)||(t.push(h),i=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const n=e.curves[t];this.curves.push(new Xd[n.type]().fromJSON(n))}return this}}class lw extends ow{constructor(e){super(),this.type="Path",this.currentPoint=new et,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new jp(this.currentPoint.clone(),new et(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const s=new qp(this.currentPoint.clone(),new et(e,t),new et(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,s,a){const r=new Wp(this.currentPoint.clone(),new et(e,t),new et(i,n),new et(s,a));return this.curves.push(r),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new Xp(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,s,a){const r=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+r,t+l,i,n,s,a),this}absarc(e,t,i,n,s,a){return this.absellipse(e,t,i,i,n,s,a),this}ellipse(e,t,i,n,s,a,r,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,i,n,s,a,r,l),this}absellipse(e,t,i,n,s,a,r,l){const c=new jh(e,t,i,n,s,a,r,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Xh extends fi{constructor(e=[new et(0,-.5),new et(.5,0),new et(0,.5)],t=12,i=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Ti(n,0,Math.PI*2);const s=[],a=[],r=[],l=[],c=[],h=1/t,d=new D,f=new et,p=new D,b=new D,_=new D;let y=0,v=0;for(let S=0;S<=e.length-1;S++)switch(S){case 0:y=e[S+1].x-e[S].x,v=e[S+1].y-e[S].y,p.x=v*1,p.y=-y,p.z=v*0,_.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(_.x,_.y,_.z);break;default:y=e[S+1].x-e[S].x,v=e[S+1].y-e[S].y,p.x=v*1,p.y=-y,p.z=v*0,b.copy(p),p.x+=_.x,p.y+=_.y,p.z+=_.z,p.normalize(),l.push(p.x,p.y,p.z),_.copy(b)}for(let S=0;S<=t;S++){const A=i+S*h*n,E=Math.sin(A),O=Math.cos(A);for(let R=0;R<=e.length-1;R++){d.x=e[R].x*E,d.y=e[R].y,d.z=e[R].x*O,a.push(d.x,d.y,d.z),f.x=S/t,f.y=R/(e.length-1),r.push(f.x,f.y);const k=l[3*R+0]*E,U=l[3*R+1],C=l[3*R+0]*O;c.push(k,U,C)}}for(let S=0;S<t;S++)for(let A=0;A<e.length-1;A++){const E=A+S*e.length,O=E,R=E+e.length,k=E+e.length+1,U=E+1;s.push(O,R,U),s.push(k,U,R)}this.setIndex(s),this.setAttribute("position",new xi(a,3)),this.setAttribute("uv",new xi(r,2)),this.setAttribute("normal",new xi(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xh(e.points,e.segments,e.phiStart,e.phiLength)}}class $h extends Xh{constructor(e=1,t=1,i=4,n=8){const s=new lw;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:n}}static fromJSON(e){return new $h(e.radius,e.length,e.capSegments,e.radialSegments)}}class ic extends fi{constructor(e=1,t=1,i=1,n=32,s=1,a=!1,r=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:r,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const h=[],d=[],f=[],p=[];let b=0;const _=[],y=i/2;let v=0;S(),a===!1&&(e>0&&A(!0),t>0&&A(!1)),this.setIndex(h),this.setAttribute("position",new xi(d,3)),this.setAttribute("normal",new xi(f,3)),this.setAttribute("uv",new xi(p,2));function S(){const E=new D,O=new D;let R=0;const k=(t-e)/i;for(let U=0;U<=s;U++){const C=[],T=U/s,Z=T*(t-e)+e;for(let z=0;z<=n;z++){const B=z/n,V=B*l+r,Y=Math.sin(V),J=Math.cos(V);O.x=Z*Y,O.y=-T*i+y,O.z=Z*J,d.push(O.x,O.y,O.z),E.set(Y,k,J).normalize(),f.push(E.x,E.y,E.z),p.push(B,1-T),C.push(b++)}_.push(C)}for(let U=0;U<n;U++)for(let C=0;C<s;C++){const T=_[C][U],Z=_[C+1][U],z=_[C+1][U+1],B=_[C][U+1];h.push(T,Z,B),h.push(Z,z,B),R+=6}c.addGroup(v,R,0),v+=R}function A(E){const O=b,R=new et,k=new D;let U=0;const C=E===!0?e:t,T=E===!0?1:-1;for(let z=1;z<=n;z++)d.push(0,y*T,0),f.push(0,T,0),p.push(.5,.5),b++;const Z=b;for(let z=0;z<=n;z++){const V=z/n*l+r,Y=Math.cos(V),J=Math.sin(V);k.x=C*J,k.y=y*T,k.z=C*Y,d.push(k.x,k.y,k.z),f.push(0,T,0),R.x=Y*.5+.5,R.y=J*.5*T+.5,p.push(R.x,R.y),b++}for(let z=0;z<n;z++){const B=O+z,V=Z+z;E===!0?h.push(V,V+1,B):h.push(V+1,V,B),U+=3}c.addGroup(v,U,E===!0?1:2),v+=U}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ic(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class $p extends ic{constructor(e=1,t=1,i=32,n=1,s=!1,a=0,r=Math.PI*2){super(0,e,t,i,n,s,a,r),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:r}}static fromJSON(e){return new $p(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}const ml=new D,gl=new D,$c=new D,yl=new On;class $d extends fi{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const n=Math.pow(10,4),s=Math.cos(kr*t),a=e.getIndex(),r=e.getAttribute("position"),l=a?a.count:r.count,c=[0,0,0],h=["a","b","c"],d=new Array(3),f={},p=[];for(let b=0;b<l;b+=3){a?(c[0]=a.getX(b),c[1]=a.getX(b+1),c[2]=a.getX(b+2)):(c[0]=b,c[1]=b+1,c[2]=b+2);const{a:_,b:y,c:v}=yl;if(_.fromBufferAttribute(r,c[0]),y.fromBufferAttribute(r,c[1]),v.fromBufferAttribute(r,c[2]),yl.getNormal($c),d[0]=`${Math.round(_.x*n)},${Math.round(_.y*n)},${Math.round(_.z*n)}`,d[1]=`${Math.round(y.x*n)},${Math.round(y.y*n)},${Math.round(y.z*n)}`,d[2]=`${Math.round(v.x*n)},${Math.round(v.y*n)},${Math.round(v.z*n)}`,!(d[0]===d[1]||d[1]===d[2]||d[2]===d[0]))for(let S=0;S<3;S++){const A=(S+1)%3,E=d[S],O=d[A],R=yl[h[S]],k=yl[h[A]],U=`${E}_${O}`,C=`${O}_${E}`;C in f&&f[C]?($c.dot(f[C].normal)<=s&&(p.push(R.x,R.y,R.z),p.push(k.x,k.y,k.z)),f[C]=null):U in f||(f[U]={index0:c[S],index1:c[A],normal:$c.clone()})}}for(const b in f)if(f[b]){const{index0:_,index1:y}=f[b];ml.fromBufferAttribute(r,_),gl.fromBufferAttribute(r,y),p.push(ml.x,ml.y,ml.z),p.push(gl.x,gl.y,gl.z)}this.setAttribute("position",new xi(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Wi extends fi{constructor(e=1,t=32,i=16,n=0,s=Math.PI*2,a=0,r=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:s,thetaStart:a,thetaLength:r},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(a+r,Math.PI);let c=0;const h=[],d=new D,f=new D,p=[],b=[],_=[],y=[];for(let v=0;v<=i;v++){const S=[],A=v/i;let E=0;v===0&&a===0?E=.5/t:v===i&&l===Math.PI&&(E=-.5/t);for(let O=0;O<=t;O++){const R=O/t;d.x=-e*Math.cos(n+R*s)*Math.sin(a+A*r),d.y=e*Math.cos(a+A*r),d.z=e*Math.sin(n+R*s)*Math.sin(a+A*r),b.push(d.x,d.y,d.z),f.copy(d).normalize(),_.push(f.x,f.y,f.z),y.push(R+E,1-A),S.push(c++)}h.push(S)}for(let v=0;v<i;v++)for(let S=0;S<t;S++){const A=h[v][S+1],E=h[v][S],O=h[v+1][S],R=h[v+1][S+1];(v!==0||a>0)&&p.push(A,E,R),(v!==i-1||l<Math.PI)&&p.push(E,O,R)}this.setIndex(p),this.setAttribute("position",new xi(b,3)),this.setAttribute("normal",new xi(_,3)),this.setAttribute("uv",new xi(y,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wi(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class cw extends as{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Sn extends Vn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Dt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Dt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=wp,this.normalScale=new et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vn,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class xs extends Sn{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new et(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ti(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Dt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Dt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Dt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function vl(o,e,t){return!o||!t&&o.constructor===e?o:typeof e.BYTES_PER_ELEMENT=="number"?new e(o):Array.prototype.slice.call(o)}function hw(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)}function uw(o){function e(n,s){return o[n]-o[s]}const t=o.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort(e),i}function Yd(o,e,t){const i=o.length,n=new o.constructor(i);for(let s=0,a=0;a!==i;++s){const r=t[s]*e;for(let l=0;l!==e;++l)n[a++]=o[r+l]}return n}function Yp(o,e,t,i){let n=1,s=o[0];for(;s!==void 0&&s[i]===void 0;)s=o[n++];if(s===void 0)return;let a=s[i];if(a!==void 0)if(Array.isArray(a))do a=s[i],a!==void 0&&(e.push(s.time),t.push.apply(t,a)),s=o[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[i],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=o[n++];while(s!==void 0);else do a=s[i],a!==void 0&&(e.push(s.time),t.push(a)),s=o[n++];while(s!==void 0)}class ko{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],s=t[i-1];e:{t:{let a;i:{n:if(!(e<n)){for(let r=i+2;;){if(n===void 0){if(e<s)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===r)break;if(s=n,n=t[++i],e<n)break t}a=t.length;break i}if(!(e>=s)){const r=t[1];e<r&&(i=2,s=r);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(n=s,s=t[--i-1],e>=s)break t}a=i,i=0;break i}break e}for(;i<a;){const r=i+a>>>1;e<t[r]?a=r:i=r+1}if(n=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n;for(let a=0;a!==n;++a)t[a]=i[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class dw extends ko{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Sr,endingEnd:Sr}}intervalChanged_(e,t,i){const n=this.parameterPositions;let s=e-2,a=e+1,r=n[s],l=n[a];if(r===void 0)switch(this.getSettings_().endingStart){case Ar:s=e,r=2*t-i;break;case Ol:s=n.length-2,r=t+n[s]-n[s+1];break;default:s=e,r=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Ar:a=e,l=2*i-t;break;case Ol:a=1,l=i+n[1]-n[0];break;default:a=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-r),this._weightNext=c/(l-i),this._offsetPrev=s*h,this._offsetNext=a*h}interpolate_(e,t,i,n){const s=this.resultBuffer,a=this.sampleValues,r=this.valueSize,l=e*r,c=l-r,h=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,p=this._weightNext,b=(i-t)/(n-t),_=b*b,y=_*b,v=-f*y+2*f*_-f*b,S=(1+f)*y+(-1.5-2*f)*_+(-.5+f)*b+1,A=(-1-p)*y+(1.5+p)*_+.5*b,E=p*y-p*_;for(let O=0;O!==r;++O)s[O]=v*a[h+O]+S*a[c+O]+A*a[l+O]+E*a[d+O];return s}}class Zp extends ko{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const s=this.resultBuffer,a=this.sampleValues,r=this.valueSize,l=e*r,c=l-r,h=(i-t)/(n-t),d=1-h;for(let f=0;f!==r;++f)s[f]=a[c+f]*d+a[l+f]*h;return s}}class fw extends ko{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ss{constructor(e,t,i,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=vl(t,this.TimeBufferType),this.values=vl(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:vl(e.times,Array),values:vl(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(i.interpolation=n)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new fw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Zp(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new dw(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ao:t=this.InterpolantFactoryMethodDiscrete;break;case Br:t=this.InterpolantFactoryMethodLinear;break;case gc:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ao;case this.InterpolantFactoryMethodLinear:return Br;case this.InterpolantFactoryMethodSmooth:return gc}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let s=0,a=n-1;for(;s!==n&&i[s]<e;)++s;for(;a!==-1&&i[a]>t;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const r=this.getValueSize();this.times=i.slice(s,a),this.values=this.values.slice(s*r,a*r)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let r=0;r!==s;r++){const l=i[r];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,r,l),e=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,r,l,a),e=!1;break}a=l}if(n!==void 0&&hw(n))for(let r=0,l=n.length;r!==l;++r){const c=n[r];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,r,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===gc,s=e.length-1;let a=1;for(let r=1;r<s;++r){let l=!1;const c=e[r],h=e[r+1];if(c!==h&&(r!==1||c!==e[0]))if(n)l=!0;else{const d=r*i,f=d-i,p=d+i;for(let b=0;b!==i;++b){const _=t[d+b];if(_!==t[f+b]||_!==t[p+b]){l=!0;break}}}if(l){if(r!==a){e[a]=e[r];const d=r*i,f=a*i;for(let p=0;p!==i;++p)t[f+p]=t[d+p]}++a}}if(s>0){e[a]=e[s];for(let r=s*i,l=a*i,c=0;c!==i;++c)t[l+c]=t[r+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,n=new i(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Ss.prototype.TimeBufferType=Float32Array;Ss.prototype.ValueBufferType=Float32Array;Ss.prototype.DefaultInterpolation=Br;class jr extends Ss{}jr.prototype.ValueTypeName="bool";jr.prototype.ValueBufferType=Array;jr.prototype.DefaultInterpolation=Ao;jr.prototype.InterpolantFactoryMethodLinear=void 0;jr.prototype.InterpolantFactoryMethodSmooth=void 0;class Kp extends Ss{}Kp.prototype.ValueTypeName="color";class Hr extends Ss{}Hr.prototype.ValueTypeName="number";class pw extends ko{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const s=this.resultBuffer,a=this.sampleValues,r=this.valueSize,l=(i-t)/(n-t);let c=e*r;for(let h=c+r;c!==h;c+=4)ai.slerpFlat(s,0,a,c-r,a,c,l);return s}}class Ga extends Ss{InterpolantFactoryMethodLinear(e){return new pw(this.times,this.values,this.getValueSize(),e)}}Ga.prototype.ValueTypeName="quaternion";Ga.prototype.DefaultInterpolation=Br;Ga.prototype.InterpolantFactoryMethodSmooth=void 0;class qr extends Ss{}qr.prototype.ValueTypeName="string";qr.prototype.ValueBufferType=Array;qr.prototype.DefaultInterpolation=Ao;qr.prototype.InterpolantFactoryMethodLinear=void 0;qr.prototype.InterpolantFactoryMethodSmooth=void 0;class Gr extends Ss{}Gr.prototype.ValueTypeName="vector";class Co{constructor(e="",t=-1,i=[],n=Uh){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=ss(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let a=0,r=i.length;a!==r;++a)t.push(gw(i[a]).scale(n));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=i.length;s!==a;++s)t.push(Ss.toJSON(i[s]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const s=t.length,a=[];for(let r=0;r<s;r++){let l=[],c=[];l.push((r+s-1)%s,r,(r+1)%s),c.push(0,1,0);const h=uw(l);l=Yd(l,1,h),c=Yd(c,1,h),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new Hr(".morphTargetInfluences["+t[r].name+"]",l,c).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const n=e;i=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let r=0,l=e.length;r<l;r++){const c=e[r],h=c.name.match(s);if(h&&h.length>1){const d=h[1];let f=n[d];f||(n[d]=f=[]),f.push(c)}}const a=[];for(const r in n)a.push(this.CreateFromMorphTargetSequence(r,n[r],t,i));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(d,f,p,b,_){if(p.length!==0){const y=[],v=[];Yp(p,y,v,b),y.length!==0&&_.push(new d(f,y,v))}},n=[],s=e.name||"default",a=e.fps||30,r=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const f=c[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let b;for(b=0;b<f.length;b++)if(f[b].morphTargets)for(let _=0;_<f[b].morphTargets.length;_++)p[f[b].morphTargets[_]]=-1;for(const _ in p){const y=[],v=[];for(let S=0;S!==f[b].morphTargets.length;++S){const A=f[b];y.push(A.time),v.push(A.morphTarget===_?1:0)}n.push(new Hr(".morphTargetInfluence["+_+"]",y,v))}l=p.length*a}else{const p=".bones["+t[d].name+"]";i(Gr,p+".position",f,"pos",n),i(Ga,p+".quaternion",f,"rot",n),i(Gr,p+".scale",f,"scl",n)}}return n.length===0?null:new this(s,l,n,r)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,n=e.length;i!==n;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function mw(o){switch(o.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Hr;case"vector":case"vector2":case"vector3":case"vector4":return Gr;case"color":return Kp;case"quaternion":return Ga;case"bool":case"boolean":return jr;case"string":return qr}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+o)}function gw(o){if(o.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=mw(o.type);if(o.times===void 0){const t=[],i=[];Yp(o.keys,t,i,"value"),o.times=t,o.values=i}return e.parse!==void 0?e.parse(o):new e(o.name,o.times,o.values,o.interpolation)}const fa={enabled:!1,files:{},add:function(o,e){this.enabled!==!1&&(this.files[o]=e)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}};class yw{constructor(e,t,i){const n=this;let s=!1,a=0,r=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){r++,s===!1&&n.onStart!==void 0&&n.onStart(h,a,r),s=!0},this.itemEnd=function(h){a++,n.onProgress!==void 0&&n.onProgress(h,a,r),a===r&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(h){n.onError!==void 0&&n.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,d){return c.push(h,d),this},this.removeHandler=function(h){const d=c.indexOf(h);return d!==-1&&c.splice(d,2),this},this.getHandler=function(h){for(let d=0,f=c.length;d<f;d+=2){const p=c[d],b=c[d+1];if(p.global&&(p.lastIndex=0),p.test(h))return b}return null}}}const vw=new yw;let Wa=class{constructor(e){this.manager=e!==void 0?e:vw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(n,s){i.load(e,n,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};Wa.DEFAULT_MATERIAL_NAME="__DEFAULT";const Fs={};class bw extends Error{constructor(e,t){super(e),this.response=t}}class Yh extends Wa{constructor(e){super(e)}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=fa.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Fs[e]!==void 0){Fs[e].push({onLoad:t,onProgress:i,onError:n});return}Fs[e]=[],Fs[e].push({onLoad:t,onProgress:i,onError:n});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),r=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=Fs[e],d=c.body.getReader(),f=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=f?parseInt(f):0,b=p!==0;let _=0;const y=new ReadableStream({start(v){S();function S(){d.read().then(({done:A,value:E})=>{if(A)v.close();else{_+=E.byteLength;const O=new ProgressEvent("progress",{lengthComputable:b,loaded:_,total:p});for(let R=0,k=h.length;R<k;R++){const U=h[R];U.onProgress&&U.onProgress(O)}v.enqueue(E),S()}})}}});return new Response(y)}else throw new bw(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,r));case"json":return c.json();default:if(r===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(r),f=d&&d[1]?d[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(b=>p.decode(b))}}}).then(c=>{fa.add(e,c);const h=Fs[e];delete Fs[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=Fs[e];if(h===void 0)throw this.manager.itemError(e),c;delete Fs[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ww extends Wa{constructor(e){super(e)}load(e,t,i,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=fa.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;const r=To("img");function l(){h(),fa.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(d){h(),n&&n(d),s.manager.itemError(e),s.manager.itemEnd(e)}function h(){r.removeEventListener("load",l,!1),r.removeEventListener("error",c,!1)}return r.addEventListener("load",l,!1),r.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(r.crossOrigin=this.crossOrigin),s.manager.itemStart(e),r.src=e,r}}class _w extends Wa{constructor(e){super(e)}load(e,t,i,n){const s=this,a=new Wh,r=new Yh(this.manager);return r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setPath(this.path),r.setWithCredentials(s.withCredentials),r.load(e,function(l){let c;try{c=s.parse(l)}catch(h){if(n!==void 0)n(h);else{console.error(h);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:ws,a.wrapT=c.wrapT!==void 0?c.wrapT:ws,a.magFilter=c.magFilter!==void 0?c.magFilter:wi,a.minFilter=c.minFilter!==void 0?c.minFilter:wi,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=is),c.mipmapCount===1&&(a.minFilter=wi),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,t&&t(a,c)},i,n),a}}class nc extends Wa{constructor(e){super(e)}load(e,t,i,n){const s=new Fi,a=new ww(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(r){s.image=r,s.needsUpdate=!0,t!==void 0&&t(s)},i,n),s}}class sc extends ri{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Dt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const Yc=new Ft,Zd=new D,Kd=new D;class Zh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new et(512,512),this.map=null,this.mapPass=null,this.matrix=new Ft,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Vh,this._frameExtents=new et(1,1),this._viewportCount=1,this._viewports=[new ui(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;Zd.setFromMatrixPosition(e.matrixWorld),t.position.copy(Zd),Kd.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Kd),t.updateMatrixWorld(),Yc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Yc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Yc)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Mw extends Zh{constructor(){super(new on(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=zr*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||n!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=n,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class xw extends sc{constructor(e,t,i=0,n=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ri.DEFAULT_UP),this.updateMatrix(),this.target=new ri,this.distance=i,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new Mw}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Qd=new Ft,lo=new D,Zc=new D;class Sw extends Zh{constructor(){super(new on(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new et(4,2),this._viewportCount=6,this._viewports=[new ui(2,1,1,1),new ui(0,1,1,1),new ui(3,1,1,1),new ui(1,1,1,1),new ui(3,0,1,1),new ui(1,0,1,1)],this._cubeDirections=[new D(1,0,0),new D(-1,0,0),new D(0,0,1),new D(0,0,-1),new D(0,1,0),new D(0,-1,0)],this._cubeUps=[new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,0,1),new D(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),lo.setFromMatrixPosition(e.matrixWorld),i.position.copy(lo),Zc.copy(i.position),Zc.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Zc),i.updateMatrixWorld(),n.makeTranslation(-lo.x,-lo.y,-lo.z),Qd.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Qd)}}class Aw extends sc{constructor(e,t,i=0,n=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Sw}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Tw extends Zh{constructor(){super(new ec(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Qp extends sc{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ri.DEFAULT_UP),this.updateMatrix(),this.target=new ri,this.shadow=new Tw}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Ew extends sc{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class bo{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Cw extends fi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Pw extends Wa{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=fa.get(e);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(c=>{t&&t(c),s.manager.itemEnd(e)}).catch(c=>{n&&n(c)});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const r={};r.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",r.headers=this.requestHeader;const l=fetch(e,r).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return fa.add(e,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){n&&n(c),fa.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});fa.add(e,l),s.manager.itemStart(e)}}class Kh{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Jd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Jd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Jd(){return(typeof performance>"u"?Date:performance).now()}class kw{constructor(e,t,i){this.binding=e,this.valueSize=i;let n,s,a;switch(t){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,s=e*n+n;let a=this.cumulativeWeight;if(a===0){for(let r=0;r!==n;++r)i[s+r]=i[r];a=t}else{a+=t;const r=t/a;this._mixBufferRegion(i,s,0,r,n)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,r=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(i,n,l,1-s,t)}a>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){r.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let s=i,a=n;s!==a;++s)t[s]=t[n+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,s){if(n>=.5)for(let a=0;a!==s;++a)e[t+a]=e[i+a]}_slerp(e,t,i,n){ai.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,s){const a=this._workIndex*s;ai.multiplyQuaternionsFlat(e,a,e,t,e,i),ai.slerpFlat(e,t,e,t,e,a,n)}_lerp(e,t,i,n,s){const a=1-n;for(let r=0;r!==s;++r){const l=t+r;e[l]=e[l]*a+e[i+r]*n}}_lerpAdditive(e,t,i,n,s){for(let a=0;a!==s;++a){const r=t+a;e[r]=e[r]+e[i+a]*n}}}const Qh="\\[\\]\\.:\\/",Iw=new RegExp("["+Qh+"]","g"),Jh="[^"+Qh+"]",Lw="[^"+Qh.replace("\\.","")+"]",Rw=/((?:WC+[\/:])*)/.source.replace("WC",Jh),Dw=/(WCOD+)?/.source.replace("WCOD",Lw),Fw=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Jh),Ow=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Jh),Uw=new RegExp("^"+Rw+Dw+Fw+Ow+"$"),Nw=["material","materials","bones","map"];class Bw{constructor(e,t,i){const n=i||oi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];n!==void 0&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class oi{constructor(e,t,i){this.path=t,this.parsedPath=i||oi.parseTrackName(t),this.node=oi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new oi.Composite(e,t,i):new oi(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Iw,"")}static parseTrackName(e){const t=Uw.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=i.nodeName.substring(n+1);Nw.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let a=0;a<s.length;a++){const r=s[a];if(r.name===t||r.uuid===t)return r;const l=i(r.children);if(l)return l}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let s=t.propertyIndex;if(e||(e=oi.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[n];if(a===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let r=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?r=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(r=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][r]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}oi.Composite=Bw;oi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};oi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};oi.prototype.GetterByBindingType=[oi.prototype._getValue_direct,oi.prototype._getValue_array,oi.prototype._getValue_arrayElement,oi.prototype._getValue_toArray];oi.prototype.SetterByBindingTypeAndVersioning=[[oi.prototype._setValue_direct,oi.prototype._setValue_direct_setNeedsUpdate,oi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[oi.prototype._setValue_array,oi.prototype._setValue_array_setNeedsUpdate,oi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[oi.prototype._setValue_arrayElement,oi.prototype._setValue_arrayElement_setNeedsUpdate,oi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[oi.prototype._setValue_fromArray,oi.prototype._setValue_fromArray_setNeedsUpdate,oi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class zw{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const s=t.tracks,a=s.length,r=new Array(a),l={endingStart:Sr,endingEnd:Sr};for(let c=0;c!==a;++c){const h=s[c].createInterpolant(null);r[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=r,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=a0,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const n=this._clip.duration,s=e._clip.duration,a=s/n,r=n/s;e.warp(1,a,t),this.warp(r,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,s=n.time,a=this.timeScale;let r=this._timeScaleInterpolant;r===null&&(r=n._lendControlInterpolant(),this._timeScaleInterpolant=r);const l=r.parameterPositions,c=r.sampleValues;return l[0]=s,l[1]=s+i,c[0]=e/a,c[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const a=this._updateTime(t),r=this._updateWeight(e);if(r>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case o0:for(let h=0,d=l.length;h!==d;++h)l[h].evaluate(a),c[h].accumulateAdditive(r);break;case Uh:default:for(let h=0,d=l.length;h!==d;++h)l[h].evaluate(a),c[h].accumulate(n,r)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,s=this._loopCount;const a=i===r0;if(e===0)return s===-1?n:a&&(s&1)===1?t-n:n;if(i===Cl){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=t||n<0){const r=Math.floor(n/t);n-=t*r,s+=Math.abs(r);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:r})}}else this.time=n;if(a&&(s&1)===1)return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=Ar,n.endingEnd=Ar):(e?n.endingStart=this.zeroSlopeAtStart?Ar:Sr:n.endingStart=Ol,t?n.endingEnd=this.zeroSlopeAtEnd?Ar:Sr:n.endingEnd=Ol)}_scheduleFading(e,t,i){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const r=a.parameterPositions,l=a.sampleValues;return r[0]=s,l[0]=t,r[1]=s+e,l[1]=i,this}}const Vw=new Float32Array(1);class Lr extends ya{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,s=n.length,a=e._propertyBindings,r=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let d=0;d!==s;++d){const f=n[d],p=f.name;let b=h[p];if(b!==void 0)++b.referenceCount,a[d]=b;else{if(b=a[d],b!==void 0){b._cacheIndex===null&&(++b.referenceCount,this._addInactiveBinding(b,l,p));continue}const _=t&&t._propertyBindings[d].binding.parsedPath;b=new kw(oi.create(i,p,_),f.ValueTypeName,f.getValueSize()),++b.referenceCount,this._addInactiveBinding(b,l,p),a[d]=b}r[d].resultBuffer=b.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,n=e._clip.uuid,s=this._actionsByClip[n];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,n,i)}const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const r=a.knownActions;e._byClipCacheIndex=r.length,r.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,r=a[s],l=r.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null;const d=r.actionByRoot,f=(e._localRoot||this._root).uuid;delete d[f],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){const s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[t];a===void 0&&(a={},n[t]=a),a[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,s=i.path,a=this._bindingsByRootAndName,r=a[n],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete r[s],Object.keys(r).length===0&&delete a[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new Zp(new Float32Array(2),new Float32Array(2),1,Vw),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,s=t[n];e.__cacheIndex=n,t[n]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const n=t||this._root,s=n.uuid;let a=typeof e=="string"?Co.findByName(n,e):e;const r=a!==null?a.uuid:e,l=this._actionsByClip[r];let c=null;if(i===void 0&&(a!==null?i=a.blendMode:i=Uh),l!==void 0){const d=l.actionByRoot[s];if(d!==void 0&&d.blendMode===i)return d;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const h=new zw(this,a,t,i);return this._bindAction(h,c),this._addInactiveAction(h,r,s),h}existingAction(e,t){const i=t||this._root,n=i.uuid,s=typeof e=="string"?Co.findByName(i,e):e,a=s?s.uuid:e,r=this._actionsByClip[a];return r!==void 0&&r.actionByRoot[n]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(n,e,s,a);const r=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)r[c].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,s=n[i];if(s!==void 0){const a=s.knownActions;for(let r=0,l=a.length;r!==l;++r){const c=a[r];this._deactivateAction(c);const h=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=h,t[h]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const a in i){const r=i[a].actionByRoot,l=r[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[t];if(s!==void 0)for(const a in s){const r=s[a];r.restoreOriginalState(),this._removeInactiveBinding(r)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}const ef=new Ft;class ys{constructor(e,t,i=0,n=1/0){this.ray=new _s(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new zh,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return ef.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(ef),this}intersectObject(e,t=!0,i=[]){return _h(e,this,i,t),i.sort(tf),i}intersectObjects(e,t=!0,i=[]){for(let n=0,s=e.length;n<s;n++)_h(e[n],this,i,t);return i.sort(tf),i}}function tf(o,e){return o.distance-e.distance}function _h(o,e,t,i){if(o.layers.test(e.layers)&&o.raycast(e,t),i===!0){const n=o.children;for(let s=0,a=n.length;s<a;s++)_h(n[s],e,t,!0)}}class Mh{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Ti(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const nf=new D,bl=new D;class Jp{constructor(e=new D,t=new D){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){nf.subVectors(e,this.start),bl.subVectors(this.end,this.start);const i=bl.dot(bl);let s=bl.dot(nf)/i;return t&&(s=Ti(s,0,1)),s}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const ra=new D,wl=new Ft,Kc=new Ft;class Hw extends Wl{constructor(e){const t=em(e),i=new fi,n=[],s=[],a=new Dt(0,0,1),r=new Dt(0,1,0);for(let c=0;c<t.length;c++){const h=t[c];h.parent&&h.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(a.r,a.g,a.b),s.push(r.r,r.g,r.b))}i.setAttribute("position",new xi(n,3)),i.setAttribute("color",new xi(s,3));const l=new yn({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");Kc.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const r=t[s];r.parent&&r.parent.isBone&&(wl.multiplyMatrices(Kc,r.matrixWorld),ra.setFromMatrixPosition(wl),n.setXYZ(a,ra.x,ra.y,ra.z),wl.multiplyMatrices(Kc,r.parent.matrixWorld),ra.setFromMatrixPosition(wl),n.setXYZ(a+1,ra.x,ra.y,ra.z),a+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function em(o){const e=[];o.isBone===!0&&e.push(o);for(let t=0;t<o.children.length;t++)e.push.apply(e,em(o.children[t]));return e}const sf=new D;let _l,Qc;class af extends ri{constructor(e=new D(0,0,1),t=new D(0,0,0),i=1,n=16776960,s=i*.2,a=s*.2){super(),this.type="ArrowHelper",_l===void 0&&(_l=new fi,_l.setAttribute("position",new xi([0,0,0,0,1,0],3)),Qc=new ic(0,.5,1,5,1),Qc.translate(0,-.5,0)),this.position.copy(t),this.line=new Mn(_l,new yn({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new It(Qc,new qt({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{sf.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(sf,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Oh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Oh);const rf={type:"change"},Jc={type:"start"},of={type:"end"},Ml=new _s,lf=new ha,Gw=Math.cos(70*Et.DEG2RAD);class tm extends ya{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new D,this.cursor=new D,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ir.ROTATE,MIDDLE:ir.DOLLY,RIGHT:ir.PAN},this.touches={ONE:nr.ROTATE,TWO:nr.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(L){L.addEventListener("keydown",je),this._domElementKeyEvents=L},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",je),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(rf),i.update(),s=n.NONE},this.update=function(){const L=new D,ye=new ai().setFromUnitVectors(e.up,new D(0,1,0)),_e=ye.clone().invert(),Ue=new D,Xe=new ai,Pt=new D,bt=2*Math.PI;return function(Ot=null){const St=i.object.position;L.copy(St).sub(i.target),L.applyQuaternion(ye),r.setFromVector3(L),i.autoRotate&&s===n.NONE&&z(T(Ot)),i.enableDamping?(r.theta+=l.theta*i.dampingFactor,r.phi+=l.phi*i.dampingFactor):(r.theta+=l.theta,r.phi+=l.phi);let At=i.minAzimuthAngle,Lt=i.maxAzimuthAngle;isFinite(At)&&isFinite(Lt)&&(At<-Math.PI?At+=bt:At>Math.PI&&(At-=bt),Lt<-Math.PI?Lt+=bt:Lt>Math.PI&&(Lt-=bt),At<=Lt?r.theta=Math.max(At,Math.min(Lt,r.theta)):r.theta=r.theta>(At+Lt)/2?Math.max(At,r.theta):Math.min(Lt,r.theta)),r.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,r.phi)),r.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let pi=!1;if(i.zoomToCursor&&R||i.object.isOrthographicCamera)r.radius=he(r.radius);else{const ii=r.radius;r.radius=he(r.radius*c),pi=ii!=r.radius}if(L.setFromSpherical(r),L.applyQuaternion(_e),St.copy(i.target).add(L),i.object.lookAt(i.target),i.enableDamping===!0?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),h.set(0,0,0)),i.zoomToCursor&&R){let ii=null;if(i.object.isPerspectiveCamera){const Qt=L.length();ii=he(Qt*c);const mi=Qt-ii;i.object.position.addScaledVector(E,mi),i.object.updateMatrixWorld(),pi=!!mi}else if(i.object.isOrthographicCamera){const Qt=new D(O.x,O.y,0);Qt.unproject(i.object);const mi=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),i.object.updateProjectionMatrix(),pi=mi!==i.object.zoom;const Ri=new D(O.x,O.y,0);Ri.unproject(i.object),i.object.position.sub(Ri).add(Qt),i.object.updateMatrixWorld(),ii=L.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;ii!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(ii).add(i.object.position):(Ml.origin.copy(i.object.position),Ml.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(Ml.direction))<Gw?e.lookAt(i.target):(lf.setFromNormalAndCoplanarPoint(i.object.up,i.target),Ml.intersectPlane(lf,i.target))))}else if(i.object.isOrthographicCamera){const ii=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/c)),ii!==i.object.zoom&&(i.object.updateProjectionMatrix(),pi=!0)}return c=1,R=!1,pi||Ue.distanceToSquared(i.object.position)>a||8*(1-Xe.dot(i.object.quaternion))>a||Pt.distanceToSquared(i.target)>a?(i.dispatchEvent(rf),Ue.copy(i.object.position),Xe.copy(i.object.quaternion),Pt.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",pt),i.domElement.removeEventListener("pointerdown",X),i.domElement.removeEventListener("pointercancel",re),i.domElement.removeEventListener("wheel",Se),i.domElement.removeEventListener("pointermove",F),i.domElement.removeEventListener("pointerup",re),i.domElement.getRootNode().removeEventListener("keydown",$e,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",je),i._domElementKeyEvents=null)};const i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=n.NONE;const a=1e-6,r=new Mh,l=new Mh;let c=1;const h=new D,d=new et,f=new et,p=new et,b=new et,_=new et,y=new et,v=new et,S=new et,A=new et,E=new D,O=new et;let R=!1;const k=[],U={};let C=!1;function T(L){return L!==null?2*Math.PI/60*i.autoRotateSpeed*L:2*Math.PI/60/60*i.autoRotateSpeed}function Z(L){const ye=Math.abs(L*.01);return Math.pow(.95,i.zoomSpeed*ye)}function z(L){l.theta-=L}function B(L){l.phi-=L}const V=function(){const L=new D;return function(_e,Ue){L.setFromMatrixColumn(Ue,0),L.multiplyScalar(-_e),h.add(L)}}(),Y=function(){const L=new D;return function(_e,Ue){i.screenSpacePanning===!0?L.setFromMatrixColumn(Ue,1):(L.setFromMatrixColumn(Ue,0),L.crossVectors(i.object.up,L)),L.multiplyScalar(_e),h.add(L)}}(),J=function(){const L=new D;return function(_e,Ue){const Xe=i.domElement;if(i.object.isPerspectiveCamera){const Pt=i.object.position;L.copy(Pt).sub(i.target);let bt=L.length();bt*=Math.tan(i.object.fov/2*Math.PI/180),V(2*_e*bt/Xe.clientHeight,i.object.matrix),Y(2*Ue*bt/Xe.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(V(_e*(i.object.right-i.object.left)/i.object.zoom/Xe.clientWidth,i.object.matrix),Y(Ue*(i.object.top-i.object.bottom)/i.object.zoom/Xe.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function Te(L){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c/=L:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ge(L){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?c*=L:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function fe(L,ye){if(!i.zoomToCursor)return;R=!0;const _e=i.domElement.getBoundingClientRect(),Ue=L-_e.left,Xe=ye-_e.top,Pt=_e.width,bt=_e.height;O.x=Ue/Pt*2-1,O.y=-(Xe/bt)*2+1,E.set(O.x,O.y,1).unproject(i.object).sub(i.object.position).normalize()}function he(L){return Math.max(i.minDistance,Math.min(i.maxDistance,L))}function Q(L){d.set(L.clientX,L.clientY)}function pe(L){fe(L.clientX,L.clientX),v.set(L.clientX,L.clientY)}function ve(L){b.set(L.clientX,L.clientY)}function K(L){f.set(L.clientX,L.clientY),p.subVectors(f,d).multiplyScalar(i.rotateSpeed);const ye=i.domElement;z(2*Math.PI*p.x/ye.clientHeight),B(2*Math.PI*p.y/ye.clientHeight),d.copy(f),i.update()}function se(L){S.set(L.clientX,L.clientY),A.subVectors(S,v),A.y>0?Te(Z(A.y)):A.y<0&&ge(Z(A.y)),v.copy(S),i.update()}function Ee(L){_.set(L.clientX,L.clientY),y.subVectors(_,b).multiplyScalar(i.panSpeed),J(y.x,y.y),b.copy(_),i.update()}function me(L){fe(L.clientX,L.clientY),L.deltaY<0?ge(Z(L.deltaY)):L.deltaY>0&&Te(Z(L.deltaY)),i.update()}function Oe(L){let ye=!1;switch(L.code){case i.keys.UP:L.ctrlKey||L.metaKey||L.shiftKey?B(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):J(0,i.keyPanSpeed),ye=!0;break;case i.keys.BOTTOM:L.ctrlKey||L.metaKey||L.shiftKey?B(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):J(0,-i.keyPanSpeed),ye=!0;break;case i.keys.LEFT:L.ctrlKey||L.metaKey||L.shiftKey?z(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):J(i.keyPanSpeed,0),ye=!0;break;case i.keys.RIGHT:L.ctrlKey||L.metaKey||L.shiftKey?z(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):J(-i.keyPanSpeed,0),ye=!0;break}ye&&(L.preventDefault(),i.update())}function Ze(L){if(k.length===1)d.set(L.pageX,L.pageY);else{const ye=Mt(L),_e=.5*(L.pageX+ye.x),Ue=.5*(L.pageY+ye.y);d.set(_e,Ue)}}function le(L){if(k.length===1)b.set(L.pageX,L.pageY);else{const ye=Mt(L),_e=.5*(L.pageX+ye.x),Ue=.5*(L.pageY+ye.y);b.set(_e,Ue)}}function ke(L){const ye=Mt(L),_e=L.pageX-ye.x,Ue=L.pageY-ye.y,Xe=Math.sqrt(_e*_e+Ue*Ue);v.set(0,Xe)}function Fe(L){i.enableZoom&&ke(L),i.enablePan&&le(L)}function ht(L){i.enableZoom&&ke(L),i.enableRotate&&Ze(L)}function at(L){if(k.length==1)f.set(L.pageX,L.pageY);else{const _e=Mt(L),Ue=.5*(L.pageX+_e.x),Xe=.5*(L.pageY+_e.y);f.set(Ue,Xe)}p.subVectors(f,d).multiplyScalar(i.rotateSpeed);const ye=i.domElement;z(2*Math.PI*p.x/ye.clientHeight),B(2*Math.PI*p.y/ye.clientHeight),d.copy(f)}function Ke(L){if(k.length===1)_.set(L.pageX,L.pageY);else{const ye=Mt(L),_e=.5*(L.pageX+ye.x),Ue=.5*(L.pageY+ye.y);_.set(_e,Ue)}y.subVectors(_,b).multiplyScalar(i.panSpeed),J(y.x,y.y),b.copy(_)}function tt(L){const ye=Mt(L),_e=L.pageX-ye.x,Ue=L.pageY-ye.y,Xe=Math.sqrt(_e*_e+Ue*Ue);S.set(0,Xe),A.set(0,Math.pow(S.y/v.y,i.zoomSpeed)),Te(A.y),v.copy(S);const Pt=(L.pageX+ye.x)*.5,bt=(L.pageY+ye.y)*.5;fe(Pt,bt)}function lt(L){i.enableZoom&&tt(L),i.enablePan&&Ke(L)}function qe(L){i.enableZoom&&tt(L),i.enableRotate&&at(L)}function X(L){i.enabled!==!1&&(k.length===0&&(i.domElement.setPointerCapture(L.pointerId),i.domElement.addEventListener("pointermove",F),i.domElement.addEventListener("pointerup",re)),!it(L)&&(dt(L),L.pointerType==="touch"?ze(L):Ie(L)))}function F(L){i.enabled!==!1&&(L.pointerType==="touch"?st(L):ce(L))}function re(L){switch(rt(L),k.length){case 0:i.domElement.releasePointerCapture(L.pointerId),i.domElement.removeEventListener("pointermove",F),i.domElement.removeEventListener("pointerup",re),i.dispatchEvent(of),s=n.NONE;break;case 1:const ye=k[0],_e=U[ye];ze({pointerId:ye,pageX:_e.x,pageY:_e.y});break}}function Ie(L){let ye;switch(L.button){case 0:ye=i.mouseButtons.LEFT;break;case 1:ye=i.mouseButtons.MIDDLE;break;case 2:ye=i.mouseButtons.RIGHT;break;default:ye=-1}switch(ye){case ir.DOLLY:if(i.enableZoom===!1)return;pe(L),s=n.DOLLY;break;case ir.ROTATE:if(L.ctrlKey||L.metaKey||L.shiftKey){if(i.enablePan===!1)return;ve(L),s=n.PAN}else{if(i.enableRotate===!1)return;Q(L),s=n.ROTATE}break;case ir.PAN:if(L.ctrlKey||L.metaKey||L.shiftKey){if(i.enableRotate===!1)return;Q(L),s=n.ROTATE}else{if(i.enablePan===!1)return;ve(L),s=n.PAN}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(Jc)}function ce(L){switch(s){case n.ROTATE:if(i.enableRotate===!1)return;K(L);break;case n.DOLLY:if(i.enableZoom===!1)return;se(L);break;case n.PAN:if(i.enablePan===!1)return;Ee(L);break}}function Se(L){i.enabled===!1||i.enableZoom===!1||s!==n.NONE||(L.preventDefault(),i.dispatchEvent(Jc),me(Ge(L)),i.dispatchEvent(of))}function Ge(L){const ye=L.deltaMode,_e={clientX:L.clientX,clientY:L.clientY,deltaY:L.deltaY};switch(ye){case 1:_e.deltaY*=16;break;case 2:_e.deltaY*=100;break}return L.ctrlKey&&!C&&(_e.deltaY*=10),_e}function $e(L){L.key==="Control"&&(C=!0,i.domElement.getRootNode().addEventListener("keyup",Qe,{passive:!0,capture:!0}))}function Qe(L){L.key==="Control"&&(C=!1,i.domElement.getRootNode().removeEventListener("keyup",Qe,{passive:!0,capture:!0}))}function je(L){i.enabled===!1||i.enablePan===!1||Oe(L)}function ze(L){switch(mt(L),k.length){case 1:switch(i.touches.ONE){case nr.ROTATE:if(i.enableRotate===!1)return;Ze(L),s=n.TOUCH_ROTATE;break;case nr.PAN:if(i.enablePan===!1)return;le(L),s=n.TOUCH_PAN;break;default:s=n.NONE}break;case 2:switch(i.touches.TWO){case nr.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Fe(L),s=n.TOUCH_DOLLY_PAN;break;case nr.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;ht(L),s=n.TOUCH_DOLLY_ROTATE;break;default:s=n.NONE}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(Jc)}function st(L){switch(mt(L),s){case n.TOUCH_ROTATE:if(i.enableRotate===!1)return;at(L),i.update();break;case n.TOUCH_PAN:if(i.enablePan===!1)return;Ke(L),i.update();break;case n.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;lt(L),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;qe(L),i.update();break;default:s=n.NONE}}function pt(L){i.enabled!==!1&&L.preventDefault()}function dt(L){k.push(L.pointerId)}function rt(L){delete U[L.pointerId];for(let ye=0;ye<k.length;ye++)if(k[ye]==L.pointerId){k.splice(ye,1);return}}function it(L){for(let ye=0;ye<k.length;ye++)if(k[ye]==L.pointerId)return!0;return!1}function mt(L){let ye=U[L.pointerId];ye===void 0&&(ye=new et,U[L.pointerId]=ye),ye.set(L.pageX,L.pageY)}function Mt(L){const ye=L.pointerId===k[0]?k[1]:k[0];return U[ye]}i.domElement.addEventListener("contextmenu",pt),i.domElement.addEventListener("pointerdown",X),i.domElement.addEventListener("pointercancel",re),i.domElement.addEventListener("wheel",Se,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",$e,{passive:!0,capture:!0}),this.update()}}const Ww={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Io{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const jw=new ec(-1,1,1,-1,0,1);class qw extends fi{constructor(){super(),this.setAttribute("position",new xi([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new xi([0,2,0,0,2,0],2))}}const Xw=new qw;class im{constructor(e){this._mesh=new It(Xw,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,jw)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class eu extends Io{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof as?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=Jl.clone(e.uniforms),this.material=new as({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new im(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class cf extends Io{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const n=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let a,r;this.inverse?(a=0,r=1):(a=1,r=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),s.buffers.stencil.setFunc(n.ALWAYS,a,4294967295),s.buffers.stencil.setClear(r),s.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(n.EQUAL,1,4294967295),s.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),s.buffers.stencil.setLocked(!0)}}class $w extends Io{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Yw{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new et);this._width=i.width,this._height=i.height,t=new Hs(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Bs}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new eu(Ww),this.copyPass.material.blending=Vs,this.clock=new Kh}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let n=0,s=this.passes.length;n<s;n++){const a=this.passes[n];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),a.needsSwap){if(i){const r=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(r.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(r.EQUAL,1,4294967295)}this.swapBuffers()}cf!==void 0&&(a instanceof cf?i=!0:a instanceof $w&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new et);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class Zw extends Io{constructor(e,t,i=null,n=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Dt}render(e,t,i){const n=e.autoClear;e.autoClear=!1;let s,a;this.overrideMaterial!==null&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=a),e.autoClear=n}}const Kw={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new et(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		precision highp float;

		uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)

		//----------------------------------------------------------------------------------
		// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag
		// SDK Version: v3.00
		// Email:       gameworks@nvidia.com
		// Site:        http://developer.nvidia.com/
		//
		// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
		//
		// Redistribution and use in source and binary forms, with or without
		// modification, are permitted provided that the following conditions
		// are met:
		//  * Redistributions of source code must retain the above copyright
		//    notice, this list of conditions and the following disclaimer.
		//  * Redistributions in binary form must reproduce the above copyright
		//    notice, this list of conditions and the following disclaimer in the
		//    documentation and/or other materials provided with the distribution.
		//  * Neither the name of NVIDIA CORPORATION nor the names of its
		//    contributors may be used to endorse or promote products derived
		//    from this software without specific prior written permission.
		//
		// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY
		// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
		// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
		// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
		// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
		// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
		// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
		// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
		// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
		// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
		// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
		//
		//----------------------------------------------------------------------------------

		#ifndef FXAA_DISCARD
			//
			// Only valid for PC OpenGL currently.
			// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
			//
			// 1 = Use discard on pixels which don't need AA.
			//     For APIs which enable concurrent TEX+ROP from same surface.
			// 0 = Return unchanged color on pixels which don't need AA.
			//
			#define FXAA_DISCARD 0
		#endif

		/*--------------------------------------------------------------------------*/
		#define FxaaTexTop(t, p) texture2D(t, p, -100.0)
		#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)
		/*--------------------------------------------------------------------------*/

		#define NUM_SAMPLES 5

		// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha
		float contrast( vec4 a, vec4 b ) {
			vec4 diff = abs( a - b );
			return max( max( max( diff.r, diff.g ), diff.b ), diff.a );
		}

		/*============================================================================

									FXAA3 QUALITY - PC

		============================================================================*/

		/*--------------------------------------------------------------------------*/
		vec4 FxaaPixelShader(
			vec2 posM,
			sampler2D tex,
			vec2 fxaaQualityRcpFrame,
			float fxaaQualityEdgeThreshold,
			float fxaaQualityinvEdgeThreshold
		) {
			vec4 rgbaM = FxaaTexTop(tex, posM);
			vec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);
			// . S .
			// W M E
			// . N .

			bool earlyExit = max( max( max(
					contrast( rgbaM, rgbaN ),
					contrast( rgbaM, rgbaS ) ),
					contrast( rgbaM, rgbaE ) ),
					contrast( rgbaM, rgbaW ) )
					< fxaaQualityEdgeThreshold;
			// . 0 .
			// 0 0 0
			// . 0 .

			#if (FXAA_DISCARD == 1)
				if(earlyExit) FxaaDiscard;
			#else
				if(earlyExit) return rgbaM;
			#endif

			float contrastN = contrast( rgbaM, rgbaN );
			float contrastS = contrast( rgbaM, rgbaS );
			float contrastE = contrast( rgbaM, rgbaE );
			float contrastW = contrast( rgbaM, rgbaW );

			float relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );
			relativeVContrast *= fxaaQualityinvEdgeThreshold;

			bool horzSpan = relativeVContrast > 0.;
			// . 1 .
			// 0 0 0
			// . 1 .

			// 45 deg edge detection and corners of objects, aka V/H contrast is too similar
			if( abs( relativeVContrast ) < .3 ) {
				// locate the edge
				vec2 dirToEdge;
				dirToEdge.x = contrastE > contrastW ? 1. : -1.;
				dirToEdge.y = contrastS > contrastN ? 1. : -1.;
				// . 2 .      . 1 .
				// 1 0 2  ~=  0 0 1
				// . 1 .      . 0 .

				// tap 2 pixels and see which ones are "outside" the edge, to
				// determine if the edge is vertical or horizontal

				vec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongH = contrast( rgbaM, rgbaAlongH );
				// . 1 .
				// 0 0 1
				// . 0 H

				vec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongV = contrast( rgbaM, rgbaAlongV );
				// V 1 .
				// 0 0 1
				// . 0 .

				relativeVContrast = matchAlongV - matchAlongH;
				relativeVContrast *= fxaaQualityinvEdgeThreshold;

				if( abs( relativeVContrast ) < .3 ) { // 45 deg edge
					// 1 1 .
					// 0 0 1
					// . 0 1

					// do a simple blur
					return mix(
						rgbaM,
						(rgbaN + rgbaS + rgbaE + rgbaW) * .25,
						.4
					);
				}

				horzSpan = relativeVContrast > 0.;
			}

			if(!horzSpan) rgbaN = rgbaW;
			if(!horzSpan) rgbaS = rgbaE;
			// . 0 .      1
			// 1 0 1  ->  0
			// . 0 .      1

			bool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );
			if(!pairN) rgbaN = rgbaS;

			vec2 offNP;
			offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
			offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;

			bool doneN = false;
			bool doneP = false;

			float nDist = 0.;
			float pDist = 0.;

			vec2 posN = posM;
			vec2 posP = posM;

			int iterationsUsed = 0;
			int iterationsUsedN = 0;
			int iterationsUsedP = 0;
			for( int i = 0; i < NUM_SAMPLES; i++ ) {
				iterationsUsed = i;

				float increment = float(i + 1);

				if(!doneN) {
					nDist += increment;
					posN = posM + offNP * nDist;
					vec4 rgbaEndN = FxaaTexTop(tex, posN.xy);
					doneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );
					iterationsUsedN = i;
				}

				if(!doneP) {
					pDist += increment;
					posP = posM - offNP * pDist;
					vec4 rgbaEndP = FxaaTexTop(tex, posP.xy);
					doneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );
					iterationsUsedP = i;
				}

				if(doneN || doneP) break;
			}


			if ( !doneP && !doneN ) return rgbaM; // failed to find end of edge

			float dist = min(
				doneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,
				doneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.
			);

			// hacky way of reduces blurriness of mostly diagonal edges
			// but reduces AA quality
			dist = pow(dist, .5);

			dist = 1. - dist;

			return mix(
				rgbaM,
				rgbaN,
				dist * .5
			);
		}

		void main() {
			const float edgeDetectionQuality = .2;
			const float invEdgeDetectionQuality = 1. / edgeDetectionQuality;

			gl_FragColor = FxaaPixelShader(
				vUv,
				tDiffuse,
				resolution,
				edgeDetectionQuality, // [0,1] contrast needed, otherwise early discard
				invEdgeDetectionQuality
			);

		}
	`},Qw={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = OptimizedCineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class Jw extends Io{constructor(){super();const e=Qw;this.uniforms=Jl.clone(e.uniforms),this.material=new cw({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new im(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,i){this.uniforms.tDiffuse.value=i.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,(this._outputColorSpace!==e.outputColorSpace||this._toneMapping!==e.toneMapping)&&(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},si.getTransfer(this._outputColorSpace)===yi&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===np?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===sp?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===ap?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===Rl?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===rp?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===op&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class e_ extends eu{constructor(){const e={uniforms:{tDiffuse:{value:null},brightness:{value:1},saturation:{value:1}},vertexShader:`
		varying vec2 vUv;
		void main() {
		  vUv = uv;
		  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		}
	  `,fragmentShader:`
		uniform sampler2D tDiffuse;
		uniform float brightness;
		uniform float saturation;
		varying vec2 vUv;

		vec3 rgb2hsv(vec3 c) {
		  vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
		  vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
		  vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
		  float d = q.x - min(q.w, q.y);
		  float e = 1.0e-10;
		  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
		}

		vec3 hsv2rgb(vec3 c) {
		  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
		  vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
		  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
		}

		void main() {
		  vec4 texel = texture2D(tDiffuse, vUv);
		  vec3 hsv = rgb2hsv(texel.rgb);
		  
		  // Adjust saturation
		  hsv.y *= saturation;
		  
		  // Convert back to RGB
		  vec3 rgb = hsv2rgb(hsv);
		  
		  // Adjust brightness
		  rgb *= brightness;
		  
		  gl_FragColor = vec4(rgb, texel.a);
		}
	  `};super(e)}setBrightness(e){this.uniforms.brightness.value=e}setSaturation(e){this.uniforms.saturation.value=e}}const Us=class Us{static toSeconds(e){const[t,i,n]=e.split(":");if(!t||!i||!n)return 0;const[s,a]=n.split(",");return parseInt(t)*3600+parseInt(i)*60+parseInt(s)+parseInt(a)/1e3}static toFrames(e,t){return Math.floor(e*t)}static parseSRT(e,t){const i=[];let n;for(;(n=Us.srtRegex.exec(e))!==null;){const[s,a,r,l,c]=n,h=Us.toSeconds(r),d=Us.toSeconds(l);i.push({id:a,text:c.replace(`
`," ").trim(),start:Us.toFrames(h,t),end:Us.toFrames(d,t)})}return i}static async fetchAndParseSRT(e,t){const n=await(await fetch(e)).text();return Us.parseSRT(n,t)}};g(Us,"srtRegex",/(\d+)\s+(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})\s+([\s\S]*?)(?=\n\s*\n|\s*$)/g);let jl=Us;const t_="data:image/svg+xml,%3csvg%20width='70'%20height='44'%20viewBox='0%200%2070%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='5'%20y='1'%20width='26'%20height='42'%20rx='13'%20stroke='white'%20stroke-width='2'/%3e%3ccircle%20cx='18'%20cy='14'%20r='2'%20fill='white'/%3e%3cpath%20d='M44%2022H66M66%2022L55%2011M66%2022L55%2033'%20stroke='white'%20stroke-width='2'/%3e%3c/svg%3e",i_="data:image/svg+xml,%3csvg%20width='70'%20height='44'%20viewBox='0%200%2070%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='5'%20y='1'%20width='26'%20height='42'%20rx='13'%20stroke='white'%20stroke-width='2'/%3e%3cpath%20d='M18%209V19'%20stroke='white'%20stroke-width='2'%20stroke-linecap='round'/%3e%3cpath%20d='M55%2033V11M55%2011L66%2022M55%2011L44%2022'%20stroke='white'%20stroke-width='2'/%3e%3c/svg%3e",n_="data:image/svg+xml,%3csvg%20width='44'%20height='44'%20viewBox='0%200%2044%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M20.6772%2022.241L20.6857%207.99889C20.6857%206.74231%2019.533%205.58875%2018.1104%205.58875H17.9673C16.5422%205.58875%2015.3903%206.74231%2015.3903%208.16575V27.2579C14.6386%2026.3419%2010.4619%2021.3138%208.58473%2022.7305C6.70922%2024.1488%207.91813%2025.8583%207.91813%2025.8583C9.63783%2028.9427%2013.5685%2035.3907%2014.6292%2037.205C16.6614%2040.6784%2020.3443%2043%2024.549%2043C30.9511%2043%2036.14%2037.623%2036.14%2030.9885V30.5526V20.3425C36.14%2019.0348%2035.0793%2017.8072%2033.7725%2017.8072H33.6414C32.3328%2017.8072%2031.2738%2019.034%2031.2738%2020.3425'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M20.6772%2017.3798C20.6772%2015.9564%2021.8308%2014.8036%2023.2542%2014.8036H23.3972C24.8207%2014.8036%2025.9725%2015.9564%2025.9725%2017.3798V22.241'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M25.975%2019.0042C25.975%2017.5807%2027.1286%2016.2595%2028.552%2016.2595H28.6951C30.1185%2016.2595%2031.2721%2017.5807%2031.2721%2019.0042V22.241'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M12.1493%2010.6363C11.6905%209.7339%2011.4325%208.71399%2011.4325%207.63449C11.4325%203.97033%2014.402%201%2018.067%201C21.7303%201%2024.6998%203.97033%2024.6998%207.63449C24.6998%208.84935%2024.3737%209.9876%2023.8033%2010.9666'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M33.0233%209.17629L36.4652%205.73432L33.0233%202.2915'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M24.4222%205.73425H36.4653'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",s_="data:image/svg+xml,%3csvg%20width='44'%20height='44'%20viewBox='0%200%2044%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M24.2774%2022.2414L24.2868%207.99906C24.2868%206.7416%2023.1332%205.58887%2021.7097%205.58887H21.5658C20.1423%205.58887%2018.9896%206.7416%2018.9896%208.16507V27.2585C18.2387%2026.3415%2014.0602%2021.3134%2012.1839%2022.7309C10.3075%2024.1484%2011.5172%2025.858%2011.5172%2025.858C13.2361%2028.9441%2017.1677%2035.3923%2018.2293%2037.2066C20.2615%2040.6793%2023.9437%2043%2028.1485%2043C34.5499%2043%2039.7389%2037.6229%2039.7389%2030.9883V20.342C39.7389%2019.0335%2038.6789%2017.8067%2037.3721%2017.8067H37.2393C35.9325%2017.8067%2034.8725%2019.0326%2034.8725%2020.342M24.2774%2017.3801C24.2774%2015.9566%2025.4302%2014.8039%2026.8537%2014.8039H26.9967C28.4202%2014.8039%2029.5737%2015.9566%2029.5737%2017.3801V22.2414M29.5745%2019.0036C29.5745%2017.5802%2030.7281%2016.2597%2032.1515%2016.2597H32.2954C33.718%2016.2597%2034.8716%2017.5802%2034.8716%2019.0036V22.2414'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M15.7485%2010.6365C15.2904%209.73322%2015.0316%208.71415%2015.0316%207.63377C15.0316%203.97039%2018.002%201%2021.6654%201C25.3296%201%2028.3%203.97039%2028.3%207.63377C28.3%208.84951%2027.9731%209.98693%2027.4027%2010.966'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M11.1196%2030.0747C10.1082%2030.1088%209.07469%2029.9121%208.09478%2029.4558C4.77448%2027.9089%203.33569%2023.9611%204.88346%2020.6408C6.43037%2017.3205%2010.3781%2015.8809%2013.6984%2017.4287C14.8009%2017.9429%2015.694%2018.7193%2016.341%2019.649'%20stroke='white'%20stroke-width='1.5'%20stroke-miterlimit='10'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",a_="AMOD__",ql="1.1.8",r_="https://d2xkbpwjh6kvh9.cloudfront.net",ti="https://d38p9xpr4rdpkc.cloudfront.net",Xl="https://86l3n9wbnc.execute-api.ap-southeast-2.amazonaws.com/Prod",ms=[Math.sin(Math.PI/4),0,0,Math.cos(Math.PI/4)],gs=[1,0,0,0],o_=60,nm=24,l_=999,c_=new D(-393.87,58.32,10.47),h_=new D(-83.3,5.91,2.21),eh=new D(0,57.2958,360),hf=new D(0,0,0),uf=[ms[3]*gs[0]+ms[0]*gs[3],ms[3]*gs[1]+ms[1]*gs[3],ms[3]*gs[2]+ms[2]*gs[3],ms[3]*gs[3]-ms[0]*gs[0]-ms[1]*gs[1]-ms[2]*gs[2]],zS={error:"#bf203e",warning:"#ff9900",info:"#0099ff",ready:"#0099ff",debug:"#ad48c1",success:"#58ce4e",performance:"#69c1c6","act-change":"#ee65df"},u_=`${ti}/slv-a-mouthful-of-dust/media/other/174399563e994/rbrr.splat`,VS=`${ti}/slv-a-mouthful-of-dust/media/other/1744086684cfd/rbrr-1.splat`,d_="/slv-a-mouthful-of-dust/media/images/174399424c4c8/rbrr-pano-lg.jpg",f_={antialias:!1,alpha:!0,precision:"highp",powerPreference:"high-performance"},p_={antialias:!1,alpha:!0,precision:"lowp",powerPreference:"default",failIfMajorPerformanceCaveat:!0},m_={uiClick:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/17439929422d1/ui-click.mp3`,group:"ui"},uiClack:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174399300cfd1/ui-clack.mp3`,group:"ui"},uiRelease01:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174486249d2c1/ui-object-release-01.mp3`,group:"ui"},uiRelease02:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174486249ece9/ui-object-release-02.mp3`,group:"ui"},uiRelease03:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1744862498e65/ui-object-release-03.mp3`,group:"ui"},uiRelease04:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1744862496b40/ui-object-release-04.mp3`,group:"ui"},uiRelease05:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174486249d716/ui-object-release-06.mp3`,group:"ui"}},g_={act3Mask:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1744244623b02/act3-mask.mp3`,group:"voice"},act3MaskAd:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174399176da2b/act3-ad-mask.mp3`,group:"voice"},act3MaskTransition:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/17448631031e3/act3-transition-mask.mp3`,group:"ui"}},y_={act3Boot:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1744244627c09/act3-boot.mp3`,group:"voice"},act3BootAd:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1743992218866/act3-ad-boot.mp3`,group:"voice"},act3BootTransition:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174486310025e/act3-transition-boot.mp3`,group:"ui"}},v_={act3Rifle:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1744244629372/act3-rifle.mp3`,group:"voice"},act3RifleAd:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1743991912fbf/act3-ad-rifle.mp3`,group:"voice"},act3RifleTransition:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174486310d1e2/act3-transition-rifle.mp3`,group:"ui"}},b_={act3Armour:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1744244620eee/act3-armour.mp3`,group:"voice"},act3ArmourAd:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174399256df53/act3-ad-armour.mp3`,group:"voice"},act3ArmourTransition:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1744863107b83/act3-transition-armour.mp3`,group:"ui"}},w_={act3Letter:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/174424462feb9/act3-letter.mp3`,group:"voice"},act3LetterTransition:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1744863101d98/act3-transition-letter.mp3`,group:"ui"},act3LetterAd:{url:`${ti}/slv-a-mouthful-of-dust/media/audio/1743992278566/act3-ad-letter.mp3`,group:"voice"}},HS={IntroSequenceFadeIn:2e3},__=[{title:"Camera Controls",controls:[{label:"Click & drag to move",icon:t_,devices:["desktop"]},{label:"Scroll to zoom",icon:i_,devices:["desktop"]},{label:"Arrow keys to move",value:`<span class='key arrow-up'><svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 8L7 2L13 8" stroke="white" stroke-width="2"/>
        </svg>
</span><span class='key arrow-left'><svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 8L7 2L13 8" stroke="white" stroke-width="2"/>
        </svg>
</span><span class='key arrow-down'><svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 8L7 2L13 8" stroke="white" stroke-width="2"/>
        </svg>
</span><span class='key arrow-right'><svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M1 8L7 2L13 8" stroke="white" stroke-width="2"/>
        </svg>
</span>`,devices:["desktop"]},{label:"Shift + Up/Down arrow keys to zoom",value:`<span class='key modifier'>shift
      </span><span class='mod plus'>+</span><span class='key arrow-up'><svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 8L7 2L13 8" stroke="white" stroke-width="2"/>
              </svg>
      </span><span class='key arrow-down'><svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 8L7 2L13 8" stroke="white" stroke-width="2"/>
              </svg>
      </span>`,devices:["desktop"]},{label:"Shift + Left/Right arrow keys to jump to next item",value:`<span class='key modifier'>shift
      </span><span class='mod plus'>+</span><span class='key arrow-left'><svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 8L7 2L13 8" stroke="white" stroke-width="2"/>
              </svg>
      </span><span class='key arrow-right'><svg width="14" height="9" viewBox="0 0 14 9" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 8L7 2L13 8" stroke="white" stroke-width="2"/>
              </svg>
      </span>`,devices:["desktop"]},{label:"WASD keys to move",value:`<span class='key '>W
      </span><span class='key '>A
      </span><span class='key '>S
      </span><span class='key '>D
      </span>`,devices:["desktop"]},{label:"Tap & drag to move",icon:n_,devices:["mobile","tablet"]},{label:"Pinch to zoom",icon:s_,devices:["mobile","tablet"]}]},{title:"Keyboard Shortcuts",controls:[{label:"Mute/Unmute",screenReader:"Mute/Unmute: {{MODIFIER}} + SHIFT + M",value:"<span class='key'>{{MODIFIER}}</span><span class='mod plus'>+</span><span class='key'>{{SHIFT}}</span><span class='mod plus'>+</span><span class='key'>M</span>",devices:["desktop"]}]}],M_="/mouthful-of-dust//lottie/mod_title.json",GS="/mouthful-of-dust//lottie/zoom_mouse_inv.json",x_="/mouthful-of-dust//lottie/zoom_mouse.json",S_="/mouthful-of-dust//lottie/rotate_mouse.json",A_="/mouthful-of-dust//lottie/zoom_touch.json",T_="/mouthful-of-dust//lottie/rotate_touch.json",E_=["scene-loader","aoc-wrapper","loading-card","content-warning","act-one","act-two","act-three","modal-container"],df=5,ff=10,C_=50;class P_{constructor(){g(this,"intervalId",null);g(this,"timeoutId",null);g(this,"isActive",!1)}start(e,t=0,i=100){this.isActive||(this.isActive=!0,this.timeoutId=window.setTimeout(()=>{this.isActive&&(this.intervalId=window.setInterval(e,i))},t))}stop(){this.isActive=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}}const Ye=(o,e,t)=>{},xh=o=>String(o).charAt(0).toUpperCase()+String(o).slice(1),di=o=>o*(Math.PI/180),th=o=>o*(180/Math.PI),k_=()=>{const o={},e=window.location.search.slice(1);return e&&e.split("&").forEach(i=>{const[n,s]=i.split("=");n&&(o[decodeURIComponent(n)]=decodeURIComponent(s))}),o},I_=o=>o==="performance"?o_:o==="impossible"?l_:nm,kt={linear:o=>o,easeInQuad:o=>o*o,easeOutQuad:o=>o*(2-o),easeInOutQuad:o=>o<.5?2*o*o:-1+(4-2*o)*o,easeInCubic:o=>o*o*o,easeOutCubic:o=>--o*o*o+1,easeInOutCubic:o=>o<.5?4*o*o*o:(o-1)*(2*o-2)*(2*o-2)+1,easeInSine:o=>1-Math.cos(o*Math.PI/2),easeOutSine:o=>Math.sin(o*Math.PI/2),easeInOutSine:o=>-(Math.cos(Math.PI*o)-1)/2,smoothstep:o=>(o=Math.max(0,Math.min(1,o)),o*o*(3-2*o)),smootherstep:o=>(o=Math.max(0,Math.min(1,o)),o*o*o*(o*(o*6-15)+10))};function tu(o,e,t){return Math.min(Math.max(o,e),t)}function xn(o,e,t,i,n,s=!0,a=kt.linear){let r=(o-e)/(t-e);r=a(r);let l=r*(n-i)+i;return s&&(l=Math.min(Math.max(l,i),n)),l}function An(o,e,t,i,n,s=!0,a=kt.linear){s&&(o=Math.max(e,Math.min(t,o)));let r=(o-e)/(t-e);return r=a(r),i+r*(n-i)}const sm=(o,e=-Math.PI)=>(o-e+3*Math.PI)%(2*Math.PI)/(2*Math.PI),L_=o=>{let e=o;return o<.10671972724703498?e=An(o,0,.10671972724703498,0,.092634514783402):o<.30671972724703483?e=An(o,.10671972724703498,.30671972724703483,.092634514783402,.29745930120951103):o<.5067197272470351?e=An(o,.30671972724703483,.5067197272470351,.29745930120951103,.5012288817103648):o<.7381362063415354?e=An(o,.5067197272470351,.7381362063415354,.5012288817103648,.7078171896825285):o<.9067197272470349?e=An(o,.7381362063415354,.9067197272470349,.7078171896825285,.8985324353282064):e=An(o,.9067197272470349,1,.8985324353282064,1),e},ih=o=>o.replace(/<[^>]+>/g,""),R_=o=>document.activeElement===o,$t=(o,e,t=!0)=>{(Array.isArray(o)?o:[o]).forEach(n=>{const s=n instanceof HTMLElement?n:document.getElementById(n);if(s){if(s.classList.contains("accBound"))return;s.classList.add("accBound");let a;typeof e=="function"?a={start:()=>{},hold:()=>{},end:e}:a={start:e.start||(()=>{}),hold:e.hold||(()=>{}),end:e.end||(()=>{})};const r=new P_;let l=!1,c=!1;const h=()=>{c||(c=!0,a.start(s),a.hold!==(()=>{})&&r.start(()=>a.hold(s)))},d=()=>{c&&(c=!1,r.stop(),a.end(s))};s.getAttribute("tabindex")||s.setAttribute("tabindex","0"),!s.getAttribute("role")&&t&&s.setAttribute("role","button");let f=!1;s.addEventListener("pointerdown",p=>{p.button===0&&!l&&(f=!0,h())}),s.addEventListener("pointerup",p=>{p.button===0&&!l&&f&&(d(),setTimeout(()=>{f=!1},10))}),s.addEventListener("pointerleave",()=>{!l&&f&&(d(),f=!1)}),s.addEventListener("click",p=>{l||f||(a.start(s),a.end(s))}),s.addEventListener("touchstart",()=>{l=!0,h()},{passive:!0}),s.addEventListener("touchend",p=>{p.preventDefault(),l=!1,d()}),s.addEventListener("touchcancel",()=>{l=!1,d()}),s.tagName.toLowerCase()!=="button"&&s.addEventListener("keydown",p=>{(p.code==="Enter"||p.code==="Space")&&(c||(a.start(s),a.end(s)))})}else console.warn(`Element with id "${n}" not found.`)})},pf=o=>{const e=window.devicePixelRatio||1;return Math.round(o*e)},D_=(o,e,t,i)=>{const n=window.devicePixelRatio||1;let s=Math.round(o*n),a=Math.round(e*n);if(s>t){const r=t/s;s=t,a=Math.round(a*r)}return{width:s,height:a}},oa=(o,e,t={})=>o.map(i=>{const n=t[i]||{},s=e.map(a=>{var l;const r=(l=n.lods)==null?void 0:l.find(c=>c.name===a.name);return{...a,...r}});return{asset:i,lods:s}}),F_=o=>({far:{meshQuality:"Tiny",materialQuality:"low"},medium:{meshQuality:"Low",materialQuality:"med"},close:{meshQuality:"Med",materialQuality:"high"}})[o]||{meshQuality:"Low",materialQuality:"low"},Un=(o,e=0,t=0)=>{const i=`/${e}x${t}/`;return`${r_}${i}${o}`},O_=(o,e=[])=>{const t=new Map(e.map(i=>[i.toLowerCase(),i]));return o.toLowerCase().split(/([- ])/).map(i=>i==="-"||i===" "?i:t.has(i)?t.get(i):i.includes("'")?i.split("'").map((n,s)=>s===0?n.charAt(0).toUpperCase()+n.slice(1):n).join("'"):i.charAt(0).toUpperCase()+i.slice(1)).join("")},bi=o=>new Promise(e=>setTimeout(e,o)),wo=o=>{const e=Math.floor(o/60),t=Math.floor(o%60);return`${e}:${t.toString().padStart(2,"0")}`},$l=o=>{const e=Math.floor(o/60),t=Math.floor(o%60);return`${e?e===1?"1 minute":e+" minutes":""} ${t?t===1?"1 second":t.toString()+" seconds":""}`},U_=o=>o.replaceAll(`
`," "),N_=o=>{if(o===1/0||isNaN(o))return"-";const e=o/1e3;if(e<5)return"about 5 seconds";if(e<10)return"about 10 seconds";if(e<30)return"about 30 seconds";if(e<60)return"less than a minute";const t=Math.ceil(e/60);if(t===1)return"about a minute";if(t<=5)return`about ${t} minutes`;const i=Math.ceil(t/5)*5;if(i<=60)return`about ${i} minutes`;const n=Math.ceil(t/60);return`about ${n} ${n===1?"hour":"hours"}`};function B_(){const o=navigator.userAgent.toLowerCase();return o.includes("firefox")?"Firefox":o.includes("edg")?"Edge":o.includes("opr")||o.includes("opera")?"Opera":o.includes("chrome")?"Chrome":o.includes("safari")?"Safari":"Unknown"}function z_(){const o=navigator.platform.toLowerCase(),e=navigator.userAgent.toLowerCase();return e.includes("windows")?"Windows":e.includes("ios")||/ipad|iphone|ipod/.test(o)?"iOS":e.includes("mac os x")?"macOS":e.includes("linux")?"Linux":e.includes("android")?"Android":"Unknown"}function V_(){try{const o=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(o.getContext("webgl")||o.getContext("experimental-webgl")))}catch{return!1}}function iu(){const o=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i,e=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i,t=navigator.userAgent.toLowerCase(),i=o.test(t),n=e.test(t);return{isMobile:i&&!n,isTablet:n,isDesktop:!i&&!n,browser:B_(),os:z_(),isTouchDevice:"ontouchstart"in window||navigator.maxTouchPoints>0,hasReducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)").matches,prefersDarkMode:window.matchMedia("(prefers-color-scheme: dark)").matches,supportsWebGL:V_()}}const am=o=>{setTimeout(()=>{queueMicrotask(o)},1)},rm=(o,e,t=100,i=0)=>{if(!(i>99)){if(o()){e();return}am(()=>{rm(o,e,t,i+1)})}},Li=o=>`/mouthful-of-dust/${o.startsWith("/")?o.substring(1):o}`,mf=(o,e)=>{const t=new D(0,0,-1);return t.applyQuaternion(e),t.normalize(),new D().copy(o).add(t.multiplyScalar(100))},Sh=(o,e,t)=>o+(e-o)*t,H_=(o,e,t)=>{const i=new D;return i.lerpVectors(o,e,t),i},G_=(o,e,t,i=!1)=>i?(t-o)/(e-o):tu((t-o)/(e-o),0,1),W_=o=>{if((o==null?void 0:o.value)!==void 0&&!(!(o!=null&&o.target)||!(o!=null&&o.updateFunc)))return o!=null&&o.duration||(o.duration=2e3),o!=null&&o.easing||(o.easing=kt.smoothstep),new Promise(e=>{const t=performance.now(),i=n=>{const s=n-t,a=Math.min(s/o.duration,1),r=o.easing(a),l=o.value+(o.target-o.value)*r;o.updateFunc(l),a<1?requestAnimationFrame(i):e()};requestAnimationFrame(i)})};class j_{constructor(e,t,i){g(this,"assetsLoaded",{sequence:!1,images:!1,audio:!1});g(this,"isFullyLoaded",!1);g(this,"sequence",[]);g(this,"subtitles",[]);g(this,"images",{});g(this,"options");g(this,"imageRoot","intro-sequence/images/");g(this,"assetsLoaded",!1);g(this,"imageElementId");g(this,"subtitleElementId");g(this,"showFocusPoints",!1);g(this,"fps");g(this,"animationFrameId",null);g(this,"currentSubtitleText","");g(this,"reducedMotion");g(this,"autoLoadAssets");g(this,"sequenceLoaded",!1);g(this,"audioTracks",new Map);g(this,"currentTrackType","default");g(this,"audioContext",null);g(this,"gainNode",null);g(this,"startTime",0);g(this,"pausedAt",0);g(this,"keyboardControlsInitialised",!1);g(this,"fadeInFirstSlide");g(this,"fadeInDuration");g(this,"firstSlideDisplayed",!1);g(this,"lastActiveContainer","even");g(this,"lastItem",null);g(this,"onPlaybackToggle",null);g(this,"currentPosition",{x:0,y:0});g(this,"currentZoom",1);g(this,"isDragging",!1);g(this,"updateTimeDisplay",e=>{const t=document.getElementById("intro-sequence-time-current");t&&(t.textContent=wo(e));const i=document.getElementById("intro-sequence-time");i&&i.setAttribute("aria-label",`${$l(e)} of ${$l(this.getTotalTime())}`)});g(this,"togglePlayback",()=>{const e=document.getElementById("act-one__ui-toggle-playback"),t=this.audioTracks.get(this.currentTrackType);let i=!1;this.audioContext&&(t!=null&&t.source?(this.stopPlayback(),e&&e.setAttribute("aria-label","Play sequence"),i=!1):(this.startPlayback(),e&&e.setAttribute("aria-label","Pause sequence"),i=!0),e&&e.classList.toggle("paused"),this.onPlaybackToggle&&this.onPlaybackToggle(i))});var n;this.options=e,this.imageElementId=e.imageElement||"",this.subtitleElementId=e.subtitleElement||"",this.fps=e.fps||25,this.fadeInFirstSlide=e.fadeInFirstSlide||!1,this.fadeInDuration=e.fadeInDuration||2e3,this.autoLoadAssets=e.autoLoadAssets??!0,this.onPlaybackToggle=(e==null?void 0:e.onPlaybackToggle)||null,t&&i&&(this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(i),(n=e.audioTracks)==null||n.forEach(s=>{this.audioTracks.set(s.type,{url:s.url,type:s.type})})),this.initialise(),this.setupProgressBarInteraction()}async initialise(){await this.loadSequence(),this.autoLoadAssets&&await this.loadAssets()}async loadSequence(){if(this.sequenceLoaded)return;const t=await(await fetch(Li("intro-sequence/sequence.json"))).json();this.sequence=t.sequence,this.subtitles=await jl.fetchAndParseSRT(Li("intro-sequence/sequence.srt"),this.fps),this.sequenceLoaded=!0,this.checkAssetsReady()}async loadAssets(){this.sequenceLoaded||await this.loadSequence(),await Promise.all([this.loadAudioAssets(),this.loadImageAssets()]),this.checkAssetsReady()}async loadAudioAssets(){if(!this.audioContext)return;const e=Array.from(this.audioTracks.values()).map(async t=>{const n=await(await fetch(t.url)).arrayBuffer(),s=await this.audioContext.decodeAudioData(n),a=this.audioTracks.get(t.type);a&&(a.buffer=s,this.audioTracks.set(t.type,a))});await Promise.all(e),this.checkAssetsReady()}setAudioBuffers(e){Object.entries(e).forEach(([t,i])=>{const n=this.audioTracks.get(t);n&&(n.buffer=i,this.audioTracks.set(t,n))}),this.checkAssetsReady()}async getAudioRequirements(){return this.sequenceLoaded||await this.initialise(),Array.from(this.audioTracks.values()).map(e=>({type:e.type,url:e.url}))}async loadImageAssets(){if(Object.keys(this.images).length>0)return;const t=(await this.getImageRequirements()).map(i=>new Promise((n,s)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{const r=document.createElement("canvas");r.width=a.naturalWidth,r.height=a.naturalHeight;const l=r.getContext("2d");if(l){l.drawImage(a,0,0);const c=new Image;c.crossOrigin="anonymous",c.src=r.toDataURL("image/jpeg",.92),c.onload=()=>{this.images[i.key]=c,n()},c.onerror=s}else s(new Error("Failed to get canvas context"))},a.onerror=s,a.src=i.src}));try{await Promise.all(t),this.checkAssetsReady()}catch{}}updateReducedMotion(e){this.reducedMotion=e}async getImageRequirements(){this.sequenceLoaded||await this.initialise();const e=window.innerWidth,t=window.innerHeight,{width:i,height:n}=D_(e,t,2400);return this.sequence.map(s=>({key:s.file,src:s.url?Un(s.url,i,0):this.imageRoot+s.file,width:i,height:n}))}setPreloadedImages(e){this.images={...e},this.checkAssetsReady()}updateSequence(e){const t=this.getTotalTime(),i=e/t*100,n=Math.floor(e*this.fps);this.updateProgressBar(i),this.updateCurrentSlide(n),this.updateSubtitle(n),this.updateTimeDisplay(e),this.onProgressCallback&&this.onProgressCallback({currentTime:e,totalTime:t,progress:i})}updateProgressBar(e){const t=document.getElementById("intro-sequence-progress");t&&(t.style.width=`${e}%`)}updateCurrentSlide(e){var n;const t=document.getElementById(this.imageElementId);if(!(t instanceof HTMLElement))return;const i=this.sequence.find(s=>e>=s.start&&e<s.end);i?(t.setAttribute("aria-label",`Current slide alt description: ${(n=i==null?void 0:i.info)==null?void 0:n.alt}`),i!==this.lastItem&&(this.updateSlideContent(i,t),this.lastItem=i),this.updateSlidePosition(i,e,t)):this.lastItem&&(this.resetSlide(t),this.lastItem=null)}updateSlideContent(e,t){var h;const i=this.images[e.file];Ye(["Updating slide content:",{file:e.file,hasPreloadedImage:!!i,imageType:((h=i==null?void 0:i.src)==null?void 0:h.substring(0,30))+"..."}]);const n=e.focusPoint||this.extractFocusPointFromFileName(e.file),[s,a]=this.getImageContainers(t);this.lastActiveContainer=this.lastActiveContainer==="odd"?"even":"odd";const r=this.lastActiveContainer==="odd"?s:a,l=this.lastActiveContainer==="odd"?a:s;i&&(r.style.backgroundImage=`url("${i.src}")`),r.style.zIndex="1",r.style.opacity="1",r.style.backgroundSize="cover",l.style.zIndex="0",l.style.backgroundSize="cover",this.currentZoom=1,this.fadeInFirstSlide&&!this.firstSlideDisplayed&&(this.applyFadeInEffect(r),this.firstSlideDisplayed=!0),this.updateFocusPointVisualization(t,n);const c=this.findNextSlide(this.getCurrentFrame());c&&this.preloadNextSlide(c,l)}updateSlidePosition(e,t,i){const n=(t-e.start)/(e.end-e.start);this.updatePositionAndZoom(e,n);const s=e.focusPoint||this.extractFocusPointFromFileName(e.file),a=s?`${(s.x+this.currentPosition.x)*100}% ${(s.y+this.currentPosition.y)*100}%`:"center",[r,l]=this.getImageContainers(i),c=this.lastActiveContainer==="odd"?r:l;c.style.backgroundPosition=a,c.style.backgroundSize=`${this.currentZoom*100}%`}getImageContainers(e){let t=!1,i=e.querySelector(".intro-sequence-image.odd"),n=e.querySelector(".intro-sequence-image.even");return i||(i=document.createElement("div"),i.className="intro-sequence-image odd",i.setAttribute("role","figure"),i.setAttribute("tabindex","-1"),e.appendChild(i),t=!0),n||(n=document.createElement("div"),n.className="intro-sequence-image even",n.setAttribute("role","figure"),n.setAttribute("tabindex","-1"),e.appendChild(n),t=!0),t&&[i,n].forEach(s=>{s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.backgroundRepeat="no-repeat",s.style.backgroundPosition="center",s.style.backgroundSize="cover",s.style.opacity="0"}),[i,n]}resetSlide(e){const[t,i]=this.getImageContainers(e);t.style.backgroundImage="",t.style.opacity="0",t.style.zIndex="0",t.setAttribute("aria-hidden","true"),t.setAttribute("tabindex","-1"),t.removeAttribute("aria-label"),i.style.backgroundImage="",i.style.opacity="0",i.style.zIndex="0",i.setAttribute("aria-hidden","true"),i.setAttribute("tabindex","-1"),i.removeAttribute("aria-label"),this.firstSlideDisplayed=!1,this.currentPosition={x:0,y:0},this.currentZoom=1}async switchAudioTrack(e){if(!this.audioTracks.has(e)){console.warn(`Audio track ${e} not found`);return}const t=this.getCurrentTime(),i=this.isPlaying();this.stopPlayback(),this.currentTrackType=e,i?this.startPlayback(void 0,t):this.setCurrentTime(t)}getCurrentTrackType(){return this.currentTrackType}isPlaying(){const e=this.audioTracks.get(this.currentTrackType);return(e==null?void 0:e.source)!==void 0}applyFadeInEffect(e){e.style.transition="",e.style.opacity="0",setTimeout(()=>{e.style.transition=`opacity ${this.fadeInDuration}ms`,e.style.opacity="1",this.firstSlideDisplayed=!0,setTimeout(()=>{e.style.transition=""},this.fadeInDuration)},10)}updateSubtitle(e){const t=document.getElementById(this.subtitleElementId);if(!(t instanceof HTMLElement))return;const i=this.subtitles.find(n=>e>=n.start&&e<n.end);i&&i.text!==this.currentSubtitleText?(this.currentSubtitleText=i.text,t.innerHTML=i.text):!i&&this.currentSubtitleText!==""&&(this.currentSubtitleText="",t.innerHTML="")}getCurrentFrame(){return Math.floor(this.getCurrentTime()*this.fps)}startPlayback(e,t){if(this.keyboardControlsInitialised||this.bindUIActions(),this.assetsLoaded&&this.audioContext){const i=this.audioTracks.get(this.currentTrackType);if(!(i!=null&&i.buffer))return;i.source&&i.source.stop();const n=this.audioContext.createBufferSource();n.buffer=i.buffer,n.connect(this.gainNode),i.source=n,this.audioTracks.set(this.currentTrackType,i);const s=t??this.pausedAt;this.startTime=this.audioContext.currentTime-s,n.start(0,s),this.playSequence(e)}}stopPlayback(){const e=this.audioTracks.get(this.currentTrackType);e!=null&&e.source&&(e.source.stop(),e.source=void 0,this.audioTracks.set(this.currentTrackType,e)),this.pausedAt=this.getCurrentTime(),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}async setTrackTotalTime(){const e=this.getTrackDuration(),t=document.getElementById("intro-sequence-time-total");t&&(t.textContent=wo(e))}getTrackDuration(){const e=this.audioTracks.get(this.currentTrackType);return e&&e.buffer?e.buffer.duration:(console.warn("Track not found or not loaded"),0)}playSequence(e){this.onProgressCallback=e;const t=()=>{const i=this.getCurrentTime(),n=this.getTotalTime(),s=this.audioTracks.get(this.currentTrackType);this.updateSequence(i),i<n&&(s!=null&&s.source)?this.animationFrameId=requestAnimationFrame(t):(this.animationFrameId=null,this.options.onSequenceFinished&&this.options.onSequenceFinished())};t()}calculateInitialZoom(e){let t=1;return e.movement&&(t=1+Math.max(Math.abs(e.movement.x),Math.abs(e.movement.y))+.1),e.zoom!==void 0&&(t*=1+Math.abs(e.zoom)),t}updatePositionAndZoom(e,t){if(this.reducedMotion)e.movement&&(this.currentPosition.x=0,this.currentPosition.y=0),e.zoom!==void 0&&(this.currentZoom=1);else if(e.movement&&(this.currentPosition.x=e.movement.x*t,this.currentPosition.y=e.movement.y*t),e.zoom!==void 0){const i=this.calculateInitialZoom(e);this.currentZoom=i*(1+e.zoom*t)}}updateFocusPointVisualization(e,t){const i=e.querySelector(".focus-point");if(i&&e.removeChild(i),this.showFocusPoints&&t){const n=document.createElement("div");n.classList.add("focus-point"),n.style.left=`${(t.x+this.currentPosition.x)*100}%`,n.style.top=`${(t.y+this.currentPosition.y)*100}%`,e.appendChild(n)}}getCurrentTime(){return this.audioContext?this.audioContext.currentTime-this.startTime:0}getCurrentTimelineTime(){return this.isPlaying()?this.audioContext?this.audioContext.currentTime-this.startTime:0:this.pausedAt}getTotalTime(){var t;const e=this.audioTracks.get(this.currentTrackType);return((t=e==null?void 0:e.buffer)==null?void 0:t.duration)??0}toggleFocusPoints(){this.showFocusPoints=!this.showFocusPoints}findNextSlide(e){return this.sequence.find(t=>t.start>e)}preloadNextSlide(e,t){if(e&&this.images[e.file]){const i=this.images[e.file],n=e.focusPoint||this.extractFocusPointFromFileName(e.file);t.style.backgroundImage=`url(${i.src})`,t.style.backgroundPosition=n?`${n.x*100}% ${n.y*100}%`:"center",t.style.backgroundSize="cover"}}setupProgressBarInteraction(){const e=document.getElementById("intro-sequence-progress-bar");if(!e)return;const t=n=>{const s=e.getBoundingClientRect(),r=(n.clientX-s.left)/s.width,l=this.getTotalTime()*r;this.setCurrentTime(l)},i=n=>{switch(n.code){case"ArrowLeft":this.setCurrentTime(this.getCurrentTimelineTime()-df);break;case"ArrowRight":this.setCurrentTime(this.getCurrentTimelineTime()+df);break}};e.addEventListener("focusin",()=>{window.addEventListener("keyup",i)}),e.addEventListener("focusout",()=>{window.removeEventListener("keyup",i)}),e.addEventListener("pointerup",n=>{n.preventDefault(),t(n)}),e.addEventListener("mousedown",n=>{this.isDragging=!0,document.body.classList.add("isDragging")}),window.addEventListener("mouseup",n=>{this.isDragging=!1,document.body.classList.remove("isDragging")}),window.addEventListener("mousemove",n=>{this.isDragging&&(n.preventDefault(),t(n))}),e.addEventListener("touchmove",n=>{n.preventDefault(),t(n.touches[0])}),e.addEventListener("touchend",n=>{n.preventDefault(),t(n.changedTouches[0])})}setCurrentTime(e){if(e<0&&(e=0),this.audioContext){const t=this.audioTracks.get(this.currentTrackType);if(!(t!=null&&t.buffer))return;const i=this.isPlaying();if(t.source&&(t.source.stop(),t.source=void 0,this.audioTracks.set(this.currentTrackType,t)),!i){this.pausedAt=e,this.updateSequence(e);return}const n=this.audioContext.createBufferSource();n.buffer=t.buffer,n.connect(this.gainNode),t.source=n,this.audioTracks.set(this.currentTrackType,t),this.startTime=this.audioContext.currentTime-e,n.start(0,e),this.updateSequence(e),this.pausedAt=e}}bindUIActions(){this.keyboardControlsInitialised=!0,document.addEventListener("keydown",e=>{if(e.code==="Space"){const t=document.activeElement;if(t&&(t.tagName==="BUTTON"||t.getAttribute("role")==="button"))return;this.togglePlayback()}}),$t("act-one__ui-toggle-playback",()=>{this.togglePlayback()})}getAudioContext(){return this.audioContext}setVolume(e){this.gainNode?this.gainNode.gain.setValueAtTime(e,this.audioContext.currentTime):this.audioElement&&(this.audioElement.volume=e)}pausePlayback(){const e=this.audioTracks.get(this.currentTrackType);e!=null&&e.source&&(this.pausedAt=this.getCurrentTime(),e.source.stop(),e.source=void 0,this.audioTracks.set(this.currentTrackType,e)),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}async cleanup(){this.sequence=[],this.subtitles=[];for(const e in this.images)this.images[e].src="",delete this.images[e];this.images={},this.audioTracks.forEach(e=>{e.source&&(e.source.stop(),e.source.disconnect())}),this.audioTracks.clear(),this.assetsLoaded={sequence:!1,images:!1,audio:!1},this.startTime=0,this.pausedAt=0}checkAssetsReady(){const e=this.sequenceLoaded,t=this.sequence.every(n=>Object.prototype.hasOwnProperty.call(this.images,n.file)),i=!this.audioContext||Array.from(this.audioTracks.values()).every(n=>n.buffer);this.assetsLoaded={sequence:e,images:t,audio:i},this.isFullyLoaded=e&&t&&i,Ye({sequence:e,images:t,audio:i,fullyLoaded:this.isFullyLoaded}),this.isFullyLoaded&&this.setTrackTotalTime(),this.isFullyLoaded&&this.options.onAssetsReady&&this.options.onAssetsReady()}isReady(){return this.isFullyLoaded}getLoadingStatus(){return{ready:this.isFullyLoaded,details:{...this.assetsLoaded}}}setPlaybackToggleCallback(e){this.onPlaybackToggle=e}extractFocusPointFromFileName(e){const t=e.match(/-x(\d+)-y(\d+)\./);return t?{x:parseInt(t[1],10)/100,y:parseInt(t[2],10)/100}:null}}class nh{constructor(e){g(this,"act",0);g(this,"onActChange");g(this,"act2Ready",!1);g(this,"changeAct",e=>(this.act=e,Ye(["New act: ",this.act]),this.onActChange&&this.onActChange(this.act),this.act));g(this,"getAct",()=>this.act);this.onActChange=(e==null?void 0:e.onActChange)||(()=>{}),this.changeAct((e==null?void 0:e.startingAct)||1)}}class q_{constructor(e={}){g(this,"audioContext");g(this,"masterGainNode");g(this,"_isMuted",!1);g(this,"tracks",new Map);g(this,"groups",new Map);g(this,"instanceCounter",0);g(this,"onTrackNotFound");g(this,"fadeTimeouts",new Map);g(this,"initialised",!1);g(this,"progressUpdateInterval",50);this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.connect(this.audioContext.destination),this.onTrackNotFound=e.onTrackNotFound,e.groups&&e.groups.forEach(t=>{var i;this.createGroup(t,((i=e.initialGroupVolumes)==null?void 0:i[t])??1)})}getAudioContext(){return this.audioContext}getMasterGainNode(){return this.masterGainNode}toggleMute(){return this._isMuted=!this._isMuted,this.masterGainNode.gain.setValueAtTime(this._isMuted?0:1,this.audioContext.currentTime),this.isMuted()}isMuted(){return this._isMuted}loadTrack(e,t,i={}){const{isPausable:n=!0,onLoaded:s,active:a=!1,group:r,decodeImmediately:l=!1,keepDecoded:c=!1}=i,h=async d=>{var f;try{const p=this.audioContext.createGain(),b=r?((f=this.groups.get(r))==null?void 0:f.gainNode)??this.masterGainNode:this.masterGainNode;p.connect(b);let _=null;l&&(_=await this.audioContext.decodeAudioData(d.slice()));const y={source:null,gainNode:p,buffer:_,compressedData:d,isPlaying:!1,isPausable:n,active:a,eventHandlers:new Map,groupId:r,isDecoded:!!_,keepDecoded:c};this.initialiseEventHandlers(y),this.tracks.set(e,y),Ye(`Audio track loaded - ${e}${r?` (group: ${r})`:""} ${_?"(pre-decoded)":"(compressed only)"}`),s&&s()}catch(p){throw p}};return new Promise((d,f)=>{typeof t=="string"?fetch(t).then(p=>p.arrayBuffer()).then(h).then(d).catch(f):h(t).then(d).catch(f)})}async ensureTrackDecoded(e){let t;if(typeof e=="string"){if(t=this.tracks.get(e),!t)return this.handleTrackNotFound(e),null}else t=e;if(t.isDecoded&&t.buffer)return t;if(!t.compressedData)throw new Error("No compressed data available for decoding");try{const i=t.compressedData.slice();return t.buffer=await this.audioContext.decodeAudioData(i),t.isDecoded=!0,t.duration=t.buffer.duration,Ye(`Audio decoded successfully, duration: ${t.duration}s`),t}catch(i){throw console.error("Failed to decode audio:",i),i}}async decodeTrack(e){try{return await this.ensureTrackDecoded(e)!==null}catch(t){return console.error(`Failed to decode track ${e}:`,t),!1}}async reloadTrack(e,t){const i=this.tracks.get(e);if(i){const n=i.isPlaying,s=i.pauseTime||0,a=i.groupId,r=i.isPausable,l=i.active;n&&this.stopTrack(e),await this.loadTrack(e,t,{isPausable:r,active:l,group:a}),n&&this.playTrack(e,{startTime:s})}else await this.loadTrack(e,t)}initialiseEventHandlers(e){e.eventHandlers=new Map,e.eventHandlers.set("complete",new Set)}addEventListener(e,t,i){const n=this.tracks.get(e);if(n){const s=n.eventHandlers.get(t);s&&s.add(i)}else this.handleTrackNotFound(name)}removeEventListener(e,t,i){const n=this.tracks.get(e);if(n){const s=n.eventHandlers.get(t);s&&s.delete(i)}}emitTrackEvent(e,t){const i=this.tracks.get(e);if(i){const n=i.eventHandlers.get(t);n&&n.forEach(s=>s())}}isTrackAvailable(e,t={}){const i=this.tracks.get(e);return i?!(i.buffer||i.compressedData)?(t.onNotFound?t.onNotFound():this.onTrackNotFound&&this.onTrackNotFound(e),!1):(Ye(`Track ${e} is available ${i.buffer?"(decoded)":"(compressed only)"}`),!0):(t.onNotFound?t.onNotFound():this.onTrackNotFound&&this.onTrackNotFound(e),!1)}unloadTrack(e,t=!1){const i=this.tracks.get(e);if(!i)return!1;if(i.isPlaying&&this.stopTrack(e),t){const n=this.audioContext.createBuffer(2,1,this.audioContext.sampleRate);return i.buffer=n,!0}else{if(i.source){i.source.onended=null;try{i.source.stop(),i.source.disconnect()}catch{}i.source=null}return i.buffer=null,!0}}initAudio(){this.initialised=!0;const e=document.getElementById("audio-element");e&&e.play()}async playTrack(e,t={}){this.initialised||this.initAudio();const i=this.tracks.get(e);let n=null,s=e;if(i){try{await this.ensureTrackDecoded(i)}catch(a){return console.error(`Failed to decode track ${e}:`,a),e}if(t.createInstance?(s=`${e}_instance_${this.instanceCounter++}`,n=this.createTrackInstance(i,s),this.tracks.set(s,n)):(n=i,i.source&&this.stopExistingSource(i,e)),n&&n.buffer){t.fadeIn&&(n.fadeIn={duration:t.fadeIn.duration/1e3,startVolume:t.fadeIn.startVolume??0,targetVolume:t.fadeIn.targetVolume??t.volume??1}),t.fadeOut&&(n.fadeOut={duration:t.fadeOut.duration/1e3,startVolume:t.fadeOut.startVolume??1,targetVolume:t.fadeOut.targetVolume??0});const a=this.audioContext.createBufferSource();a.buffer=n.buffer,n.lowPassFilter?a.connect(n.lowPassFilter):a.connect(n.gainNode),a.loop=t.loop??!1;const r=t.startTime??n.pauseTime??0;a.start(0,r),n.source=a,n.isPlaying=!0,n.active=!0,n.startTime=this.audioContext.currentTime-r,n.pauseTime=void 0;const l=t.volume??1,c=this.calculateFadeVolume(n,r,l);n.gainNode.gain.setValueAtTime(c,this.audioContext.currentTime),(n.fadeIn||n.fadeOut)&&this.startProgressMonitoring(s,n);const h=a;a.onended=()=>{n&&n.source===h&&(this.stopProgressMonitoring(n),n.isPlaying=!1,n.source=null,!n.keepDecoded&&!n.isTemp&&this.clearTrackBuffer(s),this.emitTrackEvent(s,"complete"),n.isTemp&&this.cleanupTrack(s))}}}else return this.onTrackNotFound&&this.onTrackNotFound(e),e;return s}calculateFadeVolume(e,t,i=1){if(!e.buffer)return i;const n=e.buffer.duration;let s=i;if(e.fadeIn&&t<e.fadeIn.duration){const a=t/e.fadeIn.duration;s=Sh(e.fadeIn.startVolume,e.fadeIn.targetVolume,this.easeFadeProgress(a))}if(e.fadeOut){const a=n-e.fadeOut.duration;if(t>=a){const r=(t-a)/e.fadeOut.duration;s=Sh(e.fadeOut.startVolume,e.fadeOut.targetVolume,this.easeFadeProgress(r))}}return s}easeFadeProgress(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}startProgressMonitoring(e,t){this.stopProgressMonitoring(t),t.updateProgressIntervalId=setInterval(()=>{if(!t.isPlaying||!t.source){this.stopProgressMonitoring(t);return}const i=this.getCurrentTrackTime(t),n=this.calculateFadeVolume(t,i),s=t.gainNode.gain.value;Math.abs(s-n)>.001&&t.gainNode.gain.linearRampToValueAtTime(n,this.audioContext.currentTime+this.progressUpdateInterval/2e3),t.fadeOut&&t.buffer&&(t.buffer.duration-t.fadeOut.duration,i>=t.buffer.duration-.05&&t.fadeOut.targetVolume===0&&this.stopTrack(e))},this.progressUpdateInterval)}stopProgressMonitoring(e){e.updateProgressIntervalId&&(clearInterval(e.updateProgressIntervalId),e.updateProgressIntervalId=void 0)}handleTrackNotFound(e){this.onTrackNotFound&&this.onTrackNotFound(e)}createTrackInstance(e,t){var a;const i=this.audioContext.createGain(),n=e.groupId?((a=this.groups.get(e.groupId))==null?void 0:a.gainNode)??this.masterGainNode:this.masterGainNode;i.connect(n);let s;return e.lowPassFilter&&(s=this.audioContext.createBiquadFilter(),s.type="lowpass",s.frequency.value=e.lowPassFilter.frequency.value,s.Q.value=e.lowPassFilter.Q.value,s.connect(i)),{source:null,gainNode:i,buffer:e.buffer,compressedData:e.compressedData,isPlaying:!1,isPausable:e.isPausable,active:!0,eventHandlers:new Map,isTemp:!0,instanceId:t,groupId:e.groupId,isDecoded:e.isDecoded,keepDecoded:!1}}async preloadTrack(e){const t=this.tracks.get(e);t&&!t.isDecoded&&await this.ensureTrackDecoded(t)}clearAllDecodedBuffers(){this.tracks.forEach((e,t)=>{!e.isPlaying&&e.buffer&&!e.keepDecoded&&this.clearTrackBuffer(t)})}stopExistingSource(e,t){try{e.source&&(e.source.onended=null,e.source.stop(),e.source.disconnect(),Ye(`Source stopped and disconnected for track ${t}`))}catch(i){console.warn(`Error stopping source for track ${t}:`,i)}e.source=null,e.isPlaying=!1}stopTrack(e,t=!1){const i=this.tracks.get(e);if(i&&this.stopProgressMonitoring(i),i&&i.source){try{i.source.onended=null,i.source.stop(),Ye(`Source stopped for track ${e}`)}catch(n){console.warn(`Error stopping source for track ${e}:`,n)}try{i.source.disconnect(),Ye(`Source disconnected for track ${e}`)}catch(n){console.warn(`Error disconnecting source for track ${e}:`,n)}i.source=null,i.isPlaying=!1,i.active=!1,i.pauseTime=0,t&&this.clearTrackBuffer(e),i.isTemp&&this.cleanupTrack(e)}}pauseTrack(e){const t=this.tracks.get(e);if(t&&t.source&&t.isPausable){const i=this.getCurrentTrackTime(t);this.stopProgressMonitoring(t);try{t.source.onended=null,t.source.stop(),Ye(`Source stopped for track ${e}`)}catch(n){console.warn(`Error stopping source for track ${e}:`,n)}try{t.source.disconnect(),Ye(`Source disconnected for track ${e}`)}catch(n){console.warn(`Error disconnecting source for track ${e}:`,n)}t.pauseTime=i,Ye(`Paused at time ${t.pauseTime} for track ${e}`),t.source=null,t.isPlaying=!1}else t&&!t.isPausable||this.handleTrackNotFound(e)}clearTrackBuffer(e){const t=this.tracks.get(e);t&&t.buffer&&!t.isPlaying&&(t.buffer=null,t.isDecoded=!1)}fadeTrack(e,t){const i=this.tracks.get(e);if(i){const n=this.audioContext.currentTime;i.gainNode.gain.cancelScheduledValues(n),i.gainNode.gain.setValueAtTime(i.gainNode.gain.value,n),i.gainNode.gain.linearRampToValueAtTime(t.targetVolume,n+t.duration/1e3);const s=this.fadeTimeouts.get(e);s&&clearTimeout(s);const a=setTimeout(()=>{this.fadeTimeouts.delete(e),t.stopAtEnd&&t.targetVolume===0&&this.stopTrack(e),t.onComplete&&t.onComplete()},t.duration);this.fadeTimeouts.set(e,a)}else this.handleTrackNotFound(e),t.onComplete&&t.onComplete()}setTrackVolume(e,t){const i=this.tracks.get(e);i&&i.gainNode.gain.setValueAtTime(t,this.audioContext.currentTime)}isTrackPlaying(e){const t=this.tracks.get(e);return t?t.isPlaying:!1}getAllPlayingTracks(){return Array.from(this.tracks.entries()).filter(([e,t])=>t.isPlaying).map(([e,t])=>e)}async getTrackDuration(e){const t=this.tracks.get(e);if(!t)return this.handleTrackNotFound(e),0;if(t.duration!==void 0)return t.duration;if(t.buffer&&t.isDecoded)return t.duration=t.buffer.duration,t.duration;if(!t.compressedData)return 0;try{const i=t.isDecoded;await this.ensureTrackDecoded(t);const n=t.duration;return!i&&!t.keepDecoded&&!t.isPlaying&&(Ye(`Cleaning up buffer for ${e} after duration check`),this.clearTrackBuffer(e)),n}catch(i){return console.error(`Failed to get duration for track ${e}:`,i),0}}getCurrentTime(){return this.audioContext.currentTime}getCurrentTrackTime(e){return!e.startTime||!e.isPlaying?0:this.audioContext.currentTime-e.startTime}setTrackTime(e,t){t<0&&(t=0);const i=this.tracks.get(e);if(i){const n=i.isPlaying;if(i.source){try{i.source.onended=null,i.source.stop(),Ye(`Source stopped for track ${e}`)}catch(s){console.warn(`Error stopping source for track ${e}:`,s)}try{i.source.disconnect(),Ye(`Source disconnected for track ${e}`)}catch(s){console.warn(`Error disconnecting source for track ${e}:`,s)}i.source=null,i.isPlaying=!1}if(i.pauseTime=t,Ye(`Track ${e} pauseTime set to ${i.pauseTime}`),this.stopProgressMonitoring(i),n)this.playTrack(e,{startTime:t});else{const s=i.gainNode.gain.value,a=this.calculateFadeVolume(i,t,s);i.gainNode.gain.setValueAtTime(a,this.audioContext.currentTime)}}else this.handleTrackNotFound(e)}pauseAllTracks(){this.tracks.forEach((e,t)=>{e.isPlaying&&e.isPausable&&this.pauseTrack(t)})}setTrackPausable(e,t){const i=this.tracks.get(e);i?i.isPausable=t:this.handleTrackNotFound(e)}togglePlay(e){const t=this.tracks.get(e);t?t.isPlaying?this.pauseTrack(e):this.playTrack(e,{startTime:t.pauseTime}):this.handleTrackNotFound(e)}togglePlayAll(){this.tracks.forEach((e,t)=>{e.active&&this.togglePlay(t)})}removeTrack(e){const t=this.tracks.get(e);t?(t.isPlaying&&this.stopTrack(e),t.gainNode.disconnect(),t.eventHandlers.clear(),this.tracks.delete(e)):this.handleTrackNotFound(e)}resetTrack(e){const t=this.tracks.get(e);t?(t.isPlaying&&this.stopTrack(e),t.pauseTime=0,t.isPlaying=!1):this.handleTrackNotFound(e)}cleanupTrack(e){const t=this.tracks.get(e);t&&(t.gainNode.disconnect(),t.lowPassFilter&&t.lowPassFilter.disconnect(),t.eventHandlers.clear(),this.tracks.delete(e))}createGroup(e,t=1){if(this.groups.has(e))return;const i=this.audioContext.createGain();i.connect(this.masterGainNode),i.gain.value=t,this.groups.set(e,{name:e,gainNode:i,volume:t})}setMasterVolume(e){this.masterGainNode.gain.setValueAtTime(e,this.audioContext.currentTime)}getMasterVolume(){return this.masterGainNode.gain.value}setGroupVolume(e,t){const i=this.groups.get(e);i&&(i.volume=t,i.gainNode.gain.setValueAtTime(t,this.audioContext.currentTime))}getGroupVolume(e){var t;return((t=this.groups.get(e))==null?void 0:t.volume)??1}getTracksInGroup(e){return Array.from(this.tracks.entries()).filter(([t,i])=>i.groupId===e).map(([t,i])=>t)}setGroupMuted(e,t){const i=this.groups.get(e);if(i){const n=t?0:i.volume;i.gainNode.gain.setValueAtTime(n,this.audioContext.currentTime)}}getGroupGainNode(e){const t=this.groups.get(e);return(t==null?void 0:t.gainNode)||null}setPitch(e,t){const i=this.tracks.get(e);if(!i){this.handleTrackNotFound(e);return}if(i.source){const n=1200*Math.log2(t);i.source.detune?i.source.detune.setValueAtTime(n,this.audioContext.currentTime):i.source.playbackRate.setValueAtTime(t,this.audioContext.currentTime)}}animatePitch(e,t,i,n){const s=this.tracks.get(e);if(!s||!s.source){n&&n();return}const a=this.audioContext.currentTime;if(s.source.detune){const r=s.source.detune.value,l=1200*Math.log2(t);s.source.detune.setValueAtTime(r,a),s.source.detune.linearRampToValueAtTime(l,a+i/1e3)}else{const r=s.source.playbackRate.value;s.source.playbackRate.setValueAtTime(r,a),s.source.playbackRate.linearRampToValueAtTime(t,a+i/1e3)}n&&setTimeout(n,i)}hasLowPassFilter(e){const t=this.tracks.get(e);return t?!!t.lowPassFilter:(this.handleTrackNotFound(e),!1)}addLowPassFilter(e,t,i=1){const n=this.tracks.get(e);if(!n){this.handleTrackNotFound(e);return}if(!n.lowPassFilter){const s=this.audioContext.createBiquadFilter();s.type="lowpass";const a=2e4;s.frequency.value=t!==void 0?t:a,s.Q.value=i,n.source&&(n.source.disconnect(),n.source.connect(s)),s.connect(n.gainNode),n.lowPassFilter=s,Ye(`Added low-pass filter to track ${e} (initial freq: ${s.frequency.value}Hz, Q: ${i})`);return}t!==void 0&&this.setLowPassFrequency(e,t),this.setLowPassQ(e,i)}setLowPassFrequency(e,t){const i=this.tracks.get(e);i&&i.lowPassFilter&&i.lowPassFilter.frequency.setValueAtTime(t,this.audioContext.currentTime)}setLowPassQ(e,t){const i=this.tracks.get(e);i&&i.lowPassFilter&&i.lowPassFilter.Q.setValueAtTime(t,this.audioContext.currentTime)}removeLowPassFilter(e){const t=this.tracks.get(e);!t||!t.lowPassFilter||(t.source&&(t.source.disconnect(),t.source.connect(t.gainNode)),t.lowPassFilter.disconnect(),t.lowPassFilter=void 0)}animateLowPassFrequency(e,t,i,n){const s=this.tracks.get(e);if(!s||!s.lowPassFilter){console.warn(`Track ${e} not found or has no low-pass filter`),n&&n();return}const a=this.audioContext.currentTime,r=s.lowPassFilter.frequency.value,l=Math.max(r,.1),c=Math.max(t,.1);s.lowPassFilter.frequency.setValueAtTime(l,a),s.lowPassFilter.frequency.exponentialRampToValueAtTime(c,a+i/1e3),n&&setTimeout(n,i)}getMemoryStats(){let e=0,t=0,i=0;return this.tracks.forEach(n=>{n.isDecoded&&n.buffer&&e++,n.isPlaying&&t++,n.compressedData&&(i+=n.compressedData.byteLength)}),{totalTracks:this.tracks.size,decodedTracks:e,playingTracks:t,compressedSize:i}}cleanup(){this.tracks.forEach((e,t)=>{e.isPlaying&&this.stopTrack(t),e.gainNode.disconnect(),e.eventHandlers.clear()}),this.tracks.clear(),this.groups.forEach(e=>{e.gainNode.disconnect()}),this.groups.clear()}cleanupInstances(){const e=[];this.tracks.forEach((t,i)=>{t.isTemp&&!t.isPlaying&&e.push(i)}),e.forEach(t=>{this.cleanupTrack(t)})}}function gf(o,e){if(e===l0)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===yh||e===vp){let t=o.getIndex();if(t===null){const a=[],r=o.getAttribute("position");if(r!==void 0){for(let l=0;l<r.count;l++)a.push(l);o.setIndex(a),t=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const i=t.count-2,n=[];if(e===yh)for(let a=1;a<=i;a++)n.push(t.getX(0)),n.push(t.getX(a)),n.push(t.getX(a+1));else for(let a=0;a<i;a++)a%2===0?(n.push(t.getX(a)),n.push(t.getX(a+1)),n.push(t.getX(a+2))):(n.push(t.getX(a+2)),n.push(t.getX(a+1)),n.push(t.getX(a)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=o.clone();return s.setIndex(n),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}let Yl=class extends Wa{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new K_(t)}),this.register(function(t){return new Q_(t)}),this.register(function(t){return new oM(t)}),this.register(function(t){return new lM(t)}),this.register(function(t){return new cM(t)}),this.register(function(t){return new eM(t)}),this.register(function(t){return new tM(t)}),this.register(function(t){return new iM(t)}),this.register(function(t){return new nM(t)}),this.register(function(t){return new Z_(t)}),this.register(function(t){return new sM(t)}),this.register(function(t){return new J_(t)}),this.register(function(t){return new rM(t)}),this.register(function(t){return new aM(t)}),this.register(function(t){return new $_(t)}),this.register(function(t){return new hM(t)}),this.register(function(t){return new uM(t)})}load(e,t,i,n){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=bo.extractUrlBase(e);a=bo.resolveURL(c,this.path)}else a=bo.extractUrlBase(e);this.manager.itemStart(e);const r=function(c){n?n(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new Yh(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,a,function(h){t(h),s.manager.itemEnd(e)},r)}catch(h){r(h)}},i,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let s;const a={},r={},l=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===om){try{a[Yt.KHR_BINARY_GLTF]=new dM(e)}catch(d){n&&n(d);return}s=JSON.parse(a[Yt.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new AM(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const d=this.pluginCallbacks[h](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,a[d.name]=!0}if(s.extensionsUsed)for(let h=0;h<s.extensionsUsed.length;++h){const d=s.extensionsUsed[h],f=s.extensionsRequired||[];switch(d){case Yt.KHR_MATERIALS_UNLIT:a[d]=new Y_;break;case Yt.KHR_DRACO_MESH_COMPRESSION:a[d]=new fM(s,this.dracoLoader);break;case Yt.KHR_TEXTURE_TRANSFORM:a[d]=new pM;break;case Yt.KHR_MESH_QUANTIZATION:a[d]=new mM;break;default:f.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(a),c.setPlugins(r),c.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,s){i.parse(e,t,n,s)})}};function X_(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const Yt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class $_{constructor(e){this.parser=e,this.name=Yt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const h=new Dt(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],Vi);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new Qp(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Aw(h),c.distance=d;break;case"spot":c=new xw(h),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,ua(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],r=(s.extensions&&s.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(l){return i._getNodeRef(t.cache,r,l)})}}class Y_{constructor(){this.name=Yt.KHR_MATERIALS_UNLIT}getMaterialType(){return qt}extendParams(e,t,i){const n=[];e.color=new Dt(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Vi),e.opacity=a[3]}s.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",s.baseColorTexture,rn))}return Promise.all(n)}}class Z_{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class K_{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const r=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new et(r,r)}return Promise.all(s)}}class Q_{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class J_{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class eM{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Dt(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=n.extensions[this.name];if(a.sheenColorFactor!==void 0){const r=a.sheenColorFactor;t.sheenColor.setRGB(r[0],r[1],r[2],Vi)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",a.sheenColorTexture,rn)),a.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class tM{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class iM{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const r=a.attenuationColor||[1,1,1];return t.attenuationColor=new Dt().setRGB(r[0],r[1],r[2],Vi),Promise.all(s)}}class nM{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class sM{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",a.specularTexture));const r=a.specularColorFactor||[1,1,1];return t.specularColor=new Dt().setRGB(r[0],r[1],r[2],Vi),a.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",a.specularColorTexture,rn)),Promise.all(s)}}class aM{constructor(e){this.parser=e,this.name=Yt.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}}class rM{constructor(e){this.parser=e,this.name=Yt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:xs}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class oM{constructor(e){this.parser=e,this.name=Yt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}}class lM{constructor(e){this.parser=e,this.name=Yt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],r=n.images[a.source];let l=i.textureLoader;if(r.uri){const c=i.options.manager.getHandler(r.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class cM{constructor(e){this.parser=e,this.name=Yt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],r=n.images[a.source];let l=i.textureLoader;if(r.uri){const c=i.options.manager.getHandler(r.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,a.source,l);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class hM{constructor(e){this.name=Yt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],s=this.parser.getDependency("buffer",n.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(r){const l=n.byteOffset||0,c=n.byteLength||0,h=n.count,d=n.byteStride,f=new Uint8Array(r,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,d,f,n.mode,n.filter).then(function(p){return p.buffer}):a.ready.then(function(){const p=new ArrayBuffer(h*d);return a.decodeGltfBuffer(new Uint8Array(p),h,d,f,n.mode,n.filter),p})})}else return null}}class uM{constructor(e){this.name=Yt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const c of n.primitives)if(c.mode!==Fn.TRIANGLES&&c.mode!==Fn.TRIANGLE_STRIP&&c.mode!==Fn.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=i.extensions[this.name].attributes,r=[],l={};for(const c in a)r.push(this.parser.getDependency("accessor",a[c]).then(h=>(l[c]=h,l[c])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(c=>{const h=c.pop(),d=h.isGroup?h.children:[h],f=c[0].count,p=[];for(const b of d){const _=new Ft,y=new D,v=new ai,S=new D(1,1,1),A=new Xb(b.geometry,b.material,f);for(let E=0;E<f;E++)l.TRANSLATION&&y.fromBufferAttribute(l.TRANSLATION,E),l.ROTATION&&v.fromBufferAttribute(l.ROTATION,E),l.SCALE&&S.fromBufferAttribute(l.SCALE,E),A.setMatrixAt(E,_.compose(y,v,S));for(const E in l)if(E==="_COLOR_0"){const O=l[E];A.instanceColor=new Vl(O.array,O.itemSize,O.normalized)}else E!=="TRANSLATION"&&E!=="ROTATION"&&E!=="SCALE"&&b.geometry.setAttribute(E,l[E]);ri.prototype.copy.call(A,b),this.parser.assignFinalMaterial(A),p.push(A)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}}const om="glTF",co=12,yf={JSON:1313821514,BIN:5130562};class dM{constructor(e){this.name=Yt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,co),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==om)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-co,s=new DataView(e,co);let a=0;for(;a<n;){const r=s.getUint32(a,!0);a+=4;const l=s.getUint32(a,!0);if(a+=4,l===yf.JSON){const c=new Uint8Array(e,co+a,r);this.content=i.decode(c)}else if(l===yf.BIN){const c=co+a;this.body=e.slice(c,c+r)}a+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class fM{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Yt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,r={},l={},c={};for(const h in a){const d=Ah[h]||h.toLowerCase();r[d]=a[h]}for(const h in e.attributes){const d=Ah[h]||h.toLowerCase();if(a[h]!==void 0){const f=i.accessors[e.attributes[h]],p=Rr[f.componentType];c[d]=p.name,l[d]=f.normalized===!0}}return t.getDependency("bufferView",s).then(function(h){return new Promise(function(d,f){n.decodeDracoFile(h,function(p){for(const b in p.attributes){const _=p.attributes[b],y=l[b];y!==void 0&&(_.normalized=y)}d(p)},r,c,Vi,f)})})}}class pM{constructor(){this.name=Yt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class mM{constructor(){this.name=Yt.KHR_MESH_QUANTIZATION}}class lm extends ko{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let a=0;a!==n;a++)t[a]=i[s+a];return t}interpolate_(e,t,i,n){const s=this.resultBuffer,a=this.sampleValues,r=this.valueSize,l=r*2,c=r*3,h=n-t,d=(i-t)/h,f=d*d,p=f*d,b=e*c,_=b-c,y=-2*p+3*f,v=p-f,S=1-y,A=v-f+d;for(let E=0;E!==r;E++){const O=a[_+E+r],R=a[_+E+l]*h,k=a[b+E+r],U=a[b+E]*h;s[E]=S*O+A*R+y*k+v*U}return s}}const gM=new ai;class yM extends lm{interpolate_(e,t,i,n){const s=super.interpolate_(e,t,i,n);return gM.fromArray(s).normalize().toArray(s),s}}const Fn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Rr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},vf={9728:ln,9729:wi,9984:cp,9985:El,9986:uo,9987:is},bf={33071:ws,33648:Fl,10497:Ur},sh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ah={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},la={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},vM={CUBICSPLINE:void 0,LINEAR:Br,STEP:Ao},ah={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function bM(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new Sn({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:zn})),o.DefaultMaterial}function Fa(o,e,t){for(const i in t.extensions)o[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ua(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function wM(o,e,t){let i=!1,n=!1,s=!1;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(d.POSITION!==void 0&&(i=!0),d.NORMAL!==void 0&&(n=!0),d.COLOR_0!==void 0&&(s=!0),i&&n&&s)break}if(!i&&!n&&!s)return Promise.resolve(o);const a=[],r=[],l=[];for(let c=0,h=e.length;c<h;c++){const d=e[c];if(i){const f=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):o.attributes.position;a.push(f)}if(n){const f=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):o.attributes.normal;r.push(f)}if(s){const f=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):o.attributes.color;l.push(f)}}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],f=c[2];return i&&(o.morphAttributes.position=h),n&&(o.morphAttributes.normal=d),s&&(o.morphAttributes.color=f),o.morphTargetsRelative=!0,o})}function _M(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)o.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function MM(o){let e;const t=o.extensions&&o.extensions[Yt.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+rh(t.attributes):e=o.indices+":"+rh(o.attributes)+":"+o.mode,o.targets!==void 0)for(let i=0,n=o.targets.length;i<n;i++)e+=":"+rh(o.targets[i]);return e}function rh(o){let e="";const t=Object.keys(o).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+o[t[i]]+";";return e}function Th(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function xM(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const SM=new Ft;class AM{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new X_,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,s=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||n&&s<98?this.textureLoader=new nc(this.options.manager):this.textureLoader=new Pw(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Yh(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(a){const r={scene:a[0][n.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:n.asset,parser:i,userData:{}};return Fa(s,r,n),ua(r,n),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(r)})).then(function(){for(const l of r.scenes)l.updateMatrixWorld();e(r)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,s=t.length;n<s;n++){const a=t[n].joints;for(let r=0,l=a.length;r<l;r++)e[a[r]].isBone=!0}for(let n=0,s=e.length;n<s;n++){const a=e[n];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(i[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),s=(a,r)=>{const l=this.associations.get(a);l!=null&&this.associations.set(r,l);for(const[c,h]of a.children.entries())s(h,r.children[c])};return s(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const s=e(t[n]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":n=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(s,a){return i.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Yt.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(s,a){i.load(bo.resolveURL(t.uri,n.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const a=sh[n.type],r=Rr[n.componentType],l=n.normalized===!0,c=new r(n.count*a);return Promise.resolve(new Ei(c,a,l))}const s=[];return n.bufferView!==void 0?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),n.sparse!==void 0&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(a){const r=a[0],l=sh[n.type],c=Rr[n.componentType],h=c.BYTES_PER_ELEMENT,d=h*l,f=n.byteOffset||0,p=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,b=n.normalized===!0;let _,y;if(p&&p!==d){const v=Math.floor(f/p),S="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+v+":"+n.count;let A=t.cache.get(S);A||(_=new c(r,v*p,n.count*p/h),A=new Hb(_,p/h),t.cache.add(S,A)),y=new Gh(A,l,f%p/h,b)}else r===null?_=new c(n.count*l):_=new c(r,f,n.count*l),y=new Ei(_,l,b);if(n.sparse!==void 0){const v=sh.SCALAR,S=Rr[n.sparse.indices.componentType],A=n.sparse.indices.byteOffset||0,E=n.sparse.values.byteOffset||0,O=new S(a[1],A,n.sparse.count*v),R=new c(a[2],E,n.sparse.count*l);r!==null&&(y=new Ei(y.array.slice(),y.itemSize,y.normalized));for(let k=0,U=O.length;k<U;k++){const C=O[k];if(y.setX(C,R[k*l]),l>=2&&y.setY(C,R[k*l+1]),l>=3&&y.setZ(C,R[k*l+2]),l>=4&&y.setW(C,R[k*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return y})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,a=t.images[s];let r=this.textureLoader;if(a.uri){const l=i.manager.getHandler(a.uri);l!==null&&(r=l)}return this.loadTextureImage(e,s,r)}loadTextureImage(e,t,i){const n=this,s=this.json,a=s.textures[e],r=s.images[t],l=(r.uri||r.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=a.name||r.name||"",h.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(h.name=r.uri);const f=(s.samplers||{})[a.sampler]||{};return h.magFilter=vf[f.magFilter]||wi,h.minFilter=vf[f.minFilter]||is,h.wrapS=bf[f.wrapS]||Ur,h.wrapT=bf[f.wrapT]||Ur,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,n=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const a=n.images[e],r=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=i.getDependency("bufferView",a.bufferView).then(function(d){c=!0;const f=new Blob([d],{type:a.mimeType});return l=r.createObjectURL(f),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(d){return new Promise(function(f,p){let b=f;t.isImageBitmapLoader===!0&&(b=function(_){const y=new Fi(_);y.needsUpdate=!0,f(y)}),t.load(bo.resolveURL(d,s.path),b,void 0,p)})}).then(function(d){return c===!0&&r.revokeObjectURL(l),d.userData.mimeType=a.mimeType||xM(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=h,h}assignTexture(e,t,i,n){const s=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(a=a.clone(),a.channel=i.texCoord),s.extensions[Yt.KHR_TEXTURE_TRANSFORM]){const r=i.extensions!==void 0?i.extensions[Yt.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const l=s.associations.get(a);a=s.extensions[Yt.KHR_TEXTURE_TRANSFORM].extendTexture(a,r),s.associations.set(a,l)}}return n!==void 0&&(a.colorSpace=n),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+i.uuid;let l=this.cache.get(r);l||(l=new Gp,Vn.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(r,l)),i=l}else if(e.isLine){const r="LineBasicMaterial:"+i.uuid;let l=this.cache.get(r);l||(l=new yn,Vn.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(r,l)),i=l}if(n||s||a){let r="ClonedMaterial:"+i.uuid+":";n&&(r+="derivative-tangents:"),s&&(r+="vertex-colors:"),a&&(r+="flat-shading:");let l=this.cache.get(r);l||(l=i.clone(),s&&(l.vertexColors=!0),a&&(l.flatShading=!0),n&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(r,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return Sn}loadMaterial(e){const t=this,i=this.json,n=this.extensions,s=i.materials[e];let a;const r={},l=s.extensions||{},c=[];if(l[Yt.KHR_MATERIALS_UNLIT]){const d=n[Yt.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),c.push(d.extendParams(r,s,t))}else{const d=s.pbrMetallicRoughness||{};if(r.color=new Dt(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;r.color.setRGB(f[0],f[1],f[2],Vi),r.opacity=f[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(r,"map",d.baseColorTexture,rn)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,r)})))}s.doubleSided===!0&&(r.side=Ai);const h=s.alphaMode||ah.OPAQUE;if(h===ah.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,h===ah.MASK&&(r.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==qt&&(c.push(t.assignTexture(r,"normalMap",s.normalTexture)),r.normalScale=new et(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;r.normalScale.set(d,d)}if(s.occlusionTexture!==void 0&&a!==qt&&(c.push(t.assignTexture(r,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==qt){const d=s.emissiveFactor;r.emissive=new Dt().setRGB(d[0],d[1],d[2],Vi)}return s.emissiveTexture!==void 0&&a!==qt&&c.push(t.assignTexture(r,"emissiveMap",s.emissiveTexture,rn)),Promise.all(c).then(function(){const d=new a(r);return s.name&&(d.name=s.name),ua(d,s),t.associations.set(d,{materials:e}),s.extensions&&Fa(n,d,s),d})}createUniqueName(e){const t=oi.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function s(r){return i[Yt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,t).then(function(l){return wf(l,r,t)})}const a=[];for(let r=0,l=e.length;r<l;r++){const c=e[r],h=MM(c),d=n[h];if(d)a.push(d.promise);else{let f;c.extensions&&c.extensions[Yt.KHR_DRACO_MESH_COMPRESSION]?f=s(c):f=wf(new fi,c,t),n[h]={primitive:c,promise:f},a.push(f)}}return Promise.all(a)}loadMesh(e){const t=this,i=this.json,n=this.extensions,s=i.meshes[e],a=s.primitives,r=[];for(let l=0,c=a.length;l<c;l++){const h=a[l].material===void 0?bM(this.cache):this.getDependency("material",a[l].material);r.push(h)}return r.push(t.loadGeometries(a)),Promise.all(r).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],d=[];for(let p=0,b=h.length;p<b;p++){const _=h[p],y=a[p];let v;const S=c[p];if(y.mode===Fn.TRIANGLES||y.mode===Fn.TRIANGLE_STRIP||y.mode===Fn.TRIANGLE_FAN||y.mode===void 0)v=s.isSkinnedMesh===!0?new Eo(_,S):new It(_,S),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),y.mode===Fn.TRIANGLE_STRIP?v.geometry=gf(v.geometry,vp):y.mode===Fn.TRIANGLE_FAN&&(v.geometry=gf(v.geometry,yh));else if(y.mode===Fn.LINES)v=new Wl(_,S);else if(y.mode===Fn.LINE_STRIP)v=new Mn(_,S);else if(y.mode===Fn.LINE_LOOP)v=new $b(_,S);else if(y.mode===Fn.POINTS)v=new Yb(_,S);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys(v.geometry.morphAttributes).length>0&&_M(v,s),v.name=t.createUniqueName(s.name||"mesh_"+e),ua(v,s),y.extensions&&Fa(n,v,y),t.assignFinalMaterial(v),d.push(v)}for(let p=0,b=d.length;p<b;p++)t.associations.set(d[p],{meshes:e,primitives:p});if(d.length===1)return s.extensions&&Fa(n,d[0],s),d[0];const f=new cn;s.extensions&&Fa(n,f,s),t.associations.set(f,{meshes:e});for(let p=0,b=d.length;p<b;p++)f.add(d[p]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new on(Et.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new ec(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ua(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,s=t.joints.length;n<s;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const s=n.pop(),a=n,r=[],l=[];for(let c=0,h=a.length;c<h;c++){const d=a[c];if(d){r.push(d);const f=new Ft;s!==null&&f.fromArray(s.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new jb(r,l)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],s=n.name?n.name:"animation_"+e,a=[],r=[],l=[],c=[],h=[];for(let d=0,f=n.channels.length;d<f;d++){const p=n.channels[d],b=n.samplers[p.sampler],_=p.target,y=_.node,v=n.parameters!==void 0?n.parameters[b.input]:b.input,S=n.parameters!==void 0?n.parameters[b.output]:b.output;_.node!==void 0&&(a.push(this.getDependency("node",y)),r.push(this.getDependency("accessor",v)),l.push(this.getDependency("accessor",S)),c.push(b),h.push(_))}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(d){const f=d[0],p=d[1],b=d[2],_=d[3],y=d[4],v=[];for(let S=0,A=f.length;S<A;S++){const E=f[S],O=p[S],R=b[S],k=_[S],U=y[S];if(E===void 0)continue;E.updateMatrix&&E.updateMatrix();const C=i._createAnimationTracks(E,O,R,k,U);if(C)for(let T=0;T<C.length;T++)v.push(C[T])}return new Co(s,void 0,v)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(s){const a=i._getNodeRef(i.meshCache,n.mesh,s);return n.weights!==void 0&&a.traverse(function(r){if(r.isMesh)for(let l=0,c=n.weights.length;l<c;l++)r.morphTargetInfluences[l]=n.weights[l]}),a})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],s=i._loadNodeShallow(e),a=[],r=n.children||[];for(let c=0,h=r.length;c<h;c++)a.push(i.getDependency("node",r[c]));const l=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([s,Promise.all(a),l]).then(function(c){const h=c[0],d=c[1],f=c[2];f!==null&&h.traverse(function(p){p.isSkinnedMesh&&p.bind(f,SM)});for(let p=0,b=d.length;p<b;p++)h.add(d[p]);return h})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],a=s.name?n.createUniqueName(s.name):"",r=[],l=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&r.push(l),s.camera!==void 0&&r.push(n.getDependency("camera",s.camera).then(function(c){return n._getNodeRef(n.cameraCache,s.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){r.push(c)}),this.nodeCache[e]=Promise.all(r).then(function(c){let h;if(s.isBone===!0?h=new Vp:c.length>1?h=new cn:c.length===1?h=c[0]:h=new ri,h!==c[0])for(let d=0,f=c.length;d<f;d++)h.add(c[d]);if(s.name&&(h.userData.name=s.name,h.name=a),ua(h,s),s.extensions&&Fa(i,h,s),s.matrix!==void 0){const d=new Ft;d.fromArray(s.matrix),h.applyMatrix4(d)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return n.associations.has(h)||n.associations.set(h,{}),n.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,s=new cn;i.name&&(s.name=n.createUniqueName(i.name)),ua(s,i),i.extensions&&Fa(t,s,i);const a=i.nodes||[],r=[];for(let l=0,c=a.length;l<c;l++)r.push(n.getDependency("node",a[l]));return Promise.all(r).then(function(l){for(let h=0,d=l.length;h<d;h++)s.add(l[h]);const c=h=>{const d=new Map;for(const[f,p]of n.associations)(f instanceof Vn||f instanceof Fi)&&d.set(f,p);return h.traverse(f=>{const p=n.associations.get(f);p!=null&&d.set(f,p)}),d};return n.associations=c(s),s})}_createAnimationTracks(e,t,i,n,s){const a=[],r=e.name?e.name:e.uuid,l=[];la[s.path]===la.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(r);let c;switch(la[s.path]){case la.weights:c=Hr;break;case la.rotation:c=Ga;break;case la.position:case la.scale:c=Gr;break;default:switch(i.itemSize){case 1:c=Hr;break;case 2:case 3:default:c=Gr;break}break}const h=n.interpolation!==void 0?vM[n.interpolation]:Br,d=this._getArrayFromAccessor(i);for(let f=0,p=l.length;f<p;f++){const b=new c(l[f]+"."+la[s.path],t.array,d,h);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(b),a.push(b)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Th(t.constructor),n=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)n[s]=t[s]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof Ga?yM:lm;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function TM(o,e,t){const i=e.attributes,n=new Hn;if(i.POSITION!==void 0){const r=t.json.accessors[i.POSITION],l=r.min,c=r.max;if(l!==void 0&&c!==void 0){if(n.set(new D(l[0],l[1],l[2]),new D(c[0],c[1],c[2])),r.normalized){const h=Th(Rr[r.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const r=new D,l=new D;for(let c=0,h=s.length;c<h;c++){const d=s[c];if(d.POSITION!==void 0){const f=t.json.accessors[d.POSITION],p=f.min,b=f.max;if(p!==void 0&&b!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(b[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(b[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(b[2]))),f.normalized){const _=Th(Rr[f.componentType]);l.multiplyScalar(_)}r.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(r)}o.boundingBox=n;const a=new rs;n.getCenter(a.center),a.radius=n.min.distanceTo(n.max)/2,o.boundingSphere=a}function wf(o,e,t){const i=e.attributes,n=[];function s(a,r){return t.getDependency("accessor",a).then(function(l){o.setAttribute(r,l)})}for(const a in i){const r=Ah[a]||a.toLowerCase();r in o.attributes||n.push(s(i[a],r))}if(e.indices!==void 0&&!o.index){const a=t.getDependency("accessor",e.indices).then(function(r){o.setIndex(r)});n.push(a)}return si.workingColorSpace!==Vi&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${si.workingColorSpace}" not supported.`),ua(o,e),TM(o,e,t),Promise.all(n).then(function(){return e.targets!==void 0?wM(o,e.targets,t):o})}var ns=(o=>(o[o.NONE=0]="NONE",o[o.CENTRE_POINT=1]="CENTRE_POINT",o[o.POINTS_ARRAY=2]="POINTS_ARRAY",o[o.POINTS_WITH_LINES=3]="POINTS_WITH_LINES",o[o.FULL_SKELETON=4]="FULL_SKELETON",o))(ns||{});class EM{constructor(){g(this,"loadedQualities",new Map);g(this,"qualityStates",new Map);g(this,"container");g(this,"activeQuality",null);this.container=new cn,this.container.name="quality-manager"}addQualityLevel(e){if(this.loadedQualities.has(e.quality)){Ye(`Quality level ${e.quality} already exists`);return}if(!e.mesh){Ye(`Cannot add quality level without mesh: ${e.quality}`);return}e.visible=e.visible??!1,this.loadedQualities.set(e.quality,e),e.mesh.visible=e.visible,e.mesh.name=`${e.quality}`,this.container.add(e.mesh),Ye(`Added quality level: ${e.quality}`)}createState(e,t){t&&this.loadedQualities.has(t),this.qualityStates.set(e,{quality:t||null,visible:!1})}updateState(e,t){if(!this.loadedQualities.has(t))return;const i=this.qualityStates.get(e);if(!i)return;const n=i.visible;if(n&&i.quality){const s=this.loadedQualities.get(i.quality);s&&(s.mesh.visible=!1)}if(this.qualityStates.set(e,{quality:t,visible:i.visible}),n){const s=this.loadedQualities.get(t);s&&(s.mesh.visible=!0,this.activeQuality=t)}}activateQuality(e){const t=this.loadedQualities.get(e);t&&(this.loadedQualities.forEach((i,n)=>{i.mesh.visible=!1}),this.qualityStates.forEach(i=>{i.visible=!1}),t.mesh.visible=!0,this.activeQuality=e)}getActiveQuality(){return this.getQuality(this.activeQuality)}fadeToQuality(e,t=1e3){const i=this.loadedQualities.get(e);if(!i)return;const n=this.getActiveQuality().quality;if(!n||n===e){this.activateQuality(e);return}const s=this.loadedQualities.get(n);if(!s){this.activateQuality(e);return}s.mesh.visible=!0,i.mesh.visible=!0;const a=s.mesh.position.clone(),r=i.mesh.position.clone(),l=.02;s.mesh.position.z+=l,i.mesh.position.z-=l,this.setMaterialOpacity(s.mesh,1),this.setMaterialOpacity(i.mesh,0),this.setRenderOrder(s.mesh,1),this.setRenderOrder(i.mesh,10);const c=performance.now(),h=d=>{const f=d-c,p=Math.min(f/t,1);this.setMaterialOpacity(i.mesh,p),p<1?requestAnimationFrame(h):(s.mesh.position.copy(a),i.mesh.position.copy(r),s.mesh.visible=!1,this.activateQuality(e))};requestAnimationFrame(h)}setRenderOrder(e,t){e.renderOrder=t,e.traverse(i=>{i.renderOrder=t})}setMaterialPolygonOffset(e,t,i,n){e.traverse(s=>{s instanceof It&&s.material&&(Array.isArray(s.material)?s.material:[s.material]).forEach(r=>{r.polygonOffset=t,r.polygonOffsetFactor=i,r.polygonOffsetUnits=n})})}setMaterialTransparent(e,t,i){e.traverse(n=>{n instanceof It&&n.material&&(Array.isArray(n.material)?n.material:[n.material]).forEach(a=>{a.transparent=t,a.opacity=i})})}setMaterialOpacity(e,t){e.traverse(i=>{i instanceof It&&i.material&&(Array.isArray(i.material)?i.material:[i.material]).forEach(s=>{s.opacity=t})})}activateState(e){const t=this.qualityStates.get(e);if(t){if(t.quality){if(!this.loadedQualities.get(t.quality)){Ye(`Cannot activate state ${e}: quality ${t.quality} not found`);return}}else if(Array.from(this.qualityStates.values()).some(n=>n.visible))return;if(this.loadedQualities.forEach(i=>{i.mesh.visible=!1}),this.qualityStates.forEach(i=>{i.visible=!1}),t.quality){const i=this.loadedQualities.get(t.quality);i&&(i.mesh.visible=!0,this.activeQuality=t.quality)}t.visible=!0,Ye(`Activated state: ${e}${t.quality?` (quality: ${t.quality})`:" (no quality assigned)"}`)}}getContainer(){return this.container}getLoadedQualities(){return Array.from(this.loadedQualities.keys())}getStates(){return Array.from(this.qualityStates.keys())}getStateQuality(e){var t;return((t=this.qualityStates.get(e))==null?void 0:t.quality)||null}getActiveState(){for(const[e,t]of this.qualityStates.entries())if(t.visible)return e;return null}getQuality(e){const t=this.loadedQualities.get(e);return t?{quality:e,mesh:t.mesh,meshQuality:t.meshQuality,visible:t.mesh.visible,materialQuality:t.materialQuality}:null}removeQualityLevel(e){const t=this.loadedQualities.get(e);t&&(this.container.remove(t.mesh),this.loadedQualities.delete(e),this.qualityStates.forEach((i,n)=>{i.quality===e&&this.qualityStates.delete(n)}))}removeState(e){this.qualityStates.delete(e)}disposeUnusedQualities(){const e=new Set;this.qualityStates.forEach(t=>{e.add(t.quality)}),this.loadedQualities.forEach((t,i)=>{e.has(i)||(t.material&&t.material.dispose(),t.mesh instanceof It&&(t.mesh.geometry.dispose(),Array.isArray(t.mesh.material)?t.mesh.material.forEach(n=>n.dispose()):t.mesh.material&&t.mesh.material.dispose()),this.container.remove(t.mesh),this.loadedQualities.delete(i))})}dispose(){this.loadedQualities.forEach((e,t)=>{e.material&&e.material.dispose(),e.mesh instanceof It&&(e.mesh.geometry.dispose(),Array.isArray(e.mesh.material)?e.mesh.material.forEach(i=>i.dispose()):e.mesh.material&&e.mesh.material.dispose()),this.container.remove(e.mesh)}),this.loadedQualities.clear(),this.qualityStates.clear()}}function CM(o){const e=new Map,t=new Map,i=o.clone();return cm(o,i,function(n,s){e.set(s,n),t.set(n,s)}),i.traverse(function(n){if(!n.isSkinnedMesh)return;const s=n,a=e.get(n),r=a.skeleton.bones;s.skeleton=a.skeleton.clone(),s.bindMatrix.copy(a.bindMatrix),s.skeleton.bones=r.map(function(l){return t.get(l)}),s.bind(s.skeleton,s.bindMatrix)}),i}function cm(o,e,t){t(o,e);for(let i=0;i<o.children.length;i++)cm(o.children[i],e.children[i],t)}class PM{constructor(e,t,i){g(this,"app");g(this,"key");g(this,"params");g(this,"lod");g(this,"models",new Map);g(this,"materials",new Map);g(this,"skeletonType",ns.CENTRE_POINT);g(this,"loadedMeshQualities",new Set);g(this,"visible",!0);g(this,"qualityManager");g(this,"cameraCollisionMesh",null);g(this,"collisionMeshStart",null);g(this,"collisionMeshEnd",null);g(this,"animatedCollisionMesh",null);g(this,"cameraAnimationData",null);g(this,"collisionMixer",null);g(this,"collisionAction",null);g(this,"collisionAnimationDuration",0);g(this,"skinnedAnimationController",null);g(this,"multiObjectAnimationPlayer",null);g(this,"cameraAnimationPlayer",null);g(this,"brightness",1);g(this,"normalStrength",1);g(this,"roughness",1);g(this,"metalness",0);g(this,"aoStrength",1);g(this,"container");g(this,"modelContainers",new Map);g(this,"cloneModel",e=>{let t=!1;return e.traverse(i=>{i instanceof Eo&&(t=!0)}),t?CM(e):e.clone()});g(this,"hasLODLevel",e=>this.qualityManager.getStates().includes(e));g(this,"isVisible",()=>this.visible);g(this,"setVisible",e=>{this.visible=e});this.app=e,this.key=t,this.params=i,this.container=new cn,this.params.models.forEach(n=>{const s=new cn;s.name=`${n.file}-model-container`;const a=new EM;s.add(a.getContainer()),this.container.add(s),this.modelContainers.set(n.file,{container:s,qualityManager:a})}),this.setupViewStates(),this.initQualityToggleTest()}setupViewStates(){this.modelContainers.forEach(({qualityManager:e})=>{e.createState("menuView"),e.createState("detailView"),e.activateState("menuView")})}async addLODLevel(e,t,i,n,s){this.hasMeshQuality(t)||await this.app.assetManager.loadAssetMeshes(this,[t],s),await this.app.assetManager.loadAssetMaterials(this,t,i,s);for(const a of this.params.models){const r=a.file,l=this.getModel(t,r),c=this.modelContainers.get(r);if(this.applyModelTransforms(c.container,a),l&&c){const h=this.cloneModel(l),d=this.getMaterial(r,t,i);d&&h.traverse(f=>{var p;f instanceof It&&(f.material=d,(p=this.params)!=null&&p.roughness&&(f.material.roughness=this.params.roughness),f.castShadow=!1,f.receiveShadow=!1,f.layers.set(1))}),c.qualityManager.addQualityLevel({quality:e,mesh:h,meshQuality:t,materialQuality:i})}}this.addLoadedMeshQuality(t)}async updateLODLevel(e,t){const i=this.qualityManager.getStateQuality(e);if(i&&(t.materialQuality&&(await this.app.assetManager.loadAssetMaterials(this,i,t.materialQuality),this.applyMaterialsToMeshes(i,t.materialQuality)),t.enabled!==void 0))if(t.enabled)this.qualityManager.activateState(e);else{const s=this.qualityManager.getStates().find(a=>a!==e);s&&this.qualityManager.activateState(s)}}hasMeshQuality(e){return this.loadedMeshQualities.has(e)}getLoadedMeshQualities(){return this.loadedMeshQualities}addLoadedMeshQuality(e){this.loadedMeshQualities.add(e)}getActiveMeshForModel(e){const t=this.modelContainers.get(e);if(!t)return null;const i=t.qualityManager.getActiveQuality();return i?i.mesh:null}async setupMaterial(e,t,i,n,s){const a=`${this.key}_${e}_${t}_${i}`;if(this.materials.has(a))return this.materials.get(a);const r=this.params.models.find(y=>y.file===e);if(!r||!r.textures)return;const c={tiny:[256,128,64],low:[512,256,128],med:[1024,512,256],high:[4096,2048,1024]}[i]||[512,256,128],h=y=>{const v=`${this.key}_${e}_${y}_${i}`;if(Ye(["Looking for texture:",{id:v,found:!!(n!=null&&n.find(S=>S.id===v))}]),n){const S=n.find(A=>A.id===v);if(S&&S.data instanceof Blob)return S.data;if(S&&S.data instanceof ArrayBuffer)return new Blob([S.data])}if(s){const S=s.get(v);if(S)return S}},d=r.textures.normal?this.getNormalMapPath(r.textures.normal,t):void 0,f={baseColor:r.textures.baseColor?{path:r.textures.baseColor,resolutions:c,encoding:void 0,generateMipmaps:!0,qualitySpecific:!1,preloadedData:h("baseColor")}:void 0,normal:d?{path:d,resolutions:c,encoding:void 0,generateMipmaps:!0,qualitySpecific:!0,preloadedData:h("normal")}:void 0,roughness:r.textures.roughness?{path:r.textures.roughness,resolutions:c,encoding:void 0,generateMipmaps:!1,qualitySpecific:!1,preloadedData:h("roughness")}:void 0,metallic:r.textures.metallic?{path:r.textures.metallic,resolutions:c,encoding:void 0,generateMipmaps:!1,qualitySpecific:!1,preloadedData:h("metallic")}:void 0,ao:r.textures.ao?{path:r.textures.ao,resolutions:c,encoding:void 0,generateMipmaps:!1,qualitySpecific:!1,preloadedData:h("ao")}:void 0},b=await this.app.assetManager.getMaterialManager().createMaterial(a,f,t,i);b.onBeforeCompile=y=>{var v;y.uniforms.dimFactor={value:((v=this==null?void 0:this.params)==null?void 0:v.brightness)??1},y.fragmentShader=`
          uniform float dimFactor;
          ${y.fragmentShader}
        `.replace("vec4 diffuseColor = vec4( diffuse, opacity );","vec4 diffuseColor = vec4( diffuse * dimFactor, opacity );"),b.userData.shader=y},b.customProgramCacheKey=()=>"dimFactor",b.needsUpdate=!0;const _={key:a,material:b};return this.materials.set(a,_),_}animateMaterialProperty(e){if(e!=null&&e.target)return e!=null&&e.duration||(e.duration=2e3),e!=null&&e.easing||(e.easing=kt.smoothstep),e!=null&&e.property||(e.property="BRIGHTNESS"),new Promise(t=>{const i=performance.now();this.materials.forEach(n=>{let s=0,a=null;switch(e.property){case"BRIGHTNESS":s=this.brightness,a=this.updateBrightness.bind(this);break;case"ROUGHNESS":s=this.roughness,a=this.updateRoughness.bind(this);break;case"METALNESS":s=this.metalness,a=this.updateMetalness.bind(this);break;case"NORMAL":s=this.normalStrength,a=this.updateNormalScale.bind(this);break;case"AO":s=this.aoStrength,a=this.updateAOIntensity.bind(this);break}const r=l=>{const c=l-i,h=Math.min(c/e.duration,1),d=e.easing(h),f=s+(e.target-s)*d;a(f),h<1?requestAnimationFrame(r):t()};requestAnimationFrame(r)})})}updateBrightness(e,t={}){this.brightness=e;const i=n=>{n.userData.shader&&(n.userData.shader.uniforms.dimFactor.value=this.brightness,t.skipUpdate||(n.needsUpdate=!0))};t.material?i(t.material):this.materials.forEach(({material:n})=>{i(n)})}animateBrightness(e,t=2e3,i=kt.smoothstep){this.animateMaterialProperty({property:"BRIGHTNESS",target:e,duration:t,easing:i})}updateRoughness(e,t={}){this.roughness=e;const i=n=>{n.roughness=Et.clamp(this.roughness,0,100),t.skipUpdate||(n.needsUpdate=!0)};t.material?i(t.material):this.materials.forEach(({material:n})=>{n instanceof Sn&&i(n)})}animateRoughness(e,t=2e3,i=kt.smoothstep){this.animateMaterialProperty({property:"ROUGHNESS",target:e,duration:t,easing:i})}updateMetalness(e,t={}){this.metalness=e;const i=n=>{n.metalness=Et.clamp(this.metalness,0,1),t.skipUpdate||(n.needsUpdate=!0)};t.material?i(t.material):this.materials.forEach(({material:n})=>{n instanceof Sn&&i(n)})}animateMetalness(e,t=2e3,i=kt.smoothstep){this.animateMaterialProperty({property:"METALNESS",target:e,duration:t,easing:i})}updateNormalScale(e,t={}){this.normalStrength=e;const i=n=>{n.normalMap&&(n.normalScale.set(this.normalStrength,this.normalStrength),t.skipUpdate||(n.needsUpdate=!0))};t.material?i(t.material):this.materials.forEach(({material:n})=>{n instanceof Sn&&i(n)})}animateNormalStrength(e,t=2e3,i=kt.smoothstep){this.animateMaterialProperty({property:"NORMAL",target:e,duration:t,easing:i})}updateAOIntensity(e,t={}){this.aoStrength=e;const i=n=>{n.aoMap&&(n.aoMapIntensity=Et.clamp(this.aoStrength,0,1),t.skipUpdate||(n.needsUpdate=!0))};t.material?i(t.material):this.materials.forEach(({material:n})=>{n instanceof Sn&&i(n)})}animateAOStrength(e,t=2e3,i=kt.smoothstep){this.animateMaterialProperty({property:"AO",target:e,duration:t,easing:i})}updateMaterialProperties(e){this.materials.forEach(({material:t})=>{if(!(t instanceof Sn))return;const i={skipUpdate:!0,material:t};e.brightness!==void 0&&this.updateBrightness(e.brightness,i),e.roughness!==void 0&&this.updateRoughness(e.roughness,i),e.metalness!==void 0&&this.updateMetalness(e.metalness,i),e.normalScale!==void 0&&this.updateNormalScale(e.normalScale,i),e.aoIntensity!==void 0&&this.updateAOIntensity(e.aoIntensity,i),t.needsUpdate=!0})}getNormalMapPath(e,t){var i;if(typeof e=="string")return e;if((i=e.quality)!=null&&i[t])return Ye(`Using quality-specific normal map for ${t}: ${e.quality[t]}`),e.quality[t];if(e.shared)return Ye(`No quality-specific normal map found for ${t}, using shared: ${e.shared}`),e.shared;throw new Error(`No normal map found for quality ${t} and no shared fallback available`)}updateViewStateQuality(e,t){let i=!0;return this.modelContainers.forEach(({qualityManager:n})=>{n.updateState(e,t)||(i=!1)}),i}applyMaterialsToMeshes(e,t){const i=this.qualityManager.getQuality(e);if(!i)return;const n=i.mesh;for(const s of this.params.models){const a=s.file,r=`${this.key}_${a}_${i.meshQuality}_${t}`,l=this.materials.get(r);if(!l)continue;const c=l.material,h=n.children.find(d=>d.name===a);if(!h){console.warn();continue}h.traverse(d=>{d instanceof It&&(d.material=c,d.castShadow=!0,d.receiveShadow=!0,d.layers.set(1))})}}getMaterial(e,t,i){var s;const n=`${this.key}_${e}_${t}_${i}`;return((s=this.materials.get(n))==null?void 0:s.material)||null}setModel(e,t,i){const n=new Set,s=new Set;i.traverse(a=>{a instanceof It&&(n.add(a.geometry),Array.isArray(a.material)?a.material.forEach(r=>s.add(r)):s.add(a.material))}),i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),this.models.has(e)||this.models.set(e,new Map),Ye(`Model contains ${n.size} unique geometries and ${s.size} unique materials`),this.models.get(e).set(t,i)}getModel(e,t){var i;return(i=this.models.get(e))==null?void 0:i.get(t)}setCameraCollisionMesh(e,t){if(!this.cameraCollisionMesh)if(t){this.collisionMeshStart=e.geometry.clone(),this.collisionMeshEnd=t.geometry.clone();const i=new qt({color:16776960,wireframe:!0,visible:!1,side:Ai});this.cameraCollisionMesh=e.clone(!0),this.cameraCollisionMesh.material=i,this.cameraCollisionMesh.position.copy(e.position),this.cameraCollisionMesh.rotation.copy(e.rotation),this.cameraCollisionMesh.scale.copy(e.scale),this.cameraCollisionMesh.userData.asset=this,this.container.add(this.cameraCollisionMesh);const n=new qt({color:255,wireframe:!0,transparent:!0,opacity:.2,side:Ai,visible:!1});e.material=n,this.container.add(e);const s=new qt({color:16711680,wireframe:!0,transparent:!0,opacity:.2,side:Ai,visible:!1});t.material=s,this.container.add(t)}else this.cameraCollisionMesh=e,this.cameraCollisionMesh.userData.asset=this,this.container.add(this.cameraCollisionMesh)}updateCollisionBlend(e){if(!this.collisionMeshStart||!this.collisionMeshEnd||!this.cameraCollisionMesh)return;const t=this.collisionMeshEnd.attributes.position,i=this.collisionMeshStart.attributes.position,n=this.cameraCollisionMesh.geometry.attributes.position,s=this.collisionMeshEnd.attributes.normal,a=this.collisionMeshStart.attributes.normal,r=this.cameraCollisionMesh.geometry.attributes.normal;for(let l=0;l<t.count;l++)n.setXYZ(l,Et.lerp(t.getX(l),i.getX(l),e),Et.lerp(t.getY(l),i.getY(l),e),Et.lerp(t.getZ(l),i.getZ(l),e)),r.setXYZ(l,Et.lerp(s.getX(l),a.getX(l),e),Et.lerp(s.getY(l),a.getY(l),e),Et.lerp(s.getZ(l),a.getZ(l),e));n.needsUpdate=!0,r.needsUpdate=!0}getCameraCollisionMesh(){return this.cameraCollisionMesh}setSkeletonType(e){this.skeletonType=e}getSkeletonType(){return this.skeletonType}updateOpacity(e){this.materials.forEach(({material:t})=>{t instanceof Vn&&(t.opacity=e,t.transparent=!0,t.needsUpdate=!0)})}dispose(){this.materials.forEach(({key:e})=>{this.app.assetManager.getMaterialManager().disposeMaterial(e)}),this.materials.clear(),this.models.clear(),this.qualityManager.dispose(),this.cameraCollisionMesh&&(this.cameraCollisionMesh.geometry.dispose(),this.cameraCollisionMesh.material instanceof Vn&&this.cameraCollisionMesh.material.dispose(),this.cameraCollisionMesh=null),this.collisionMixer&&(this.collisionMixer.stopAllAction(),this.collisionAction=null,this.collisionMixer=null),this.skeletonType=ns.CENTRE_POINT,this.loadedMeshQualities.clear()}findMesh(e){let t=null;return e.traverse(i=>{if(i.type==="Mesh"||i.type==="SkinnedMesh")return t=i,t}),t}createPrimitiveMesh(e){const t=new va(1,1,1),i=new Sn({color:16711680}),n=new It(t,i);e.position&&n.position.set(e.position.x,e.position.y,e.position.z),e.rotation&&n.rotation.set(di(e.rotation.x),di(e.rotation.y),di(e.rotation.z));const s=new cn;return s.add(n),s}async loadCameraCollisionMesh(){const{file:e,scale:t,transform:i}=this.params.cameraCollisionMesh;try{let n=await this.app.assetManager.loadModel(e,"Collision");const s=this.findMesh(n);if(!s)throw new Error("No mesh found in the base collision model");let a=null;try{let c=await this.app.assetManager.loadModel(e,"CollisionSpherical");a=this.findMesh(c)}catch{}t&&(s.scale.setScalar(t),a&&a.scale.setScalar(t));const l=new Hn().setFromObject(s).getCenter(new D);s.position.sub(l),a&&a.position.sub(l),i&&(i.position&&(s.position.set(i.position.x,i.position.y,i.position.z),a&&a.position.copy(s.position)),i.rotation&&(s.rotation.set(di(i.rotation.x),di(i.rotation.y),di(i.rotation.z)),a&&a.rotation.copy(s.rotation)),i.scale&&(typeof i.scale=="number"?(s.scale.setScalar(i.scale),a&&a.scale.setScalar(i.scale)):(s.scale.set(i.scale.x,i.scale.y,i.scale.z),a&&a.scale.copy(s.scale)))),s.material=new qt({color:16776960,wireframe:!0,visible:!1,side:Ai}),a&&(a.material=new qt({color:16711680,wireframe:!0,visible:!1,side:Ai})),this.setCameraCollisionMesh(s,a)}catch(n){console.error(`Error loading collision mesh for asset: ${this.key}`,n),this.createDefaultCollisionMesh()}}removeLODLevel(e){const t=this.qualityManager.getStateQuality(e);t&&(this.qualityManager.removeState(e),this.qualityManager.getStates().some(s=>this.qualityManager.getStateQuality(s)===t)||this.qualityManager.removeQualityLevel(t))}snapshotCollisionMesh(e){e.updateWorldMatrix(!0,!0);const t=new fi,i=e.geometry,n=i.attributes.position.clone(),s=new Float32Array(n.count*3),a=new D;for(let r=0;r<n.count;r++)a.fromBufferAttribute(n,r),a.applyMatrix4(e.matrixWorld),s[r*3]=a.x,s[r*3+1]=a.y,s[r*3+2]=a.z;if(t.setAttribute("position",new Ei(s,3)),i.index&&t.setIndex(i.index.clone()),this.cameraCollisionMesh)this.cameraCollisionMesh.geometry.dispose(),this.cameraCollisionMesh.geometry=t;else{const r=new qt({color:16776960,wireframe:!0,visible:!1,side:Ai});this.cameraCollisionMesh=new It(t,r),this.cameraCollisionMesh.userData.asset=this,this.container.add(this.cameraCollisionMesh)}}updateCollisionMeshAnimation(e){this.collisionMeshStart&&this.collisionMeshEnd&&this.updateCollisionBlend(e)}update(e){this.collisionMixer&&(this.collisionMixer.update(e),this.animatedCollisionMesh&&this.snapshotCollisionMesh(this.animatedCollisionMesh))}hasAnimatedCollision(){return this.collisionMeshStart!==null&&this.collisionMeshEnd!==null}setCameraAnimation(e,t,i){this.cameraAnimationData={data:e,file:t,type:i},Ye(`Camera animation set for asset: ${this.key}`)}getCameraAnimation(){return this.cameraAnimationData}hasCameraAnimation(){return this.params.cameraAnimation!==void 0&&this.params.cameraAnimation!==null}createDefaultCollisionMesh(){const e=new Wi(1,32,32),t=new qt({color:65280,wireframe:!0,side:Ai,visible:this.app.debugMode}),i=new It(e,t);i.visible=!1,this.setCameraCollisionMesh(i)}getQualityStates(){const e=Array.from(this.modelContainers.values())[0];return(e==null?void 0:e.qualityManager.getStates())||[]}setQualityState(e){this.modelContainers.forEach(({qualityManager:t})=>{t.activateState(e)})}getActiveState(){const e=Array.from(this.modelContainers.values())[0];return(e==null?void 0:e.qualityManager.getActiveState())||null}getActiveQuality(){const e=Array.from(this.modelContainers.values())[0];return(e==null?void 0:e.qualityManager.getActiveQuality())||null}getStateQuality(e){const t=Array.from(this.modelContainers.values())[0];return(t==null?void 0:t.qualityManager.getStateQuality(e))||null}applyModelTransforms(e,t){t.position&&e.position.set(t.position.x,t.position.y,t.position.z),t.rotation&&e.rotation.set(di(t.rotation.x),di(t.rotation.y),di(t.rotation.z)),t.scale&&(typeof t.scale=="number"?e.scale.setScalar(t.scale):e.scale.set(t.scale.x,t.scale.y,t.scale.z))}initQualityToggleTest(){window.addEventListener("keydown",e=>{e.key==="p"&&(this.getActiveState()==="menuView"?this.setQualityState("detailView"):this.setQualityState("menuView"))})}}class _f{static loadModel(e){return new Promise((t,i)=>{new Yl().load(e,s=>{t(s.scene)},void 0,i)})}static async loadGaussianSplatLibrary(){return await ep(()=>import("./gaussian-splats-3d.module-CSU3ntWD.js"),[])}static async loadSplat(e,t,i,n,s={}){const a=await this.loadGaussianSplatLibrary(),{position:r=[-40,-50,10],rotation:l=[0,0,0],scale:c=[500,500,500],progressiveLoad:h=!1,sphericalHarmonicsDegree:d=2,onReady:f=null,renderFunc:p=null}=s,b=new a.DropInViewer({renderer:n,camera:i,useBuiltInControls:!1,sphericalHarmonicsDegree:d,antialiased:!1,selfDrivenMode:!1,sceneRevealMode:a.SceneRevealMode.Instant,progressiveLoad:h,inMemoryCompressionLevel:2,optimizeSplatData:!0,freeIntermediateSplatData:!0,halfPrecisionCovariancesOnGPU:!0});return b.splatMesh.onSplatTreeReady(()=>{f&&f()}),b.addSplatScene(e,{position:r,rotation:l,scale:c,splatAlphaRemovalThreshold:20}).then(()=>{const _=b.splatMesh.material;_.onBeforeCompile=y=>{y.uniforms.dimFactor={value:1},y.fragmentShader=`
          uniform float dimFactor;
          ${y.fragmentShader}
          `.replace("vec3 color = vColor.rgb;","vec3 color = vColor.rgb * dimFactor;")},_.needsUpdate=!0}),b}static async loadSplatFromBuffer(e,t,i,n,s={}){const a=await this.loadGaussianSplatLibrary(),{position:r=[0,0,0],rotation:l=[0,0,0],scale:c=[500,500,500],progressiveLoad:h=!1,sphericalHarmonicsDegree:d=2,onReady:f=null,onError:p=null,renderFunc:b=null,maxRetries:_=3,retryDelay:y=2e3}=s,v=async()=>{const k=new D(0,0,0),U=5,C=256;let T;try{T=await a.SplatLoader.loadFromFileData(e,20,0,!0,0,k,U,C)}catch(z){throw console.error("SPLAT - Failed during SplatLoader.loadFromFileData:",z),z}const Z=new a.DropInViewer({renderer:n,camera:i,useBuiltInControls:!1,sphericalHarmonicsDegree:d,antialiased:!1,selfDrivenMode:!1,sceneRevealMode:a.SceneRevealMode.Instant,progressiveLoad:h,inMemoryCompressionLevel:2,optimizeSplatData:!0,freeIntermediateSplatData:!0,halfPrecisionCovariancesOnGPU:!0,gpuAcceleratedSort:!1,sharedMemoryForWorkers:!1,enableSIMDInSort:!1});try{let z=null;const B=new Promise((Y,J)=>{z=setTimeout(()=>{J(new Error("SPLAT - addSplatBuffers timed out after 30 seconds"))},3e4)});await Promise.race([Z.addSplatBuffers([T],[{splatAlphaRemovalThreshold:20,position:r,rotation:l,scale:c}],!0,!1,!1,!1,!1,!0),B]),clearTimeout(z),Z.position.set(-780,-50,10);const V=Z.splatMesh.material;V.onBeforeCompile=Y=>{Y.uniforms.dimFactor={value:1},Y.fragmentShader=`
          uniform float dimFactor;
          ${Y.fragmentShader}
          `.replace("vec3 color = vColor.rgb;","vec3 color = vColor.rgb * dimFactor;")},V.needsUpdate=!0}catch(z){throw z}return Z};let S=null;for(let A=1;A<=_;A++)try{return await v()}catch(E){S=E,A<_&&await new Promise(O=>setTimeout(O,y))}return p&&p(S),null}}class kM extends _w{constructor(e){super(e),this.type=Bs}parse(e){const a=function(U,C){switch(U){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(C||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(C||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(C||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(C||""))}},h=`
`,d=function(U,C,T){C=C||1024;let z=U.pos,B=-1,V=0,Y="",J=String.fromCharCode.apply(null,new Uint16Array(U.subarray(z,z+128)));for(;0>(B=J.indexOf(h))&&V<C&&z<U.byteLength;)Y+=J,V+=J.length,z+=128,J+=String.fromCharCode.apply(null,new Uint16Array(U.subarray(z,z+128)));return-1<B?(U.pos+=V+B+1,Y+J.slice(0,B)):!1},f=function(U){const C=/^#\?(\S+)/,T=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,z=/^\s*FORMAT=(\S+)\s*$/,B=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,V={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Y,J;for((U.pos>=U.byteLength||!(Y=d(U)))&&a(1,"no header found"),(J=Y.match(C))||a(3,"bad initial token"),V.valid|=1,V.programtype=J[1],V.string+=Y+`
`;Y=d(U),Y!==!1;){if(V.string+=Y+`
`,Y.charAt(0)==="#"){V.comments+=Y+`
`;continue}if((J=Y.match(T))&&(V.gamma=parseFloat(J[1])),(J=Y.match(Z))&&(V.exposure=parseFloat(J[1])),(J=Y.match(z))&&(V.valid|=2,V.format=J[1]),(J=Y.match(B))&&(V.valid|=4,V.height=parseInt(J[1],10),V.width=parseInt(J[2],10)),V.valid&2&&V.valid&4)break}return V.valid&2||a(3,"missing format specifier"),V.valid&4||a(3,"missing image size specifier"),V},p=function(U,C,T){const Z=C;if(Z<8||Z>32767||U[0]!==2||U[1]!==2||U[2]&128)return new Uint8Array(U);Z!==(U[2]<<8|U[3])&&a(3,"wrong scanline width");const z=new Uint8Array(4*C*T);z.length||a(4,"unable to allocate buffer space");let B=0,V=0;const Y=4*Z,J=new Uint8Array(4),Te=new Uint8Array(Y);let ge=T;for(;ge>0&&V<U.byteLength;){V+4>U.byteLength&&a(1),J[0]=U[V++],J[1]=U[V++],J[2]=U[V++],J[3]=U[V++],(J[0]!=2||J[1]!=2||(J[2]<<8|J[3])!=Z)&&a(3,"bad rgbe scanline format");let fe=0,he;for(;fe<Y&&V<U.byteLength;){he=U[V++];const pe=he>128;if(pe&&(he-=128),(he===0||fe+he>Y)&&a(3,"bad scanline data"),pe){const ve=U[V++];for(let K=0;K<he;K++)Te[fe++]=ve}else Te.set(U.subarray(V,V+he),fe),fe+=he,V+=he}const Q=Z;for(let pe=0;pe<Q;pe++){let ve=0;z[B]=Te[pe+ve],ve+=Z,z[B+1]=Te[pe+ve],ve+=Z,z[B+2]=Te[pe+ve],ve+=Z,z[B+3]=Te[pe+ve],B+=4}ge--}return z},b=function(U,C,T,Z){const z=U[C+3],B=Math.pow(2,z-128)/255;T[Z+0]=U[C+0]*B,T[Z+1]=U[C+1]*B,T[Z+2]=U[C+2]*B,T[Z+3]=1},_=function(U,C,T,Z){const z=U[C+3],B=Math.pow(2,z-128)/255;T[Z+0]=Yo.toHalfFloat(Math.min(U[C+0]*B,65504)),T[Z+1]=Yo.toHalfFloat(Math.min(U[C+1]*B,65504)),T[Z+2]=Yo.toHalfFloat(Math.min(U[C+2]*B,65504)),T[Z+3]=Yo.toHalfFloat(1)},y=new Uint8Array(e);y.pos=0;const v=f(y),S=v.width,A=v.height,E=p(y.subarray(y.pos),S,A);let O,R,k;switch(this.type){case Tn:k=E.length/4;const U=new Float32Array(k*4);for(let T=0;T<k;T++)b(E,T*4,U,T*4);O=U,R=Tn;break;case Bs:k=E.length/4;const C=new Uint16Array(k*4);for(let T=0;T<k;T++)_(E,T*4,C,T*4);O=C,R=Bs;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:S,height:A,data:O,header:v.string,gamma:v.gamma,exposure:v.exposure,type:R}}setDataType(e){return this.type=e,this}load(e,t,i,n){function s(a,r){switch(a.type){case Tn:case Bs:a.colorSpace=Vi,a.minFilter=wi,a.magFilter=wi,a.generateMipmaps=!1,a.flipY=!0;break}t&&t(a,r)}return super.load(e,s,i,n)}}class IM{constructor(){g(this,"materials",new Map);g(this,"textureLoader");g(this,"loadedTextures",new Map);g(this,"qualityPresets",[{name:"ultra",baseColorRes:4096,normalRes:4096,roughnessRes:4096,metallicRes:4096,aoRes:4096},{name:"high",baseColorRes:2048,normalRes:2048,roughnessRes:1024,metallicRes:1024,aoRes:1024},{name:"med",baseColorRes:1024,normalRes:1024,roughnessRes:512,metallicRes:512,aoRes:512},{name:"low",baseColorRes:512,normalRes:512,roughnessRes:256,metallicRes:256,aoRes:256},{name:"tiny",baseColorRes:256,normalRes:256,roughnessRes:256,metallicRes:128,aoRes:128},{name:"minimum",baseColorRes:128,normalRes:128,roughnessRes:128,metallicRes:128,aoRes:128}]);this.textureLoader=new nc}async loadTexture(e,t,i){try{if(Ye(["loadTexture called:",{path:e,resolution:t,hasPreloadedData:!!i.preloadedData}]),i.preloadedData){Ye("Using preloaded data for texture");const a=URL.createObjectURL(i.preloadedData),r=await this.textureLoader.loadAsync(a);return URL.revokeObjectURL(a),r}let n=e;e.includes("letter")&&(n=`/fit-in/${e}`);const s=Un(n,0,t);return await this.textureLoader.loadAsync(s)}catch(n){return console.warn(`Failed to load texture at resolution ${t}: ${e}`,n),null}}async loadTextureAtResolution(e,t,i){Ye(`Loading texture at resolution ${t}: ${e.path}`);const n=await this.loadTexture(e.path,t,{encoding:e.encoding||void 0,generateMipmaps:e.generateMipmaps??!0,preloadedData:e.preloadedData});return n?(n.encoding=e.encoding||void 0,Ye(`Texture encoding set to: ${n.encoding}`),n.flipY=!1,n.generateMipmaps=e.generateMipmaps??!0,n.minFilter=is,n.magFilter=wi,i?(Ye(`Updating existing texture for ${e.path}`),i.image=n.image,i.needsUpdate=!0,n.dispose(),i):(Ye(`Creating new texture for ${e.path}`),n.needsUpdate=!0,n)):(Ye(`Failed to load texture: ${e.path}`),i||null)}async createMaterial(e,t,i,n="low"){if(this.materials.has(e))return this.materials.get(e);const s=new Sn({transparent:!0});s.userData.textureSet=t,s.userData.meshQuality=i,s.side=Ai,e.includes("letter")&&(s.transparent=!0,s.depthWrite=!0,s.alphaTest=.5),s.needsUpdate=!0;const a=this.getQualityPreset(n)||this.getQualityPreset("low");return await this.updateMaterialTextures(s,t,i,a),this.materials.set(e,s),s}async loadAdditionalQuality(e,t,i){const n=this.materials.get(e);if(!n)return;const s=this.getQualityPreset(t);if(!s)return;const a=n.userData.textureSet;if(!a)return;const r=n.userData.meshQuality,l=i||["baseColor","normal","roughness","metallic","ao"];await this.updateMaterialTextures(n,a,r,s,l)}getQualityPreset(e){return this.qualityPresets.find(t=>t.name.toLowerCase()===e.toLowerCase())||null}async updateMaterialTextures(e,t,i,n,s=["baseColor","normal","roughness","metallic","ao"]){Ye(`Starting texture update for quality level: ${n.name}`);for(const a of s){const r=t[a];if(!r)continue;const l=n[`${a}Res`];let c,h;switch(a){case"baseColor":c="map",h=void 0;break;case"normal":c="normalMap",h=void 0;break;case"roughness":c="roughnessMap",h=void 0;break;case"metallic":c="metalnessMap",h=void 0;break;case"ao":c="aoMap",h=void 0;break;default:continue}const d=e[c],f={...r,encoding:h};try{const p=await this.loadTextureAtResolution(f,l,d||void 0);p?(Ye("- Successfully loaded new texture","texture"),e[c]=p,Ye(`- Assigned texture to material.${c}`,"texture"),a==="normal"?e.normalScale.set(1,1):a==="roughness"?e.roughness=1:a==="metallic"||a==="ao"&&(e.aoMapIntensity=1)):Ye("- Failed to load new texture","error")}catch{}}e.needsUpdate=!0,this.debugMaterialState(e)}debugMaterialState(e){Ye({map:e.map?"loaded":"not loaded",normalMap:e.normalMap?"loaded":"not loaded",roughnessMap:e.roughnessMap?"loaded":"not loaded",metalnessMap:e.metalnessMap?"loaded":"not loaded",aoMap:e.aoMap?"loaded":"not loaded",needsUpdate:e.needsUpdate,transparent:e.transparent,opacity:e.opacity})}async loadQualities(e,t,i){for(const n of t)await this.loadAdditionalQuality(e,n),i&&i(n)}getMaterial(e){return this.materials.get(e)||null}getCurrentQuality(e){const t=this.materials.get(e);if(!t)return null;const i=t.map;if(!i||!i.image)return null;const n=i.image.width,s=this.qualityPresets.find(a=>a.baseColorRes===n);return s?s.name:null}getLoadedResolutions(e){var i,n,s,a,r,l,c,h,d,f;const t=this.materials.get(e);return t?{baseColor:((n=(i=t.map)==null?void 0:i.image)==null?void 0:n.width)||null,normal:((a=(s=t.normalMap)==null?void 0:s.image)==null?void 0:a.width)||null,roughness:((l=(r=t.roughnessMap)==null?void 0:r.image)==null?void 0:l.width)||null,metallic:((h=(c=t.metalnessMap)==null?void 0:c.image)==null?void 0:h.width)||null,ao:((f=(d=t.aoMap)==null?void 0:d.image)==null?void 0:f.width)||null}:{}}updateMaterialProperty(e,t,i){const n=this.materials.get(e);n&&t in n&&(n[t]=i,n.needsUpdate=!0)}setEnvMapIntensity(e,t){const i=this.materials.get(e);i&&(i.envMapIntensity=t,i.needsUpdate=!0)}disposeMaterial(e){const t=this.materials.get(e);if(!t)return;[t.map,t.normalMap,t.roughnessMap,t.metalnessMap,t.aoMap].forEach(n=>{n&&n.dispose()}),t.dispose(),this.materials.delete(e)}disposeAll(){Array.from(this.materials.keys()).forEach(t=>this.disposeMaterial(t)),this.loadedTextures.clear()}}var Ii=(o=>(o.MODEL="model",o.TEXTURE="texture",o.AUDIO="audio",o.IMAGE="image",o.SPLAT="splat",o.HDRI="hdri",o))(Ii||{});class nu{constructor(e){g(this,"name");g(this,"maxRetries");g(this,"retryDelay");g(this,"priority");g(this,"speedSampleSize",5);g(this,"speedUpdateInterval",100);g(this,"lastSpeedMeasurementTime",0);g(this,"manualComplete");g(this,"parentGroup",null);g(this,"debug",!1);g(this,"assets",[]);g(this,"sortedAssets");g(this,"processedAssets",new Set);g(this,"loadedAssets",[]);g(this,"assetsFinished",!1);g(this,"errors",[]);g(this,"children",[]);g(this,"status","pending");g(this,"loadStartTime",0);g(this,"loadEndTime",0);g(this,"totalBytes",0);g(this,"loadedBytes",0);g(this,"sizesInitialised",!1);g(this,"speedMeasurements",[]);g(this,"lastETRs",[]);g(this,"etrHistorySize",10);g(this,"etrStabilityThreshold",.5);g(this,"onProgress");g(this,"onComplete");g(this,"onAssetLoaded");g(this,"onError");g(this,"readyToComplete",!1);g(this,"manuallyCompleted",!1);g(this,"progressUpdateInterval",100);g(this,"lastProgressUpdateTime",0);g(this,"load",async()=>{if(this.status="loading",this.errors=[],this.loadStartTime=performance.now(),!this.sizesInitialised){const n=await this.calculateTotalSizesRecursive();this.totalBytes=n,this.sizesInitialised=!0}const e=[];for(const n of this.sortedAssets)e.push({type:"asset",priority:n.config.priority||0,item:n});for(const n of this.children)e.push({type:"group",priority:n.getPriority(),item:n});const t=new Map;for(const n of e)t.has(n.priority)||t.set(n.priority,[]),t.get(n.priority).push({type:n.type,item:n.item});const i=Array.from(t.keys()).sort((n,s)=>s-n);for(const n of i){const s=t.get(n);await Promise.all(s.map(async a=>{var r;if(a.type==="asset"){const l=a.item,c=(r=Array.from(this.assets.entries()).find(([h,d])=>d===l))==null?void 0:r[0];if(!c)return;if(l.status!=="complete")try{await this.loadAsset(c,l)}catch(h){this.handleAssetError(c,l,h)}}else{const l=a.item;await l.load(),l.getStatus()==="complete"&&this.loadedAssets.push(...l.getLoadedAssets())}}))}this.assetsFinished=!0,this.checkForCompletion()});g(this,"finaliseLoad",()=>{this.loadEndTime=performance.now(),this.children.forEach(e=>{this.errors.push(...e.getErrors())}),this.onComplete&&(this.onComplete(this.loadedAssets,this),this.loadedAssets.forEach(e=>{this.processedAssets.add(e.id)})),this.readyToComplete=!0,(!this.manualComplete||this.manuallyCompleted)&&this.completeGroup(),this.checkChildrenCompletion()});g(this,"loadAsset",async(e,t)=>{t.status="loading",Ye(`Loading asset: ${e} (${t.config.type})`);let i=0;for(;i<=this.maxRetries;)try{const n=await this.fetchAssetData(e,t.config.url),s={id:e,type:t.config.type,data:n,options:t.config.options};this.atomicAddLoadedAsset(s),t.status="complete",Ye(`Asset loaded: ${e}`,"asset-complete");return}catch(n){if(i++,i<=this.maxRetries)Ye(`Retrying asset: ${e} (attempt ${i}/${this.maxRetries})`),await new Promise(s=>setTimeout(s,this.retryDelay));else throw this.handleAssetError(e,t,n),n}});g(this,"fetchAssetData",async(e,t)=>{var c;const n=(c=(await fetch(t)).body)==null?void 0:c.getReader(),s=[];if(!n)throw new Error("Failed to get reader for response body");let a=0;for(;;){const{done:h,value:d}=await n.read();if(h)break;s.push(d),a+=d.length,this.updateLoadProgress(d.length,e)}const r=new Uint8Array(a);let l=0;for(const h of s)r.set(h,l),l+=h.length;return this.processAssetData(r,e)});g(this,"processAssetData",async(e,t)=>{const i=this.assets.get(t);if(!i)throw new Error(`Asset not found: ${t}`);switch(i.config.type){case"model":case"audio":case"splat":case"texture":case"hdri":return e.buffer;case"image":{const n=new Blob([e]),s=URL.createObjectURL(n);return await this.loadImageAssetFromBlob(s)}default:throw new Error(`Unsupported asset type: ${i.config.type}`)}});g(this,"loadImageAssetFromBlob",async e=>new Promise((t,i)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{const s=document.createElement("canvas");s.width=n.naturalWidth,s.height=n.naturalHeight;const a=s.getContext("2d");if(a){a.drawImage(n,0,0);const r=new Image;r.crossOrigin="anonymous",r.src=s.toDataURL("image/jpeg",.92),r.onload=()=>{URL.revokeObjectURL(e),t(r)},r.onerror=i}else i(new Error("Failed to get canvas context"))},n.onerror=s=>{URL.revokeObjectURL(e),i(s)},n.src=e}));g(this,"atomicAddLoadedAsset",e=>{this.loadedAssets.push(e),this.onAssetLoaded&&this.onAssetLoaded(e,this),this.handleChildProgress()});g(this,"getAssets",()=>this.assets);g(this,"getProgress",()=>{const{totalLoadedAssets:e,totalAssets:t,totalBytesLoaded:i,totalBytes:n}=this.calculateAggregatedStats(),s=this.calculateAggregateETR();return{groupName:this.name,loaded:e,total:t,percentage:n>0?i/n*100:0,currentAsset:this.getCurrentLoadingAsset(),bytesLoaded:i,totalBytes:n,currentSpeed:this.calculateAggregateCurrentSpeed(),averageSpeed:this.calculateAggregateAverageSpeed(),estimatedTimeRemaining:s.raw,stableEstimatedTimeRemaining:s.stable}});g(this,"getCurrentLoadingAsset",()=>{const e=Array.from(this.assets.entries()).find(([,t])=>t.status==="loading");if(e)return e[0];for(const t of this.children){const i=t.getProgress();if(i.currentAsset)return i.currentAsset}});g(this,"getLoadDuration",()=>this.loadStartTime===0?0:(this.loadEndTime||performance.now())-this.loadStartTime);g(this,"handleAssetError",(e,t,i)=>{t.status="error",this.errors.push({assetId:e,type:t.config.type,error:i,attempts:t.attempts}),this.onError&&this.onError(this.errors,this)});g(this,"getErrors",()=>this.errors);g(this,"getStatus",()=>this.manualComplete&&!this.manuallyCompleted?"loading":this.status);g(this,"cleanup",(e=5e3)=>{Ye(`Cleanup scheduled for load group "${this.getName()}" in ${e}ms`),setTimeout(()=>{this.loadedAssets.forEach(t=>{if(this.processedAssets.has(t.id))switch(Ye(`Cleaning up asset: ${t.id}`),t.type){case"image":t.data instanceof ImageBitmap&&t.data.close();break;case"splat":case"model":case"audio":t.data=null;break;case"texture":case"hdri":t.data instanceof Blob&&URL.revokeObjectURL(URL.createObjectURL(t.data));break}}),this.loadedAssets=[],this.processedAssets.clear(),this.parentGroup=null,this.children.forEach(t=>t.cleanup(e)),Ye(`Load group "${this.getName()}" assets cleaned up.`)},e)});g(this,"getName",()=>this.name);g(this,"getPriority",()=>this.priority);this.name=e.name,this.maxRetries=e.maxRetries??3,this.retryDelay=e.retryDelay??1e3,this.priority=e.priority??0,this.manualComplete=e.manualComplete??!1,this.debug=e.debug??!1,this.onProgress=e.onProgress,this.onComplete=e.onComplete,this.onAssetLoaded=e.onAssetLoaded,this.onError=e.onError,e.assets=(e==null?void 0:e.assets)??[],this.assets=new Map,e.assets.forEach(t=>{this.assets.set(t.id,{config:t,status:"pending",attempts:0})}),this.sortedAssets=Array.from(this.assets.values()).sort((t,i)=>(i.config.priority||0)-(t.config.priority||0)),e.children&&e.children.length>0&&(this.children=e.children.map(t=>{const i=new nu({...t,debug:(t==null?void 0:t.debug)??this.debug});i.parentGroup=this;const n=i.onProgress;i.onProgress=(l,c)=>{n&&n(l,c),this.handleChildProgress()};const s=i.onComplete;i.onComplete=(l,c)=>{if(s&&s(l,c),c.getStatus()==="complete"){const h=new Set(this.loadedAssets.map(f=>f.id)),d=l.filter(f=>!h.has(f.id));this.loadedAssets.push(...d),this.assetsFinished&&this.checkForCompletion()}};const a=i.onError;i.onError=(l,c)=>{a&&a(l,c),this.errors.push(...l),this.handleChildProgress()};const r=i.onAssetLoaded;return i.onAssetLoaded=(l,c)=>{r&&r(l,c),this.handleChildProgress()},i}))}checkForCompletion(){this.debug&&this.outputDebug("Checking for completion"),this.assetsFinished&&this.children.every(e=>e.getStatus()==="complete")&&this.finaliseLoad()}markAsComplete(){if(!this.manualComplete){console.warn("Attempted to manually complete a load group that doesn't have manual completion enabled");return}if(!this.readyToComplete){console.warn("Attempted to manually complete a load group before assets finished loading");return}this.manuallyCompleted=!0,this.completeGroup(),this.parentGroup&&this.parentGroup.checkForCompletion()}checkChildrenCompletion(){if(this.children.length===0)return;this.children.every(t=>t.getStatus()==="complete")&&this.readyToComplete&&(!this.manualComplete||this.manuallyCompleted)&&this.completeGroup()}completeGroup(){this.status=this.errors.length>0?"error":"complete"}isReadyForCompletion(){return this.readyToComplete&&!this.manuallyCompleted&&this.manualComplete}async calculateTotalSizesRecursive(){if(this.sizesInitialised)return this.totalBytes;const e=Array.from(this.assets.values()).map(async s=>{try{const a=await fetch(s.config.url,{method:"HEAD"});return Number(a.headers.get("Content-Length"))||0}catch(a){return console.warn(`Could not get size for ${s.config.id}:`,a),0}}),i=(await Promise.all(e)).reduce((s,a)=>s+a,0);let n=0;for(const s of this.children){const a=await s.calculateTotalSizesRecursive();n+=a}return this.totalBytes=i+n,this.sizesInitialised=!0,this.totalBytes}updateLoadProgress(e,t){this.loadedBytes+=e;const i=performance.now();i-this.lastSpeedMeasurementTime>=this.speedUpdateInterval&&(this.recordSpeedMeasurement(i),this.lastSpeedMeasurementTime=i,this.handleChildProgress())}recordSpeedMeasurement(e){this.speedMeasurements.push({timestamp:e,bytes:this.loadedBytes}),this.speedMeasurements.length>this.speedSampleSize&&this.speedMeasurements.shift()}calculateCurrentSpeed(){if(this.speedMeasurements.length<2)return 0;const e=this.speedMeasurements[0],t=this.speedMeasurements[this.speedMeasurements.length-1],i=(t.timestamp-e.timestamp)/1e3,n=t.bytes-e.bytes;return i>0?n/i:0}calculateAverageSpeed(){if(this.loadStartTime===0)return 0;const e=(performance.now()-this.loadStartTime)/1e3;return e>0?this.loadedBytes/e:0}calculateEstimatedTimeRemaining(e){return e===0?1/0:(this.totalBytes-this.loadedBytes)/e*1e3}calculateAggregatedStats(){const e=this.loadedAssets.length,t=this.assets.size,i=this.loadedBytes,n=this.totalBytes;let s=0,a=0,r=0;for(const f of this.children){const p=f.getProgress();s+=p.loaded,a+=p.total,r+=p.bytesLoaded||0}const l=e+s,c=t+a,h=i+r;return{totalLoadedAssets:l,totalAssets:c,totalBytesLoaded:h,totalBytes:n}}calculateAggregateCurrentSpeed(){let t=this.calculateCurrentSpeed()*this.loadedBytes,i=this.loadedBytes;for(const s of this.children){const a=s.getProgress(),r=a.currentSpeed||0,l=a.bytesLoaded||0;t+=r*l,i+=l}return i===0?0:t/i}calculateAggregateAverageSpeed(){let t=this.calculateAverageSpeed()*this.loadedBytes,i=this.loadedBytes;for(const n of this.children){const s=n.getProgress(),a=s.averageSpeed||0,r=s.bytesLoaded||0;t+=a*r,i+=r}return i===0?0:t/i}calculateStableETR(e){if(this.lastETRs.length===0)return this.lastETRs.push(e),e;const t=this.lastETRs[0];if(e<t)return this.lastETRs=[e],e;if((e-t)/t>this.etrStabilityThreshold)return this.lastETRs=[e],e;if(e>t){if(this.lastETRs.push(e),this.lastETRs.length>=this.etrHistorySize&&this.lastETRs.every(s=>s>t))return this.lastETRs=[e],e;this.lastETRs.length>this.etrHistorySize&&this.lastETRs.shift()}return t}calculateAggregateETR(){const e=this.calculateAggregateCurrentSpeed();if(e===0)return{raw:1/0,stable:1/0};const{totalBytes:t,totalBytesLoaded:i}=this.calculateAggregatedStats(),s=(t-i)/e*1e3,a=this.calculateStableETR(s);return{raw:s,stable:a}}handleChildProgress(){if(!this.onProgress)return;const e=performance.now();if(e-this.lastProgressUpdateTime<this.progressUpdateInterval)return;const t=this.getProgress();this.onProgress(t,this),this.lastProgressUpdateTime=e}getLoadedAssets(){return this.loadedAssets}getAggregateBytesLoaded(){const{totalBytesLoaded:e}=this.calculateAggregatedStats();return e}outputDebug(e="",t=""){let i="";e&&(i+=`${t}${e}
`),i+=`${t}LoadGroup: ${this.getName()}
`,i+=`${t}Status: ${this.getStatus()}
`;const n=this.getProgress();i+=`${t}Progress: ${n.percentage.toFixed(2)}%
`,i+=`${t}Assets Loaded: ${n.loaded}/${n.total}
`,i+=`${t}Bytes: ${n.bytesLoaded}/${n.totalBytes}
`,n.currentAsset&&(i+=`${t}Currently Loading: ${n.currentAsset}
`);const s=this.getAssets();s.size>0&&(i+=`${t}Assets:
`,s.forEach((r,l)=>{i+=`${t}  - ${l} (${r.config.type}): ${r.status}
`}));const a=this.getErrors();return a.length>0&&(i+=`${t}Errors:
`,a.forEach(r=>{i+=`${t}  - ${r.assetId}: ${r.error.message} (${r.attempts} attempts)
`})),this.isReadyForCompletion()&&(i+=`${t}WARNING: Group requires manual completion and is ready but not completed
`),this.children.length>0&&(i+=`${t}Child Groups:
`,this.children.forEach(r=>{i+=r.outputDebug("",t+"  ")})),i}}class LM{constructor(e){g(this,"assetManager");g(this,"queue",[]);g(this,"completedGroups",new Map);g(this,"loading",!1);g(this,"addGroup",e=>{const t=new nu(e);this.queue.push(t),this.queue.sort((i,n)=>n.getPriority()-i.getPriority()),this.processQueue()});g(this,"processQueue",async()=>{if(this.loading||this.queue.length===0)return;this.loading=!0;const e=this.queue.shift();if(e)try{await e.load(this.assetManager),this.completedGroups.set(e.getName(),e)}catch(t){console.error(`Error loading group ${e.getName()}:`,t)}this.loading=!1,this.processQueue()});g(this,"getGroupProgress",e=>{const t=this.queue.find(i=>i.getName()===e);return t==null?void 0:t.getProgress()});g(this,"getAllProgress",()=>{const e={};return this.queue.forEach(t=>{e[t.getName()]=t.getProgress()}),e});g(this,"cleanupGroup",(e,t=3,i=5e3)=>{const n=this.completedGroups.get(e);if(!n){t>0&&setTimeout(()=>this.cleanupGroup(e,t-1,i),100);return}n.cleanup(i),this.completedGroups.delete(e)});g(this,"cleanupAllGroups",(e=5e3)=>{this.completedGroups.forEach(t=>{t.cleanup(e)}),this.completedGroups.clear()});this.assetManager=e}}class Dr{constructor(e,t,i){g(this,"isActive",!1);g(this,"controlsEnabled",!0);g(this,"camera");g(this,"cameraParentGroup");g(this,"cameraTarget");g(this,"mixer",null);g(this,"animations",[]);g(this,"currentAction",null);g(this,"debugging",!1);g(this,"animationDuration",0);g(this,"fps",25);g(this,"currentFrameIndex",0);g(this,"unitScale",50);g(this,"originalAnimationClip",null);g(this,"scene");g(this,"callbacks");g(this,"gltf",null);g(this,"allAnimationClips",[]);g(this,"frameOffset",0);g(this,"offsetSeconds",0);g(this,"currentFocalLength",35);g(this,"focalLengthScale",100);g(this,"userOffsetEnabled",!0);g(this,"cameraOffsetGroup");g(this,"userOffset",new D);g(this,"targetUserOffset",new D);g(this,"maxOffsetDistance",5);g(this,"offsetEasing",.9);g(this,"isDragging",!1);g(this,"previousMousePosition",new et);g(this,"mouseOffsetSensitivity",.01);g(this,"returnToCentre",!0);g(this,"returnDelay",50);g(this,"returnSpeed",.05);g(this,"lastInteractionTime",0);g(this,"lastScrollTime",0);g(this,"isReturning",!1);g(this,"scrollSensitivity",.01);g(this,"zOffset",0);g(this,"targetZOffset",0);g(this,"maxZOffset",7.5);g(this,"lastScrollDelta",null);g(this,"syntheticScrollCount",0);g(this,"syntheticScrollThreshold",40);g(this,"pinchStartDistance",null);g(this,"lastScrollDirPositive",null);g(this,"activeKeys",new Set);g(this,"keyboardSensitivity",1.5);g(this,"keyboardAnimationId",null);g(this,"keyboardInvertX",!1);g(this,"keyboardInvertY",!1);g(this,"boundOnMouseDown",this.onMouseDown.bind(this));g(this,"boundOnMouseMove",this.onMouseMove.bind(this));g(this,"boundOnMouseUp",this.onMouseUp.bind(this));g(this,"boundOnScroll",this.onScroll.bind(this));g(this,"boundOnTouchStart",this.onTouchStart.bind(this));g(this,"boundOnTouchMove",this.onTouchMove.bind(this));g(this,"boundOnTouchEnd",this.onTouchEnd.bind(this));g(this,"boundOnKeyDown",this.onKeyDown.bind(this));g(this,"boundOnKeyUp",this.onKeyUp.bind(this));this.camera=e,this.scene=t,this.debugging=(i==null?void 0:i.debug)||!1,i!=null&&i.callbacks?this.callbacks=i.callbacks:this.callbacks={},this.cameraParentGroup=new cn,this.cameraTarget=new ri,this.cameraOffsetGroup=new ri,this.cameraParentGroup.name="CameraAnimationGroup",this.cameraTarget.name="CameraTarget",this.cameraOffsetGroup.name="CameraOffsetGroup",this.cameraParentGroup.add(this.cameraTarget),this.cameraTarget.add(this.cameraOffsetGroup),this.scene.add(this.cameraParentGroup),this.initOffsetControls()}async loadAnimation(e){try{let t;if(typeof e=="string"?t=await new Yl().loadAsync(e):t=e,this.gltf=t,this.allAnimationClips=t.animations,this.animations=t.animations,this.animations.length===0)throw new Error("No animations found in GLB file");this.animations=[this.allAnimationClips[0]],this.originalAnimationClip=this.allAnimationClips[0],this.debugging&&(Ye(`Found ${this.allAnimationClips.length} animation clips in GLB file:`,"camera-animation"),this.allAnimationClips.forEach((i,n)=>{Ye(`Animation #${n}: "${i.name}" - ${i.duration}s, ${i.tracks.length} tracks`,"camera-animation")}),Ye(["Animation tracks:",this.originalAnimationClip.tracks.map(i=>({name:i.name,valueSize:i.getValueSize(),times:i.times.length,values:i.values.length}))],"camera-animation")),this.animationDuration=this.originalAnimationClip.duration,this.debugging&&Ye(["Animation loaded:",{duration:this.animationDuration,totalFrames:this.getTotalFrames(),fps:this.fps,tracks:this.originalAnimationClip.tracks.length}],"camera-animation")}catch{}}initKeyboardControls(){document.addEventListener("keydown",this.boundOnKeyDown),document.addEventListener("keyup",this.boundOnKeyUp)}initOffsetControls(){document.addEventListener("mousedown",this.boundOnMouseDown),document.addEventListener("mousemove",this.boundOnMouseMove),document.addEventListener("mouseup",this.boundOnMouseUp),document.addEventListener("mouseleave",this.boundOnMouseUp),document.addEventListener("wheel",this.boundOnScroll,{passive:!1}),document.addEventListener("touchstart",this.boundOnTouchStart),document.addEventListener("touchmove",this.boundOnTouchMove),document.addEventListener("touchend",this.boundOnTouchEnd),this.initKeyboardControls()}removeKeyboardControls(){document.removeEventListener("keydown",this.boundOnKeyDown),document.removeEventListener("keyup",this.boundOnKeyUp),this.keyboardAnimationId&&(cancelAnimationFrame(this.keyboardAnimationId),this.keyboardAnimationId=null),this.activeKeys.clear()}removeOffsetControls(){document.removeEventListener("mousedown",this.boundOnMouseDown),document.removeEventListener("mousemove",this.boundOnMouseMove),document.removeEventListener("mouseup",this.boundOnMouseUp),document.removeEventListener("mouseleave",this.boundOnMouseUp),document.removeEventListener("wheel",this.boundOnScroll),document.removeEventListener("touchstart",this.boundOnTouchStart),document.removeEventListener("touchmove",this.boundOnTouchMove),document.removeEventListener("touchend",this.boundOnTouchEnd),this.removeKeyboardControls()}setUserOffset(e){this.userOffsetEnabled=e}setAutoReturn(e){this.returnToCentre=e,e||(this.isReturning=!1)}setReturnDelay(e){this.returnDelay=e}setReturnSpeed(e){this.returnSpeed=Et.clamp(e,.001,1)}verifyScrollEvent(e){const t=e.deltaY>0,i=t!==this.lastScrollDirPositive;if(this.lastScrollDirPositive=t,i)return this.syntheticScrollCount=0,!0;if(Date.now()-this.lastScrollTime>100)return this.syntheticScrollCount=0,!0;const n=Math.abs(e.deltaY),s=Math.abs(n-this.lastScrollDelta);return n<=this.lastScrollDelta?this.syntheticScrollCount++:this.syntheticScrollCount>10&&s<20?this.syntheticScrollCount++:this.syntheticScrollCount=0,!(this.syntheticScrollCount>this.syntheticScrollThreshold)}onScroll(e){if(!this.isActive||!this.controlsEnabled)return;e.preventDefault();const t=e.deltaY*this.scrollSensitivity,i=this.verifyScrollEvent(e);if(this.lastScrollDelta=Math.abs(e.deltaY),this.lastScrollTime=Date.now(),!i)return;const n=t>0&&this.targetZOffset>0||t<0&&this.targetZOffset<0;let s=t;if(n){const r=Math.abs(this.targetZOffset)/this.maxZOffset;if(r>.5){const l=(r-.5)/.5,c=1/(1+Math.pow(l*3,3));s*=c}}this.targetZOffset+=s;const a=this.maxZOffset*3;this.targetZOffset=Et.clamp(this.targetZOffset,-a,a),this.lastInteractionTime=Date.now(),this.isReturning=!1}onKeyDown(e){if(!this.isActive||!this.controlsEnabled)return;const t=e.code.toLowerCase();["arrowup","arrowdown","arrowleft","arrowright","keyw","keys","keya","keyd"].includes(t)&&(e.preventDefault(),this.activeKeys.add(t),this.keyboardAnimationId||this.updateKeyboardOffset(),this.lastInteractionTime=Date.now(),this.isReturning=!1)}onKeyUp(e){const t=e.code.toLowerCase();this.activeKeys.delete(t),this.activeKeys.size===0&&this.keyboardAnimationId&&(cancelAnimationFrame(this.keyboardAnimationId),this.keyboardAnimationId=null)}setKeyboardInversion(e,t){this.keyboardInvertX=e,this.keyboardInvertY=t}updateKeyboardOffset(){if(!this.isActive||!this.controlsEnabled||this.activeKeys.size===0){this.keyboardAnimationId=null;return}let e=0,t=0;const i=this.keyboardInvertX?-1:1,n=this.keyboardInvertY?-1:1;this.activeKeys.forEach(s=>{switch(s){case"arrowleft":case"keya":e+=this.keyboardSensitivity*i;break;case"arrowright":case"keyd":e-=this.keyboardSensitivity*i;break;case"arrowup":case"keyw":t+=this.keyboardSensitivity*n;break;case"arrowdown":case"keys":t-=this.keyboardSensitivity*n;break}}),(e!==0||t!==0)&&(this.updateOffset(e,t),this.lastInteractionTime=Date.now(),this.isReturning=!1),this.keyboardAnimationId=requestAnimationFrame(()=>this.updateKeyboardOffset())}onMouseDown(e){this.userOffsetEnabled&&(this.isDragging=!0,this.previousMousePosition.set(e.clientX,e.clientY))}onMouseMove(e){if(!this.isDragging||!this.isActive||!this.userOffsetEnabled||!this.controlsEnabled)return;const t=e.clientX-this.previousMousePosition.x,i=e.clientY-this.previousMousePosition.y;this.updateOffset(t,i),this.previousMousePosition.set(e.clientX,e.clientY),this.lastInteractionTime=Date.now(),this.isReturning=!1}onMouseUp(){this.isDragging=!1}onTouchStart(e){if(!(!this.isActive||!this.controlsEnabled)){if(e.touches.length===1){this.isDragging=!0;const t=e.touches[0];this.previousMousePosition.set(t.clientX,t.clientY)}else if(e.touches.length===2){const t=e.touches[0].clientX-e.touches[1].clientX,i=e.touches[0].clientY-e.touches[1].clientY;this.pinchStartDistance=Math.sqrt(t*t+i*i)}}}onTouchMove(e){if(!(!this.isActive||!this.controlsEnabled)){if(e.touches.length===1&&this.isDragging){const t=e.touches[0],i=t.clientX-this.previousMousePosition.x,n=t.clientY-this.previousMousePosition.y;this.updateOffset(i,n),this.previousMousePosition.set(t.clientX,t.clientY)}else if(e.touches.length===2&&this.pinchStartDistance!==null){const t=e.touches[0].clientX-e.touches[1].clientX,i=e.touches[0].clientY-e.touches[1].clientY,n=Math.sqrt(t*t+i*i),s=(n-this.pinchStartDistance)*.01;this.targetZOffset=Et.clamp(this.targetZOffset-s,-this.maxZOffset,this.maxZOffset),this.pinchStartDistance=n}this.lastInteractionTime=Date.now(),this.isReturning=!1}}handleAutoReturn(){if(!this.returnToCentre||this.isDragging)return;Date.now()-this.lastInteractionTime>this.returnDelay&&(this.isReturning=!0),this.isReturning&&(this.targetUserOffset.lengthSq()>1e-4&&(this.targetUserOffset.multiplyScalar(1-this.returnSpeed),this.targetUserOffset.lengthSq()<1e-4&&this.targetUserOffset.set(0,0,0)),Math.abs(this.targetZOffset)>.001&&(this.targetZOffset*=1-this.returnSpeed,Math.abs(this.targetZOffset)<.001&&(this.targetZOffset=0)),this.targetUserOffset.lengthSq()<1e-4&&Math.abs(this.targetZOffset)<.001&&(this.isReturning=!1))}onTouchEnd(e){this.isDragging=!1}updateOffset(e,t){const i=new D(-e*this.mouseOffsetSensitivity,t*this.mouseOffsetSensitivity,0),s=this.targetUserOffset.length()/this.maxOffsetDistance;if(s>.5){const r=this.targetUserOffset.clone().normalize(),l=i.dot(r);if(l>0){const c=(s-.5)/.5,h=1/(1+Math.pow(c*3,3)),d=r.clone().multiplyScalar(l),f=i.clone().sub(d);d.multiplyScalar(h),i.copy(d.add(f))}}this.targetUserOffset.add(i);const a=this.maxOffsetDistance*1.5;this.targetUserOffset.length()>a&&this.targetUserOffset.normalize().multiplyScalar(a)}setMaxOffsetDistance(e){this.maxOffsetDistance=e}setOffsetSensitivity(e){this.mouseOffsetSensitivity=e}setOffsetEasing(e){this.offsetEasing=Et.clamp(e,0,1)}resetUserOffset(){this.targetUserOffset.set(0,0,0),this.userOffset.set(0,0,0),this.targetZOffset=0,this.zOffset=0}setScrollSensitivity(e){this.scrollSensitivity=e}setMaxZOffset(e){this.maxZOffset=e}getZOffset(){return this.zOffset}getUserOffset(){return new D(this.userOffset.x,this.userOffset.y,this.zOffset)}setAnimationIndex(e){return!this.allAnimationClips||this.allAnimationClips.length===0?!1:e<0||e>=this.allAnimationClips.length?(Ye(`Invalid animation index: ${e}. Available range: 0-${this.allAnimationClips.length-1}`),!1):(this.animations=[this.allAnimationClips[e]],this.originalAnimationClip=this.allAnimationClips[e],this.animationDuration=this.originalAnimationClip.duration,this.mixer&&this.mixer.uncacheRoot(this.cameraParentGroup),this.mixer=new Lr(this.cameraParentGroup),this.currentAction=this.mixer.clipAction(this.animations[0]),this.debugging&&(Ye(`Set animation to index ${e}: "${this.originalAnimationClip.name}"`),Ye(["Animation details:",{duration:this.animationDuration,totalFrames:this.getTotalFrames(),fps:this.fps,tracks:this.originalAnimationClip.tracks.length}])),this.currentFrameIndex=0,!0)}calibrateAnimation(e){if(!this.originalAnimationClip)return;this.cameraParentGroup.position.set(0,0,0),this.cameraParentGroup.quaternion.copy(e),this.cameraTarget.position.set(0,0,0),this.cameraTarget.quaternion.set(0,0,0,1);const t=this.originalAnimationClip.tracks.map(i=>{const n=i.times,s=i.values,a=i.getValueSize(),r=new Float32Array(s.length);for(let l=0;l<n.length;l++){const c=Array.from(s.slice(l*a,(l+1)*a));if(i.name.includes("position")){const h=c.map(d=>d*this.unitScale);r.set(h,l*a)}else i.name.includes("quaternion"),r.set(c,l*a)}return new i.constructor(i.name,n,r)});this.animations=[new Co(this.originalAnimationClip.name,this.originalAnimationClip.duration,t)],this.mixer&&this.mixer.uncacheRoot(this.cameraParentGroup),this.mixer=new Lr(this.cameraParentGroup),this.currentAction=this.mixer.clipAction(this.animations[0]),this.setFrame(0),Ye(["Calibration Complete",{parentGroupPosition:this.cameraParentGroup.position.toArray(),parentGroupRotation:this.cameraParentGroup.quaternion.toArray(),cameraLocalPosition:this.camera.position.toArray()}])}setTime(e){if(!this.mixer||!this.currentAction||!this.animations[0])return;const t=e+this.offsetSeconds,i=Math.max(0,Math.min(t,this.animationDuration)),n=i*this.fps,s=Math.floor(n)-this.frameOffset;this.animations[0].tracks.forEach(r=>{var y;const l=r.times,c=r.values,h=r.getValueSize();let d=-1,f=-1;for(let v=0;v<l.length;v++)if(l[v]>=i){f=v,d=Math.max(0,v-1);break}f===-1&&(d=l.length-1,f=l.length-1);let p=0;if(d!==f){const v=l[f]-l[d];p=v>0?(i-l[d])/v:0}const b=c.slice(d*h,(d+1)*h),_=c.slice(f*h,(f+1)*h);if(r.name.includes("position")){const v=new D().fromArray(b),S=new D().fromArray(_);this.cameraTarget.position.lerpVectors(v,S,p)}else if(r.name.includes("quaternion")){const v=new ai().fromArray(b),S=new ai().fromArray(_);this.cameraTarget.quaternion.slerpQuaternions(v,S,p)}else if(r.name.includes("scale")){const v=b[0],S=_[0],A=v+(S-v)*p;this.currentFocalLength=A*this.focalLengthScale,(y=this==null?void 0:this.callbacks)!=null&&y.onFocalLengthChange&&this.isActive&&this.callbacks.onFocalLengthChange(this.currentFocalLength)}}),this.syncCameraWithTarget(),this.currentFrameIndex=s,this.callbacks.onTimeUpdate&&this.isActive&&this.callbacks.onTimeUpdate(i)}syncCameraWithTarget(){if(this.isActive){if(this.handleAutoReturn(),this.userOffsetEnabled){this.userOffset.lerp(this.targetUserOffset,this.offsetEasing),this.zOffset=Et.lerp(this.zOffset,this.targetZOffset,this.offsetEasing);const e=new D(this.userOffset.x,this.userOffset.y,this.zOffset);this.cameraOffsetGroup.position.copy(e)}this.cameraOffsetGroup.getWorldPosition(this.camera.position),this.cameraOffsetGroup.getWorldQuaternion(this.camera.quaternion),this.camera.updateMatrix(),this.camera.updateMatrixWorld(!0)}}getAutoReturnSettings(){return{enabled:this.returnToCentre,delay:this.returnDelay,speed:this.returnSpeed}}startReturn(){this.isReturning=!0,this.lastInteractionTime=0}cancelReturn(){this.isReturning=!1}isReturningToCentre(){return this.isReturning}setFocalLengthScaleFactor(e){this.focalLengthScale=e}setCameraOffset(e,t,i,n=!1){this.targetUserOffset.set(e,t,i),n&&(this.userOffset.copy(this.targetUserOffset),this.cameraOffsetGroup.position.copy(this.userOffset))}getCameraOffsetGroup(){return this.cameraOffsetGroup}getOffsetEasing(){return this.offsetEasing}setIsActive(e){this.isActive=e}setControlsActive(e){this.controlsEnabled=e,e||(this.isDragging=!1,this.activeKeys.clear(),this.keyboardAnimationId&&(cancelAnimationFrame(this.keyboardAnimationId),this.keyboardAnimationId=null))}setFrame(e){if(!this.mixer||!this.currentAction||!this.animations[0])return;const t=this.getTotalFrames(),i=e+this.frameOffset,s=Math.max(0,Math.min(i,t-1))/this.fps;this.setTime(s-this.offsetSeconds)}getCurrentFrame(){return this.currentFrameIndex}getTotalFrames(){return this.animationDuration?Math.floor(this.animationDuration*this.fps):0}setFPS(e){this.fps=e}getFPS(){return this.fps}setUnitScale(e){this.unitScale=e}getUnitScale(){return this.unitScale}getCameraTargetWorldPosition(){const e=new D;return this.cameraTarget.getWorldPosition(e),e}getCameraTargetWorldQuaternion(){const e=new ai;return this.cameraTarget.getWorldQuaternion(e),e}getCameraTargetFocalLength(){return this.currentFocalLength}resetCameraTransform(){this.camera.position.set(0,0,0),this.camera.quaternion.set(0,0,0,1)}getCameraParentGroup(){return this.cameraParentGroup}setFrameOffset(e){this.frameOffset=Math.max(0,e),this.offsetSeconds=this.frameOffset/this.fps,this.debugging&&Ye(`Camera animation frame offset set to ${this.frameOffset} frames (${this.offsetSeconds.toFixed(2)}s)`)}getFrameOffset(){return this.frameOffset}clearFrameOffset(){this.frameOffset=0,this.offsetSeconds=0,this.debugging}detachCamera(){const e=this.camera.getWorldPosition(new D),t=this.camera.getWorldQuaternion(new ai);return this.cameraParentGroup.remove(this.camera),this.camera.position.copy(e),this.camera.quaternion.copy(t),this.scene.add(this.camera),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.camera}getCallbacks(){return this.callbacks}getOffsetSeconds(){return this.offsetSeconds}setCallbacks(e){return this.callbacks={...this.callbacks,...e},this.callbacks}clone(){const e=new Dr(this.camera,this.scene);return e.fps=this.fps,e.unitScale=this.unitScale,e.debugging=this.debugging,e.focalLengthScale=this.focalLengthScale,this.frameOffset&&e.setFrameOffset(this.frameOffset),this.originalAnimationClip&&(e.originalAnimationClip=this.originalAnimationClip,e.animations=[...this.animations],e.animationDuration=this.animationDuration,this.allAnimationClips&&(e.allAnimationClips=this.allAnimationClips),e.mixer=new Lr(e.cameraParentGroup),e.animations.length>0&&(e.currentAction=e.mixer.clipAction(e.animations[0]))),e.callbacks={...this.callbacks},e.currentFrameIndex=0,e}dispose(){this.mixer&&(this.mixer.stopAllAction(),this.mixer.uncacheRoot(this.camera)),this.removeOffsetControls(),this.currentAction=null,this.mixer=null,this.callbacks={}}}class RM{constructor(e){g(this,"app");g(this,"assets",[]);g(this,"splatMesh");g(this,"usePrimitiveMeshes",!1);g(this,"materialManager");g(this,"loadQueueManager");g(this,"initialiseAssetsCameraAnimations",()=>{this.assets.forEach(async e=>{var i,n,s,a,r,l,c,h,d,f;const t=(n=(i=e==null?void 0:e.params)==null?void 0:i.cameraAnimation)==null?void 0:n.type;if(t){switch(t){case"basic":e.cameraAnimationPlayer=new Dr(this.app.camera.camera,this.app.scene),await e.cameraAnimationPlayer.loadAnimation(e.getCameraAnimation().data||((a=(s=e==null?void 0:e.params)==null?void 0:s.cameraAnimation)==null?void 0:a.file));break;case"adaptive-fov":e.cameraAnimationPlayer=new Dr(this.app.camera.camera,this.app.scene,{callbacks:{onFocalLengthChange:p=>{this.app.camera.setFocalLength(p)}}}),await e.cameraAnimationPlayer.loadAnimation(e.getCameraAnimation().data||((l=(r=e==null?void 0:e.params)==null?void 0:r.cameraAnimation)==null?void 0:l.file));break;case"built-in":e.cameraAnimationPlayer=new Dr(this.app.camera.camera,this.app.scene,{callbacks:{onFocalLengthChange:p=>{this.app.camera.setFocalLength(p)}}}),await e.cameraAnimationPlayer.loadAnimation(e.getCameraAnimation().data||((h=(c=e==null?void 0:e.params)==null?void 0:c.cameraAnimation)==null?void 0:h.file)),e.cameraAnimationPlayer.setAnimationIndex(1),e.cameraAnimationPlayer.setFrameOffset(100);break;case"multi-object":await e.multiObjectAnimationPlayer.loadAnimation(e.getCameraAnimation().data),e.multiObjectAnimationPlayer.setFrameOffset(100),e.multiObjectAnimationPlayer.setFrame(1);break}(f=(d=e==null?void 0:e.params)==null?void 0:d.cameraAnimation)!=null&&f.focalLengthScale&&e.cameraAnimationPlayer.setFocalLengthScaleFactor(e.params.cameraAnimation.focalLengthScale)}})});this.app=e,this.materialManager=new IM,this.loadQueueManager=new LM(this)}async loadAssetData(e){try{const i=await(await fetch(e)).json();this.initialiseAssets(i)}catch(t){console.error("Error loading asset data:",t)}}initialiseAssets(e){Object.keys(e.assets).forEach(i=>{const n=new PM(this.app,i,e.assets[i]);this.assets.push(n)})}getMaterialManager(){return this.materialManager}async loadMeshesWithMaterials(e,t){t&&Ye(["loadMeshesWithMaterials called with loadedAssets:",t.map(n=>({id:n.id,type:n.type,hasData:!!n.data,options:n.options}))]);const i=e.map(async n=>{const s=this.getAssetByKey(n.asset);if(!s){console.warn(`Asset not found: ${n.asset}`);return}Ye(`Processing asset: ${n.asset}`);for(const a of n.lods)Ye([`Adding LOD level for ${n.asset}:`,{name:a.name,meshQuality:a.meshQuality,materialQuality:a.materialQuality}]),await s.addLODLevel(a.name,a.meshQuality,a.materialQuality,a.distance,t)});await Promise.all(i)}getAssetByKey(e){return this.assets.find(t=>t.key===e)}async loadAssetMeshes(e,t,i){for(const n of t)if(!e.hasMeshQuality(n)){Ye(`Loading mesh quality ${n} for asset ${e.key}`);const s=e.params.models.map(async a=>{let r;if(this.usePrimitiveMeshes)r=this.createPrimitiveMesh(a);else{`${a.file}${n}`;const l=`${e.key}_${a.file}_${n}`,c=i==null?void 0:i.find(h=>h.id===l);if(e.key==="letter"){const h=(c==null?void 0:c.data)instanceof ArrayBuffer?await this.parseGLBFromBuffer(c.data,!0):await this.loadModel(a.file,n);e.setCameraAnimation(h,e.params.cameraAnimation.file,e.params.cameraAnimation.type||"built-in"),r=h.scene,r.animations=h.animations,r.name=a.file}else r=(c==null?void 0:c.data)instanceof ArrayBuffer?await this.parseGLBFromBuffer(c.data):await this.loadModel(a.file,n),r.name=a.file;e.setModel(n,a.file,r),Ye(`Loaded model ${a.file} for quality ${n}`),r.traverse(h=>{})}});await Promise.all(s),e.params.cameraCollisionMeshSkeletonType?e.setSkeletonType(e.params.cameraCollisionMeshSkeletonType):e.setSkeletonType("CENTRE_POINT"),e.params.cameraCollisionMesh&&!e.getCameraCollisionMesh()?await e.loadCameraCollisionMesh():e.createDefaultCollisionMesh(),e.addLoadedMeshQuality(n),e.container.traverse(a=>{})}}async processLoadedAssets(e){const t=new Map;for(const i of e){const{assetKey:n,modelName:s,meshQuality:a,materialQuality:r}=i.options;t.has(n)||t.set(n,{models:new Map,textures:new Map});const l=t.get(n);if(i.type===Ii.MODEL){const c=`${n}_${s}_${a}`;l.models.set(c,i.data)}else if(i.type===Ii.TEXTURE){const c=`${n}_${s}_${i.options.textureType}_${r}`;l.textures.set(c,i.data)}}for(const[i,n]of t){const s=this.getAssetByKey(i);if(!s){console.warn(`Asset not found: ${i}`);continue}const a=new Set;for(const[l,c]of n.models){const h=l.split("_");a.add(h[h.length-1])}for(const l of a)await this.loadAssetMeshes(s,[l],n.models);const r=new Set;for(const[l,c]of n.textures){const h=l.split("_");r.add(h[h.length-1])}for(const l of a)for(const c of r){for(const h of s.params.models)await s.setupMaterial(h.file,l,c,n.textures);s.applyMaterialsToMeshes(l,c)}}}async parseGLBFromBuffer(e,t=!1){const i=new Yl;return new Promise((n,s)=>{i.parse(e,"",a=>n(t?a:a.scene),a=>s(a))})}async loadAssetMaterials(e,t,i,n){const s=e.params.models.map(async a=>{await e.setupMaterial(a.file,t,i,n)});await Promise.all(s),Ye(`Materials loaded for asset: ${e.key} [Mesh Quality: ${t}, Material Quality: ${i}]`)}findMesh(e){let t=null;return e.traverse(i=>{if(i.type==="Mesh"||i.type==="SkinnedMesh")return t=i,t}),t}createPrimitiveMesh(e){const t=new va(1,1,1),i=new Sn({color:16711680}),n=new It(t,i);e.position&&n.position.set(e.position.x,e.position.y,e.position.z),e.rotation&&n.rotation.set(di(e.rotation.x),di(e.rotation.y),di(e.rotation.z));const s=new cn;return s.add(n),s}async loadModel(e,t){const i=Li(`/models/${e}.${t}.glb`),n=new Yl;return new Promise((s,a)=>{n.load(i,r=>{var l,c,h,d;Ye([`Model loaded: ${e}.${t}`,{hasAnimations:((l=r.animations)==null?void 0:l.length)>0,animationCount:((c=r.animations)==null?void 0:c.length)||0,animationNames:(h=r.animations)==null?void 0:h.map(f=>f.name)}]),((d=r.animations)==null?void 0:d.length)>0&&(r.scene.animations=r.animations,r.animations.forEach(f=>{f.tracks.forEach(p=>{const b=p.name.split(".")[0],_=r.scene.getObjectByName(b);_&&("animations"in _||Object.defineProperty(_,"animations",{value:[],writable:!0,enumerable:!0}),_.animations.includes(f)||(_.animations=_.animations||[],_.animations.push(f)))})})),s(r.scene)},void 0,r=>{console.error(`Error loading model: ${e}.${t}`,r),a(r)})})}async loadHDRI(e,t){return new Promise((i,n)=>{const s=new kM,a=r=>(r.mapping=Dl,r.magFilter=wi,r.minFilter=wi,r.generateMipmaps=!1,r);if(t){const r=new Blob([t],{type:"application/octet-stream"}),l=new FileReader;l.onload=()=>{s.load(l.result,c=>i(a(c)),void 0,n)},l.onerror=n,l.readAsDataURL(r)}else s.setPath("/hdris/").load(e,r=>i(a(r)),void 0,n)})}applyHDRIToScene(e,t=!1){this.app.scene.environment=e,t&&(this.app.scene.background=e)}toggleHDRIBackground(e){e?this.app.scene.background=this.app.scene.environment:this.app.scene.background=null}createLoadGroup(e){this.loadQueueManager.addGroup(e)}getAdditionalLetterTextures(e){const t=[];for(const i of e);return t}getRequiredFilesForLODConfigs(e){var n,s;const t=[],i=this.getMaterialManager();for(const a of e){const r=this.getAssetByKey(a.asset);if(r)for(const l of a.lods){const{meshQuality:c,materialQuality:h}=l,d=i.getQualityPreset(h);if(!d){console.warn(`Quality preset not found for ${h}`);continue}for(const f of r.params.models){const p=`${ti}${(n=f.files)==null?void 0:n[c]}`;t.push({type:Ii.MODEL,id:`${r.key}_${f.file}_${c}`,url:p,options:{meshQuality:c,modelName:f.file,assetKey:r.key}});const b=f.textures;if(b){if(b.baseColor&&typeof b.baseColor=="string"&&t.push({type:Ii.TEXTURE,id:`${r.key}_${f.file}_baseColor_${h}`,url:Un(b.baseColor,0,d.baseColorRes),options:{textureType:"baseColor",materialQuality:h,modelName:f.file,assetKey:r.key}}),b.normal){let _;typeof b.normal=="string"?_=b.normal:_=((s=b.normal.quality)==null?void 0:s[c])||b.normal.shared,_&&t.push({type:Ii.TEXTURE,id:`${r.key}_${f.file}_normal_${h}`,url:Un(_,d.normalRes,d.normalRes),options:{textureType:"normal",materialQuality:h,modelName:f.file,assetKey:r.key}})}b.roughness&&typeof b.roughness=="string"&&t.push({type:Ii.TEXTURE,id:`${r.key}_${f.file}_roughness_${h}`,url:Un(b.roughness,d.roughnessRes,d.roughnessRes),options:{textureType:"roughness",materialQuality:h,modelName:f.file,assetKey:r.key}}),b.metallic&&typeof b.metallic=="string"&&t.push({type:Ii.TEXTURE,id:`${r.key}_${f.file}_metallic_${h}`,url:Un(b.metallic,d.metallicRes,d.metallicRes),options:{textureType:"metallic",materialQuality:h,modelName:f.file,assetKey:r.key}}),b.ao&&typeof b.ao=="string"&&t.push({type:Ii.TEXTURE,id:`${r.key}_${f.file}_ao_${h}`,url:Un(b.ao,d.aoRes,d.aoRes),options:{textureType:"ao",materialQuality:h,modelName:f.file,assetKey:r.key}})}}}}return t}getRequiredCameraAnimations(){var t;const e=[];for(const i of this.assets)(t=i.params.cameraAnimation)!=null&&t.file&&e.push({type:Ii.MODEL,id:`${i.key}_camera_animation`,url:i.params.cameraAnimation.file,options:{assetKey:i.key,animationType:i.params.cameraAnimation.type||"default"},priority:5});return e}async loadSplat(e,t){return new Promise(async(i,n)=>{const s=await _f.loadSplat(e,this.app.scene,this.app.camera.camera,this.app.renderer,{renderFunc:t,rotation:uf,onReady:()=>{i(s)},onError:a=>{console.error("Error loading splat:",a),n(a)}});return this.splatMesh=s.splatMesh,s})}async loadSplatFromBuffer(e,t){if(!e)return;const i=await _f.loadSplatFromBuffer(e,this.app.scene,this.app.camera.camera,this.app.renderer,{renderFunc:t,rotation:uf,onReady:()=>{resolve(i)},onError:n=>{console.error("Error loading splat from buffer:",n),reject(n)}});return this.splatMesh=i.splatMesh,i}}const Va=class Va{constructor(e={}){g(this,"storage");g(this,"namespace");g(this,"cache",{});g(this,"cacheLifetime",6e5);const{useSessionStorage:t=!1,namespace:i=a_}=e;this.storage=t?sessionStorage:localStorage,this.namespace=i}static getInstance(e){return Va.instance||(Va.instance=new Va(e)),Va.instance}getNamespacedKey(e){return`${this.namespace}${e}`}setPreference(e,t,i=-1){try{const n={value:t,timestamp:Date.now(),expiresAt:i===-1?-1:Date.now()+i},s=JSON.stringify(n);this.storage.setItem(this.getNamespacedKey(e),s),this.cache[e]={...n,lastChecked:Date.now()}}catch(n){console.error("Error saving preference:",n)}}getPreference(e,t=null){if(this.cache[e]&&!this.isCacheExpired(this.cache[e]))return this.cache[e].value;try{const i=this.storage.getItem(this.getNamespacedKey(e));if(!i)return t;const n=JSON.parse(i);return this.isExpired(n)?(this.removePreference(e),t):(this.cache[e]={...n,lastChecked:Date.now()},n.value)}catch(i){return console.error("Error retrieving preference:",i),t}}getPreferenceMetadata(e){if(this.cache[e]&&!this.isCacheExpired(this.cache[e])){const{lastChecked:t,...i}=this.cache[e];return i}try{const t=this.storage.getItem(this.getNamespacedKey(e));if(!t)return null;const i=JSON.parse(t);return this.isExpired(i)?(this.removePreference(e),null):(this.cache[e]={...i,lastChecked:Date.now()},i)}catch(t){return console.error("Error retrieving preference metadata:",t),null}}removePreference(e){this.storage.removeItem(this.getNamespacedKey(e)),delete this.cache[e]}clearAllPreferences(){Object.keys(this.storage).forEach(e=>{e.startsWith(this.namespace)&&this.storage.removeItem(e)}),this.cache={}}isExpired(e){return e.expiresAt!==-1&&Date.now()>e.expiresAt}isCacheExpired(e){return Date.now()-e.lastChecked>this.cacheLifetime}invalidateCache(e){delete this.cache[e]}setCacheLifetime(e){this.cacheLifetime=e}};g(Va,"instance");let Gs=Va;class DM{constructor(e){g(this,"content",null);g(this,"preferenceManager");g(this,"bindingsMap",new Map);this.uiManager=e,this.preferenceManager=Gs.getInstance()}async loadSettingsContent(){if(!this.content)try{const e=await fetch(Li("/modal-content/settings-content.html"));this.content=await e.text()}catch(e){console.error("Failed to load settings content:",e),this.content="<p>Error loading settings content.</p>"}return this.content}async injectSettingsContent(e,t="settings-content"){if(!e)return;const i=await this.loadSettingsContent(),n=document.createElement("div");n.id=t,n.innerHTML=i,e.innerHTML="",e.appendChild(n),rm(()=>document.getElementById(t),()=>{requestAnimationFrame(()=>{this.initialiseSettings(t),this.setVersionNumber()})})}setVersionNumber(){const e=document.getElementById("version");e&&(e.innerText=`v${ql}`)}initialiseSettings(e){const t=document.getElementById(e);t&&(this.initialiseSwitches(t,e),this.initialiseVolumeSliders(t,e),this.initialiseOptionSelects(t,e),this.initialiseRefreshNotification(t,e))}initialiseSwitches(e,t){e.querySelectorAll(".modal-switch").forEach(n=>{const s=n.id;this.bindingsMap.has(s)||this.bindingsMap.set(s,new Map),this.setInitialSwitchState(n),this.bindingsMap.get(s).has(t)||this.bindSwitch(n,t)})}setInitialSwitchState(e){e.setAttribute("tabindex","0"),e.setAttribute("role","switch");let t=!1;switch(e.id){case"switch-show-subtitles":t=this.uiManager.getShowSubtitles();break;case"switch-reduce-motion":t=this.uiManager.getReduceMotion();break;case"switch-keyboard-invert-x":t=this.uiManager.getKeyboardInvertX();break;case"switch-keyboard-invert-y":t=this.uiManager.getKeyboardInvertY();break;case"switch-onscreen-controls":t=this.uiManager.getShowOnscreenControls();break;case"switch-onscreen-controls-left":t=this.uiManager.getOnscreenControlsLeft();break;case"switch-onscreen-controls-top":t=this.uiManager.getOnscreenControlsTop();break;case"enable-splat":t=this.uiManager.getEnableSplat();break;case"switch-high-contrast":t=this.uiManager.getHighContrast();break}t?e.classList.add("active"):e.classList.remove("active"),e.setAttribute("aria-checked",t.toString())}initialiseVolumeSliders(e,t){e.querySelectorAll(".volume-slider").forEach(n=>{const s=n.id;this.bindingsMap.has(s)||this.bindingsMap.set(s,new Map),n.setAttribute("tabindex","0"),this.setInitialSliderState(n),this.bindingsMap.get(s).has(t)||this.bindVolumeSlider(n,t)})}initialiseOptionSelects(e,t){e.querySelectorAll(".modal-option-select").forEach(n=>{const s=n.id;this.bindingsMap.has(s)||this.bindingsMap.set(s,new Map),this.setInitialOptionSelectState(n),this.bindingsMap.get(s).has(t)||this.bindOptionSelect(n,t)})}setInitialOptionSelectState(e){switch(e.id){case"graphics-preset":const t=this.uiManager.preferenceManager.getPreference("graphics-preset")||"med";this.setActiveOption(e,t);break;case"fps-limit":const i=this.uiManager.preferenceManager.getPreference("fps-limit")||"30";this.setActiveOption(e,i);break}}bindOptionSelect(e,t){e.setAttribute("role","radiogroup"),e.querySelectorAll(".modal-option").forEach(n=>{n.setAttribute("role","radio");const s=c=>{c.preventDefault(),c.stopPropagation(),this.handleOptionSelect(e,n)},a=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),c.stopPropagation(),this.handleOptionSelect(e,n))};n.addEventListener("pointerup",s),n.addEventListener("keydown",a);const r=n.id;this.bindingsMap.has(r)||this.bindingsMap.set(r,new Map),this.bindingsMap.get(r).set(t,{click:s,keydown:a})})}handleOptionSelect(e,t){var s,a;e.querySelectorAll(".modal-option").forEach(r=>{r.classList.remove("active"),r.setAttribute("aria-checked","false")}),t.classList.add("active"),t.setAttribute("aria-checked","true");const n=t.id.split("__")[1];switch(e.id){case"graphics-preset":(s=this.uiManager)!=null&&s.setGraphicsPreset&&this.uiManager.setGraphicsPreset(n),this.showRefreshNotification(e);break;case"fps-limit":(a=this.uiManager)!=null&&a.setFpsLimit&&this.uiManager.setFpsLimit(n),this.uiManager.app.setRenderFps(n==="unlimited"?999:parseInt(n));break}this.uiManager.playUISound("click"),this.updateAllOptionSelects(e.id,n,e)}setActiveOption(e,t){e.querySelectorAll(".modal-option").forEach(a=>{a.classList.remove("active"),a.setAttribute("aria-checked","false"),a.setAttribute("tabindex","0"),a.setAttribute("role","option")});const n=`${e.id}__${t}`,s=e.querySelector(`#${n}`);s&&(s.classList.add("active"),s.setAttribute("aria-checked","true"))}updateAllOptionSelects(e,t,i){document.querySelectorAll(`#${e}`).forEach(n=>{n!==i&&this.setActiveOption(n,t)})}setInitialSliderState(e){var a;const t=e.id.replace("volume-",""),n=(this.uiManager.preferenceManager.getPreference(`volume-${t}`)??1)*100;e.value=n.toString();const s=(a=e.parentElement)==null?void 0:a.querySelector(".volume-number");s&&(s.textContent=Math.round(n).toString())}bindSwitch(e,t){$t(e,()=>{this.handleSwitchToggle(e)})}bindVolumeSlider(e,t){const i=()=>{this.handleVolumeChange(e),this.updateAllSliders(e.id,e.value)};e.addEventListener("input",i),this.bindingsMap.get(e.id).set(t,{click:i,keydown:()=>{}})}handleSwitchToggle(e){const t=!e.classList.contains("active");switch(t?e.classList.add("active"):e.classList.remove("active"),e.setAttribute("aria-checked",t.toString()),e.id){case"switch-show-subtitles":this.uiManager.setShowSubtitles(t);break;case"switch-reduce-motion":this.uiManager.setReduceMotion(t);break;case"switch-keyboard-invert-x":this.uiManager.setKeyboardInvertX(t);break;case"switch-keyboard-invert-y":this.uiManager.setKeyboardInvertY(t);break;case"switch-onscreen-controls":this.uiManager.setShowOnscreenControls(t);break;case"switch-onscreen-controls-left":this.uiManager.setOnscreenControlsLeft(t);break;case"switch-onscreen-controls-top":this.uiManager.setOnscreenControlsTop(t);break;case"switch-high-contrast":this.uiManager.setHighContrast(t);break;case"enable-splat":this.uiManager.setEnableSplat(t),this.showRefreshNotification(e);break}this.uiManager.playUISound(t?"click":"clack"),this.updateAllSwitches(e.id,t,e)}showRefreshNotification(e){const t=this.findSettingsContainer(e);if(!t)return;const i=t.querySelector(".settings-refresh-notification");if(!i){console.warn("Settings refresh notification element not found");return}i.classList.remove("minim"),i.removeAttribute("aria-hidden"),this.uiManager.makeScreenReaderAnnouncement("Graphical settings updated but not applied. Refresh the page for them to take effect."),$t("apply-settings-button",()=>{this.preferenceManager.removePreference("asset-load-start"),this.preferenceManager.setPreference("skip-aoc",!0),window.location.reload()})}findSettingsContainer(e){let t=e;for(;t;){if(t.id&&t.id.includes("settings-content")||t.querySelectorAll("section").length>0)return t;t=t.parentElement}return null}initialiseRefreshNotification(e,t){const i=e.querySelector(".settings-refresh-notification");i&&(i.classList.add("minim"),$t("apply-settings-button",()=>{this.preferenceManager.removePreference("asset-load-start"),this.preferenceManager.setPreference("skip-aoc",!0),window.location.reload()}))}handleVolumeChange(e){var s;const t=e.id.replace("volume-",""),i=parseFloat(e.value)/100;this.uiManager.handleVolumeChange(t,i);const n=(s=e.parentElement)==null?void 0:s.querySelector(".volume-number");n&&(n.textContent=Math.round(parseFloat(e.value)).toString())}updateAllSwitches(e,t,i){document.querySelectorAll(`#${e}`).forEach(n=>{n!==i&&(t?n.classList.add("active"):n.classList.remove("active"),n.setAttribute("aria-checked",t.toString()))})}updateAllSliders(e,t){document.querySelectorAll(`#${e}`).forEach(i=>{var s;i.value=t;const n=(s=i.parentElement)==null?void 0:s.querySelector(".volume-number");n&&(n.textContent=Math.round(parseFloat(t)).toString())})}cleanup(e){this.bindingsMap.forEach((t,i)=>{const n=t.get(e);if(n){const s=document.getElementById(i);s&&(s.removeEventListener("pointerup",n.click),s.removeEventListener("input",n.click),s.removeEventListener("keydown",n.keydown)),t.delete(e)}})}}class FM{constructor(e){g(this,"content",null);g(this,"uiManager");g(this,"isSubmitting",!1);g(this,"preferenceManager");g(this,"bindingsMap",new Map);g(this,"feedbackState",{overallExperience:null,loadingTime:null,usability:null,technicalPerformance:null,imagesAndSound:null,writings:null,additionalFeedback:""});this.uiManager=e,this.uiManager=e,this.preferenceManager=Gs.getInstance(),this.loadSavedFeedbackState()}async loadFeedbackContent(){if(!this.content)try{const e=await fetch(Li("/modal-content/feedback-content.html"));this.content=await e.text()}catch(e){console.error("Failed to load feedback content:",e),this.content="<p>Error loading feedback content.</p>"}return this.content}async injectFeedbackContent(e,t="feedback-content"){if(!e)return;const i=await this.loadFeedbackContent(),n=document.createElement("div");n.id=t,n.innerHTML=i,e.innerHTML="",e.appendChild(n),requestAnimationFrame(()=>{this.initialiseFeedback(t)})}initialiseFeedback(e){const t=document.getElementById(e);t&&(this.initialiseFeedbackSwitches(t,e),this.initialiseTextFeedback(t,e),this.initialiseSubmitButton(t,e))}initialiseFeedbackSwitches(e,t){e.querySelectorAll(".feedback-switch").forEach(n=>{const s=n.id;if(!s.startsWith("feedback-"))return;const a=this.getFeedbackCategoryFromId(s);if(!a)return;this.bindingsMap.has(s)||this.bindingsMap.set(s,new Map),this.setInitialFeedbackSwitchState(n,a),this.bindingsMap.get(s).has(t)||this.bindFeedbackSwitch(n,a,t)})}getFeedbackCategoryFromId(e){return{"feedback-overall-experience":"overallExperience","feedback-loading-time":"loadingTime","feedback-usability":"usability","feedback-technical-performance":"technicalPerformance","feedback-images-and-sound":"imagesAndSound","feedback-writings":"writings"}[e]||null}setInitialFeedbackSwitchState(e,t){e.setAttribute("role","radiogroup"),e.setAttribute("aria-label",`Rate your ${t} experience`);const i=this.feedbackState[t],n=e.querySelector(".feedback-switch-positive"),s=e.querySelector(".feedback-switch-negative");n&&s&&(n.setAttribute("tabindex","0"),s.setAttribute("tabindex","0"),n.setAttribute("role","radio"),n.setAttribute("aria-label","positive"),s.setAttribute("role","radio"),s.setAttribute("aria-label","negative"),n.classList.remove("active"),s.classList.remove("active"),n.setAttribute("aria-checked","false"),s.setAttribute("aria-checked","false"),i==="positive"?(n.classList.add("active"),n.setAttribute("aria-checked","true")):i==="negative"&&(s.classList.add("active"),s.setAttribute("aria-checked","true")))}bindFeedbackSwitch(e,t,i){var f;const n=e.querySelector(".feedback-switch-positive"),s=e.querySelector(".feedback-switch-negative");if(!n||!s)return;const a=p=>{p.preventDefault(),p.stopPropagation(),this.handleFeedbackSelection(t,"positive",e)},r=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),p.stopPropagation(),this.handleFeedbackSelection(t,"positive",e))},l=p=>{p.preventDefault(),p.stopPropagation(),this.handleFeedbackSelection(t,"negative",e)},c=p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),p.stopPropagation(),this.handleFeedbackSelection(t,"negative",e))},h=(f=this.bindingsMap.get(e.id))==null?void 0:f.get(i);h&&(n.removeEventListener("click",h.click),n.removeEventListener("keydown",h.keydown),s.removeEventListener("click",h.click),s.removeEventListener("keydown",h.keydown)),n.addEventListener("pointerup",a),n.addEventListener("keydown",r),s.addEventListener("pointerup",l),s.addEventListener("keydown",c),this.bindingsMap.has(e.id)||this.bindingsMap.set(e.id,new Map),this.bindingsMap.get(e.id).set(i,{click:a,keydown:r})}initialiseTextFeedback(e,t){var r;const i=e.querySelector("#feedback-additional-input");if(!i)return;i.value=this.feedbackState.additionalFeedback||"";const n=()=>{this.feedbackState.additionalFeedback=i.value,this.saveFeedbackState()},s=(r=this.bindingsMap.get("feedback-additional-input"))==null?void 0:r.get(t);s&&i.removeEventListener("input",s.click),i.addEventListener("input",n),this.bindingsMap.has("feedback-additional-input")||this.bindingsMap.set("feedback-additional-input",new Map),this.bindingsMap.get("feedback-additional-input").set(t,{click:n,keydown:()=>{}})}initialiseSubmitButton(e,t){var l;const i=e.querySelector("#feedback-submit-button");if(!i)return;const n=c=>{c.preventDefault(),c.stopPropagation(),this.handleFeedbackSubmission()},s=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),c.stopPropagation(),this.handleFeedbackSubmission())},a=(l=this.bindingsMap.get("feedback-submit-button"))==null?void 0:l.get(t);a&&(i.removeEventListener("click",a.click),i.removeEventListener("keydown",a.keydown)),i.addEventListener("pointerup",n),i.addEventListener("keydown",s),this.bindingsMap.has("feedback-submit-button")||this.bindingsMap.set("feedback-submit-button",new Map),this.bindingsMap.get("feedback-submit-button").set(t,{click:n,keydown:s})}handleFeedbackSelection(e,t,i){this.feedbackState[e]=t,this.saveFeedbackState();const n=i.querySelector(".feedback-switch-positive"),s=i.querySelector(".feedback-switch-negative");n&&s&&(n.classList.remove("active"),s.classList.remove("active"),n.setAttribute("aria-checked","false"),s.setAttribute("aria-checked","false"),t==="positive"?(n.classList.add("active"),n.setAttribute("aria-checked","true"),this.uiManager.playUISound("click")):t==="negative"&&(s.classList.add("active"),s.setAttribute("aria-checked","true"),this.uiManager.playUISound("clack"))),this.updateAllFeedbackSwitches(e,t,i)}updateAllFeedbackSwitches(e,t,i){const n=`feedback-${this.getSwitchIdFromCategory(e)}`;document.querySelectorAll(`#${n}`).forEach(s=>{if(s===i)return;const a=s.querySelector(".feedback-switch-positive"),r=s.querySelector(".feedback-switch-negative");a&&r&&(a.classList.remove("active"),r.classList.remove("active"),a.setAttribute("aria-checked","false"),r.setAttribute("aria-checked","false"),t==="positive"?(a.classList.add("active"),a.setAttribute("aria-checked","true")):t==="negative"&&(r.classList.add("active"),r.setAttribute("aria-checked","true")))})}getSwitchIdFromCategory(e){return{overallExperience:"overall-experience",loadingTime:"loading-time",usability:"usability",technicalPerformance:"technical-performance",imagesAndSound:"images-and-sound",writings:"writings"}[e]||e}handleFeedbackSubmission(){if(!this.isSubmitting){this.isSubmitting=!0;try{this.uiManager.playUISound("click");const e={...this.feedbackState,uuid:this.uiManager.app.sessionsManager.getUuid(),deviceInfo:this.collectDeviceInfo(),graphicsPreset:this.preferenceManager.getPreference("graphics-preset",null),isMobile:this.preferenceManager.getPreference("is-mobile",null),splatEnabled:this.preferenceManager.getPreference("enable-splat",null),buildVer:ql};Ye("Submitting feedback:",e),this.sendNotification(e),this.sendFeedback(e).then(()=>{this.showSubmitSuccess(),this.clearFeedback(),setTimeout(()=>{this.uiManager.closeModal(),setTimeout(()=>{this.isSubmitting=!1},1e3)},150)}).catch(t=>{console.error("Error submitting feedback:",t)})}catch(e){console.error("Error in feedback submission:",e)}}}collectDeviceInfo(){return{userAgent:navigator.userAgent,platform:navigator.platform,screenWidth:window.innerWidth,screenHeight:window.innerHeight,devicePixelRatio:window.devicePixelRatio,language:navigator.language,apiSupport:{webGL:!!window.WebGLRenderingContext,webGL2:!!window.WebGL2RenderingContext,fullscreen:!!document.fullscreenEnabled,audioContext:!!window.AudioContext||!!window.webkitAudioContext}}}async sendFeedback(e){const t=`${Xl}/mod/feedback/submit`;try{const i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw new Error(`HTTP error: ${i.status}`);return await i.json()}catch(i){throw console.error("Error sending feedback:",i),i}}async sendNotification(e){const t=`${Xl}/api/v1/forms/submit`;try{const i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formName:"mod-feedback",data:e})});if(!i.ok)throw new Error(`HTTP error: ${i.status}`);return await i.json()}catch(i){throw console.error("Error sending notification:",i),i}}showSubmitSuccess(){const e=document.getElementById("feedback-submit-button");if(!e)return;const t=e.textContent||"Submit";e.textContent="Thank you!",e.classList.add("submitted"),setTimeout(()=>{e.textContent=t,e.classList.remove("submitted")},2e3)}showSubmitError(){const e=document.getElementById("feedback-submit-button");if(!e)return;const t=e.textContent||"Submit";e.textContent="Error, please try again",e.classList.add("error"),setTimeout(()=>{e.textContent=t,e.classList.remove("error")},3e3)}loadSavedFeedbackState(){const e=this.preferenceManager.getPreference("feedback");e&&(this.feedbackState={...this.feedbackState,...e})}saveFeedbackState(){this.preferenceManager.setPreference("feedback",this.feedbackState)}clearFeedback(){this.feedbackState={overallExperience:null,loadingTime:null,usability:null,technicalPerformance:null,imagesAndSound:null,writings:null,additionalFeedback:""},this.saveFeedbackState(),Object.keys(this.feedbackState).forEach(e=>{if(e==="additionalFeedback"){const t=document.querySelector("#feedback-additional-input");t&&(t.value="")}else{const t=e,i=`feedback-${this.getSwitchIdFromCategory(t)}`;document.querySelectorAll(`#${i}`).forEach(n=>{const s=n.querySelector(".feedback-switch-positive"),a=n.querySelector(".feedback-switch-negative");s&&a&&(s.classList.remove("active"),a.classList.remove("active"),s.setAttribute("aria-checked","false"),a.setAttribute("aria-checked","false"))})}})}cleanup(e){this.bindingsMap.forEach((t,i)=>{const n=t.get(e);if(n){const s=document.getElementById(i);if(s)if(s.classList.contains("feedback-switch")){const a=s.querySelector(".feedback-switch-positive"),r=s.querySelector(".feedback-switch-negative");a&&(a.removeEventListener("click",n.click),a.removeEventListener("keydown",n.keydown)),r&&(r.removeEventListener("click",n.click),r.removeEventListener("keydown",n.keydown))}else s.removeEventListener("click",n.click),s.removeEventListener("keydown",n.keydown),s.id==="feedback-additional-input"&&s.removeEventListener("input",n.click);t.delete(e)}})}}const OM=(o,e=!0)=>{switch(o){case"macOS":return e?"":"command";case"Windows":case"Linux":return e?"Ctrl":"control";default:return"Ctrl"}},UM=(o,e=!0)=>{if(!e)return"Shift";switch(o){case"macOS":return"";default:return"Shift"}},hm=(o,e)=>{if(o)return o.replace("{{MODIFIER}}",OM(e.os)).replace("{{SHIFT}}",UM(e.os))},NM=(o,e,t)=>o.map(i=>({...i,controls:i.controls.filter(n=>n.devices?t?n.devices.includes("mobile"):t?n.devices.includes("tablet"):n.devices.includes("desktop"):!0).map(n=>({...n,value:hm(n.value,e)}))})).filter(i=>i.controls.length>0);function BM(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Mf,Eh={exports:{}};Mf=Eh.exports,typeof navigator<"u"&&(Eh.exports=function(){var o="http://www.w3.org/2000/svg",e="",t=!1,i=-999999,n=function(u){t=!!u},s=function(){return t},a=function(u){e=u},r=function(){return e};function l(u){return document.createElement(u)}function c(u,m){var w,M,x=u.length;for(w=0;w<x;w+=1)for(var I in M=u[w].prototype)Object.prototype.hasOwnProperty.call(M,I)&&(m.prototype[I]=M[I])}function h(u){function m(){}return m.prototype=u,m}var d=function(){function u(m){this.audios=[],this.audioFactory=m,this._volume=1,this._isMuted=!1}return u.prototype={addAudio:function(m){this.audios.push(m)},pause:function(){var m,w=this.audios.length;for(m=0;m<w;m+=1)this.audios[m].pause()},resume:function(){var m,w=this.audios.length;for(m=0;m<w;m+=1)this.audios[m].resume()},setRate:function(m){var w,M=this.audios.length;for(w=0;w<M;w+=1)this.audios[w].setRate(m)},createAudio:function(m){return this.audioFactory?this.audioFactory(m):window.Howl?new window.Howl({src:[m]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(m){this.audioFactory=m},setVolume:function(m){this._volume=m,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var m,w=this.audios.length;for(m=0;m<w;m+=1)this.audios[m].volume(this._volume*(this._isMuted?0:1))}},function(){return new u}}(),f=function(){function u(w,M){var x,I=0,q=[];switch(w){case"int16":case"uint8c":x=1;break;default:x=1.1}for(I=0;I<M;I+=1)q.push(x);return q}function m(w,M){return w==="float32"?new Float32Array(M):w==="int16"?new Int16Array(M):w==="uint8c"?new Uint8ClampedArray(M):u(w,M)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?m:u}();function p(u){return Array.apply(null,{length:u})}var b=!0,_=null,y="",v=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),S=Math.pow,A=Math.sqrt,E=Math.floor,O=Math.min,R=150,k=Math.PI/180,U=.5519;function C(u,m,w,M){this.type=u,this.currentTime=m,this.totalTime=w,this.direction=M<0?-1:1}function T(u,m){this.type=u,this.direction=m<0?-1:1}function Z(u,m,w,M){this.type=u,this.currentLoop=w,this.totalLoops=m,this.direction=M<0?-1:1}function z(u,m,w){this.type=u,this.firstFrame=m,this.totalFrames=w}function B(u,m){this.type=u,this.target=m}function V(u,m){this.type="renderFrameError",this.nativeError=u,this.currentTime=m}function Y(u){this.type="configError",this.nativeError=u}var J,Te=(J=0,function(){return y+"__lottie_element_"+(J+=1)});function ge(u,m,w){var M,x,I,q,$,ue,Ce,Ve;switch(ue=w*(1-m),Ce=w*(1-($=6*u-(q=Math.floor(6*u)))*m),Ve=w*(1-(1-$)*m),q%6){case 0:M=w,x=Ve,I=ue;break;case 1:M=Ce,x=w,I=ue;break;case 2:M=ue,x=w,I=Ve;break;case 3:M=ue,x=Ce,I=w;break;case 4:M=Ve,x=ue,I=w;break;case 5:M=w,x=ue,I=Ce}return[M,x,I]}function fe(u,m,w){var M,x=Math.max(u,m,w),I=Math.min(u,m,w),q=x-I,$=x===0?0:q/x,ue=x/255;switch(x){case I:M=0;break;case u:M=m-w+q*(m<w?6:0),M/=6*q;break;case m:M=w-u+2*q,M/=6*q;break;case w:M=u-m+4*q,M/=6*q}return[M,$,ue]}function he(u,m){var w=fe(255*u[0],255*u[1],255*u[2]);return w[1]+=m,w[1]>1?w[1]=1:w[1]<=0&&(w[1]=0),ge(w[0],w[1],w[2])}function Q(u,m){var w=fe(255*u[0],255*u[1],255*u[2]);return w[2]+=m,w[2]>1?w[2]=1:w[2]<0&&(w[2]=0),ge(w[0],w[1],w[2])}function pe(u,m){var w=fe(255*u[0],255*u[1],255*u[2]);return w[0]+=m/360,w[0]>1?w[0]-=1:w[0]<0&&(w[0]+=1),ge(w[0],w[1],w[2])}var ve=function(){var u,m,w=[];for(u=0;u<256;u+=1)m=u.toString(16),w[u]=m.length===1?"0"+m:m;return function(M,x,I){return M<0&&(M=0),x<0&&(x=0),I<0&&(I=0),"#"+w[M]+w[x]+w[I]}}(),K=function(u){b=!!u},se=function(){return b},Ee=function(u){_=u},me=function(){return _},Oe=function(u){R=u},Ze=function(){return R},le=function(u){y=u};function ke(u){return document.createElementNS(o,u)}function Fe(u){return Fe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},Fe(u)}var ht=function(){var u,m,w=1,M=[],x={onmessage:function(){},postMessage:function(be){u({data:be})}},I={postMessage:function(be){x.onmessage({data:be})}};function q(be){if(window.Worker&&window.Blob&&s()){var de=new Blob(["var _workerSelf = self; self.onmessage = ",be.toString()],{type:"text/javascript"}),te=URL.createObjectURL(de);return new Worker(te)}return u=be,x}function $(){m||((m=q(function(be){function de(){function Ne(Pe,ae){var oe,P,H,Ae,Je,zt,Rt=Pe.length;for(P=0;P<Rt;P+=1)if("ks"in(oe=Pe[P])&&!oe.completed){if(oe.completed=!0,oe.hasMask){var Ht=oe.masksProperties;for(Ae=Ht.length,H=0;H<Ae;H+=1)if(Ht[H].pt.k.i)W(Ht[H].pt.k);else for(zt=Ht[H].pt.k.length,Je=0;Je<zt;Je+=1)Ht[H].pt.k[Je].s&&W(Ht[H].pt.k[Je].s[0]),Ht[H].pt.k[Je].e&&W(Ht[H].pt.k[Je].e[0])}oe.ty===0?(oe.layers=G(oe.refId,ae),Ne(oe.layers,ae)):oe.ty===4?N(oe.shapes):oe.ty===5&&Tt(oe)}}function He(Pe,ae){if(Pe){var oe=0,P=Pe.length;for(oe=0;oe<P;oe+=1)Pe[oe].t===1&&(Pe[oe].data.layers=G(Pe[oe].data.refId,ae),Ne(Pe[oe].data.layers,ae))}}function ie(Pe,ae){for(var oe=0,P=ae.length;oe<P;){if(ae[oe].id===Pe)return ae[oe];oe+=1}return null}function G(Pe,ae){var oe=ie(Pe,ae);return oe?oe.layers.__used?JSON.parse(JSON.stringify(oe.layers)):(oe.layers.__used=!0,oe.layers):null}function N(Pe){var ae,oe,P;for(ae=Pe.length-1;ae>=0;ae-=1)if(Pe[ae].ty==="sh")if(Pe[ae].ks.k.i)W(Pe[ae].ks.k);else for(P=Pe[ae].ks.k.length,oe=0;oe<P;oe+=1)Pe[ae].ks.k[oe].s&&W(Pe[ae].ks.k[oe].s[0]),Pe[ae].ks.k[oe].e&&W(Pe[ae].ks.k[oe].e[0]);else Pe[ae].ty==="gr"&&N(Pe[ae].it)}function W(Pe){var ae,oe=Pe.i.length;for(ae=0;ae<oe;ae+=1)Pe.i[ae][0]+=Pe.v[ae][0],Pe.i[ae][1]+=Pe.v[ae][1],Pe.o[ae][0]+=Pe.v[ae][0],Pe.o[ae][1]+=Pe.v[ae][1]}function ne(Pe,ae){var oe=ae?ae.split("."):[100,100,100];return Pe[0]>oe[0]||!(oe[0]>Pe[0])&&(Pe[1]>oe[1]||!(oe[1]>Pe[1])&&(Pe[2]>oe[2]||!(oe[2]>Pe[2])&&null))}var we,Be=function(){var Pe=[4,4,14];function ae(P){var H=P.t.d;P.t.d={k:[{s:H,t:0}]}}function oe(P){var H,Ae=P.length;for(H=0;H<Ae;H+=1)P[H].ty===5&&ae(P[H])}return function(P){if(ne(Pe,P.v)&&(oe(P.layers),P.assets)){var H,Ae=P.assets.length;for(H=0;H<Ae;H+=1)P.assets[H].layers&&oe(P.assets[H].layers)}}}(),xe=(we=[4,7,99],function(Pe){if(Pe.chars&&!ne(we,Pe.v)){var ae,oe=Pe.chars.length;for(ae=0;ae<oe;ae+=1){var P=Pe.chars[ae];P.data&&P.data.shapes&&(N(P.data.shapes),P.data.ip=0,P.data.op=99999,P.data.st=0,P.data.sr=1,P.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},Pe.chars[ae].t||(P.data.shapes.push({ty:"no"}),P.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}),ct=function(){var Pe=[5,7,15];function ae(P){var H=P.t.p;typeof H.a=="number"&&(H.a={a:0,k:H.a}),typeof H.p=="number"&&(H.p={a:0,k:H.p}),typeof H.r=="number"&&(H.r={a:0,k:H.r})}function oe(P){var H,Ae=P.length;for(H=0;H<Ae;H+=1)P[H].ty===5&&ae(P[H])}return function(P){if(ne(Pe,P.v)&&(oe(P.layers),P.assets)){var H,Ae=P.assets.length;for(H=0;H<Ae;H+=1)P.assets[H].layers&&oe(P.assets[H].layers)}}}(),Ct=function(){var Pe=[4,1,9];function ae(P){var H,Ae,Je,zt=P.length;for(H=0;H<zt;H+=1)if(P[H].ty==="gr")ae(P[H].it);else if(P[H].ty==="fl"||P[H].ty==="st")if(P[H].c.k&&P[H].c.k[0].i)for(Je=P[H].c.k.length,Ae=0;Ae<Je;Ae+=1)P[H].c.k[Ae].s&&(P[H].c.k[Ae].s[0]/=255,P[H].c.k[Ae].s[1]/=255,P[H].c.k[Ae].s[2]/=255,P[H].c.k[Ae].s[3]/=255),P[H].c.k[Ae].e&&(P[H].c.k[Ae].e[0]/=255,P[H].c.k[Ae].e[1]/=255,P[H].c.k[Ae].e[2]/=255,P[H].c.k[Ae].e[3]/=255);else P[H].c.k[0]/=255,P[H].c.k[1]/=255,P[H].c.k[2]/=255,P[H].c.k[3]/=255}function oe(P){var H,Ae=P.length;for(H=0;H<Ae;H+=1)P[H].ty===4&&ae(P[H].shapes)}return function(P){if(ne(Pe,P.v)&&(oe(P.layers),P.assets)){var H,Ae=P.assets.length;for(H=0;H<Ae;H+=1)P.assets[H].layers&&oe(P.assets[H].layers)}}}(),ot=function(){var Pe=[4,4,18];function ae(P){var H,Ae,Je;for(H=P.length-1;H>=0;H-=1)if(P[H].ty==="sh")if(P[H].ks.k.i)P[H].ks.k.c=P[H].closed;else for(Je=P[H].ks.k.length,Ae=0;Ae<Je;Ae+=1)P[H].ks.k[Ae].s&&(P[H].ks.k[Ae].s[0].c=P[H].closed),P[H].ks.k[Ae].e&&(P[H].ks.k[Ae].e[0].c=P[H].closed);else P[H].ty==="gr"&&ae(P[H].it)}function oe(P){var H,Ae,Je,zt,Rt,Ht,Xt=P.length;for(Ae=0;Ae<Xt;Ae+=1){if((H=P[Ae]).hasMask){var Kt=H.masksProperties;for(zt=Kt.length,Je=0;Je<zt;Je+=1)if(Kt[Je].pt.k.i)Kt[Je].pt.k.c=Kt[Je].cl;else for(Ht=Kt[Je].pt.k.length,Rt=0;Rt<Ht;Rt+=1)Kt[Je].pt.k[Rt].s&&(Kt[Je].pt.k[Rt].s[0].c=Kt[Je].cl),Kt[Je].pt.k[Rt].e&&(Kt[Je].pt.k[Rt].e[0].c=Kt[Je].cl)}H.ty===4&&ae(H.shapes)}}return function(P){if(ne(Pe,P.v)&&(oe(P.layers),P.assets)){var H,Ae=P.assets.length;for(H=0;H<Ae;H+=1)P.assets[H].layers&&oe(P.assets[H].layers)}}}();function Vt(Pe){Pe.__complete||(Ct(Pe),Be(Pe),xe(Pe),ct(Pe),ot(Pe),Ne(Pe.layers,Pe.assets),He(Pe.chars,Pe.assets),Pe.__complete=!0)}function Tt(Pe){Pe.t.a.length===0&&Pe.t.p}var We={};return We.completeData=Vt,We.checkColors=Ct,We.checkChars=xe,We.checkPathProperties=ct,We.checkShapes=ot,We.completeLayers=Ne,We}if(I.dataManager||(I.dataManager=de()),I.assetLoader||(I.assetLoader=function(){function Ne(ie){var G=ie.getResponseHeader("content-type");return G&&ie.responseType==="json"&&G.indexOf("json")!==-1||ie.response&&Fe(ie.response)==="object"?ie.response:ie.response&&typeof ie.response=="string"?JSON.parse(ie.response):ie.responseText?JSON.parse(ie.responseText):null}function He(ie,G,N,W){var ne,we=new XMLHttpRequest;try{we.responseType="json"}catch{}we.onreadystatechange=function(){if(we.readyState===4)if(we.status===200)ne=Ne(we),N(ne);else try{ne=Ne(we),N(ne)}catch(Be){W&&W(Be)}};try{we.open(["G","E","T"].join(""),ie,!0)}catch{we.open(["G","E","T"].join(""),G+"/"+ie,!0)}we.send()}return{load:He}}()),be.data.type==="loadAnimation")I.assetLoader.load(be.data.path,be.data.fullPath,function(Ne){I.dataManager.completeData(Ne),I.postMessage({id:be.data.id,payload:Ne,status:"success"})},function(){I.postMessage({id:be.data.id,status:"error"})});else if(be.data.type==="complete"){var te=be.data.animation;I.dataManager.completeData(te),I.postMessage({id:be.data.id,payload:te,status:"success"})}else be.data.type==="loadData"&&I.assetLoader.load(be.data.path,be.data.fullPath,function(Ne){I.postMessage({id:be.data.id,payload:Ne,status:"success"})},function(){I.postMessage({id:be.data.id,status:"error"})})})).onmessage=function(be){var de=be.data,te=de.id,Ne=M[te];M[te]=null,de.status==="success"?Ne.onComplete(de.payload):Ne.onError&&Ne.onError()})}function ue(be,de){var te="processId_"+(w+=1);return M[te]={onComplete:be,onError:de},te}function Ce(be,de,te){$();var Ne=ue(de,te);m.postMessage({type:"loadAnimation",path:be,fullPath:window.location.origin+window.location.pathname,id:Ne})}function Ve(be,de,te){$();var Ne=ue(de,te);m.postMessage({type:"loadData",path:be,fullPath:window.location.origin+window.location.pathname,id:Ne})}function ee(be,de,te){$();var Ne=ue(de,te);m.postMessage({type:"complete",animation:be,id:Ne})}return{loadAnimation:Ce,loadData:Ve,completeAnimation:ee}}(),at=function(){var u=function(){var ie=l("canvas");ie.width=1,ie.height=1;var G=ie.getContext("2d");return G.fillStyle="rgba(0,0,0,0)",G.fillRect(0,0,1,1),ie}();function m(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function w(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function M(ie,G,N){var W="";if(ie.e)W=ie.p;else if(G){var ne=ie.p;ne.indexOf("images/")!==-1&&(ne=ne.split("/")[1]),W=G+ne}else W=N,W+=ie.u?ie.u:"",W+=ie.p;return W}function x(ie){var G=0,N=setInterval((function(){(ie.getBBox().width||G>500)&&(this._imageLoaded(),clearInterval(N)),G+=1}).bind(this),50)}function I(ie){var G=M(ie,this.assetsPath,this.path),N=ke("image");v?this.testImageLoaded(N):N.addEventListener("load",this._imageLoaded,!1),N.addEventListener("error",(function(){W.img=u,this._imageLoaded()}).bind(this),!1),N.setAttributeNS("http://www.w3.org/1999/xlink","href",G),this._elementHelper.append?this._elementHelper.append(N):this._elementHelper.appendChild(N);var W={img:N,assetData:ie};return W}function q(ie){var G=M(ie,this.assetsPath,this.path),N=l("img");N.crossOrigin="anonymous",N.addEventListener("load",this._imageLoaded,!1),N.addEventListener("error",(function(){W.img=u,this._imageLoaded()}).bind(this),!1),N.src=G;var W={img:N,assetData:ie};return W}function $(ie){var G={assetData:ie},N=M(ie,this.assetsPath,this.path);return ht.loadData(N,(function(W){G.img=W,this._footageLoaded()}).bind(this),(function(){G.img={},this._footageLoaded()}).bind(this)),G}function ue(ie,G){var N;this.imagesLoadedCb=G;var W=ie.length;for(N=0;N<W;N+=1)ie[N].layers||(ie[N].t&&ie[N].t!=="seq"?ie[N].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(ie[N]))):(this.totalImages+=1,this.images.push(this._createImageData(ie[N]))))}function Ce(ie){this.path=ie||""}function Ve(ie){this.assetsPath=ie||""}function ee(ie){for(var G=0,N=this.images.length;G<N;){if(this.images[G].assetData===ie)return this.images[G].img;G+=1}return null}function be(){this.imagesLoadedCb=null,this.images.length=0}function de(){return this.totalImages===this.loadedAssets}function te(){return this.totalFootages===this.loadedFootagesCount}function Ne(ie,G){ie==="svg"?(this._elementHelper=G,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function He(){this._imageLoaded=m.bind(this),this._footageLoaded=w.bind(this),this.testImageLoaded=x.bind(this),this.createFootageData=$.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return He.prototype={loadAssets:ue,setAssetsPath:Ve,setPath:Ce,loadedImages:de,loadedFootages:te,destroy:be,getAsset:ee,createImgData:q,createImageData:I,imageLoaded:m,footageLoaded:w,setCacheType:Ne},He}();function Ke(){}Ke.prototype={triggerEvent:function(u,m){if(this._cbs[u])for(var w=this._cbs[u],M=0;M<w.length;M+=1)w[M](m)},addEventListener:function(u,m){return this._cbs[u]||(this._cbs[u]=[]),this._cbs[u].push(m),(function(){this.removeEventListener(u,m)}).bind(this)},removeEventListener:function(u,m){if(m){if(this._cbs[u]){for(var w=0,M=this._cbs[u].length;w<M;)this._cbs[u][w]===m&&(this._cbs[u].splice(w,1),w-=1,M-=1),w+=1;this._cbs[u].length||(this._cbs[u]=null)}}else this._cbs[u]=null}};var tt=function(){function u(m){for(var w,M=m.split(`\r
`),x={},I=0,q=0;q<M.length;q+=1)(w=M[q].split(":")).length===2&&(x[w[0]]=w[1].trim(),I+=1);if(I===0)throw new Error;return x}return function(m){for(var w=[],M=0;M<m.length;M+=1){var x=m[M],I={time:x.tm,duration:x.dr};try{I.payload=JSON.parse(m[M].cm)}catch{try{I.payload=u(m[M].cm)}catch{I.payload={name:m[M].cm}}}w.push(I)}return w}}(),lt=function(){function u(m){this.compositions.push(m)}return function(){function m(w){for(var M=0,x=this.compositions.length;M<x;){if(this.compositions[M].data&&this.compositions[M].data.nm===w)return this.compositions[M].prepareFrame&&this.compositions[M].data.xt&&this.compositions[M].prepareFrame(this.currentFrame),this.compositions[M].compInterface;M+=1}return null}return m.compositions=[],m.currentFrame=0,m.registerComposition=u,m}}(),qe={},X=function(u,m){qe[u]=m};function F(u){return qe[u]}function re(){if(qe.canvas)return"canvas";for(var u in qe)if(qe[u])return u;return""}function Ie(u){return Ie=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},Ie(u)}var ce=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=Te(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=se(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=lt(),this.imagePreloader=new at,this.audioController=d(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new C("drawnFrame",0,0,0),this.expressionsPlugin=me()};c([Ke],ce),ce.prototype.setParams=function(u){(u.wrapper||u.container)&&(this.wrapper=u.wrapper||u.container);var m="svg";u.animType?m=u.animType:u.renderer&&(m=u.renderer);var w=F(m);this.renderer=new w(this,u.rendererSettings),this.imagePreloader.setCacheType(m,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=m,u.loop===""||u.loop===null||u.loop===void 0||u.loop===!0?this.loop=!0:u.loop===!1?this.loop=!1:this.loop=parseInt(u.loop,10),this.autoplay=!("autoplay"in u)||u.autoplay,this.name=u.name?u.name:"",this.autoloadSegments=!Object.prototype.hasOwnProperty.call(u,"autoloadSegments")||u.autoloadSegments,this.assetsPath=u.assetsPath,this.initialSegment=u.initialSegment,u.audioFactory&&this.audioController.setAudioFactory(u.audioFactory),u.animationData?this.setupAnimation(u.animationData):u.path&&(u.path.lastIndexOf("\\")!==-1?this.path=u.path.substr(0,u.path.lastIndexOf("\\")+1):this.path=u.path.substr(0,u.path.lastIndexOf("/")+1),this.fileName=u.path.substr(u.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),ht.loadAnimation(u.path,this.configAnimation,this.onSetupError))},ce.prototype.onSetupError=function(){this.trigger("data_failed")},ce.prototype.setupAnimation=function(u){ht.completeAnimation(u,this.configAnimation)},ce.prototype.setData=function(u,m){m&&Ie(m)!=="object"&&(m=JSON.parse(m));var w={wrapper:u,animationData:m},M=u.attributes;w.path=M.getNamedItem("data-animation-path")?M.getNamedItem("data-animation-path").value:M.getNamedItem("data-bm-path")?M.getNamedItem("data-bm-path").value:M.getNamedItem("bm-path")?M.getNamedItem("bm-path").value:"",w.animType=M.getNamedItem("data-anim-type")?M.getNamedItem("data-anim-type").value:M.getNamedItem("data-bm-type")?M.getNamedItem("data-bm-type").value:M.getNamedItem("bm-type")?M.getNamedItem("bm-type").value:M.getNamedItem("data-bm-renderer")?M.getNamedItem("data-bm-renderer").value:M.getNamedItem("bm-renderer")?M.getNamedItem("bm-renderer").value:re()||"canvas";var x=M.getNamedItem("data-anim-loop")?M.getNamedItem("data-anim-loop").value:M.getNamedItem("data-bm-loop")?M.getNamedItem("data-bm-loop").value:M.getNamedItem("bm-loop")?M.getNamedItem("bm-loop").value:"";x==="false"?w.loop=!1:x==="true"?w.loop=!0:x!==""&&(w.loop=parseInt(x,10));var I=M.getNamedItem("data-anim-autoplay")?M.getNamedItem("data-anim-autoplay").value:M.getNamedItem("data-bm-autoplay")?M.getNamedItem("data-bm-autoplay").value:!M.getNamedItem("bm-autoplay")||M.getNamedItem("bm-autoplay").value;w.autoplay=I!=="false",w.name=M.getNamedItem("data-name")?M.getNamedItem("data-name").value:M.getNamedItem("data-bm-name")?M.getNamedItem("data-bm-name").value:M.getNamedItem("bm-name")?M.getNamedItem("bm-name").value:"",(M.getNamedItem("data-anim-prerender")?M.getNamedItem("data-anim-prerender").value:M.getNamedItem("data-bm-prerender")?M.getNamedItem("data-bm-prerender").value:M.getNamedItem("bm-prerender")?M.getNamedItem("bm-prerender").value:"")==="false"&&(w.prerender=!1),w.path?this.setParams(w):this.trigger("destroy")},ce.prototype.includeLayers=function(u){u.op>this.animationData.op&&(this.animationData.op=u.op,this.totalFrames=Math.floor(u.op-this.animationData.ip));var m,w,M=this.animationData.layers,x=M.length,I=u.layers,q=I.length;for(w=0;w<q;w+=1)for(m=0;m<x;){if(M[m].id===I[w].id){M[m]=I[w];break}m+=1}if((u.chars||u.fonts)&&(this.renderer.globalData.fontManager.addChars(u.chars),this.renderer.globalData.fontManager.addFonts(u.fonts,this.renderer.globalData.defs)),u.assets)for(x=u.assets.length,m=0;m<x;m+=1)this.animationData.assets.push(u.assets[m]);this.animationData.__complete=!1,ht.completeAnimation(this.animationData,this.onSegmentComplete)},ce.prototype.onSegmentComplete=function(u){this.animationData=u;var m=me();m&&m.initExpressions(this),this.loadNextSegment()},ce.prototype.loadNextSegment=function(){var u=this.animationData.segments;if(!u||u.length===0||!this.autoloadSegments)return this.trigger("data_ready"),void(this.timeCompleted=this.totalFrames);var m=u.shift();this.timeCompleted=m.time*this.frameRate;var w=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,ht.loadData(w,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},ce.prototype.loadSegments=function(){this.animationData.segments||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},ce.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},ce.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},ce.prototype.configAnimation=function(u){if(this.renderer)try{this.animationData=u,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(u),u.assets||(u.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(u.assets),this.markers=tt(u.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(m){this.triggerConfigError(m)}},ce.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},ce.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var u=me();u&&u.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},ce.prototype.resize=function(u,m){var w=typeof u=="number"?u:void 0,M=typeof m=="number"?m:void 0;this.renderer.updateContainerSize(w,M)},ce.prototype.setSubframe=function(u){this.isSubframeEnabled=!!u},ce.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},ce.prototype.renderFrame=function(){if(this.isLoaded!==!1&&this.renderer)try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(u){this.triggerRenderFrameError(u)}},ce.prototype.play=function(u){u&&this.name!==u||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},ce.prototype.pause=function(u){u&&this.name!==u||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},ce.prototype.togglePause=function(u){u&&this.name!==u||(this.isPaused===!0?this.play():this.pause())},ce.prototype.stop=function(u){u&&this.name!==u||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},ce.prototype.getMarkerData=function(u){for(var m,w=0;w<this.markers.length;w+=1)if((m=this.markers[w]).payload&&m.payload.name===u)return m;return null},ce.prototype.goToAndStop=function(u,m,w){if(!w||this.name===w){var M=Number(u);if(isNaN(M)){var x=this.getMarkerData(u);x&&this.goToAndStop(x.time,!0)}else m?this.setCurrentRawFrameValue(u):this.setCurrentRawFrameValue(u*this.frameModifier);this.pause()}},ce.prototype.goToAndPlay=function(u,m,w){if(!w||this.name===w){var M=Number(u);if(isNaN(M)){var x=this.getMarkerData(u);x&&(x.duration?this.playSegments([x.time,x.time+x.duration],!0):this.goToAndStop(x.time,!0))}else this.goToAndStop(M,m,w);this.play()}},ce.prototype.advanceTime=function(u){if(this.isPaused!==!0&&this.isLoaded!==!1){var m=this.currentRawFrame+u*this.frameModifier,w=!1;m>=this.totalFrames-1&&this.frameModifier>0?this.loop&&this.playCount!==this.loop?m>=this.totalFrames?(this.playCount+=1,this.checkSegments(m%this.totalFrames)||(this.setCurrentRawFrameValue(m%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(m):this.checkSegments(m>this.totalFrames?m%this.totalFrames:0)||(w=!0,m=this.totalFrames-1):m<0?this.checkSegments(m%this.totalFrames)||(!this.loop||this.playCount--<=0&&this.loop!==!0?(w=!0,m=0):(this.setCurrentRawFrameValue(this.totalFrames+m%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0)):this.setCurrentRawFrameValue(m),w&&(this.setCurrentRawFrameValue(m),this.pause(),this.trigger("complete"))}},ce.prototype.adjustSegment=function(u,m){this.playCount=0,u[1]<u[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=u[0]-u[1],this.timeCompleted=this.totalFrames,this.firstFrame=u[1],this.setCurrentRawFrameValue(this.totalFrames-.001-m)):u[1]>u[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=u[1]-u[0],this.timeCompleted=this.totalFrames,this.firstFrame=u[0],this.setCurrentRawFrameValue(.001+m)),this.trigger("segmentStart")},ce.prototype.setSegment=function(u,m){var w=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<u?w=u:this.currentRawFrame+this.firstFrame>m&&(w=m-u)),this.firstFrame=u,this.totalFrames=m-u,this.timeCompleted=this.totalFrames,w!==-1&&this.goToAndStop(w,!0)},ce.prototype.playSegments=function(u,m){if(m&&(this.segments.length=0),Ie(u[0])==="object"){var w,M=u.length;for(w=0;w<M;w+=1)this.segments.push(u[w])}else this.segments.push(u);this.segments.length&&m&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},ce.prototype.resetSegments=function(u){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),u&&this.checkSegments(0)},ce.prototype.checkSegments=function(u){return!!this.segments.length&&(this.adjustSegment(this.segments.shift(),u),!0)},ce.prototype.destroy=function(u){u&&this.name!==u||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},ce.prototype.setCurrentRawFrameValue=function(u){this.currentRawFrame=u,this.gotoFrame()},ce.prototype.setSpeed=function(u){this.playSpeed=u,this.updaFrameModifier()},ce.prototype.setDirection=function(u){this.playDirection=u<0?-1:1,this.updaFrameModifier()},ce.prototype.setLoop=function(u){this.loop=u},ce.prototype.setVolume=function(u,m){m&&this.name!==m||this.audioController.setVolume(u)},ce.prototype.getVolume=function(){return this.audioController.getVolume()},ce.prototype.mute=function(u){u&&this.name!==u||this.audioController.mute()},ce.prototype.unmute=function(u){u&&this.name!==u||this.audioController.unmute()},ce.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},ce.prototype.getPath=function(){return this.path},ce.prototype.getAssetsPath=function(u){var m="";if(u.e)m=u.p;else if(this.assetsPath){var w=u.p;w.indexOf("images/")!==-1&&(w=w.split("/")[1]),m=this.assetsPath+w}else m=this.path,m+=u.u?u.u:"",m+=u.p;return m},ce.prototype.getAssetData=function(u){for(var m=0,w=this.assets.length;m<w;){if(u===this.assets[m].id)return this.assets[m];m+=1}return null},ce.prototype.hide=function(){this.renderer.hide()},ce.prototype.show=function(){this.renderer.show()},ce.prototype.getDuration=function(u){return u?this.totalFrames:this.totalFrames/this.frameRate},ce.prototype.updateDocumentData=function(u,m,w){try{this.renderer.getElementByPath(u).updateDocumentData(m,w)}catch{}},ce.prototype.trigger=function(u){if(this._cbs&&this._cbs[u])switch(u){case"enterFrame":this.triggerEvent(u,new C(u,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(u,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(u,new Z(u,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(u,new T(u,this.frameMult));break;case"segmentStart":this.triggerEvent(u,new z(u,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(u,new B(u,this));break;default:this.triggerEvent(u)}u==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new C(u,this.currentFrame,this.totalFrames,this.frameMult)),u==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new Z(u,this.loop,this.playCount,this.frameMult)),u==="complete"&&this.onComplete&&this.onComplete.call(this,new T(u,this.frameMult)),u==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new z(u,this.firstFrame,this.totalFrames)),u==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new B(u,this))},ce.prototype.triggerRenderFrameError=function(u){var m=new V(u,this.currentFrame);this.triggerEvent("error",m),this.onError&&this.onError.call(this,m)},ce.prototype.triggerConfigError=function(u){var m=new Y(u,this.currentFrame);this.triggerEvent("error",m),this.onError&&this.onError.call(this,m)};var Se=function(){var u={},m=[],w=0,M=0,x=0,I=!0,q=!1;function $(ae){for(var oe=0,P=ae.target;oe<M;)m[oe].animation===P&&(m.splice(oe,1),oe-=1,M-=1,P.isPaused||ee()),oe+=1}function ue(ae,oe){if(!ae)return null;for(var P=0;P<M;){if(m[P].elem===ae&&m[P].elem!==null)return m[P].animation;P+=1}var H=new ce;return be(H,ae),H.setData(ae,oe),H}function Ce(){var ae,oe=m.length,P=[];for(ae=0;ae<oe;ae+=1)P.push(m[ae].animation);return P}function Ve(){x+=1,Ct()}function ee(){x-=1}function be(ae,oe){ae.addEventListener("destroy",$),ae.addEventListener("_active",Ve),ae.addEventListener("_idle",ee),m.push({elem:oe,animation:ae}),M+=1}function de(ae){var oe=new ce;return be(oe,null),oe.setParams(ae),oe}function te(ae,oe){var P;for(P=0;P<M;P+=1)m[P].animation.setSpeed(ae,oe)}function Ne(ae,oe){var P;for(P=0;P<M;P+=1)m[P].animation.setDirection(ae,oe)}function He(ae){var oe;for(oe=0;oe<M;oe+=1)m[oe].animation.play(ae)}function ie(ae){var oe,P=ae-w;for(oe=0;oe<M;oe+=1)m[oe].animation.advanceTime(P);w=ae,x&&!q?window.requestAnimationFrame(ie):I=!0}function G(ae){w=ae,window.requestAnimationFrame(ie)}function N(ae){var oe;for(oe=0;oe<M;oe+=1)m[oe].animation.pause(ae)}function W(ae,oe,P){var H;for(H=0;H<M;H+=1)m[H].animation.goToAndStop(ae,oe,P)}function ne(ae){var oe;for(oe=0;oe<M;oe+=1)m[oe].animation.stop(ae)}function we(ae){var oe;for(oe=0;oe<M;oe+=1)m[oe].animation.togglePause(ae)}function Be(ae){var oe;for(oe=M-1;oe>=0;oe-=1)m[oe].animation.destroy(ae)}function xe(ae,oe,P){var H,Ae=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),Je=Ae.length;for(H=0;H<Je;H+=1)P&&Ae[H].setAttribute("data-bm-type",P),ue(Ae[H],ae);if(oe&&Je===0){P||(P="svg");var zt=document.getElementsByTagName("body")[0];zt.innerText="";var Rt=l("div");Rt.style.width="100%",Rt.style.height="100%",Rt.setAttribute("data-bm-type",P),zt.appendChild(Rt),ue(Rt,ae)}}function ct(){var ae;for(ae=0;ae<M;ae+=1)m[ae].animation.resize()}function Ct(){!q&&x&&I&&(window.requestAnimationFrame(G),I=!1)}function ot(){q=!0}function Vt(){q=!1,Ct()}function Tt(ae,oe){var P;for(P=0;P<M;P+=1)m[P].animation.setVolume(ae,oe)}function We(ae){var oe;for(oe=0;oe<M;oe+=1)m[oe].animation.mute(ae)}function Pe(ae){var oe;for(oe=0;oe<M;oe+=1)m[oe].animation.unmute(ae)}return u.registerAnimation=ue,u.loadAnimation=de,u.setSpeed=te,u.setDirection=Ne,u.play=He,u.pause=N,u.stop=ne,u.togglePause=we,u.searchAnimations=xe,u.resize=ct,u.goToAndStop=W,u.destroy=Be,u.freeze=ot,u.unfreeze=Vt,u.setVolume=Tt,u.mute=We,u.unmute=Pe,u.getRegisteredAnimations=Ce,u}(),Ge=function(){var u={};u.getBezierEasing=w;var m={};function w(G,N,W,ne,we){var Be=we||("bez_"+G+"_"+N+"_"+W+"_"+ne).replace(/\./g,"p");if(m[Be])return m[Be];var xe=new ie([G,N,W,ne]);return m[Be]=xe,xe}var M=4,x=.001,I=1e-7,q=10,$=11,ue=1/($-1),Ce=typeof Float32Array=="function";function Ve(G,N){return 1-3*N+3*G}function ee(G,N){return 3*N-6*G}function be(G){return 3*G}function de(G,N,W){return((Ve(N,W)*G+ee(N,W))*G+be(N))*G}function te(G,N,W){return 3*Ve(N,W)*G*G+2*ee(N,W)*G+be(N)}function Ne(G,N,W,ne,we){var Be,xe,ct=0;do(Be=de(xe=N+(W-N)/2,ne,we)-G)>0?W=xe:N=xe;while(Math.abs(Be)>I&&++ct<q);return xe}function He(G,N,W,ne){for(var we=0;we<M;++we){var Be=te(N,W,ne);if(Be===0)return N;N-=(de(N,W,ne)-G)/Be}return N}function ie(G){this._p=G,this._mSampleValues=Ce?new Float32Array($):new Array($),this._precomputed=!1,this.get=this.get.bind(this)}return ie.prototype={get:function(G){var N=this._p[0],W=this._p[1],ne=this._p[2],we=this._p[3];return this._precomputed||this._precompute(),N===W&&ne===we?G:G===0?0:G===1?1:de(this._getTForX(G),W,we)},_precompute:function(){var G=this._p[0],N=this._p[1],W=this._p[2],ne=this._p[3];this._precomputed=!0,G===N&&W===ne||this._calcSampleValues()},_calcSampleValues:function(){for(var G=this._p[0],N=this._p[2],W=0;W<$;++W)this._mSampleValues[W]=de(W*ue,G,N)},_getTForX:function(G){for(var N=this._p[0],W=this._p[2],ne=this._mSampleValues,we=0,Be=1,xe=$-1;Be!==xe&&ne[Be]<=G;++Be)we+=ue;var ct=we+(G-ne[--Be])/(ne[Be+1]-ne[Be])*ue,Ct=te(ct,N,W);return Ct>=x?He(G,ct,N,W):Ct===0?ct:Ne(G,we,we+ue,N,W)}},u}(),$e=function(){function u(m){return m.concat(p(m.length))}return{double:u}}(),Qe=function(u,m,w){var M=0,x=u,I=p(x);function q(){return M?I[M-=1]:m()}function $(ue){M===x&&(I=$e.double(I),x*=2),w&&w(ue),I[M]=ue,M+=1}return{newElement:q,release:$}},je=function(){function u(){return{addedLength:0,percents:f("float32",Ze()),lengths:f("float32",Ze())}}return Qe(8,u)}(),ze=function(){function u(){return{lengths:[],totalLength:0}}function m(w){var M,x=w.lengths.length;for(M=0;M<x;M+=1)je.release(w.lengths[M]);w.lengths.length=0}return Qe(8,u,m)}();function st(){var u=Math;function m(de,te,Ne,He,ie,G){var N=de*He+te*ie+Ne*G-ie*He-G*de-Ne*te;return N>-.001&&N<.001}function w(de,te,Ne,He,ie,G,N,W,ne){if(Ne===0&&G===0&&ne===0)return m(de,te,He,ie,N,W);var we,Be=u.sqrt(u.pow(He-de,2)+u.pow(ie-te,2)+u.pow(G-Ne,2)),xe=u.sqrt(u.pow(N-de,2)+u.pow(W-te,2)+u.pow(ne-Ne,2)),ct=u.sqrt(u.pow(N-He,2)+u.pow(W-ie,2)+u.pow(ne-G,2));return(we=Be>xe?Be>ct?Be-xe-ct:ct-xe-Be:ct>xe?ct-xe-Be:xe-Be-ct)>-1e-4&&we<1e-4}var M=function(de,te,Ne,He){var ie,G,N,W,ne,we,Be=Ze(),xe=0,ct=[],Ct=[],ot=je.newElement();for(N=Ne.length,ie=0;ie<Be;ie+=1){for(ne=ie/(Be-1),we=0,G=0;G<N;G+=1)W=S(1-ne,3)*de[G]+3*S(1-ne,2)*ne*Ne[G]+3*(1-ne)*S(ne,2)*He[G]+S(ne,3)*te[G],ct[G]=W,Ct[G]!==null&&(we+=S(ct[G]-Ct[G],2)),Ct[G]=ct[G];we&&(xe+=we=A(we)),ot.percents[ie]=ne,ot.lengths[ie]=xe}return ot.addedLength=xe,ot};function x(de){var te,Ne=ze.newElement(),He=de.c,ie=de.v,G=de.o,N=de.i,W=de._length,ne=Ne.lengths,we=0;for(te=0;te<W-1;te+=1)ne[te]=M(ie[te],ie[te+1],G[te],N[te+1]),we+=ne[te].addedLength;return He&&W&&(ne[te]=M(ie[te],ie[0],G[te],N[0]),we+=ne[te].addedLength),Ne.totalLength=we,Ne}function I(de){this.segmentLength=0,this.points=new Array(de)}function q(de,te){this.partialLength=de,this.point=te}var $,ue=($={},function(de,te,Ne,He){var ie=(de[0]+"_"+de[1]+"_"+te[0]+"_"+te[1]+"_"+Ne[0]+"_"+Ne[1]+"_"+He[0]+"_"+He[1]).replace(/\./g,"p");if(!$[ie]){var G,N,W,ne,we,Be,xe,ct=Ze(),Ct=0,ot=null;de.length===2&&(de[0]!==te[0]||de[1]!==te[1])&&m(de[0],de[1],te[0],te[1],de[0]+Ne[0],de[1]+Ne[1])&&m(de[0],de[1],te[0],te[1],te[0]+He[0],te[1]+He[1])&&(ct=2);var Vt=new I(ct);for(W=Ne.length,G=0;G<ct;G+=1){for(xe=p(W),we=G/(ct-1),Be=0,N=0;N<W;N+=1)ne=S(1-we,3)*de[N]+3*S(1-we,2)*we*(de[N]+Ne[N])+3*(1-we)*S(we,2)*(te[N]+He[N])+S(we,3)*te[N],xe[N]=ne,ot!==null&&(Be+=S(xe[N]-ot[N],2));Ct+=Be=A(Be),Vt.points[G]=new q(Be,xe),ot=xe}Vt.segmentLength=Ct,$[ie]=Vt}return $[ie]});function Ce(de,te){var Ne=te.percents,He=te.lengths,ie=Ne.length,G=E((ie-1)*de),N=de*te.addedLength,W=0;if(G===ie-1||G===0||N===He[G])return Ne[G];for(var ne=He[G]>N?-1:1,we=!0;we;)if(He[G]<=N&&He[G+1]>N?(W=(N-He[G])/(He[G+1]-He[G]),we=!1):G+=ne,G<0||G>=ie-1){if(G===ie-1)return Ne[G];we=!1}return Ne[G]+(Ne[G+1]-Ne[G])*W}function Ve(de,te,Ne,He,ie,G){var N=Ce(ie,G),W=1-N;return[u.round(1e3*(W*W*W*de[0]+(N*W*W+W*N*W+W*W*N)*Ne[0]+(N*N*W+W*N*N+N*W*N)*He[0]+N*N*N*te[0]))/1e3,u.round(1e3*(W*W*W*de[1]+(N*W*W+W*N*W+W*W*N)*Ne[1]+(N*N*W+W*N*N+N*W*N)*He[1]+N*N*N*te[1]))/1e3]}var ee=f("float32",8);function be(de,te,Ne,He,ie,G,N){ie<0?ie=0:ie>1&&(ie=1);var W,ne=Ce(ie,N),we=Ce(G=G>1?1:G,N),Be=de.length,xe=1-ne,ct=1-we,Ct=xe*xe*xe,ot=ne*xe*xe*3,Vt=ne*ne*xe*3,Tt=ne*ne*ne,We=xe*xe*ct,Pe=ne*xe*ct+xe*ne*ct+xe*xe*we,ae=ne*ne*ct+xe*ne*we+ne*xe*we,oe=ne*ne*we,P=xe*ct*ct,H=ne*ct*ct+xe*we*ct+xe*ct*we,Ae=ne*we*ct+xe*we*we+ne*ct*we,Je=ne*we*we,zt=ct*ct*ct,Rt=we*ct*ct+ct*we*ct+ct*ct*we,Ht=we*we*ct+ct*we*we+we*ct*we,Xt=we*we*we;for(W=0;W<Be;W+=1)ee[4*W]=u.round(1e3*(Ct*de[W]+ot*Ne[W]+Vt*He[W]+Tt*te[W]))/1e3,ee[4*W+1]=u.round(1e3*(We*de[W]+Pe*Ne[W]+ae*He[W]+oe*te[W]))/1e3,ee[4*W+2]=u.round(1e3*(P*de[W]+H*Ne[W]+Ae*He[W]+Je*te[W]))/1e3,ee[4*W+3]=u.round(1e3*(zt*de[W]+Rt*Ne[W]+Ht*He[W]+Xt*te[W]))/1e3;return ee}return{getSegmentsLength:x,getNewSegment:be,getPointInSegment:Ve,buildBezierData:ue,pointOnLine2D:m,pointOnLine3D:w}}var pt=st();function dt(u){return Mt(u)||mt(u)||it(u)||rt()}function rt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function it(u,m){if(u){if(typeof u=="string")return wt(u,m);var w=Object.prototype.toString.call(u).slice(8,-1);return w==="Object"&&u.constructor&&(w=u.constructor.name),w==="Map"||w==="Set"?Array.from(u):w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w)?wt(u,m):void 0}}function mt(u){if(typeof Symbol<"u"&&u[Symbol.iterator]!=null||u["@@iterator"]!=null)return Array.from(u)}function Mt(u){if(Array.isArray(u))return wt(u)}function wt(u,m){(m==null||m>u.length)&&(m=u.length);for(var w=0,M=new Array(m);w<m;w++)M[w]=u[w];return M}function L(u,m,w){return u*(1-w)+m*w}function ye(u,m,w){return[L(u[0],m[0],w),L(u[1],m[1],w)]}function _e(u,m){return u.map(function(w,M){return w+(m[M]||0)})}function Ue(u,m){return u.map(function(w,M){return w-(m[M]||0)})}function Xe(u){var m=Math.hypot.apply(Math,dt(u));return m>Number.EPSILON?u.map(function(w){return w/m}):u}function Pt(u,m,w,M,x){var I=[u,_e(u,m),_e(M,w),M],q=bt(I,x),$=bt(q,x),ue=Ue($[1],$[0]),Ce=Math.hypot.apply(Math,dt(ue));if(Ce>Number.EPSILON)return ue.map(function(te){return te/Ce});var Ve=Ue(q[2],q[0]),ee=Math.hypot.apply(Math,dt(Ve));if(ee>Number.EPSILON)return Ve.map(function(te){return te/ee});var be=Ue(q[1],q[0]),de=Math.hypot.apply(Math,dt(be));return de>Number.EPSILON?be.map(function(te){return te/de}):Xe(Ue(I[3],I[0]))}function bt(u,m){for(var w=[],M=0;M<u.length-1;M+=1)w.push(ye(u[M],u[M+1],m));return w}var _t=i,Ot=Math.abs;function St(u,m){var w,M=this.offsetTime;this.propType==="multidimensional"&&(w=f("float32",this.pv.length));for(var x,I,q,$,ue,Ce,Ve,ee,be,de=m.lastIndex,te=de,Ne=this.keyframes.length-1,He=!0;He;){if(x=this.keyframes[te],I=this.keyframes[te+1],te===Ne-1&&u>=I.t-M){x.h&&(x=I),de=0;break}if(I.t-M>u){de=te;break}te<Ne-1?te+=1:(de=0,He=!1)}q=this.keyframesMetadata[te]||{};var ie,G=I.t-M,N=x.t-M;if(x.to){q.bezierData||(q.bezierData=pt.buildBezierData(x.s,I.s||x.e,x.to,x.ti));var W=q.bezierData;if(u>=G||u<N){var ne=u>=G?W.points.length-1:0;for(ue=W.points[ne].point.length,$=0;$<ue;$+=1)w[$]=W.points[ne].point[$]}else{q.__fnct?be=q.__fnct:(be=Ge.getBezierEasing(x.o.x,x.o.y,x.i.x,x.i.y,x.n).get,q.__fnct=be),Ce=be((u-N)/(G-N));var we=x.s,Be=I.s||x.e;if(Ce>1)for(var xe=Pt(x.s,x.to,x.ti,I.s||x.e,1),ct=W.segmentLength*(Ce-1),Ct=0;Ct<Be.length;Ct+=1)w[Ct]=Be[Ct]+xe[Ct]*ct;else if(Ce<0)for(var ot=Pt(x.s,x.to,x.ti,I.s||x.e,0),Vt=W.segmentLength*Ce,Tt=0;Tt<we.length;Tt+=1)w[Tt]=we[Tt]+ot[Tt]*Vt;else{var We,Pe=W.segmentLength*Ce,ae=m.lastFrame<u&&m._lastKeyframeIndex===te?m._lastAddedLength:0;for(ee=m.lastFrame<u&&m._lastKeyframeIndex===te?m._lastPoint:0,He=!0,Ve=W.points.length;He;){if(ae+=W.points[ee].partialLength,Pe===0||Ce===0||ee===W.points.length-1){for(ue=W.points[ee].point.length,$=0;$<ue;$+=1)w[$]=W.points[ee].point[$];break}if(Pe>=ae&&Pe<ae+W.points[ee+1].partialLength){for(We=(Pe-ae)/W.points[ee+1].partialLength,ue=W.points[ee].point.length,$=0;$<ue;$+=1)w[$]=W.points[ee].point[$]+(W.points[ee+1].point[$]-W.points[ee].point[$])*We;break}ee<Ve-1?ee+=1:He=!1}m._lastPoint=ee,m._lastAddedLength=ae-W.points[ee].partialLength,m._lastKeyframeIndex=te}}}else{var oe,P,H,Ae,Je;if(Ne=x.s.length,ie=I.s||x.e,this.sh&&x.h!==1)u>=G?(w[0]=ie[0],w[1]=ie[1],w[2]=ie[2]):u<=N?(w[0]=x.s[0],w[1]=x.s[1],w[2]=x.s[2]):Lt(w,At(pi(x.s),pi(ie),(u-N)/(G-N)));else for(te=0;te<Ne;te+=1)x.h!==1&&(u>=G?Ce=1:u<N?Ce=0:(x.o.x.constructor===Array?(q.__fnct||(q.__fnct=[]),q.__fnct[te]?be=q.__fnct[te]:(oe=x.o.x[te]===void 0?x.o.x[0]:x.o.x[te],P=x.o.y[te]===void 0?x.o.y[0]:x.o.y[te],H=x.i.x[te]===void 0?x.i.x[0]:x.i.x[te],Ae=x.i.y[te]===void 0?x.i.y[0]:x.i.y[te],be=Ge.getBezierEasing(oe,P,H,Ae).get,q.__fnct[te]=be)):q.__fnct?be=q.__fnct:(oe=x.o.x,P=x.o.y,H=x.i.x,Ae=x.i.y,be=Ge.getBezierEasing(oe,P,H,Ae).get,x.keyframeMetadata=be),Ce=be((u-N)/(G-N)))),ie=I.s||x.e,Je=x.h===1?x.s[te]:x.s[te]+(ie[te]-x.s[te])*Ce,this.propType==="multidimensional"?w[te]=Je:w=Je}return m.lastIndex=de,w}function At(u,m,w){var M,x,I,q,$,ue=[],Ce=u[0],Ve=u[1],ee=u[2],be=u[3],de=m[0],te=m[1],Ne=m[2],He=m[3];return(x=Ce*de+Ve*te+ee*Ne+be*He)<0&&(x=-x,de=-de,te=-te,Ne=-Ne,He=-He),1-x>1e-6?(M=Math.acos(x),I=Math.sin(M),q=Math.sin((1-w)*M)/I,$=Math.sin(w*M)/I):(q=1-w,$=w),ue[0]=q*Ce+$*de,ue[1]=q*Ve+$*te,ue[2]=q*ee+$*Ne,ue[3]=q*be+$*He,ue}function Lt(u,m){var w=m[0],M=m[1],x=m[2],I=m[3],q=Math.atan2(2*M*I-2*w*x,1-2*M*M-2*x*x),$=Math.asin(2*w*M+2*x*I),ue=Math.atan2(2*w*I-2*M*x,1-2*w*w-2*x*x);u[0]=q/k,u[1]=$/k,u[2]=ue/k}function pi(u){var m=u[0]*k,w=u[1]*k,M=u[2]*k,x=Math.cos(m/2),I=Math.cos(w/2),q=Math.cos(M/2),$=Math.sin(m/2),ue=Math.sin(w/2),Ce=Math.sin(M/2);return[$*ue*q+x*I*Ce,$*I*q+x*ue*Ce,x*ue*q-$*I*Ce,x*I*q-$*ue*Ce]}function ii(){var u=this.comp.renderedFrame-this.offsetTime,m=this.keyframes[0].t-this.offsetTime,w=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(u===this._caching.lastFrame||this._caching.lastFrame!==_t&&(this._caching.lastFrame>=w&&u>=w||this._caching.lastFrame<m&&u<m))){this._caching.lastFrame>=u&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var M=this.interpolateValue(u,this._caching);this.pv=M}return this._caching.lastFrame=u,this.pv}function Qt(u){var m;if(this.propType==="unidimensional")m=u*this.mult,Ot(this.v-m)>1e-5&&(this.v=m,this._mdf=!0);else for(var w=0,M=this.v.length;w<M;)m=u[w]*this.mult,Ot(this.v[w]-m)>1e-5&&(this.v[w]=m,this._mdf=!0),w+=1}function mi(){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var u;this.lock=!0,this._mdf=this._isFirstFrame;var m=this.effectsSequence.length,w=this.kf?this.pv:this.data.k;for(u=0;u<m;u+=1)w=this.effectsSequence[u](w);this.setVValue(w),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function Ri(u){this.effectsSequence.push(u),this.container.addDynamicProperty(this)}function Ki(u,m,w,M){this.propType="unidimensional",this.mult=w||1,this.data=m,this.v=w?m.k*w:m.k,this.pv=m.k,this._mdf=!1,this.elem=u,this.container=M,this.comp=u.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=mi,this.setVValue=Qt,this.addEffect=Ri}function En(u,m,w,M){var x;this.propType="multidimensional",this.mult=w||1,this.data=m,this._mdf=!1,this.elem=u,this.container=M,this.comp=u.comp,this.k=!1,this.kf=!1,this.frameId=-1;var I=m.k.length;for(this.v=f("float32",I),this.pv=f("float32",I),this.vel=f("float32",I),x=0;x<I;x+=1)this.v[x]=m.k[x]*this.mult,this.pv[x]=m.k[x];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=mi,this.setVValue=Qt,this.addEffect=Ri}function un(u,m,w,M){this.propType="unidimensional",this.keyframes=m.k,this.keyframesMetadata=[],this.offsetTime=u.data.st,this.frameId=-1,this._caching={lastFrame:_t,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=m,this.mult=w||1,this.elem=u,this.container=M,this.comp=u.comp,this.v=_t,this.pv=_t,this._isFirstFrame=!0,this.getValue=mi,this.setVValue=Qt,this.interpolateValue=St,this.effectsSequence=[ii.bind(this)],this.addEffect=Ri}function Qi(u,m,w,M){var x;this.propType="multidimensional";var I,q,$,ue,Ce=m.k.length;for(x=0;x<Ce-1;x+=1)m.k[x].to&&m.k[x].s&&m.k[x+1]&&m.k[x+1].s&&(I=m.k[x].s,q=m.k[x+1].s,$=m.k[x].to,ue=m.k[x].ti,(I.length===2&&(I[0]!==q[0]||I[1]!==q[1])&&pt.pointOnLine2D(I[0],I[1],q[0],q[1],I[0]+$[0],I[1]+$[1])&&pt.pointOnLine2D(I[0],I[1],q[0],q[1],q[0]+ue[0],q[1]+ue[1])||I.length===3&&(I[0]!==q[0]||I[1]!==q[1]||I[2]!==q[2])&&pt.pointOnLine3D(I[0],I[1],I[2],q[0],q[1],q[2],I[0]+$[0],I[1]+$[1],I[2]+$[2])&&pt.pointOnLine3D(I[0],I[1],I[2],q[0],q[1],q[2],q[0]+ue[0],q[1]+ue[1],q[2]+ue[2]))&&(m.k[x].to=null,m.k[x].ti=null),I[0]===q[0]&&I[1]===q[1]&&$[0]===0&&$[1]===0&&ue[0]===0&&ue[1]===0&&(I.length===2||I[2]===q[2]&&$[2]===0&&ue[2]===0)&&(m.k[x].to=null,m.k[x].ti=null));this.effectsSequence=[ii.bind(this)],this.data=m,this.keyframes=m.k,this.keyframesMetadata=[],this.offsetTime=u.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=w||1,this.elem=u,this.container=M,this.comp=u.comp,this.getValue=mi,this.setVValue=Qt,this.interpolateValue=St,this.frameId=-1;var Ve=m.k[0].s.length;for(this.v=f("float32",Ve),this.pv=f("float32",Ve),x=0;x<Ve;x+=1)this.v[x]=_t,this.pv[x]=_t;this._caching={lastFrame:_t,lastIndex:0,value:f("float32",Ve)},this.addEffect=Ri}var ft=function(){function u(m,w,M,x,I){var q;if(w.sid&&(w=m.globalData.slotManager.getProp(w)),w.k.length)if(typeof w.k[0]=="number")q=new En(m,w,x,I);else switch(M){case 0:q=new un(m,w,x,I);break;case 1:q=new Qi(m,w,x,I)}else q=new Ki(m,w,x,I);return q.effectsSequence.length&&I.addDynamicProperty(q),q}return{getProp:u}}();function gi(){}gi.prototype={addDynamicProperty:function(u){this.dynamicProperties.indexOf(u)===-1&&(this.dynamicProperties.push(u),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){var u;this._mdf=!1;var m=this.dynamicProperties.length;for(u=0;u<m;u+=1)this.dynamicProperties[u].getValue(),this.dynamicProperties[u]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(u){this.container=u,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var j=function(){function u(){return f("float32",2)}return Qe(8,u)}();function Me(){this.c=!1,this._length=0,this._maxLength=8,this.v=p(this._maxLength),this.o=p(this._maxLength),this.i=p(this._maxLength)}Me.prototype.setPathData=function(u,m){this.c=u,this.setLength(m);for(var w=0;w<m;)this.v[w]=j.newElement(),this.o[w]=j.newElement(),this.i[w]=j.newElement(),w+=1},Me.prototype.setLength=function(u){for(;this._maxLength<u;)this.doubleArrayLength();this._length=u},Me.prototype.doubleArrayLength=function(){this.v=this.v.concat(p(this._maxLength)),this.i=this.i.concat(p(this._maxLength)),this.o=this.o.concat(p(this._maxLength)),this._maxLength*=2},Me.prototype.setXYAt=function(u,m,w,M,x){var I;switch(this._length=Math.max(this._length,M+1),this._length>=this._maxLength&&this.doubleArrayLength(),w){case"v":I=this.v;break;case"i":I=this.i;break;case"o":I=this.o;break;default:I=[]}(!I[M]||I[M]&&!x)&&(I[M]=j.newElement()),I[M][0]=u,I[M][1]=m},Me.prototype.setTripleAt=function(u,m,w,M,x,I,q,$){this.setXYAt(u,m,"v",q,$),this.setXYAt(w,M,"o",q,$),this.setXYAt(x,I,"i",q,$)},Me.prototype.reverse=function(){var u=new Me;u.setPathData(this.c,this._length);var m=this.v,w=this.o,M=this.i,x=0;this.c&&(u.setTripleAt(m[0][0],m[0][1],M[0][0],M[0][1],w[0][0],w[0][1],0,!1),x=1);var I,q=this._length-1,$=this._length;for(I=x;I<$;I+=1)u.setTripleAt(m[q][0],m[q][1],M[q][0],M[q][1],w[q][0],w[q][1],I,!1),q-=1;return u},Me.prototype.length=function(){return this._length};var De=function(){function u(){return new Me}function m(x){var I,q=x._length;for(I=0;I<q;I+=1)j.release(x.v[I]),j.release(x.i[I]),j.release(x.o[I]),x.v[I]=null,x.i[I]=null,x.o[I]=null;x._length=0,x.c=!1}function w(x){var I,q=M.newElement(),$=x._length===void 0?x.v.length:x._length;for(q.setLength($),q.c=x.c,I=0;I<$;I+=1)q.setTripleAt(x.v[I][0],x.v[I][1],x.o[I][0],x.o[I][1],x.i[I][0],x.i[I][1],I);return q}var M=Qe(4,u,m);return M.clone=w,M}();function Re(){this._length=0,this._maxLength=4,this.shapes=p(this._maxLength)}Re.prototype.addShape=function(u){this._length===this._maxLength&&(this.shapes=this.shapes.concat(p(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=u,this._length+=1},Re.prototype.releaseShapes=function(){var u;for(u=0;u<this._length;u+=1)De.release(this.shapes[u]);this._length=0};var Le=function(){var u={newShapeCollection:x,release:I},m=0,w=4,M=p(w);function x(){return m?M[m-=1]:new Re}function I(q){var $,ue=q._length;for($=0;$<ue;$+=1)De.release(q.shapes[$]);q._length=0,m===w&&(M=$e.double(M),w*=2),M[m]=q,m+=1}return u}(),gt=function(){var u=-999999;function m(ie,G,N){var W,ne,we,Be,xe,ct,Ct,ot,Vt,Tt=N.lastIndex,We=this.keyframes;if(ie<We[0].t-this.offsetTime)W=We[0].s[0],we=!0,Tt=0;else if(ie>=We[We.length-1].t-this.offsetTime)W=We[We.length-1].s?We[We.length-1].s[0]:We[We.length-2].e[0],we=!0;else{for(var Pe,ae,oe,P=Tt,H=We.length-1,Ae=!0;Ae&&(Pe=We[P],!((ae=We[P+1]).t-this.offsetTime>ie));)P<H-1?P+=1:Ae=!1;if(oe=this.keyframesMetadata[P]||{},Tt=P,!(we=Pe.h===1)){if(ie>=ae.t-this.offsetTime)ot=1;else if(ie<Pe.t-this.offsetTime)ot=0;else{var Je;oe.__fnct?Je=oe.__fnct:(Je=Ge.getBezierEasing(Pe.o.x,Pe.o.y,Pe.i.x,Pe.i.y).get,oe.__fnct=Je),ot=Je((ie-(Pe.t-this.offsetTime))/(ae.t-this.offsetTime-(Pe.t-this.offsetTime)))}ne=ae.s?ae.s[0]:Pe.e[0]}W=Pe.s[0]}for(ct=G._length,Ct=W.i[0].length,N.lastIndex=Tt,Be=0;Be<ct;Be+=1)for(xe=0;xe<Ct;xe+=1)Vt=we?W.i[Be][xe]:W.i[Be][xe]+(ne.i[Be][xe]-W.i[Be][xe])*ot,G.i[Be][xe]=Vt,Vt=we?W.o[Be][xe]:W.o[Be][xe]+(ne.o[Be][xe]-W.o[Be][xe])*ot,G.o[Be][xe]=Vt,Vt=we?W.v[Be][xe]:W.v[Be][xe]+(ne.v[Be][xe]-W.v[Be][xe])*ot,G.v[Be][xe]=Vt}function w(){var ie=this.comp.renderedFrame-this.offsetTime,G=this.keyframes[0].t-this.offsetTime,N=this.keyframes[this.keyframes.length-1].t-this.offsetTime,W=this._caching.lastFrame;return W!==u&&(W<G&&ie<G||W>N&&ie>N)||(this._caching.lastIndex=W<ie?this._caching.lastIndex:0,this.interpolateShape(ie,this.pv,this._caching)),this._caching.lastFrame=ie,this.pv}function M(){this.paths=this.localShapeCollection}function x(ie,G){if(ie._length!==G._length||ie.c!==G.c)return!1;var N,W=ie._length;for(N=0;N<W;N+=1)if(ie.v[N][0]!==G.v[N][0]||ie.v[N][1]!==G.v[N][1]||ie.o[N][0]!==G.o[N][0]||ie.o[N][1]!==G.o[N][1]||ie.i[N][0]!==G.i[N][0]||ie.i[N][1]!==G.i[N][1])return!1;return!0}function I(ie){x(this.v,ie)||(this.v=De.clone(ie),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function q(){if(this.elem.globalData.frameId!==this.frameId)if(this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var ie,G;this.lock=!0,this._mdf=!1,ie=this.kf?this.pv:this.data.ks?this.data.ks.k:this.data.pt.k;var N=this.effectsSequence.length;for(G=0;G<N;G+=1)ie=this.effectsSequence[G](ie);this.setVValue(ie),this.lock=!1,this.frameId=this.elem.globalData.frameId}else this._mdf=!1}function $(ie,G,N){this.propType="shape",this.comp=ie.comp,this.container=ie,this.elem=ie,this.data=G,this.k=!1,this.kf=!1,this._mdf=!1;var W=N===3?G.pt.k:G.ks.k;this.v=De.clone(W),this.pv=De.clone(this.v),this.localShapeCollection=Le.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=M,this.effectsSequence=[]}function ue(ie){this.effectsSequence.push(ie),this.container.addDynamicProperty(this)}function Ce(ie,G,N){this.propType="shape",this.comp=ie.comp,this.elem=ie,this.container=ie,this.offsetTime=ie.data.st,this.keyframes=N===3?G.pt.k:G.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var W=this.keyframes[0].s[0].i.length;this.v=De.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,W),this.pv=De.clone(this.v),this.localShapeCollection=Le.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=u,this.reset=M,this._caching={lastFrame:u,lastIndex:0},this.effectsSequence=[w.bind(this)]}$.prototype.interpolateShape=m,$.prototype.getValue=q,$.prototype.setVValue=I,$.prototype.addEffect=ue,Ce.prototype.getValue=q,Ce.prototype.interpolateShape=m,Ce.prototype.setVValue=I,Ce.prototype.addEffect=ue;var Ve=function(){var ie=U;function G(N,W){this.v=De.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=Le.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=W.d,this.elem=N,this.comp=N.comp,this.frameId=-1,this.initDynamicPropertyContainer(N),this.p=ft.getProp(N,W.p,1,0,this),this.s=ft.getProp(N,W.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return G.prototype={reset:M,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var N=this.p.v[0],W=this.p.v[1],ne=this.s.v[0]/2,we=this.s.v[1]/2,Be=this.d!==3,xe=this.v;xe.v[0][0]=N,xe.v[0][1]=W-we,xe.v[1][0]=Be?N+ne:N-ne,xe.v[1][1]=W,xe.v[2][0]=N,xe.v[2][1]=W+we,xe.v[3][0]=Be?N-ne:N+ne,xe.v[3][1]=W,xe.i[0][0]=Be?N-ne*ie:N+ne*ie,xe.i[0][1]=W-we,xe.i[1][0]=Be?N+ne:N-ne,xe.i[1][1]=W-we*ie,xe.i[2][0]=Be?N+ne*ie:N-ne*ie,xe.i[2][1]=W+we,xe.i[3][0]=Be?N-ne:N+ne,xe.i[3][1]=W+we*ie,xe.o[0][0]=Be?N+ne*ie:N-ne*ie,xe.o[0][1]=W-we,xe.o[1][0]=Be?N+ne:N-ne,xe.o[1][1]=W+we*ie,xe.o[2][0]=Be?N-ne*ie:N+ne*ie,xe.o[2][1]=W+we,xe.o[3][0]=Be?N-ne:N+ne,xe.o[3][1]=W-we*ie}},c([gi],G),G}(),ee=function(){function ie(G,N){this.v=De.newElement(),this.v.setPathData(!0,0),this.elem=G,this.comp=G.comp,this.data=N,this.frameId=-1,this.d=N.d,this.initDynamicPropertyContainer(G),N.sy===1?(this.ir=ft.getProp(G,N.ir,0,0,this),this.is=ft.getProp(G,N.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=ft.getProp(G,N.pt,0,0,this),this.p=ft.getProp(G,N.p,1,0,this),this.r=ft.getProp(G,N.r,0,k,this),this.or=ft.getProp(G,N.or,0,0,this),this.os=ft.getProp(G,N.os,0,.01,this),this.localShapeCollection=Le.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return ie.prototype={reset:M,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var G,N,W,ne,we=2*Math.floor(this.pt.v),Be=2*Math.PI/we,xe=!0,ct=this.or.v,Ct=this.ir.v,ot=this.os.v,Vt=this.is.v,Tt=2*Math.PI*ct/(2*we),We=2*Math.PI*Ct/(2*we),Pe=-Math.PI/2;Pe+=this.r.v;var ae=this.data.d===3?-1:1;for(this.v._length=0,G=0;G<we;G+=1){W=xe?ot:Vt,ne=xe?Tt:We;var oe=(N=xe?ct:Ct)*Math.cos(Pe),P=N*Math.sin(Pe),H=oe===0&&P===0?0:P/Math.sqrt(oe*oe+P*P),Ae=oe===0&&P===0?0:-oe/Math.sqrt(oe*oe+P*P);oe+=+this.p.v[0],P+=+this.p.v[1],this.v.setTripleAt(oe,P,oe-H*ne*W*ae,P-Ae*ne*W*ae,oe+H*ne*W*ae,P+Ae*ne*W*ae,G,!0),xe=!xe,Pe+=Be*ae}},convertPolygonToPath:function(){var G,N=Math.floor(this.pt.v),W=2*Math.PI/N,ne=this.or.v,we=this.os.v,Be=2*Math.PI*ne/(4*N),xe=.5*-Math.PI,ct=this.data.d===3?-1:1;for(xe+=this.r.v,this.v._length=0,G=0;G<N;G+=1){var Ct=ne*Math.cos(xe),ot=ne*Math.sin(xe),Vt=Ct===0&&ot===0?0:ot/Math.sqrt(Ct*Ct+ot*ot),Tt=Ct===0&&ot===0?0:-Ct/Math.sqrt(Ct*Ct+ot*ot);Ct+=+this.p.v[0],ot+=+this.p.v[1],this.v.setTripleAt(Ct,ot,Ct-Vt*Be*we*ct,ot-Tt*Be*we*ct,Ct+Vt*Be*we*ct,ot+Tt*Be*we*ct,G,!0),xe+=W*ct}this.paths.length=0,this.paths[0]=this.v}},c([gi],ie),ie}(),be=function(){function ie(G,N){this.v=De.newElement(),this.v.c=!0,this.localShapeCollection=Le.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=G,this.comp=G.comp,this.frameId=-1,this.d=N.d,this.initDynamicPropertyContainer(G),this.p=ft.getProp(G,N.p,1,0,this),this.s=ft.getProp(G,N.s,1,0,this),this.r=ft.getProp(G,N.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return ie.prototype={convertRectToPath:function(){var G=this.p.v[0],N=this.p.v[1],W=this.s.v[0]/2,ne=this.s.v[1]/2,we=O(W,ne,this.r.v),Be=we*(1-U);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(G+W,N-ne+we,G+W,N-ne+we,G+W,N-ne+Be,0,!0),this.v.setTripleAt(G+W,N+ne-we,G+W,N+ne-Be,G+W,N+ne-we,1,!0),we!==0?(this.v.setTripleAt(G+W-we,N+ne,G+W-we,N+ne,G+W-Be,N+ne,2,!0),this.v.setTripleAt(G-W+we,N+ne,G-W+Be,N+ne,G-W+we,N+ne,3,!0),this.v.setTripleAt(G-W,N+ne-we,G-W,N+ne-we,G-W,N+ne-Be,4,!0),this.v.setTripleAt(G-W,N-ne+we,G-W,N-ne+Be,G-W,N-ne+we,5,!0),this.v.setTripleAt(G-W+we,N-ne,G-W+we,N-ne,G-W+Be,N-ne,6,!0),this.v.setTripleAt(G+W-we,N-ne,G+W-Be,N-ne,G+W-we,N-ne,7,!0)):(this.v.setTripleAt(G-W,N+ne,G-W+Be,N+ne,G-W,N+ne,2),this.v.setTripleAt(G-W,N-ne,G-W,N-ne+Be,G-W,N-ne,3))):(this.v.setTripleAt(G+W,N-ne+we,G+W,N-ne+Be,G+W,N-ne+we,0,!0),we!==0?(this.v.setTripleAt(G+W-we,N-ne,G+W-we,N-ne,G+W-Be,N-ne,1,!0),this.v.setTripleAt(G-W+we,N-ne,G-W+Be,N-ne,G-W+we,N-ne,2,!0),this.v.setTripleAt(G-W,N-ne+we,G-W,N-ne+we,G-W,N-ne+Be,3,!0),this.v.setTripleAt(G-W,N+ne-we,G-W,N+ne-Be,G-W,N+ne-we,4,!0),this.v.setTripleAt(G-W+we,N+ne,G-W+we,N+ne,G-W+Be,N+ne,5,!0),this.v.setTripleAt(G+W-we,N+ne,G+W-Be,N+ne,G+W-we,N+ne,6,!0),this.v.setTripleAt(G+W,N+ne-we,G+W,N+ne-we,G+W,N+ne-Be,7,!0)):(this.v.setTripleAt(G-W,N-ne,G-W+Be,N-ne,G-W,N-ne,1,!0),this.v.setTripleAt(G-W,N+ne,G-W,N+ne-Be,G-W,N+ne,2,!0),this.v.setTripleAt(G+W,N+ne,G+W-Be,N+ne,G+W,N+ne,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:M},c([gi],ie),ie}();function de(ie,G,N){var W;return N===3||N===4?W=(N===3?G.pt:G.ks).k.length?new Ce(ie,G,N):new $(ie,G,N):N===5?W=new be(ie,G):N===6?W=new Ve(ie,G):N===7&&(W=new ee(ie,G)),W.k&&ie.addDynamicProperty(W),W}function te(){return $}function Ne(){return Ce}var He={};return He.getShapeProp=de,He.getConstructorFunction=te,He.getKeyframedConstructorFunction=Ne,He}(),vt=function(){var u=Math.cos,m=Math.sin,w=Math.tan,M=Math.round;function x(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function I(P){if(P===0)return this;var H=u(P),Ae=m(P);return this._t(H,-Ae,0,0,Ae,H,0,0,0,0,1,0,0,0,0,1)}function q(P){if(P===0)return this;var H=u(P),Ae=m(P);return this._t(1,0,0,0,0,H,-Ae,0,0,Ae,H,0,0,0,0,1)}function $(P){if(P===0)return this;var H=u(P),Ae=m(P);return this._t(H,0,Ae,0,0,1,0,0,-Ae,0,H,0,0,0,0,1)}function ue(P){if(P===0)return this;var H=u(P),Ae=m(P);return this._t(H,-Ae,0,0,Ae,H,0,0,0,0,1,0,0,0,0,1)}function Ce(P,H){return this._t(1,H,P,1,0,0)}function Ve(P,H){return this.shear(w(P),w(H))}function ee(P,H){var Ae=u(H),Je=m(H);return this._t(Ae,Je,0,0,-Je,Ae,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,w(P),1,0,0,0,0,1,0,0,0,0,1)._t(Ae,-Je,0,0,Je,Ae,0,0,0,0,1,0,0,0,0,1)}function be(P,H,Ae){return Ae||Ae===0||(Ae=1),P===1&&H===1&&Ae===1?this:this._t(P,0,0,0,0,H,0,0,0,0,Ae,0,0,0,0,1)}function de(P,H,Ae,Je,zt,Rt,Ht,Xt,Kt,Jt,ni,In,Yn,Ln,Rn,mn){return this.props[0]=P,this.props[1]=H,this.props[2]=Ae,this.props[3]=Je,this.props[4]=zt,this.props[5]=Rt,this.props[6]=Ht,this.props[7]=Xt,this.props[8]=Kt,this.props[9]=Jt,this.props[10]=ni,this.props[11]=In,this.props[12]=Yn,this.props[13]=Ln,this.props[14]=Rn,this.props[15]=mn,this}function te(P,H,Ae){return Ae=Ae||0,P!==0||H!==0||Ae!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,P,H,Ae,1):this}function Ne(P,H,Ae,Je,zt,Rt,Ht,Xt,Kt,Jt,ni,In,Yn,Ln,Rn,mn){var Gt=this.props;if(P===1&&H===0&&Ae===0&&Je===0&&zt===0&&Rt===1&&Ht===0&&Xt===0&&Kt===0&&Jt===0&&ni===1&&In===0)return Gt[12]=Gt[12]*P+Gt[15]*Yn,Gt[13]=Gt[13]*Rt+Gt[15]*Ln,Gt[14]=Gt[14]*ni+Gt[15]*Rn,Gt[15]*=mn,this._identityCalculated=!1,this;var er=Gt[0],tr=Gt[1],Ea=Gt[2],ps=Gt[3],Ps=Gt[4],gn=Gt[5],Ks=Gt[6],Qs=Gt[7],Zn=Gt[8],Js=Gt[9],Kn=Gt[10],Ca=Gt[11],Oo=Gt[12],Uo=Gt[13],No=Gt[14],Bo=Gt[15];return Gt[0]=er*P+tr*zt+Ea*Kt+ps*Yn,Gt[1]=er*H+tr*Rt+Ea*Jt+ps*Ln,Gt[2]=er*Ae+tr*Ht+Ea*ni+ps*Rn,Gt[3]=er*Je+tr*Xt+Ea*In+ps*mn,Gt[4]=Ps*P+gn*zt+Ks*Kt+Qs*Yn,Gt[5]=Ps*H+gn*Rt+Ks*Jt+Qs*Ln,Gt[6]=Ps*Ae+gn*Ht+Ks*ni+Qs*Rn,Gt[7]=Ps*Je+gn*Xt+Ks*In+Qs*mn,Gt[8]=Zn*P+Js*zt+Kn*Kt+Ca*Yn,Gt[9]=Zn*H+Js*Rt+Kn*Jt+Ca*Ln,Gt[10]=Zn*Ae+Js*Ht+Kn*ni+Ca*Rn,Gt[11]=Zn*Je+Js*Xt+Kn*In+Ca*mn,Gt[12]=Oo*P+Uo*zt+No*Kt+Bo*Yn,Gt[13]=Oo*H+Uo*Rt+No*Jt+Bo*Ln,Gt[14]=Oo*Ae+Uo*Ht+No*ni+Bo*Rn,Gt[15]=Oo*Je+Uo*Xt+No*In+Bo*mn,this._identityCalculated=!1,this}function He(P){var H=P.props;return this.transform(H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],H[8],H[9],H[10],H[11],H[12],H[13],H[14],H[15])}function ie(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function G(P){for(var H=0;H<16;){if(P.props[H]!==this.props[H])return!1;H+=1}return!0}function N(P){var H;for(H=0;H<16;H+=1)P.props[H]=this.props[H];return P}function W(P){var H;for(H=0;H<16;H+=1)this.props[H]=P[H]}function ne(P,H,Ae){return{x:P*this.props[0]+H*this.props[4]+Ae*this.props[8]+this.props[12],y:P*this.props[1]+H*this.props[5]+Ae*this.props[9]+this.props[13],z:P*this.props[2]+H*this.props[6]+Ae*this.props[10]+this.props[14]}}function we(P,H,Ae){return P*this.props[0]+H*this.props[4]+Ae*this.props[8]+this.props[12]}function Be(P,H,Ae){return P*this.props[1]+H*this.props[5]+Ae*this.props[9]+this.props[13]}function xe(P,H,Ae){return P*this.props[2]+H*this.props[6]+Ae*this.props[10]+this.props[14]}function ct(){var P=this.props[0]*this.props[5]-this.props[1]*this.props[4],H=this.props[5]/P,Ae=-this.props[1]/P,Je=-this.props[4]/P,zt=this.props[0]/P,Rt=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/P,Ht=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/P,Xt=new vt;return Xt.props[0]=H,Xt.props[1]=Ae,Xt.props[4]=Je,Xt.props[5]=zt,Xt.props[12]=Rt,Xt.props[13]=Ht,Xt}function Ct(P){return this.getInverseMatrix().applyToPointArray(P[0],P[1],P[2]||0)}function ot(P){var H,Ae=P.length,Je=[];for(H=0;H<Ae;H+=1)Je[H]=Ct(P[H]);return Je}function Vt(P,H,Ae){var Je=f("float32",6);if(this.isIdentity())Je[0]=P[0],Je[1]=P[1],Je[2]=H[0],Je[3]=H[1],Je[4]=Ae[0],Je[5]=Ae[1];else{var zt=this.props[0],Rt=this.props[1],Ht=this.props[4],Xt=this.props[5],Kt=this.props[12],Jt=this.props[13];Je[0]=P[0]*zt+P[1]*Ht+Kt,Je[1]=P[0]*Rt+P[1]*Xt+Jt,Je[2]=H[0]*zt+H[1]*Ht+Kt,Je[3]=H[0]*Rt+H[1]*Xt+Jt,Je[4]=Ae[0]*zt+Ae[1]*Ht+Kt,Je[5]=Ae[0]*Rt+Ae[1]*Xt+Jt}return Je}function Tt(P,H,Ae){return this.isIdentity()?[P,H,Ae]:[P*this.props[0]+H*this.props[4]+Ae*this.props[8]+this.props[12],P*this.props[1]+H*this.props[5]+Ae*this.props[9]+this.props[13],P*this.props[2]+H*this.props[6]+Ae*this.props[10]+this.props[14]]}function We(P,H){if(this.isIdentity())return P+","+H;var Ae=this.props;return Math.round(100*(P*Ae[0]+H*Ae[4]+Ae[12]))/100+","+Math.round(100*(P*Ae[1]+H*Ae[5]+Ae[13]))/100}function Pe(){for(var P=0,H=this.props,Ae="matrix3d(",Je=1e4;P<16;)Ae+=M(H[P]*Je)/Je,Ae+=P===15?")":",",P+=1;return Ae}function ae(P){var H=1e4;return P<1e-6&&P>0||P>-1e-6&&P<0?M(P*H)/H:P}function oe(){var P=this.props;return"matrix("+ae(P[0])+","+ae(P[1])+","+ae(P[4])+","+ae(P[5])+","+ae(P[12])+","+ae(P[13])+")"}return function(){this.reset=x,this.rotate=I,this.rotateX=q,this.rotateY=$,this.rotateZ=ue,this.skew=Ve,this.skewFromAxis=ee,this.shear=Ce,this.scale=be,this.setTransform=de,this.translate=te,this.transform=Ne,this.multiply=He,this.applyToPoint=ne,this.applyToX=we,this.applyToY=Be,this.applyToZ=xe,this.applyToPointArray=Tt,this.applyToTriplePoints=Vt,this.applyToPointStringified=We,this.toCSS=Pe,this.to2dCSS=oe,this.clone=N,this.cloneFromProps=W,this.equals=G,this.inversePoints=ot,this.inversePoint=Ct,this.getInverseMatrix=ct,this._t=this.transform,this.isIdentity=ie,this._identity=!0,this._identityCalculated=!1,this.props=f("float32",16),this.reset()}}();function xt(u){return xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},xt(u)}var ut={};function Nt(u){a(u)}function nt(){Se.searchAnimations()}function Bt(u){K(u)}function _i(u){le(u)}function vi(u){return Se.loadAnimation(u)}function Pi(u){if(typeof u=="string")switch(u){case"high":Oe(200);break;default:case"medium":Oe(50);break;case"low":Oe(10)}else!isNaN(u)&&u>1&&Oe(u)}function dn(){return typeof navigator<"u"}function Zt(u,m){u==="expressions"&&Ee(m)}function Ut(u){switch(u){case"propertyFactory":return ft;case"shapePropertyFactory":return gt;case"matrix":return vt;default:return null}}function Cn(){document.readyState==="complete"&&(clearInterval(Mi),nt())}function li(u){for(var m=Ji.split("&"),w=0;w<m.length;w+=1){var M=m[w].split("=");if(decodeURIComponent(M[0])==u)return decodeURIComponent(M[1])}return null}ut.play=Se.play,ut.pause=Se.pause,ut.setLocationHref=Nt,ut.togglePause=Se.togglePause,ut.setSpeed=Se.setSpeed,ut.setDirection=Se.setDirection,ut.stop=Se.stop,ut.searchAnimations=nt,ut.registerAnimation=Se.registerAnimation,ut.loadAnimation=vi,ut.setSubframeRendering=Bt,ut.resize=Se.resize,ut.goToAndStop=Se.goToAndStop,ut.destroy=Se.destroy,ut.setQuality=Pi,ut.inBrowser=dn,ut.installPlugin=Zt,ut.freeze=Se.freeze,ut.unfreeze=Se.unfreeze,ut.setVolume=Se.setVolume,ut.mute=Se.mute,ut.unmute=Se.unmute,ut.getRegisteredAnimations=Se.getRegisteredAnimations,ut.useWebWorker=n,ut.setIDPrefix=_i,ut.__getFactory=Ut,ut.version="5.12.2";var Ji="",Ws=document.getElementsByTagName("script"),Gn=Ws.length-1,As=Ws[Gn]||{src:""};Ji=As.src?As.src.replace(/^[^\?]+\??/,""):"",li("renderer");var Mi=setInterval(Cn,100);try{xt(Mf)!=="object"&&(window.bodymovin=ut)}catch{}function en(u){for(var m=u.fStyle?u.fStyle.split(" "):[],w="normal",M="normal",x=m.length,I=0;I<x;I+=1)switch(m[I].toLowerCase()){case"italic":M="italic";break;case"bold":w="700";break;case"black":w="900";break;case"medium":w="500";break;case"regular":case"normal":w="400";break;case"light":case"thin":w="200"}return{style:M,weight:u.fWeight||w}}var Ni=function(){var u=5e3,m={w:0,size:0,shapes:[],data:{shapes:[]}},w=[];w=w.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var M=127988,x=917631,I=917601,q=917626,$=65039,ue=8205,Ce=127462,Ve=127487,ee=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function be(ae){var oe,P=ae.split(","),H=P.length,Ae=[];for(oe=0;oe<H;oe+=1)P[oe]!=="sans-serif"&&P[oe]!=="monospace"&&Ae.push(P[oe]);return Ae.join(",")}function de(ae,oe){var P=l("span");P.setAttribute("aria-hidden",!0),P.style.fontFamily=oe;var H=l("span");H.innerText="giItT1WQy@!-/#",P.style.position="absolute",P.style.left="-10000px",P.style.top="-10000px",P.style.fontSize="300px",P.style.fontVariant="normal",P.style.fontStyle="normal",P.style.fontWeight="normal",P.style.letterSpacing="0",P.appendChild(H),document.body.appendChild(P);var Ae=H.offsetWidth;return H.style.fontFamily=be(ae)+", "+oe,{node:H,w:Ae,parent:P}}function te(){var ae,oe,P,H=this.fonts.length,Ae=H;for(ae=0;ae<H;ae+=1)this.fonts[ae].loaded?Ae-=1:this.fonts[ae].fOrigin==="n"||this.fonts[ae].origin===0?this.fonts[ae].loaded=!0:(oe=this.fonts[ae].monoCase.node,P=this.fonts[ae].monoCase.w,oe.offsetWidth!==P?(Ae-=1,this.fonts[ae].loaded=!0):(oe=this.fonts[ae].sansCase.node,P=this.fonts[ae].sansCase.w,oe.offsetWidth!==P&&(Ae-=1,this.fonts[ae].loaded=!0)),this.fonts[ae].loaded&&(this.fonts[ae].sansCase.parent.parentNode.removeChild(this.fonts[ae].sansCase.parent),this.fonts[ae].monoCase.parent.parentNode.removeChild(this.fonts[ae].monoCase.parent)));Ae!==0&&Date.now()-this.initTime<u?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function Ne(ae,oe){var P,H=document.body&&oe?"svg":"canvas",Ae=en(ae);if(H==="svg"){var Je=ke("text");Je.style.fontSize="100px",Je.setAttribute("font-family",ae.fFamily),Je.setAttribute("font-style",Ae.style),Je.setAttribute("font-weight",Ae.weight),Je.textContent="1",ae.fClass?(Je.style.fontFamily="inherit",Je.setAttribute("class",ae.fClass)):Je.style.fontFamily=ae.fFamily,oe.appendChild(Je),P=Je}else{var zt=new OffscreenCanvas(500,500).getContext("2d");zt.font=Ae.style+" "+Ae.weight+" 100px "+ae.fFamily,P=zt}function Rt(Ht){return H==="svg"?(P.textContent=Ht,P.getComputedTextLength()):P.measureText(Ht).width}return{measureText:Rt}}function He(ae,oe){if(ae){if(this.chars)return this.isLoaded=!0,void(this.fonts=ae.list);if(!document.body)return this.isLoaded=!0,ae.list.forEach(function(ni){ni.helper=Ne(ni),ni.cache={}}),void(this.fonts=ae.list);var P,H=ae.list,Ae=H.length,Je=Ae;for(P=0;P<Ae;P+=1){var zt,Rt,Ht=!0;if(H[P].loaded=!1,H[P].monoCase=de(H[P].fFamily,"monospace"),H[P].sansCase=de(H[P].fFamily,"sans-serif"),H[P].fPath){if(H[P].fOrigin==="p"||H[P].origin===3){if((zt=document.querySelectorAll('style[f-forigin="p"][f-family="'+H[P].fFamily+'"], style[f-origin="3"][f-family="'+H[P].fFamily+'"]')).length>0&&(Ht=!1),Ht){var Xt=l("style");Xt.setAttribute("f-forigin",H[P].fOrigin),Xt.setAttribute("f-origin",H[P].origin),Xt.setAttribute("f-family",H[P].fFamily),Xt.type="text/css",Xt.innerText="@font-face {font-family: "+H[P].fFamily+"; font-style: normal; src: url('"+H[P].fPath+"');}",oe.appendChild(Xt)}}else if(H[P].fOrigin==="g"||H[P].origin===1){for(zt=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),Rt=0;Rt<zt.length;Rt+=1)zt[Rt].href.indexOf(H[P].fPath)!==-1&&(Ht=!1);if(Ht){var Kt=l("link");Kt.setAttribute("f-forigin",H[P].fOrigin),Kt.setAttribute("f-origin",H[P].origin),Kt.type="text/css",Kt.rel="stylesheet",Kt.href=H[P].fPath,document.body.appendChild(Kt)}}else if(H[P].fOrigin==="t"||H[P].origin===2){for(zt=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),Rt=0;Rt<zt.length;Rt+=1)H[P].fPath===zt[Rt].src&&(Ht=!1);if(Ht){var Jt=l("link");Jt.setAttribute("f-forigin",H[P].fOrigin),Jt.setAttribute("f-origin",H[P].origin),Jt.setAttribute("rel","stylesheet"),Jt.setAttribute("href",H[P].fPath),oe.appendChild(Jt)}}}else H[P].loaded=!0,Je-=1;H[P].helper=Ne(H[P],oe),H[P].cache={},this.fonts.push(H[P])}Je===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}else this.isLoaded=!0}function ie(ae){if(ae){var oe;this.chars||(this.chars=[]);var P,H,Ae=ae.length,Je=this.chars.length;for(oe=0;oe<Ae;oe+=1){for(P=0,H=!1;P<Je;)this.chars[P].style===ae[oe].style&&this.chars[P].fFamily===ae[oe].fFamily&&this.chars[P].ch===ae[oe].ch&&(H=!0),P+=1;H||(this.chars.push(ae[oe]),Je+=1)}}}function G(ae,oe,P){for(var H=0,Ae=this.chars.length;H<Ae;){if(this.chars[H].ch===ae&&this.chars[H].style===oe&&this.chars[H].fFamily===P)return this.chars[H];H+=1}return(typeof ae=="string"&&ae.charCodeAt(0)!==13||!ae)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",ae,oe,P)),m}function N(ae,oe,P){var H=this.getFontByName(oe),Ae=ae;if(!H.cache[Ae]){var Je=H.helper;if(ae===" "){var zt=Je.measureText("|"+ae+"|"),Rt=Je.measureText("||");H.cache[Ae]=(zt-Rt)/100}else H.cache[Ae]=Je.measureText(ae)/100}return H.cache[Ae]*P}function W(ae){for(var oe=0,P=this.fonts.length;oe<P;){if(this.fonts[oe].fName===ae)return this.fonts[oe];oe+=1}return this.fonts[0]}function ne(ae){var oe=0,P=ae.charCodeAt(0);if(P>=55296&&P<=56319){var H=ae.charCodeAt(1);H>=56320&&H<=57343&&(oe=1024*(P-55296)+H-56320+65536)}return oe}function we(ae,oe){var P=ae.toString(16)+oe.toString(16);return ee.indexOf(P)!==-1}function Be(ae){return ae===ue}function xe(ae){return ae===$}function ct(ae){var oe=ne(ae);return oe>=Ce&&oe<=Ve}function Ct(ae){return ct(ae.substr(0,2))&&ct(ae.substr(2,2))}function ot(ae){return w.indexOf(ae)!==-1}function Vt(ae,oe){var P=ne(ae.substr(oe,2));if(P!==M)return!1;var H=0;for(oe+=2;H<5;){if((P=ne(ae.substr(oe,2)))<I||P>q)return!1;H+=1,oe+=2}return ne(ae.substr(oe,2))===x}function Tt(){this.isLoaded=!0}var We=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};We.isModifier=we,We.isZeroWidthJoiner=Be,We.isFlagEmoji=Ct,We.isRegionalCode=ct,We.isCombinedCharacter=ot,We.isRegionalFlag=Vt,We.isVariationSelector=xe,We.BLACK_FLAG_CODE_POINT=M;var Pe={addChars:ie,addFonts:He,getCharData:G,getFontByName:W,measureText:N,checkLoadedFonts:te,setIsLoaded:Tt};return We.prototype=Pe,We}();function Di(u){this.animationData=u}function Ts(u){return new Di(u)}function os(){}Di.prototype.getProp=function(u){return this.animationData.slots&&this.animationData.slots[u.sid]?Object.assign(u,this.animationData.slots[u.sid].p):u},os.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(u){this.renderableComponents.indexOf(u)===-1&&this.renderableComponents.push(u)},removeRenderableComponent:function(u){this.renderableComponents.indexOf(u)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(u),1)},prepareRenderableFrame:function(u){this.checkLayerLimits(u)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(u){this.data.ip-this.data.st<=u&&this.data.op-this.data.st>u?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var u,m=this.renderableComponents.length;for(u=0;u<m;u+=1)this.renderableComponents[u].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var ji,$r=(ji={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"},function(u){return ji[u]||""});function ja(u,m,w){this.p=ft.getProp(m,u.v,0,0,w)}function wa(u,m,w){this.p=ft.getProp(m,u.v,0,0,w)}function Lo(u,m,w){this.p=ft.getProp(m,u.v,1,0,w)}function qa(u,m,w){this.p=ft.getProp(m,u.v,1,0,w)}function Xa(u,m,w){this.p=ft.getProp(m,u.v,0,0,w)}function Yr(u,m,w){this.p=ft.getProp(m,u.v,0,0,w)}function Ro(u,m,w){this.p=ft.getProp(m,u.v,0,0,w)}function Do(){this.p={}}function $a(u,m){var w,M=u.ef||[];this.effectElements=[];var x,I=M.length;for(w=0;w<I;w+=1)x=new Wn(M[w],m),this.effectElements.push(x)}function Wn(u,m){this.init(u,m)}function jn(){}function bn(){}function tn(u,m,w){this.initFrame(),this.initRenderable(),this.assetData=m.getAssetData(u.refId),this.footageData=m.imageLoader.getAsset(this.assetData),this.initBaseData(u,m,w)}function Ci(u,m,w){this.initFrame(),this.initRenderable(),this.assetData=m.getAssetData(u.refId),this.initBaseData(u,m,w),this._isPlaying=!1,this._canPlay=!1;var M=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(M),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=u.tm?ft.getProp(this,u.tm,0,m.frameRate,this):{_placeholder:!0},this.lv=ft.getProp(this,u.au&&u.au.lv?u.au.lv:{k:[100]},1,.01,this)}function Si(){}c([gi],Wn),Wn.prototype.getValue=Wn.prototype.iterateDynamicProperties,Wn.prototype.init=function(u,m){var w;this.data=u,this.effectElements=[],this.initDynamicPropertyContainer(m);var M,x=this.data.ef.length,I=this.data.ef;for(w=0;w<x;w+=1){switch(M=null,I[w].ty){case 0:M=new ja(I[w],m,this);break;case 1:M=new wa(I[w],m,this);break;case 2:M=new Lo(I[w],m,this);break;case 3:M=new qa(I[w],m,this);break;case 4:case 7:M=new Ro(I[w],m,this);break;case 10:M=new Xa(I[w],m,this);break;case 11:M=new Yr(I[w],m,this);break;case 5:M=new $a(I[w],m);break;default:M=new Do(I[w])}M&&this.effectElements.push(M)}},jn.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var u=0,m=this.data.masksProperties.length;u<m;){if(this.data.masksProperties[u].mode!=="n"&&this.data.masksProperties[u].cl!==!1)return!0;u+=1}return!1},initExpressions:function(){},setBlendMode:function(){var u=$r(this.data.bm);(this.baseElement||this.layerElement).style["mix-blend-mode"]=u},initBaseData:function(u,m,w){this.globalData=m,this.comp=w,this.data=u,this.layerId=Te(),this.data.sr||(this.data.sr=1),this.effectsManager=new $a(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},bn.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(u,m){var w,M=this.dynamicProperties.length;for(w=0;w<M;w+=1)(m||this._isParent&&this.dynamicProperties[w].propType==="transform")&&(this.dynamicProperties[w].getValue(),this.dynamicProperties[w]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(u){this.dynamicProperties.indexOf(u)===-1&&this.dynamicProperties.push(u)}},tn.prototype.prepareFrame=function(){},c([os,jn,bn],tn),tn.prototype.getBaseElement=function(){return null},tn.prototype.renderFrame=function(){},tn.prototype.destroy=function(){},tn.prototype.initExpressions=function(){},tn.prototype.getFootageData=function(){return this.footageData},Ci.prototype.prepareFrame=function(u){if(this.prepareRenderableFrame(u,!0),this.prepareProperties(u,!0),this.tm._placeholder)this._currentTime=u/this.data.sr;else{var m=this.tm.v;this._currentTime=m}this._volume=this.lv.v[0];var w=this._volume*this._volumeMultiplier;this._previousVolume!==w&&(this._previousVolume=w,this.audio.volume(w))},c([os,jn,bn],Ci),Ci.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},Ci.prototype.show=function(){},Ci.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},Ci.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},Ci.prototype.resume=function(){this._canPlay=!0},Ci.prototype.setRate=function(u){this.audio.rate(u)},Ci.prototype.volume=function(u){this._volumeMultiplier=u,this._previousVolume=u*this._volume,this.audio.volume(this._previousVolume)},Ci.prototype.getBaseElement=function(){return null},Ci.prototype.destroy=function(){},Ci.prototype.sourceRectAtTime=function(){},Ci.prototype.initExpressions=function(){},Si.prototype.checkLayers=function(u){var m,w,M=this.layers.length;for(this.completeLayers=!0,m=M-1;m>=0;m-=1)this.elements[m]||(w=this.layers[m]).ip-w.st<=u-this.layers[m].st&&w.op-w.st>u-this.layers[m].st&&this.buildItem(m),this.completeLayers=!!this.elements[m]&&this.completeLayers;this.checkPendingElements()},Si.prototype.createItem=function(u){switch(u.ty){case 2:return this.createImage(u);case 0:return this.createComp(u);case 1:return this.createSolid(u);case 3:default:return this.createNull(u);case 4:return this.createShape(u);case 5:return this.createText(u);case 6:return this.createAudio(u);case 13:return this.createCamera(u);case 15:return this.createFootage(u)}},Si.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},Si.prototype.createAudio=function(u){return new Ci(u,this.globalData,this)},Si.prototype.createFootage=function(u){return new tn(u,this.globalData,this)},Si.prototype.buildAllItems=function(){var u,m=this.layers.length;for(u=0;u<m;u+=1)this.buildItem(u);this.checkPendingElements()},Si.prototype.includeLayers=function(u){var m;this.completeLayers=!1;var w,M=u.length,x=this.layers.length;for(m=0;m<M;m+=1)for(w=0;w<x;){if(this.layers[w].id===u[m].id){this.layers[w]=u[m];break}w+=1}},Si.prototype.setProjectInterface=function(u){this.globalData.projectInterface=u},Si.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},Si.prototype.buildElementParenting=function(u,m,w){for(var M=this.elements,x=this.layers,I=0,q=x.length;I<q;)x[I].ind==m&&(M[I]&&M[I]!==!0?(w.push(M[I]),M[I].setAsParent(),x[I].parent!==void 0?this.buildElementParenting(u,x[I].parent,w):u.setHierarchy(w)):(this.buildItem(I),this.addPendingElement(u))),I+=1},Si.prototype.addPendingElement=function(u){this.pendingElements.push(u)},Si.prototype.searchExtraCompositions=function(u){var m,w=u.length;for(m=0;m<w;m+=1)if(u[m].xt){var M=this.createComp(u[m]);M.initExpressions(),this.globalData.projectInterface.registerComposition(M)}},Si.prototype.getElementById=function(u){var m,w=this.elements.length;for(m=0;m<w;m+=1)if(this.elements[m].data.ind===u)return this.elements[m];return null},Si.prototype.getElementByPath=function(u){var m,w=u.shift();if(typeof w=="number")m=this.elements[w];else{var M,x=this.elements.length;for(M=0;M<x;M+=1)if(this.elements[M].data.nm===w){m=this.elements[M];break}}return u.length===0?m:m.getElementByPath(u)},Si.prototype.setupGlobalData=function(u,m){this.globalData.fontManager=new Ni,this.globalData.slotManager=Ts(u),this.globalData.fontManager.addChars(u.chars),this.globalData.fontManager.addFonts(u.fonts,m),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=u.fr,this.globalData.nm=u.nm,this.globalData.compSize={w:u.w,h:u.h}};var Zr=function(){var u=[0,0];function m(ue){var Ce=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||Ce,this.a&&ue.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&ue.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&ue.skewFromAxis(-this.sk.v,this.sa.v),this.r?ue.rotate(-this.r.v):ue.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?ue.translate(this.px.v,this.py.v,-this.pz.v):ue.translate(this.px.v,this.py.v,0):ue.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function w(ue){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||ue){var Ce;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var Ve,ee;if(Ce=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(Ve=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/Ce,0),ee=this.p.getValueAtTime(this.p.keyframes[0].t/Ce,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(Ve=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/Ce,0),ee=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/Ce,0)):(Ve=this.p.pv,ee=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/Ce,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){Ve=[],ee=[];var be=this.px,de=this.py;be._caching.lastFrame+be.offsetTime<=be.keyframes[0].t?(Ve[0]=be.getValueAtTime((be.keyframes[0].t+.01)/Ce,0),Ve[1]=de.getValueAtTime((de.keyframes[0].t+.01)/Ce,0),ee[0]=be.getValueAtTime(be.keyframes[0].t/Ce,0),ee[1]=de.getValueAtTime(de.keyframes[0].t/Ce,0)):be._caching.lastFrame+be.offsetTime>=be.keyframes[be.keyframes.length-1].t?(Ve[0]=be.getValueAtTime(be.keyframes[be.keyframes.length-1].t/Ce,0),Ve[1]=de.getValueAtTime(de.keyframes[de.keyframes.length-1].t/Ce,0),ee[0]=be.getValueAtTime((be.keyframes[be.keyframes.length-1].t-.01)/Ce,0),ee[1]=de.getValueAtTime((de.keyframes[de.keyframes.length-1].t-.01)/Ce,0)):(Ve=[be.pv,de.pv],ee[0]=be.getValueAtTime((be._caching.lastFrame+be.offsetTime-.01)/Ce,be.offsetTime),ee[1]=de.getValueAtTime((de._caching.lastFrame+de.offsetTime-.01)/Ce,de.offsetTime))}else Ve=ee=u;this.v.rotate(-Math.atan2(Ve[1]-ee[1],Ve[0]-ee[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function M(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length&&(this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1,!this.s.effectsSequence.length)){if(this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2,this.sk){if(this.sk.effectsSequence.length||this.sa.effectsSequence.length)return;this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3}this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):this.rz.effectsSequence.length||this.ry.effectsSequence.length||this.rx.effectsSequence.length||this.or.effectsSequence.length||(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}}function x(){}function I(ue){this._addDynamicProperty(ue),this.elem.addDynamicProperty(ue),this._isDirty=!0}function q(ue,Ce,Ve){if(this.elem=ue,this.frameId=-1,this.propType="transform",this.data=Ce,this.v=new vt,this.pre=new vt,this.appliedTransformations=0,this.initDynamicPropertyContainer(Ve||ue),Ce.p&&Ce.p.s?(this.px=ft.getProp(ue,Ce.p.x,0,0,this),this.py=ft.getProp(ue,Ce.p.y,0,0,this),Ce.p.z&&(this.pz=ft.getProp(ue,Ce.p.z,0,0,this))):this.p=ft.getProp(ue,Ce.p||{k:[0,0,0]},1,0,this),Ce.rx){if(this.rx=ft.getProp(ue,Ce.rx,0,k,this),this.ry=ft.getProp(ue,Ce.ry,0,k,this),this.rz=ft.getProp(ue,Ce.rz,0,k,this),Ce.or.k[0].ti){var ee,be=Ce.or.k.length;for(ee=0;ee<be;ee+=1)Ce.or.k[ee].to=null,Ce.or.k[ee].ti=null}this.or=ft.getProp(ue,Ce.or,1,k,this),this.or.sh=!0}else this.r=ft.getProp(ue,Ce.r||{k:0},0,k,this);Ce.sk&&(this.sk=ft.getProp(ue,Ce.sk,0,k,this),this.sa=ft.getProp(ue,Ce.sa,0,k,this)),this.a=ft.getProp(ue,Ce.a||{k:[0,0,0]},1,0,this),this.s=ft.getProp(ue,Ce.s||{k:[100,100,100]},1,.01,this),Ce.o?this.o=ft.getProp(ue,Ce.o,0,.01,ue):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}function $(ue,Ce,Ve){return new q(ue,Ce,Ve)}return q.prototype={applyToMatrix:m,getValue:w,precalculateMatrix:M,autoOrient:x},c([gi],q),q.prototype.addDynamicProperty=I,q.prototype._addDynamicProperty=gi.prototype.addDynamicProperty,{getTransformProperty:$}}(),_a={TRANSFORM_EFFECT:"transformEFfect"};function ls(){}function qn(u,m,w){this.data=u,this.element=m,this.globalData=w,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var M,x,I=this.globalData.defs,q=this.masksProperties?this.masksProperties.length:0;this.viewData=p(q),this.solidPath="";var $,ue,Ce,Ve,ee,be,de=this.masksProperties,te=0,Ne=[],He=Te(),ie="clipPath",G="clip-path";for(M=0;M<q;M+=1)if((de[M].mode!=="a"&&de[M].mode!=="n"||de[M].inv||de[M].o.k!==100||de[M].o.x)&&(ie="mask",G="mask"),de[M].mode!=="s"&&de[M].mode!=="i"||te!==0?Ce=null:((Ce=ke("rect")).setAttribute("fill","#ffffff"),Ce.setAttribute("width",this.element.comp.data.w||0),Ce.setAttribute("height",this.element.comp.data.h||0),Ne.push(Ce)),x=ke("path"),de[M].mode==="n")this.viewData[M]={op:ft.getProp(this.element,de[M].o,0,.01,this.element),prop:gt.getShapeProp(this.element,de[M],3),elem:x,lastPath:""},I.appendChild(x);else{var N;if(te+=1,x.setAttribute("fill",de[M].mode==="s"?"#000000":"#ffffff"),x.setAttribute("clip-rule","nonzero"),de[M].x.k!==0?(ie="mask",G="mask",be=ft.getProp(this.element,de[M].x,0,null,this.element),N=Te(),(Ve=ke("filter")).setAttribute("id",N),(ee=ke("feMorphology")).setAttribute("operator","erode"),ee.setAttribute("in","SourceGraphic"),ee.setAttribute("radius","0"),Ve.appendChild(ee),I.appendChild(Ve),x.setAttribute("stroke",de[M].mode==="s"?"#000000":"#ffffff")):(ee=null,be=null),this.storedData[M]={elem:x,x:be,expan:ee,lastPath:"",lastOperator:"",filterId:N,lastRadius:0},de[M].mode==="i"){ue=Ne.length;var W=ke("g");for($=0;$<ue;$+=1)W.appendChild(Ne[$]);var ne=ke("mask");ne.setAttribute("mask-type","alpha"),ne.setAttribute("id",He+"_"+te),ne.appendChild(x),I.appendChild(ne),W.setAttribute("mask","url("+r()+"#"+He+"_"+te+")"),Ne.length=0,Ne.push(W)}else Ne.push(x);de[M].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[M]={elem:x,lastPath:"",op:ft.getProp(this.element,de[M].o,0,.01,this.element),prop:gt.getShapeProp(this.element,de[M],3),invRect:Ce},this.viewData[M].prop.k||this.drawPath(de[M],this.viewData[M].prop.v,this.viewData[M])}for(this.maskElement=ke(ie),q=Ne.length,M=0;M<q;M+=1)this.maskElement.appendChild(Ne[M]);te>0&&(this.maskElement.setAttribute("id",He),this.element.maskedElement.setAttribute(G,"url("+r()+"#"+He+")"),I.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}ls.prototype={initTransform:function(){var u=new vt;this.finalTransform={mProp:this.data.ks?Zr.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:u,localMat:u,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var u,m=this.finalTransform.mat,w=0,M=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;w<M;){if(this.hierarchy[w].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}w+=1}if(this.finalTransform._matMdf)for(u=this.finalTransform.mProp.v.props,m.cloneFromProps(u),w=0;w<M;w+=1)m.multiply(this.hierarchy[w].finalTransform.mProp.v)}this.localTransforms&&!this.finalTransform._matMdf||(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var u=0,m=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;u<m;)this.localTransforms[u]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[u]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),u+=1;if(this.finalTransform._localMatMdf){var w=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(w),u=1;u<m;u+=1){var M=this.localTransforms[u].matrix;w.multiply(M)}w.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var x=this.finalTransform.localOpacity;for(u=0;u<m;u+=1)x*=.01*this.localTransforms[u].opacity;this.finalTransform.localOpacity=x}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var u=this.renderableEffectsManager.getEffects(_a.TRANSFORM_EFFECT);if(u.length){this.localTransforms=[],this.finalTransform.localMat=new vt;var m=0,w=u.length;for(m=0;m<w;m+=1)this.localTransforms.push(u[m])}}},globalToLocal:function(u){var m=[];m.push(this.finalTransform);for(var w,M=!0,x=this.comp;M;)x.finalTransform?(x.data.hasMask&&m.splice(0,0,x.finalTransform),x=x.comp):M=!1;var I,q=m.length;for(w=0;w<q;w+=1)I=m[w].mat.applyToPointArray(0,0,0),u=[u[0]-I[0],u[1]-I[1],0];return u},mHelper:new vt},qn.prototype.getMaskProperty=function(u){return this.viewData[u].prop},qn.prototype.renderFrame=function(u){var m,w=this.element.finalTransform.mat,M=this.masksProperties.length;for(m=0;m<M;m+=1)if((this.viewData[m].prop._mdf||u)&&this.drawPath(this.masksProperties[m],this.viewData[m].prop.v,this.viewData[m]),(this.viewData[m].op._mdf||u)&&this.viewData[m].elem.setAttribute("fill-opacity",this.viewData[m].op.v),this.masksProperties[m].mode!=="n"&&(this.viewData[m].invRect&&(this.element.finalTransform.mProp._mdf||u)&&this.viewData[m].invRect.setAttribute("transform",w.getInverseMatrix().to2dCSS()),this.storedData[m].x&&(this.storedData[m].x._mdf||u))){var x=this.storedData[m].expan;this.storedData[m].x.v<0?(this.storedData[m].lastOperator!=="erode"&&(this.storedData[m].lastOperator="erode",this.storedData[m].elem.setAttribute("filter","url("+r()+"#"+this.storedData[m].filterId+")")),x.setAttribute("radius",-this.storedData[m].x.v)):(this.storedData[m].lastOperator!=="dilate"&&(this.storedData[m].lastOperator="dilate",this.storedData[m].elem.setAttribute("filter",null)),this.storedData[m].elem.setAttribute("stroke-width",2*this.storedData[m].x.v))}},qn.prototype.getMaskelement=function(){return this.maskElement},qn.prototype.createLayerSolidPath=function(){var u="M0,0 ";return u+=" h"+this.globalData.compSize.w,u+=" v"+this.globalData.compSize.h,u+=" h-"+this.globalData.compSize.w,u+=" v-"+this.globalData.compSize.h+" "},qn.prototype.drawPath=function(u,m,w){var M,x,I=" M"+m.v[0][0]+","+m.v[0][1];for(x=m._length,M=1;M<x;M+=1)I+=" C"+m.o[M-1][0]+","+m.o[M-1][1]+" "+m.i[M][0]+","+m.i[M][1]+" "+m.v[M][0]+","+m.v[M][1];if(m.c&&x>1&&(I+=" C"+m.o[M-1][0]+","+m.o[M-1][1]+" "+m.i[0][0]+","+m.i[0][1]+" "+m.v[0][0]+","+m.v[0][1]),w.lastPath!==I){var q="";w.elem&&(m.c&&(q=u.inv?this.solidPath+I:I),w.elem.setAttribute("d",q)),w.lastPath=I}},qn.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var Ma,cs=function(){var u={};function m(M,x){var I=ke("filter");return I.setAttribute("id",M),x!==!0&&(I.setAttribute("filterUnits","objectBoundingBox"),I.setAttribute("x","0%"),I.setAttribute("y","0%"),I.setAttribute("width","100%"),I.setAttribute("height","100%")),I}function w(){var M=ke("feColorMatrix");return M.setAttribute("type","matrix"),M.setAttribute("color-interpolation-filters","sRGB"),M.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),M}return u.createFilter=m,u.createAlphaToLuminanceFilter=w,u}(),Ya=(Ma={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"},(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(Ma.maskType=!1),/firefox/i.test(navigator.userAgent)&&(Ma.svgLumaHidden=!1),Ma),xa={},fn="filter_result_";function Sa(u){var m,w,M="SourceGraphic",x=u.data.ef?u.data.ef.length:0,I=Te(),q=cs.createFilter(I,!0),$=0;for(this.filters=[],m=0;m<x;m+=1){w=null;var ue=u.data.ef[m].ty;xa[ue]&&(w=new xa[ue].effect(q,u.effectsManager.effectElements[m],u,fn+$,M),M=fn+$,xa[ue].countsAsEffect&&($+=1)),w&&this.filters.push(w)}$&&(u.globalData.defs.appendChild(q),u.layerElement.setAttribute("filter","url("+r()+"#"+I+")")),this.filters.length&&u.addRenderableComponent(this)}function Kr(u,m,w){xa[u]={effect:m,countsAsEffect:w}}function js(){}function hs(){}function qs(){}function Xs(u,m,w){this.assetData=m.getAssetData(u.refId),this.assetData&&this.assetData.sid&&(this.assetData=m.slotManager.getProp(this.assetData)),this.initElement(u,m,w),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function Aa(u,m){this.elem=u,this.pos=m}function $s(){}Sa.prototype.renderFrame=function(u){var m,w=this.filters.length;for(m=0;m<w;m+=1)this.filters[m].renderFrame(u)},Sa.prototype.getEffects=function(u){var m,w=this.filters.length,M=[];for(m=0;m<w;m+=1)this.filters[m].type===u&&M.push(this.filters[m]);return M},js.prototype={initRendererElement:function(){this.layerElement=ke("g")},createContainerElements:function(){this.matteElement=ke("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var u=null;if(this.data.td){this.matteMasks={};var m=ke("g");m.setAttribute("id",this.layerId),m.appendChild(this.layerElement),u=m,this.globalData.defs.appendChild(m)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),u=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var w=ke("clipPath"),M=ke("path");M.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var x=Te();if(w.setAttribute("id",x),w.appendChild(M),this.globalData.defs.appendChild(w),this.checkMasks()){var I=ke("g");I.setAttribute("clip-path","url("+r()+"#"+x+")"),I.appendChild(this.layerElement),this.transformedElement=I,u?u.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+r()+"#"+x+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new qn(this.data,this,this.globalData),this.renderableEffectsManager=new Sa(this),this.searchEffectTransforms()},getMatte:function(u){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[u]){var m,w,M,x,I=this.layerId+"_"+u;if(u===1||u===3){var q=ke("mask");q.setAttribute("id",I),q.setAttribute("mask-type",u===3?"luminance":"alpha"),(M=ke("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),q.appendChild(M),this.globalData.defs.appendChild(q),Ya.maskType||u!==1||(q.setAttribute("mask-type","luminance"),m=Te(),w=cs.createFilter(m),this.globalData.defs.appendChild(w),w.appendChild(cs.createAlphaToLuminanceFilter()),(x=ke("g")).appendChild(M),q.appendChild(x),x.setAttribute("filter","url("+r()+"#"+m+")"))}else if(u===2){var $=ke("mask");$.setAttribute("id",I),$.setAttribute("mask-type","alpha");var ue=ke("g");$.appendChild(ue),m=Te(),w=cs.createFilter(m);var Ce=ke("feComponentTransfer");Ce.setAttribute("in","SourceGraphic"),w.appendChild(Ce);var Ve=ke("feFuncA");Ve.setAttribute("type","table"),Ve.setAttribute("tableValues","1.0 0.0"),Ce.appendChild(Ve),this.globalData.defs.appendChild(w);var ee=ke("rect");ee.setAttribute("width",this.comp.data.w),ee.setAttribute("height",this.comp.data.h),ee.setAttribute("x","0"),ee.setAttribute("y","0"),ee.setAttribute("fill","#ffffff"),ee.setAttribute("opacity","0"),ue.setAttribute("filter","url("+r()+"#"+m+")"),ue.appendChild(ee),(M=ke("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),ue.appendChild(M),Ya.maskType||($.setAttribute("mask-type","luminance"),w.appendChild(cs.createAlphaToLuminanceFilter()),x=ke("g"),ue.appendChild(ee),x.appendChild(this.layerElement),ue.appendChild(x)),this.globalData.defs.appendChild($)}this.matteMasks[u]=I}return this.matteMasks[u]},setMatte:function(u){this.matteElement&&this.matteElement.setAttribute("mask","url("+r()+"#"+u+")")}},hs.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(u){this.hierarchy=u},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}},c([os,h({initElement:function(u,m,w){this.initFrame(),this.initBaseData(u,m,w),this.initTransform(u,m,w),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){this.hidden||this.isInRange&&!this.isTransparent||((this.baseElement||this.layerElement).style.display="none",this.hidden=!0)},show:function(){this.isInRange&&!this.isTransparent&&(this.data.hd||((this.baseElement||this.layerElement).style.display="block"),this.hidden=!1,this._isFirstFrame=!0)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(u){this._mdf=!1,this.prepareRenderableFrame(u),this.prepareProperties(u,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}})],qs),c([jn,ls,js,hs,bn,qs],Xs),Xs.prototype.createContent=function(){var u=this.globalData.getAssetsPath(this.assetData);this.innerElem=ke("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",u),this.layerElement.appendChild(this.innerElem)},Xs.prototype.sourceRectAtTime=function(){return this.sourceRect},$s.prototype={addShapeToModifiers:function(u){var m,w=this.shapeModifiers.length;for(m=0;m<w;m+=1)this.shapeModifiers[m].addShape(u)},isShapeInAnimatedModifiers:function(u){for(var m=0,w=this.shapeModifiers.length;m<w;)if(this.shapeModifiers[m].isAnimatedWithShape(u))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var u,m=this.shapes.length;for(u=0;u<m;u+=1)this.shapes[u].sh.reset();for(u=(m=this.shapeModifiers.length)-1;u>=0&&!this.shapeModifiers[u].processShapes(this._isFirstFrame);u-=1);}},searchProcessedElement:function(u){for(var m=this.processedElements,w=0,M=m.length;w<M;){if(m[w].elem===u)return m[w].pos;w+=1}return 0},addProcessedElement:function(u,m){for(var w=this.processedElements,M=w.length;M;)if(w[M-=1].elem===u)return void(w[M].pos=m);w.push(new Aa(u,m))},prepareFrame:function(u){this.prepareRenderableFrame(u),this.prepareProperties(u,this.isInRange)}};var Pn=function(){var u={},m={};function w(x,I){m[x]||(m[x]=I)}function M(x,I,q){return new m[x](I,q)}return u.registerModifier=w,u.getModifier=M,u}();function us(){}us.prototype.initModifierProperties=function(){},us.prototype.addShapeToModifier=function(){},us.prototype.addShape=function(u){if(!this.closed){u.sh.container.addDynamicProperty(u.sh);var m={shape:u.sh,data:u,localShapeCollection:Le.newShapeCollection()};this.shapes.push(m),this.addShapeToModifier(m),this._isAnimated&&u.setAsAnimated()}},us.prototype.init=function(u,m){this.shapes=[],this.elem=u,this.initDynamicPropertyContainer(u),this.initModifierProperties(u,m),this.frameId=i,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},us.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},c([gi],us);var Za={1:"butt",2:"round",3:"square"},Ka={1:"miter",2:"round",3:"bevel"};function Ys(u,m,w){this.caches=[],this.styles=[],this.transformers=u,this.lStr="",this.sh=w,this.lvl=m,this._isAnimated=!!w.k;for(var M=0,x=u.length;M<x;){if(u[M].mProps.dynamicProperties.length){this._isAnimated=!0;break}M+=1}}function Qr(u,m){this.data=u,this.type=u.ty,this.d="",this.lvl=m,this._mdf=!1,this.closed=u.hd===!0,this.pElem=ke("path"),this.msElem=null}function ds(u,m,w,M){var x;this.elem=u,this.frameId=-1,this.dataProps=p(m.length),this.renderer=w,this.k=!1,this.dashStr="",this.dashArray=f("float32",m.length?m.length-1:0),this.dashoffset=f("float32",1),this.initDynamicPropertyContainer(M);var I,q=m.length||0;for(x=0;x<q;x+=1)I=ft.getProp(u,m[x].v,0,0,this),this.k=I.k||this.k,this.dataProps[x]={n:m[x].n,p:I};this.k||this.getValue(!0),this._isAnimated=this.k}function Qa(u,m,w){this.initDynamicPropertyContainer(u),this.getValue=this.iterateDynamicProperties,this.o=ft.getProp(u,m.o,0,.01,this),this.w=ft.getProp(u,m.w,0,null,this),this.d=new ds(u,m.d||{},"svg",this),this.c=ft.getProp(u,m.c,1,255,this),this.style=w,this._isAnimated=!!this._isAnimated}function qi(u,m,w){this.initDynamicPropertyContainer(u),this.getValue=this.iterateDynamicProperties,this.o=ft.getProp(u,m.o,0,.01,this),this.c=ft.getProp(u,m.c,1,255,this),this.style=w}function Fo(u,m,w){this.initDynamicPropertyContainer(u),this.getValue=this.iterateDynamicProperties,this.style=w}function fs(u,m,w){this.data=m,this.c=f("uint8c",4*m.p);var M=m.k.k[0].s?m.k.k[0].s.length-4*m.p:m.k.k.length-4*m.p;this.o=f("float32",M),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=M,this.initDynamicPropertyContainer(w),this.prop=ft.getProp(u,m.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}function Xn(u,m,w){this.initDynamicPropertyContainer(u),this.getValue=this.iterateDynamicProperties,this.initGradientData(u,m,w)}function Jr(u,m,w){this.initDynamicPropertyContainer(u),this.getValue=this.iterateDynamicProperties,this.w=ft.getProp(u,m.w,0,null,this),this.d=new ds(u,m.d||{},"svg",this),this.initGradientData(u,m,w),this._isAnimated=!!this._isAnimated}function oc(){this.it=[],this.prevViewData=[],this.gr=ke("g")}function Xi(u,m,w){this.transform={mProps:u,op:m,container:w},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}Ys.prototype.setAsAnimated=function(){this._isAnimated=!0},Qr.prototype.reset=function(){this.d="",this._mdf=!1},ds.prototype.getValue=function(u){if((this.elem.globalData.frameId!==this.frameId||u)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||u,this._mdf)){var m=0,w=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),m=0;m<w;m+=1)this.dataProps[m].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[m].p.v:this.dashArray[m]=this.dataProps[m].p.v:this.dashoffset[0]=this.dataProps[m].p.v}},c([gi],ds),c([gi],Qa),c([gi],qi),c([gi],Fo),fs.prototype.comparePoints=function(u,m){for(var w=0,M=this.o.length/2;w<M;){if(Math.abs(u[4*w]-u[4*m+2*w])>.01)return!1;w+=1}return!0},fs.prototype.checkCollapsable=function(){if(this.o.length/2!=this.c.length/4)return!1;if(this.data.k.k[0].s)for(var u=0,m=this.data.k.k.length;u<m;){if(!this.comparePoints(this.data.k.k[u].s,this.data.p))return!1;u+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},fs.prototype.getValue=function(u){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||u){var m,w,M,x=4*this.data.p;for(m=0;m<x;m+=1)w=m%4==0?100:255,M=Math.round(this.prop.v[m]*w),this.c[m]!==M&&(this.c[m]=M,this._cmdf=!u);if(this.o.length)for(x=this.prop.v.length,m=4*this.data.p;m<x;m+=1)w=m%2==0?100:1,M=m%2==0?Math.round(100*this.prop.v[m]):this.prop.v[m],this.o[m-4*this.data.p]!==M&&(this.o[m-4*this.data.p]=M,this._omdf=!u);this._mdf=!u}},c([gi],fs),Xn.prototype.initGradientData=function(u,m,w){this.o=ft.getProp(u,m.o,0,.01,this),this.s=ft.getProp(u,m.s,1,null,this),this.e=ft.getProp(u,m.e,1,null,this),this.h=ft.getProp(u,m.h||{k:0},0,.01,this),this.a=ft.getProp(u,m.a||{k:0},0,k,this),this.g=new fs(u,m.g,this),this.style=w,this.stops=[],this.setGradientData(w.pElem,m),this.setGradientOpacity(m,w),this._isAnimated=!!this._isAnimated},Xn.prototype.setGradientData=function(u,m){var w=Te(),M=ke(m.t===1?"linearGradient":"radialGradient");M.setAttribute("id",w),M.setAttribute("spreadMethod","pad"),M.setAttribute("gradientUnits","userSpaceOnUse");var x,I,q,$=[];for(q=4*m.g.p,I=0;I<q;I+=4)x=ke("stop"),M.appendChild(x),$.push(x);u.setAttribute(m.ty==="gf"?"fill":"stroke","url("+r()+"#"+w+")"),this.gf=M,this.cst=$},Xn.prototype.setGradientOpacity=function(u,m){if(this.g._hasOpacity&&!this.g._collapsable){var w,M,x,I=ke("mask"),q=ke("path");I.appendChild(q);var $=Te(),ue=Te();I.setAttribute("id",ue);var Ce=ke(u.t===1?"linearGradient":"radialGradient");Ce.setAttribute("id",$),Ce.setAttribute("spreadMethod","pad"),Ce.setAttribute("gradientUnits","userSpaceOnUse"),x=u.g.k.k[0].s?u.g.k.k[0].s.length:u.g.k.k.length;var Ve=this.stops;for(M=4*u.g.p;M<x;M+=2)(w=ke("stop")).setAttribute("stop-color","rgb(255,255,255)"),Ce.appendChild(w),Ve.push(w);q.setAttribute(u.ty==="gf"?"fill":"stroke","url("+r()+"#"+$+")"),u.ty==="gs"&&(q.setAttribute("stroke-linecap",Za[u.lc||2]),q.setAttribute("stroke-linejoin",Ka[u.lj||2]),u.lj===1&&q.setAttribute("stroke-miterlimit",u.ml)),this.of=Ce,this.ms=I,this.ost=Ve,this.maskId=ue,m.msElem=q}},c([gi],Xn),c([Xn,gi],Jr);var pn=function(u,m,w,M){if(m===0)return"";var x,I=u.o,q=u.i,$=u.v,ue=" M"+M.applyToPointStringified($[0][0],$[0][1]);for(x=1;x<m;x+=1)ue+=" C"+M.applyToPointStringified(I[x-1][0],I[x-1][1])+" "+M.applyToPointStringified(q[x][0],q[x][1])+" "+M.applyToPointStringified($[x][0],$[x][1]);return w&&m&&(ue+=" C"+M.applyToPointStringified(I[x-1][0],I[x-1][1])+" "+M.applyToPointStringified(q[0][0],q[0][1])+" "+M.applyToPointStringified($[0][0],$[0][1]),ue+="z"),ue},$i=function(){var u=new vt,m=new vt;function w(Ve){switch(Ve.ty){case"fl":return q;case"gf":return ue;case"gs":return $;case"st":return Ce;case"sh":case"el":case"rc":case"sr":return I;case"tr":return M;case"no":return x;default:return null}}function M(Ve,ee,be){(be||ee.transform.op._mdf)&&ee.transform.container.setAttribute("opacity",ee.transform.op.v),(be||ee.transform.mProps._mdf)&&ee.transform.container.setAttribute("transform",ee.transform.mProps.v.to2dCSS())}function x(){}function I(Ve,ee,be){var de,te,Ne,He,ie,G,N,W,ne,we,Be=ee.styles.length,xe=ee.lvl;for(G=0;G<Be;G+=1){if(He=ee.sh._mdf||be,ee.styles[G].lvl<xe){for(W=m.reset(),ne=xe-ee.styles[G].lvl,we=ee.transformers.length-1;!He&&ne>0;)He=ee.transformers[we].mProps._mdf||He,ne-=1,we-=1;if(He)for(ne=xe-ee.styles[G].lvl,we=ee.transformers.length-1;ne>0;)W.multiply(ee.transformers[we].mProps.v),ne-=1,we-=1}else W=u;if(te=(N=ee.sh.paths)._length,He){for(Ne="",de=0;de<te;de+=1)(ie=N.shapes[de])&&ie._length&&(Ne+=pn(ie,ie._length,ie.c,W));ee.caches[G]=Ne}else Ne=ee.caches[G];ee.styles[G].d+=Ve.hd===!0?"":Ne,ee.styles[G]._mdf=He||ee.styles[G]._mdf}}function q(Ve,ee,be){var de=ee.style;(ee.c._mdf||be)&&de.pElem.setAttribute("fill","rgb("+E(ee.c.v[0])+","+E(ee.c.v[1])+","+E(ee.c.v[2])+")"),(ee.o._mdf||be)&&de.pElem.setAttribute("fill-opacity",ee.o.v)}function $(Ve,ee,be){ue(Ve,ee,be),Ce(Ve,ee,be)}function ue(Ve,ee,be){var de,te,Ne,He,ie,G=ee.gf,N=ee.g._hasOpacity,W=ee.s.v,ne=ee.e.v;if(ee.o._mdf||be){var we=Ve.ty==="gf"?"fill-opacity":"stroke-opacity";ee.style.pElem.setAttribute(we,ee.o.v)}if(ee.s._mdf||be){var Be=Ve.t===1?"x1":"cx",xe=Be==="x1"?"y1":"cy";G.setAttribute(Be,W[0]),G.setAttribute(xe,W[1]),N&&!ee.g._collapsable&&(ee.of.setAttribute(Be,W[0]),ee.of.setAttribute(xe,W[1]))}if(ee.g._cmdf||be){de=ee.cst;var ct=ee.g.c;for(Ne=de.length,te=0;te<Ne;te+=1)(He=de[te]).setAttribute("offset",ct[4*te]+"%"),He.setAttribute("stop-color","rgb("+ct[4*te+1]+","+ct[4*te+2]+","+ct[4*te+3]+")")}if(N&&(ee.g._omdf||be)){var Ct=ee.g.o;for(Ne=(de=ee.g._collapsable?ee.cst:ee.ost).length,te=0;te<Ne;te+=1)He=de[te],ee.g._collapsable||He.setAttribute("offset",Ct[2*te]+"%"),He.setAttribute("stop-opacity",Ct[2*te+1])}if(Ve.t===1)(ee.e._mdf||be)&&(G.setAttribute("x2",ne[0]),G.setAttribute("y2",ne[1]),N&&!ee.g._collapsable&&(ee.of.setAttribute("x2",ne[0]),ee.of.setAttribute("y2",ne[1])));else if((ee.s._mdf||ee.e._mdf||be)&&(ie=Math.sqrt(Math.pow(W[0]-ne[0],2)+Math.pow(W[1]-ne[1],2)),G.setAttribute("r",ie),N&&!ee.g._collapsable&&ee.of.setAttribute("r",ie)),ee.s._mdf||ee.e._mdf||ee.h._mdf||ee.a._mdf||be){ie||(ie=Math.sqrt(Math.pow(W[0]-ne[0],2)+Math.pow(W[1]-ne[1],2)));var ot=Math.atan2(ne[1]-W[1],ne[0]-W[0]),Vt=ee.h.v;Vt>=1?Vt=.99:Vt<=-1&&(Vt=-.99);var Tt=ie*Vt,We=Math.cos(ot+ee.a.v)*Tt+W[0],Pe=Math.sin(ot+ee.a.v)*Tt+W[1];G.setAttribute("fx",We),G.setAttribute("fy",Pe),N&&!ee.g._collapsable&&(ee.of.setAttribute("fx",We),ee.of.setAttribute("fy",Pe))}}function Ce(Ve,ee,be){var de=ee.style,te=ee.d;te&&(te._mdf||be)&&te.dashStr&&(de.pElem.setAttribute("stroke-dasharray",te.dashStr),de.pElem.setAttribute("stroke-dashoffset",te.dashoffset[0])),ee.c&&(ee.c._mdf||be)&&de.pElem.setAttribute("stroke","rgb("+E(ee.c.v[0])+","+E(ee.c.v[1])+","+E(ee.c.v[2])+")"),(ee.o._mdf||be)&&de.pElem.setAttribute("stroke-opacity",ee.o.v),(ee.w._mdf||be)&&(de.pElem.setAttribute("stroke-width",ee.w.v),de.msElem&&de.msElem.setAttribute("stroke-width",ee.w.v))}return{createRenderFunction:w}}();function ci(u,m,w){this.shapes=[],this.shapesData=u.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(u,m,w),this.prevViewData=[]}function Ja(u,m,w,M,x,I){this.o=u,this.sw=m,this.sc=w,this.fc=M,this.m=x,this.p=I,this._mdf={o:!0,sw:!!m,sc:!!w,fc:!!M,m:!0,p:!0}}function nn(u,m){this._frameId=i,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,m.d&&m.d.sid&&(m.d=u.globalData.slotManager.getProp(m.d)),this.data=m,this.elem=u,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}c([jn,ls,js,$s,hs,bn,qs],ci),ci.prototype.initSecondaryElement=function(){},ci.prototype.identityMatrix=new vt,ci.prototype.buildExpressionInterface=function(){},ci.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},ci.prototype.filterUniqueShapes=function(){var u,m,w,M,x=this.shapes.length,I=this.stylesList.length,q=[],$=!1;for(w=0;w<I;w+=1){for(M=this.stylesList[w],$=!1,q.length=0,u=0;u<x;u+=1)(m=this.shapes[u]).styles.indexOf(M)!==-1&&(q.push(m),$=m._isAnimated||$);q.length>1&&$&&this.setShapesAsAnimated(q)}},ci.prototype.setShapesAsAnimated=function(u){var m,w=u.length;for(m=0;m<w;m+=1)u[m].setAsAnimated()},ci.prototype.createStyleElement=function(u,m){var w,M=new Qr(u,m),x=M.pElem;return u.ty==="st"?w=new Qa(this,u,M):u.ty==="fl"?w=new qi(this,u,M):u.ty==="gf"||u.ty==="gs"?(w=new(u.ty==="gf"?Xn:Jr)(this,u,M),this.globalData.defs.appendChild(w.gf),w.maskId&&(this.globalData.defs.appendChild(w.ms),this.globalData.defs.appendChild(w.of),x.setAttribute("mask","url("+r()+"#"+w.maskId+")"))):u.ty==="no"&&(w=new Fo(this,u,M)),u.ty!=="st"&&u.ty!=="gs"||(x.setAttribute("stroke-linecap",Za[u.lc||2]),x.setAttribute("stroke-linejoin",Ka[u.lj||2]),x.setAttribute("fill-opacity","0"),u.lj===1&&x.setAttribute("stroke-miterlimit",u.ml)),u.r===2&&x.setAttribute("fill-rule","evenodd"),u.ln&&x.setAttribute("id",u.ln),u.cl&&x.setAttribute("class",u.cl),u.bm&&(x.style["mix-blend-mode"]=$r(u.bm)),this.stylesList.push(M),this.addToAnimatedContents(u,w),w},ci.prototype.createGroupElement=function(u){var m=new oc;return u.ln&&m.gr.setAttribute("id",u.ln),u.cl&&m.gr.setAttribute("class",u.cl),u.bm&&(m.gr.style["mix-blend-mode"]=$r(u.bm)),m},ci.prototype.createTransformElement=function(u,m){var w=Zr.getTransformProperty(this,u,this),M=new Xi(w,w.o,m);return this.addToAnimatedContents(u,M),M},ci.prototype.createShapeElement=function(u,m,w){var M=4;u.ty==="rc"?M=5:u.ty==="el"?M=6:u.ty==="sr"&&(M=7);var x=new Ys(m,w,gt.getShapeProp(this,u,M,this));return this.shapes.push(x),this.addShapeToModifiers(x),this.addToAnimatedContents(u,x),x},ci.prototype.addToAnimatedContents=function(u,m){for(var w=0,M=this.animatedContents.length;w<M;){if(this.animatedContents[w].element===m)return;w+=1}this.animatedContents.push({fn:$i.createRenderFunction(u),element:m,data:u})},ci.prototype.setElementStyles=function(u){var m,w=u.styles,M=this.stylesList.length;for(m=0;m<M;m+=1)w.indexOf(this.stylesList[m])!==-1||this.stylesList[m].closed||w.push(this.stylesList[m])},ci.prototype.reloadShapes=function(){var u;this._isFirstFrame=!0;var m=this.itemsData.length;for(u=0;u<m;u+=1)this.prevViewData[u]=this.itemsData[u];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),m=this.dynamicProperties.length,u=0;u<m;u+=1)this.dynamicProperties[u].getValue();this.renderModifiers()},ci.prototype.searchShapes=function(u,m,w,M,x,I,q){var $,ue,Ce,Ve,ee,be,de=[].concat(I),te=u.length-1,Ne=[],He=[];for($=te;$>=0;$-=1){if((be=this.searchProcessedElement(u[$]))?m[$]=w[be-1]:u[$]._render=q,u[$].ty==="fl"||u[$].ty==="st"||u[$].ty==="gf"||u[$].ty==="gs"||u[$].ty==="no")be?m[$].style.closed=u[$].hd:m[$]=this.createStyleElement(u[$],x),u[$]._render&&m[$].style.pElem.parentNode!==M&&M.appendChild(m[$].style.pElem),Ne.push(m[$].style);else if(u[$].ty==="gr"){if(be)for(Ce=m[$].it.length,ue=0;ue<Ce;ue+=1)m[$].prevViewData[ue]=m[$].it[ue];else m[$]=this.createGroupElement(u[$]);this.searchShapes(u[$].it,m[$].it,m[$].prevViewData,m[$].gr,x+1,de,q),u[$]._render&&m[$].gr.parentNode!==M&&M.appendChild(m[$].gr)}else u[$].ty==="tr"?(be||(m[$]=this.createTransformElement(u[$],M)),Ve=m[$].transform,de.push(Ve)):u[$].ty==="sh"||u[$].ty==="rc"||u[$].ty==="el"||u[$].ty==="sr"?(be||(m[$]=this.createShapeElement(u[$],de,x)),this.setElementStyles(m[$])):u[$].ty==="tm"||u[$].ty==="rd"||u[$].ty==="ms"||u[$].ty==="pb"||u[$].ty==="zz"||u[$].ty==="op"?(be?(ee=m[$]).closed=!1:((ee=Pn.getModifier(u[$].ty)).init(this,u[$]),m[$]=ee,this.shapeModifiers.push(ee)),He.push(ee)):u[$].ty==="rp"&&(be?(ee=m[$]).closed=!0:(ee=Pn.getModifier(u[$].ty),m[$]=ee,ee.init(this,u,$,m),this.shapeModifiers.push(ee),q=!1),He.push(ee));this.addProcessedElement(u[$],$+1)}for(te=Ne.length,$=0;$<te;$+=1)Ne[$].closed=!0;for(te=He.length,$=0;$<te;$+=1)He[$].closed=!0},ci.prototype.renderInnerContent=function(){var u;this.renderModifiers();var m=this.stylesList.length;for(u=0;u<m;u+=1)this.stylesList[u].reset();for(this.renderShape(),u=0;u<m;u+=1)(this.stylesList[u]._mdf||this._isFirstFrame)&&(this.stylesList[u].msElem&&(this.stylesList[u].msElem.setAttribute("d",this.stylesList[u].d),this.stylesList[u].d="M0 0"+this.stylesList[u].d),this.stylesList[u].pElem.setAttribute("d",this.stylesList[u].d||"M0 0"))},ci.prototype.renderShape=function(){var u,m,w=this.animatedContents.length;for(u=0;u<w;u+=1)m=this.animatedContents[u],(this._isFirstFrame||m.element._isAnimated)&&m.data!==!0&&m.fn(m.data,m.element,this._isFirstFrame)},ci.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},Ja.prototype.update=function(u,m,w,M,x,I){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var q=!1;return this.o!==u&&(this.o=u,this._mdf.o=!0,q=!0),this.sw!==m&&(this.sw=m,this._mdf.sw=!0,q=!0),this.sc!==w&&(this.sc=w,this._mdf.sc=!0,q=!0),this.fc!==M&&(this.fc=M,this._mdf.fc=!0,q=!0),this.m!==x&&(this.m=x,this._mdf.m=!0,q=!0),!I.length||this.p[0]===I[0]&&this.p[1]===I[1]&&this.p[4]===I[4]&&this.p[5]===I[5]&&this.p[12]===I[12]&&this.p[13]===I[13]||(this.p=I,this._mdf.p=!0,q=!0),q},nn.prototype.defaultBoxWidth=[0,0],nn.prototype.copyData=function(u,m){for(var w in m)Object.prototype.hasOwnProperty.call(m,w)&&(u[w]=m[w]);return u},nn.prototype.setCurrentData=function(u){u.__complete||this.completeTextData(u),this.currentData=u,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},nn.prototype.searchProperty=function(){return this.searchKeyframes()},nn.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},nn.prototype.addEffect=function(u){this.effectsSequence.push(u),this.elem.addDynamicProperty(this)},nn.prototype.getValue=function(u){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length||u){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var m=this.currentData,w=this.keysIndex;if(this.lock)this.setCurrentData(this.currentData);else{var M;this.lock=!0,this._mdf=!1;var x=this.effectsSequence.length,I=u||this.data.d.k[this.keysIndex].s;for(M=0;M<x;M+=1)I=w!==this.keysIndex?this.effectsSequence[M](I,I.t):this.effectsSequence[M](this.currentData,I.t);m!==I&&this.setCurrentData(I),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}}},nn.prototype.getKeyframeValue=function(){for(var u=this.data.d.k,m=this.elem.comp.renderedFrame,w=0,M=u.length;w<=M-1&&!(w===M-1||u[w+1].t>m);)w+=1;return this.keysIndex!==w&&(this.keysIndex=w),this.data.d.k[this.keysIndex].s},nn.prototype.buildFinalText=function(u){for(var m,w,M=[],x=0,I=u.length,q=!1,$=!1,ue="";x<I;)q=$,$=!1,m=u.charCodeAt(x),ue=u.charAt(x),Ni.isCombinedCharacter(m)?q=!0:m>=55296&&m<=56319?Ni.isRegionalFlag(u,x)?ue=u.substr(x,14):(w=u.charCodeAt(x+1))>=56320&&w<=57343&&(Ni.isModifier(m,w)?(ue=u.substr(x,2),q=!0):ue=Ni.isFlagEmoji(u.substr(x,4))?u.substr(x,4):u.substr(x,2)):m>56319?(w=u.charCodeAt(x+1),Ni.isVariationSelector(m)&&(q=!0)):Ni.isZeroWidthJoiner(m)&&(q=!0,$=!0),q?(M[M.length-1]+=ue,q=!1):M.push(ue),x+=ue.length;return M},nn.prototype.completeTextData=function(u){u.__complete=!0;var m,w,M,x,I,q,$,ue=this.elem.globalData.fontManager,Ce=this.data,Ve=[],ee=0,be=Ce.m.g,de=0,te=0,Ne=0,He=[],ie=0,G=0,N=ue.getFontByName(u.f),W=0,ne=en(N);u.fWeight=ne.weight,u.fStyle=ne.style,u.finalSize=u.s,u.finalText=this.buildFinalText(u.t),w=u.finalText.length,u.finalLineHeight=u.lh;var we,Be=u.tr/1e3*u.finalSize;if(u.sz)for(var xe,ct,Ct=!0,ot=u.sz[0],Vt=u.sz[1];Ct;){xe=0,ie=0,w=(ct=this.buildFinalText(u.t)).length,Be=u.tr/1e3*u.finalSize;var Tt=-1;for(m=0;m<w;m+=1)we=ct[m].charCodeAt(0),M=!1,ct[m]===" "?Tt=m:we!==13&&we!==3||(ie=0,M=!0,xe+=u.finalLineHeight||1.2*u.finalSize),ue.chars?($=ue.getCharData(ct[m],N.fStyle,N.fFamily),W=M?0:$.w*u.finalSize/100):W=ue.measureText(ct[m],u.f,u.finalSize),ie+W>ot&&ct[m]!==" "?(Tt===-1?w+=1:m=Tt,xe+=u.finalLineHeight||1.2*u.finalSize,ct.splice(m,Tt===m?1:0,"\r"),Tt=-1,ie=0):(ie+=W,ie+=Be);xe+=N.ascent*u.finalSize/100,this.canResize&&u.finalSize>this.minimumFontSize&&Vt<xe?(u.finalSize-=1,u.finalLineHeight=u.finalSize*u.lh/u.s):(u.finalText=ct,w=u.finalText.length,Ct=!1)}ie=-Be,W=0;var We,Pe=0;for(m=0;m<w;m+=1)if(M=!1,(we=(We=u.finalText[m]).charCodeAt(0))===13||we===3?(Pe=0,He.push(ie),G=ie>G?ie:G,ie=-2*Be,x="",M=!0,Ne+=1):x=We,ue.chars?($=ue.getCharData(We,N.fStyle,ue.getFontByName(u.f).fFamily),W=M?0:$.w*u.finalSize/100):W=ue.measureText(x,u.f,u.finalSize),We===" "?Pe+=W+Be:(ie+=W+Be+Pe,Pe=0),Ve.push({l:W,an:W,add:de,n:M,anIndexes:[],val:x,line:Ne,animatorJustifyOffset:0}),be==2){if(de+=W,x===""||x===" "||m===w-1){for(x!==""&&x!==" "||(de-=W);te<=m;)Ve[te].an=de,Ve[te].ind=ee,Ve[te].extra=W,te+=1;ee+=1,de=0}}else if(be==3){if(de+=W,x===""||m===w-1){for(x===""&&(de-=W);te<=m;)Ve[te].an=de,Ve[te].ind=ee,Ve[te].extra=W,te+=1;de=0,ee+=1}}else Ve[ee].ind=ee,Ve[ee].extra=0,ee+=1;if(u.l=Ve,G=ie>G?ie:G,He.push(ie),u.sz)u.boxWidth=u.sz[0],u.justifyOffset=0;else switch(u.boxWidth=G,u.j){case 1:u.justifyOffset=-u.boxWidth;break;case 2:u.justifyOffset=-u.boxWidth/2;break;default:u.justifyOffset=0}u.lineWidths=He;var ae,oe,P,H,Ae=Ce.a;q=Ae.length;var Je=[];for(I=0;I<q;I+=1){for((ae=Ae[I]).a.sc&&(u.strokeColorAnim=!0),ae.a.sw&&(u.strokeWidthAnim=!0),(ae.a.fc||ae.a.fh||ae.a.fs||ae.a.fb)&&(u.fillColorAnim=!0),H=0,P=ae.s.b,m=0;m<w;m+=1)(oe=Ve[m]).anIndexes[I]=H,(P==1&&oe.val!==""||P==2&&oe.val!==""&&oe.val!==" "||P==3&&(oe.n||oe.val==" "||m==w-1)||P==4&&(oe.n||m==w-1))&&(ae.s.rn===1&&Je.push(H),H+=1);Ce.a[I].s.totalChars=H;var zt,Rt=-1;if(ae.s.rn===1)for(m=0;m<w;m+=1)Rt!=(oe=Ve[m]).anIndexes[I]&&(Rt=oe.anIndexes[I],zt=Je.splice(Math.floor(Math.random()*Je.length),1)[0]),oe.anIndexes[I]=zt}u.yOffset=u.finalLineHeight||1.2*u.finalSize,u.ls=u.ls||0,u.ascent=N.ascent*u.finalSize/100},nn.prototype.updateDocumentData=function(u,m){m=m===void 0?this.keysIndex:m;var w=this.copyData({},this.data.d.k[m].s);w=this.copyData(w,u),this.data.d.k[m].s=w,this.recalculate(m),this.setCurrentData(w),this.elem.addDynamicProperty(this)},nn.prototype.recalculate=function(u){var m=this.data.d.k[u].s;m.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(m)},nn.prototype.canResizeFont=function(u){this.canResize=u,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},nn.prototype.setMinimumFontSize=function(u){this.minimumFontSize=Math.floor(u)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var Cm=function(){var u=Math.max,m=Math.min,w=Math.floor;function M(I,q){this._currentTextLength=-1,this.k=!1,this.data=q,this.elem=I,this.comp=I.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(I),this.s=ft.getProp(I,q.s||{k:0},0,0,this),this.e="e"in q?ft.getProp(I,q.e,0,0,this):{v:100},this.o=ft.getProp(I,q.o||{k:0},0,0,this),this.xe=ft.getProp(I,q.xe||{k:0},0,0,this),this.ne=ft.getProp(I,q.ne||{k:0},0,0,this),this.sm=ft.getProp(I,q.sm||{k:100},0,0,this),this.a=ft.getProp(I,q.a,0,.01,this),this.dynamicProperties.length||this.getValue()}function x(I,q,$){return new M(I,q)}return M.prototype={getMult:function(I){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var q=0,$=0,ue=1,Ce=1;this.ne.v>0?q=this.ne.v/100:$=-this.ne.v/100,this.xe.v>0?ue=1-this.xe.v/100:Ce=1+this.xe.v/100;var Ve=Ge.getBezierEasing(q,$,ue,Ce).get,ee=0,be=this.finalS,de=this.finalE,te=this.data.sh;if(te===2)ee=Ve(ee=de===be?I>=de?1:0:u(0,m(.5/(de-be)+(I-be)/(de-be),1)));else if(te===3)ee=Ve(ee=de===be?I>=de?0:1:1-u(0,m(.5/(de-be)+(I-be)/(de-be),1)));else if(te===4)de===be?ee=0:(ee=u(0,m(.5/(de-be)+(I-be)/(de-be),1)))<.5?ee*=2:ee=1-2*(ee-.5),ee=Ve(ee);else if(te===5){if(de===be)ee=0;else{var Ne=de-be,He=-Ne/2+(I=m(u(0,I+.5-be),de-be)),ie=Ne/2;ee=Math.sqrt(1-He*He/(ie*ie))}ee=Ve(ee)}else te===6?(de===be?ee=0:(I=m(u(0,I+.5-be),de-be),ee=(1+Math.cos(Math.PI+2*Math.PI*I/(de-be)))/2),ee=Ve(ee)):(I>=w(be)&&(ee=u(0,m(I-be<0?m(de,1)-(be-I):de-I,1))),ee=Ve(ee));if(this.sm.v!==100){var G=.01*this.sm.v;G===0&&(G=1e-8);var N=.5-.5*G;ee<N?ee=0:(ee=(ee-N)/G)>1&&(ee=1)}return ee*this.a.v},getValue:function(I){this.iterateDynamicProperties(),this._mdf=I||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,I&&this.data.r===2&&(this.e.v=this._currentTextLength);var q=this.data.r===2?1:100/this.data.totalChars,$=this.o.v/q,ue=this.s.v/q+$,Ce=this.e.v/q+$;if(ue>Ce){var Ve=ue;ue=Ce,Ce=Ve}this.finalS=ue,this.finalE=Ce}},c([gi],M),{getTextSelectorProp:x}}();function Pm(u,m,w){var M={propType:!1},x=ft.getProp,I=m.a;this.a={r:I.r?x(u,I.r,0,k,w):M,rx:I.rx?x(u,I.rx,0,k,w):M,ry:I.ry?x(u,I.ry,0,k,w):M,sk:I.sk?x(u,I.sk,0,k,w):M,sa:I.sa?x(u,I.sa,0,k,w):M,s:I.s?x(u,I.s,1,.01,w):M,a:I.a?x(u,I.a,1,0,w):M,o:I.o?x(u,I.o,0,.01,w):M,p:I.p?x(u,I.p,1,0,w):M,sw:I.sw?x(u,I.sw,0,0,w):M,sc:I.sc?x(u,I.sc,1,0,w):M,fc:I.fc?x(u,I.fc,1,0,w):M,fh:I.fh?x(u,I.fh,0,0,w):M,fs:I.fs?x(u,I.fs,0,.01,w):M,fb:I.fb?x(u,I.fb,0,.01,w):M,t:I.t?x(u,I.t,0,0,w):M},this.s=Cm.getTextSelectorProp(u,m.s,w),this.s.t=m.s.t}function Ta(u,m,w){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=u,this._renderType=m,this._elem=w,this._animatorsData=p(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(w)}function kn(){}Ta.prototype.searchProperties=function(){var u,m,w=this._textData.a.length,M=ft.getProp;for(u=0;u<w;u+=1)m=this._textData.a[u],this._animatorsData[u]=new Pm(this._elem,m,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:M(this._elem,this._textData.p.a,0,0,this),f:M(this._elem,this._textData.p.f,0,0,this),l:M(this._elem,this._textData.p.l,0,0,this),r:M(this._elem,this._textData.p.r,0,0,this),p:M(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=M(this._elem,this._textData.m.a,1,0,this)},Ta.prototype.getMeasures=function(u,m){if(this.lettersChangedFlag=m,this._mdf||this._isFirstFrame||m||this._hasMaskedPath&&this._pathData.m._mdf){this._isFirstFrame=!1;var w,M,x,I,q,$,ue,Ce,Ve,ee,be,de,te,Ne,He,ie,G,N,W,ne=this._moreOptions.alignment.v,we=this._animatorsData,Be=this._textData,xe=this.mHelper,ct=this._renderType,Ct=this.renderedLetters.length,ot=u.l;if(this._hasMaskedPath){if(W=this._pathData.m,!this._pathData.n||this._pathData._mdf){var Vt,Tt=W.v;for(this._pathData.r.v&&(Tt=Tt.reverse()),q={tLength:0,segments:[]},I=Tt._length-1,ie=0,x=0;x<I;x+=1)Vt=pt.buildBezierData(Tt.v[x],Tt.v[x+1],[Tt.o[x][0]-Tt.v[x][0],Tt.o[x][1]-Tt.v[x][1]],[Tt.i[x+1][0]-Tt.v[x+1][0],Tt.i[x+1][1]-Tt.v[x+1][1]]),q.tLength+=Vt.segmentLength,q.segments.push(Vt),ie+=Vt.segmentLength;x=I,W.v.c&&(Vt=pt.buildBezierData(Tt.v[x],Tt.v[0],[Tt.o[x][0]-Tt.v[x][0],Tt.o[x][1]-Tt.v[x][1]],[Tt.i[0][0]-Tt.v[0][0],Tt.i[0][1]-Tt.v[0][1]]),q.tLength+=Vt.segmentLength,q.segments.push(Vt),ie+=Vt.segmentLength),this._pathData.pi=q}if(q=this._pathData.pi,$=this._pathData.f.v,be=0,ee=1,Ce=0,Ve=!0,Ne=q.segments,$<0&&W.v.c)for(q.tLength<Math.abs($)&&($=-Math.abs($)%q.tLength),ee=(te=Ne[be=Ne.length-1].points).length-1;$<0;)$+=te[ee].partialLength,(ee-=1)<0&&(ee=(te=Ne[be-=1].points).length-1);de=(te=Ne[be].points)[ee-1],He=(ue=te[ee]).partialLength}I=ot.length,w=0,M=0;var We,Pe,ae,oe,P,H=1.2*u.finalSize*.714,Ae=!0;ae=we.length;var Je,zt,Rt,Ht,Xt,Kt,Jt,ni,In,Yn,Ln,Rn,mn=-1,Gt=$,er=be,tr=ee,Ea=-1,ps="",Ps=this.defaultPropsArray;if(u.j===2||u.j===1){var gn=0,Ks=0,Qs=u.j===2?-.5:-1,Zn=0,Js=!0;for(x=0;x<I;x+=1)if(ot[x].n){for(gn&&(gn+=Ks);Zn<x;)ot[Zn].animatorJustifyOffset=gn,Zn+=1;gn=0,Js=!0}else{for(Pe=0;Pe<ae;Pe+=1)(We=we[Pe].a).t.propType&&(Js&&u.j===2&&(Ks+=We.t.v*Qs),(P=we[Pe].s.getMult(ot[x].anIndexes[Pe],Be.a[Pe].s.totalChars)).length?gn+=We.t.v*P[0]*Qs:gn+=We.t.v*P*Qs);Js=!1}for(gn&&(gn+=Ks);Zn<x;)ot[Zn].animatorJustifyOffset=gn,Zn+=1}for(x=0;x<I;x+=1){if(xe.reset(),Ht=1,ot[x].n)w=0,M+=u.yOffset,M+=Ae?1:0,$=Gt,Ae=!1,this._hasMaskedPath&&(ee=tr,de=(te=Ne[be=er].points)[ee-1],He=(ue=te[ee]).partialLength,Ce=0),ps="",Ln="",In="",Rn="",Ps=this.defaultPropsArray;else{if(this._hasMaskedPath){if(Ea!==ot[x].line){switch(u.j){case 1:$+=ie-u.lineWidths[ot[x].line];break;case 2:$+=(ie-u.lineWidths[ot[x].line])/2}Ea=ot[x].line}mn!==ot[x].ind&&(ot[mn]&&($+=ot[mn].extra),$+=ot[x].an/2,mn=ot[x].ind),$+=ne[0]*ot[x].an*.005;var Kn=0;for(Pe=0;Pe<ae;Pe+=1)(We=we[Pe].a).p.propType&&((P=we[Pe].s.getMult(ot[x].anIndexes[Pe],Be.a[Pe].s.totalChars)).length?Kn+=We.p.v[0]*P[0]:Kn+=We.p.v[0]*P),We.a.propType&&((P=we[Pe].s.getMult(ot[x].anIndexes[Pe],Be.a[Pe].s.totalChars)).length?Kn+=We.a.v[0]*P[0]:Kn+=We.a.v[0]*P);for(Ve=!0,this._pathData.a.v&&($=.5*ot[0].an+(ie-this._pathData.f.v-.5*ot[0].an-.5*ot[ot.length-1].an)*mn/(I-1),$+=this._pathData.f.v);Ve;)Ce+He>=$+Kn||!te?(G=($+Kn-Ce)/ue.partialLength,zt=de.point[0]+(ue.point[0]-de.point[0])*G,Rt=de.point[1]+(ue.point[1]-de.point[1])*G,xe.translate(-ne[0]*ot[x].an*.005,-ne[1]*H*.01),Ve=!1):te&&(Ce+=ue.partialLength,(ee+=1)>=te.length&&(ee=0,Ne[be+=1]?te=Ne[be].points:W.v.c?(ee=0,te=Ne[be=0].points):(Ce-=ue.partialLength,te=null)),te&&(de=ue,He=(ue=te[ee]).partialLength));Je=ot[x].an/2-ot[x].add,xe.translate(-Je,0,0)}else Je=ot[x].an/2-ot[x].add,xe.translate(-Je,0,0),xe.translate(-ne[0]*ot[x].an*.005,-ne[1]*H*.01,0);for(Pe=0;Pe<ae;Pe+=1)(We=we[Pe].a).t.propType&&(P=we[Pe].s.getMult(ot[x].anIndexes[Pe],Be.a[Pe].s.totalChars),w===0&&u.j===0||(this._hasMaskedPath?P.length?$+=We.t.v*P[0]:$+=We.t.v*P:P.length?w+=We.t.v*P[0]:w+=We.t.v*P));for(u.strokeWidthAnim&&(Kt=u.sw||0),u.strokeColorAnim&&(Xt=u.sc?[u.sc[0],u.sc[1],u.sc[2]]:[0,0,0]),u.fillColorAnim&&u.fc&&(Jt=[u.fc[0],u.fc[1],u.fc[2]]),Pe=0;Pe<ae;Pe+=1)(We=we[Pe].a).a.propType&&((P=we[Pe].s.getMult(ot[x].anIndexes[Pe],Be.a[Pe].s.totalChars)).length?xe.translate(-We.a.v[0]*P[0],-We.a.v[1]*P[1],We.a.v[2]*P[2]):xe.translate(-We.a.v[0]*P,-We.a.v[1]*P,We.a.v[2]*P));for(Pe=0;Pe<ae;Pe+=1)(We=we[Pe].a).s.propType&&((P=we[Pe].s.getMult(ot[x].anIndexes[Pe],Be.a[Pe].s.totalChars)).length?xe.scale(1+(We.s.v[0]-1)*P[0],1+(We.s.v[1]-1)*P[1],1):xe.scale(1+(We.s.v[0]-1)*P,1+(We.s.v[1]-1)*P,1));for(Pe=0;Pe<ae;Pe+=1){if(We=we[Pe].a,P=we[Pe].s.getMult(ot[x].anIndexes[Pe],Be.a[Pe].s.totalChars),We.sk.propType&&(P.length?xe.skewFromAxis(-We.sk.v*P[0],We.sa.v*P[1]):xe.skewFromAxis(-We.sk.v*P,We.sa.v*P)),We.r.propType&&(P.length?xe.rotateZ(-We.r.v*P[2]):xe.rotateZ(-We.r.v*P)),We.ry.propType&&(P.length?xe.rotateY(We.ry.v*P[1]):xe.rotateY(We.ry.v*P)),We.rx.propType&&(P.length?xe.rotateX(We.rx.v*P[0]):xe.rotateX(We.rx.v*P)),We.o.propType&&(P.length?Ht+=(We.o.v*P[0]-Ht)*P[0]:Ht+=(We.o.v*P-Ht)*P),u.strokeWidthAnim&&We.sw.propType&&(P.length?Kt+=We.sw.v*P[0]:Kt+=We.sw.v*P),u.strokeColorAnim&&We.sc.propType)for(ni=0;ni<3;ni+=1)P.length?Xt[ni]+=(We.sc.v[ni]-Xt[ni])*P[0]:Xt[ni]+=(We.sc.v[ni]-Xt[ni])*P;if(u.fillColorAnim&&u.fc){if(We.fc.propType)for(ni=0;ni<3;ni+=1)P.length?Jt[ni]+=(We.fc.v[ni]-Jt[ni])*P[0]:Jt[ni]+=(We.fc.v[ni]-Jt[ni])*P;We.fh.propType&&(Jt=P.length?pe(Jt,We.fh.v*P[0]):pe(Jt,We.fh.v*P)),We.fs.propType&&(Jt=P.length?he(Jt,We.fs.v*P[0]):he(Jt,We.fs.v*P)),We.fb.propType&&(Jt=P.length?Q(Jt,We.fb.v*P[0]):Q(Jt,We.fb.v*P))}}for(Pe=0;Pe<ae;Pe+=1)(We=we[Pe].a).p.propType&&(P=we[Pe].s.getMult(ot[x].anIndexes[Pe],Be.a[Pe].s.totalChars),this._hasMaskedPath?P.length?xe.translate(0,We.p.v[1]*P[0],-We.p.v[2]*P[1]):xe.translate(0,We.p.v[1]*P,-We.p.v[2]*P):P.length?xe.translate(We.p.v[0]*P[0],We.p.v[1]*P[1],-We.p.v[2]*P[2]):xe.translate(We.p.v[0]*P,We.p.v[1]*P,-We.p.v[2]*P));if(u.strokeWidthAnim&&(In=Kt<0?0:Kt),u.strokeColorAnim&&(Yn="rgb("+Math.round(255*Xt[0])+","+Math.round(255*Xt[1])+","+Math.round(255*Xt[2])+")"),u.fillColorAnim&&u.fc&&(Ln="rgb("+Math.round(255*Jt[0])+","+Math.round(255*Jt[1])+","+Math.round(255*Jt[2])+")"),this._hasMaskedPath){if(xe.translate(0,-u.ls),xe.translate(0,ne[1]*H*.01+M,0),this._pathData.p.v){N=(ue.point[1]-de.point[1])/(ue.point[0]-de.point[0]);var Ca=180*Math.atan(N)/Math.PI;ue.point[0]<de.point[0]&&(Ca+=180),xe.rotate(-Ca*Math.PI/180)}xe.translate(zt,Rt,0),$-=ne[0]*ot[x].an*.005,ot[x+1]&&mn!==ot[x+1].ind&&($+=ot[x].an/2,$+=.001*u.tr*u.finalSize)}else{switch(xe.translate(w,M,0),u.ps&&xe.translate(u.ps[0],u.ps[1]+u.ascent,0),u.j){case 1:xe.translate(ot[x].animatorJustifyOffset+u.justifyOffset+(u.boxWidth-u.lineWidths[ot[x].line]),0,0);break;case 2:xe.translate(ot[x].animatorJustifyOffset+u.justifyOffset+(u.boxWidth-u.lineWidths[ot[x].line])/2,0,0)}xe.translate(0,-u.ls),xe.translate(Je,0,0),xe.translate(ne[0]*ot[x].an*.005,ne[1]*H*.01,0),w+=ot[x].l+.001*u.tr*u.finalSize}ct==="html"?ps=xe.toCSS():ct==="svg"?ps=xe.to2dCSS():Ps=[xe.props[0],xe.props[1],xe.props[2],xe.props[3],xe.props[4],xe.props[5],xe.props[6],xe.props[7],xe.props[8],xe.props[9],xe.props[10],xe.props[11],xe.props[12],xe.props[13],xe.props[14],xe.props[15]],Rn=Ht}Ct<=x?(oe=new Ja(Rn,In,Yn,Ln,ps,Ps),this.renderedLetters.push(oe),Ct+=1,this.lettersChangedFlag=!0):(oe=this.renderedLetters[x],this.lettersChangedFlag=oe.update(Rn,In,Yn,Ln,ps,Ps)||this.lettersChangedFlag)}}},Ta.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},Ta.prototype.mHelper=new vt,Ta.prototype.defaultPropsArray=[],c([gi],Ta),kn.prototype.initElement=function(u,m,w){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(u,m,w),this.textProperty=new nn(this,u.t,this.dynamicProperties),this.textAnimator=new Ta(u.t,this.renderType,this),this.initTransform(u,m,w),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},kn.prototype.prepareFrame=function(u){this._mdf=!1,this.prepareRenderableFrame(u),this.prepareProperties(u,this.isInRange)},kn.prototype.createPathShape=function(u,m){var w,M,x=m.length,I="";for(w=0;w<x;w+=1)m[w].ty==="sh"&&(M=m[w].ks.k,I+=pn(M,M.i.length,!0,u));return I},kn.prototype.updateDocumentData=function(u,m){this.textProperty.updateDocumentData(u,m)},kn.prototype.canResizeFont=function(u){this.textProperty.canResizeFont(u)},kn.prototype.setMinimumFontSize=function(u){this.textProperty.setMinimumFontSize(u)},kn.prototype.applyTextPropertiesToMatrix=function(u,m,w,M,x){switch(u.ps&&m.translate(u.ps[0],u.ps[1]+u.ascent,0),m.translate(0,-u.ls,0),u.j){case 1:m.translate(u.justifyOffset+(u.boxWidth-u.lineWidths[w]),0,0);break;case 2:m.translate(u.justifyOffset+(u.boxWidth-u.lineWidths[w])/2,0,0)}m.translate(M,x,0)},kn.prototype.buildColor=function(u){return"rgb("+Math.round(255*u[0])+","+Math.round(255*u[1])+","+Math.round(255*u[2])+")"},kn.prototype.emptyProp=new Ja,kn.prototype.destroy=function(){},kn.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var km={shapes:[]};function Es(u,m,w){this.textSpans=[],this.renderType="svg",this.initElement(u,m,w)}function lc(u,m,w){this.initElement(u,m,w)}function Zs(u,m,w){this.initFrame(),this.initBaseData(u,m,w),this.initFrame(),this.initTransform(u,m,w),this.initHierarchy()}function Bi(){}function Cs(){}function eo(u,m,w){this.layers=u.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?p(this.layers.length):[],this.initElement(u,m,w),this.tm=u.tm?ft.getProp(this,u.tm,0,m.frameRate,this):{_placeholder:!0}}function cc(u,m){this.animationItem=u,this.layers=null,this.renderedFrame=-1,this.svgElement=ke("svg");var w="";if(m&&m.title){var M=ke("title"),x=Te();M.setAttribute("id",x),M.textContent=m.title,this.svgElement.appendChild(M),w+=x}if(m&&m.description){var I=ke("desc"),q=Te();I.setAttribute("id",q),I.textContent=m.description,this.svgElement.appendChild(I),w+=" "+q}w&&this.svgElement.setAttribute("aria-labelledby",w);var $=ke("defs");this.svgElement.appendChild($);var ue=ke("g");this.svgElement.appendChild(ue),this.layerElement=ue,this.renderConfig={preserveAspectRatio:m&&m.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:m&&m.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:m&&m.contentVisibility||"visible",progressiveLoad:m&&m.progressiveLoad||!1,hideOnTransparent:!(m&&m.hideOnTransparent===!1),viewBoxOnly:m&&m.viewBoxOnly||!1,viewBoxSize:m&&m.viewBoxSize||!1,className:m&&m.className||"",id:m&&m.id||"",focusable:m&&m.focusable,filterSize:{width:m&&m.filterSize&&m.filterSize.width||"100%",height:m&&m.filterSize&&m.filterSize.height||"100%",x:m&&m.filterSize&&m.filterSize.x||"0%",y:m&&m.filterSize&&m.filterSize.y||"0%"},width:m&&m.width,height:m&&m.height,runExpressions:!m||m.runExpressions===void 0||m.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:$,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function $n(){}function ou(){}function hc(u,m,w,M,x){var I=m.container.globalData.renderConfig.filterSize,q=m.data.fs||I;u.setAttribute("x",q.x||I.x),u.setAttribute("y",q.y||I.y),u.setAttribute("width",q.width||I.width),u.setAttribute("height",q.height||I.height),this.filterManager=m;var $=ke("feGaussianBlur");$.setAttribute("in","SourceAlpha"),$.setAttribute("result",M+"_drop_shadow_1"),$.setAttribute("stdDeviation","0"),this.feGaussianBlur=$,u.appendChild($);var ue=ke("feOffset");ue.setAttribute("dx","25"),ue.setAttribute("dy","0"),ue.setAttribute("in",M+"_drop_shadow_1"),ue.setAttribute("result",M+"_drop_shadow_2"),this.feOffset=ue,u.appendChild(ue);var Ce=ke("feFlood");Ce.setAttribute("flood-color","#00ff00"),Ce.setAttribute("flood-opacity","1"),Ce.setAttribute("result",M+"_drop_shadow_3"),this.feFlood=Ce,u.appendChild(Ce);var Ve=ke("feComposite");Ve.setAttribute("in",M+"_drop_shadow_3"),Ve.setAttribute("in2",M+"_drop_shadow_2"),Ve.setAttribute("operator","in"),Ve.setAttribute("result",M+"_drop_shadow_4"),u.appendChild(Ve);var ee=this.createMergeNode(M,[M+"_drop_shadow_4",x]);u.appendChild(ee)}function lu(u,m,w,M){u.setAttribute("x","-100%"),u.setAttribute("y","-100%"),u.setAttribute("width","300%"),u.setAttribute("height","300%"),this.filterManager=m;var x=ke("feGaussianBlur");x.setAttribute("result",M),u.appendChild(x),this.feGaussianBlur=x}return c([jn,ls,js,hs,bn,qs,kn],Es),Es.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=ke("text"))},Es.prototype.buildTextContents=function(u){for(var m=0,w=u.length,M=[],x="";m<w;)u[m]==="\r"||u[m]===""?(M.push(x),x=""):x+=u[m],m+=1;return M.push(x),M},Es.prototype.buildShapeData=function(u,m){if(u.shapes&&u.shapes.length){var w=u.shapes[0];if(w.it){var M=w.it[w.it.length-1];M.s&&(M.s.k[0]=m,M.s.k[1]=m)}}return u},Es.prototype.buildNewText=function(){var u,m;this.addDynamicProperty(this);var w=this.textProperty.currentData;this.renderedLetters=p(w?w.l.length:0),w.fc?this.layerElement.setAttribute("fill",this.buildColor(w.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),w.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(w.sc)),this.layerElement.setAttribute("stroke-width",w.sw)),this.layerElement.setAttribute("font-size",w.finalSize);var M=this.globalData.fontManager.getFontByName(w.f);if(M.fClass)this.layerElement.setAttribute("class",M.fClass);else{this.layerElement.setAttribute("font-family",M.fFamily);var x=w.fWeight,I=w.fStyle;this.layerElement.setAttribute("font-style",I),this.layerElement.setAttribute("font-weight",x)}this.layerElement.setAttribute("aria-label",w.t);var q,$=w.l||[],ue=!!this.globalData.fontManager.chars;m=$.length;var Ce=this.mHelper,Ve="",ee=this.data.singleShape,be=0,de=0,te=!0,Ne=.001*w.tr*w.finalSize;if(!ee||ue||w.sz){var He,ie=this.textSpans.length;for(u=0;u<m;u+=1){if(this.textSpans[u]||(this.textSpans[u]={span:null,childSpan:null,glyph:null}),!ue||!ee||u===0){if(q=ie>u?this.textSpans[u].span:ke(ue?"g":"text"),ie<=u){if(q.setAttribute("stroke-linecap","butt"),q.setAttribute("stroke-linejoin","round"),q.setAttribute("stroke-miterlimit","4"),this.textSpans[u].span=q,ue){var G=ke("g");q.appendChild(G),this.textSpans[u].childSpan=G}this.textSpans[u].span=q,this.layerElement.appendChild(q)}q.style.display="inherit"}if(Ce.reset(),ee&&($[u].n&&(be=-Ne,de+=w.yOffset,de+=te?1:0,te=!1),this.applyTextPropertiesToMatrix(w,Ce,$[u].line,be,de),be+=$[u].l||0,be+=Ne),ue){var N;if((He=this.globalData.fontManager.getCharData(w.finalText[u],M.fStyle,this.globalData.fontManager.getFontByName(w.f).fFamily)).t===1)N=new eo(He.data,this.globalData,this);else{var W=km;He.data&&He.data.shapes&&(W=this.buildShapeData(He.data,w.finalSize)),N=new ci(W,this.globalData,this)}if(this.textSpans[u].glyph){var ne=this.textSpans[u].glyph;this.textSpans[u].childSpan.removeChild(ne.layerElement),ne.destroy()}this.textSpans[u].glyph=N,N._debug=!0,N.prepareFrame(0),N.renderFrame(),this.textSpans[u].childSpan.appendChild(N.layerElement),He.t===1&&this.textSpans[u].childSpan.setAttribute("transform","scale("+w.finalSize/100+","+w.finalSize/100+")")}else ee&&q.setAttribute("transform","translate("+Ce.props[12]+","+Ce.props[13]+")"),q.textContent=$[u].val,q.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}ee&&q&&q.setAttribute("d",Ve)}else{var we=this.textContainer,Be="start";switch(w.j){case 1:Be="end";break;case 2:Be="middle";break;default:Be="start"}we.setAttribute("text-anchor",Be),we.setAttribute("letter-spacing",Ne);var xe=this.buildTextContents(w.finalText);for(m=xe.length,de=w.ps?w.ps[1]+w.ascent:0,u=0;u<m;u+=1)(q=this.textSpans[u].span||ke("tspan")).textContent=xe[u],q.setAttribute("x",0),q.setAttribute("y",de),q.style.display="inherit",we.appendChild(q),this.textSpans[u]||(this.textSpans[u]={span:null,glyph:null}),this.textSpans[u].span=q,de+=w.finalLineHeight;this.layerElement.appendChild(we)}for(;u<this.textSpans.length;)this.textSpans[u].span.style.display="none",u+=1;this._sizeChanged=!0},Es.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var u=this.layerElement.getBBox();this.bbox={top:u.y,left:u.x,width:u.width,height:u.height}}return this.bbox},Es.prototype.getValue=function(){var u,m,w=this.textSpans.length;for(this.renderedFrame=this.comp.renderedFrame,u=0;u<w;u+=1)(m=this.textSpans[u].glyph)&&(m.prepareFrame(this.comp.renderedFrame-this.data.st),m._mdf&&(this._mdf=!0))},Es.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){var u,m;this._sizeChanged=!0;var w,M,x,I=this.textAnimator.renderedLetters,q=this.textProperty.currentData.l;for(m=q.length,u=0;u<m;u+=1)q[u].n||(w=I[u],M=this.textSpans[u].span,(x=this.textSpans[u].glyph)&&x.renderFrame(),w._mdf.m&&M.setAttribute("transform",w.m),w._mdf.o&&M.setAttribute("opacity",w.o),w._mdf.sw&&M.setAttribute("stroke-width",w.sw),w._mdf.sc&&M.setAttribute("stroke",w.sc),w._mdf.fc&&M.setAttribute("fill",w.fc))}},c([Xs],lc),lc.prototype.createContent=function(){var u=ke("rect");u.setAttribute("width",this.data.sw),u.setAttribute("height",this.data.sh),u.setAttribute("fill",this.data.sc),this.layerElement.appendChild(u)},Zs.prototype.prepareFrame=function(u){this.prepareProperties(u,!0)},Zs.prototype.renderFrame=function(){},Zs.prototype.getBaseElement=function(){return null},Zs.prototype.destroy=function(){},Zs.prototype.sourceRectAtTime=function(){},Zs.prototype.hide=function(){},c([jn,ls,hs,bn],Zs),c([Si],Bi),Bi.prototype.createNull=function(u){return new Zs(u,this.globalData,this)},Bi.prototype.createShape=function(u){return new ci(u,this.globalData,this)},Bi.prototype.createText=function(u){return new Es(u,this.globalData,this)},Bi.prototype.createImage=function(u){return new Xs(u,this.globalData,this)},Bi.prototype.createSolid=function(u){return new lc(u,this.globalData,this)},Bi.prototype.configAnimation=function(u){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+u.w+" "+u.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",u.w),this.svgElement.setAttribute("height",u.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var m=this.globalData.defs;this.setupGlobalData(u,m),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=u;var w=ke("clipPath"),M=ke("rect");M.setAttribute("width",u.w),M.setAttribute("height",u.h),M.setAttribute("x",0),M.setAttribute("y",0);var x=Te();w.setAttribute("id",x),w.appendChild(M),this.layerElement.setAttribute("clip-path","url("+r()+"#"+x+")"),m.appendChild(w),this.layers=u.layers,this.elements=p(u.layers.length)},Bi.prototype.destroy=function(){var u;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var m=this.layers?this.layers.length:0;for(u=0;u<m;u+=1)this.elements[u]&&this.elements[u].destroy&&this.elements[u].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},Bi.prototype.updateContainerSize=function(){},Bi.prototype.findIndexByInd=function(u){var m=0,w=this.layers.length;for(m=0;m<w;m+=1)if(this.layers[m].ind===u)return m;return-1},Bi.prototype.buildItem=function(u){var m=this.elements;if(!m[u]&&this.layers[u].ty!==99){m[u]=!0;var w=this.createItem(this.layers[u]);if(m[u]=w,me()&&(this.layers[u].ty===0&&this.globalData.projectInterface.registerComposition(w),w.initExpressions()),this.appendElementInPos(w,u),this.layers[u].tt){var M="tp"in this.layers[u]?this.findIndexByInd(this.layers[u].tp):u-1;if(M===-1)return;if(this.elements[M]&&this.elements[M]!==!0){var x=m[M].getMatte(this.layers[u].tt);w.setMatte(x)}else this.buildItem(M),this.addPendingElement(w)}}},Bi.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var u=this.pendingElements.pop();if(u.checkParenting(),u.data.tt)for(var m=0,w=this.elements.length;m<w;){if(this.elements[m]===u){var M="tp"in u.data?this.findIndexByInd(u.data.tp):m-1,x=this.elements[M].getMatte(this.layers[m].tt);u.setMatte(x);break}m+=1}}},Bi.prototype.renderFrame=function(u){if(this.renderedFrame!==u&&!this.destroyed){var m;u===null?u=this.renderedFrame:this.renderedFrame=u,this.globalData.frameNum=u,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=u,this.globalData._mdf=!1;var w=this.layers.length;for(this.completeLayers||this.checkLayers(u),m=w-1;m>=0;m-=1)(this.completeLayers||this.elements[m])&&this.elements[m].prepareFrame(u-this.layers[m].st);if(this.globalData._mdf)for(m=0;m<w;m+=1)(this.completeLayers||this.elements[m])&&this.elements[m].renderFrame()}},Bi.prototype.appendElementInPos=function(u,m){var w=u.getBaseElement();if(w){for(var M,x=0;x<m;)this.elements[x]&&this.elements[x]!==!0&&this.elements[x].getBaseElement()&&(M=this.elements[x].getBaseElement()),x+=1;M?this.layerElement.insertBefore(w,M):this.layerElement.appendChild(w)}},Bi.prototype.hide=function(){this.layerElement.style.display="none"},Bi.prototype.show=function(){this.layerElement.style.display="block"},c([jn,ls,hs,bn,qs],Cs),Cs.prototype.initElement=function(u,m,w){this.initFrame(),this.initBaseData(u,m,w),this.initTransform(u,m,w),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),!this.data.xt&&m.progressiveLoad||this.buildAllItems(),this.hide()},Cs.prototype.prepareFrame=function(u){if(this._mdf=!1,this.prepareRenderableFrame(u),this.prepareProperties(u,this.isInRange),this.isInRange||this.data.xt){if(this.tm._placeholder)this.renderedFrame=u/this.data.sr;else{var m=this.tm.v;m===this.data.op&&(m=this.data.op-1),this.renderedFrame=m}var w,M=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),w=M-1;w>=0;w-=1)(this.completeLayers||this.elements[w])&&(this.elements[w].prepareFrame(this.renderedFrame-this.layers[w].st),this.elements[w]._mdf&&(this._mdf=!0))}},Cs.prototype.renderInnerContent=function(){var u,m=this.layers.length;for(u=0;u<m;u+=1)(this.completeLayers||this.elements[u])&&this.elements[u].renderFrame()},Cs.prototype.setElements=function(u){this.elements=u},Cs.prototype.getElements=function(){return this.elements},Cs.prototype.destroyElements=function(){var u,m=this.layers.length;for(u=0;u<m;u+=1)this.elements[u]&&this.elements[u].destroy()},Cs.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},c([Bi,Cs,js],eo),eo.prototype.createComp=function(u){return new eo(u,this.globalData,this)},c([Bi],cc),cc.prototype.createComp=function(u){return new eo(u,this.globalData,this)},c([us],$n),$n.prototype.initModifierProperties=function(u,m){this.s=ft.getProp(u,m.s,0,.01,this),this.e=ft.getProp(u,m.e,0,.01,this),this.o=ft.getProp(u,m.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=m.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},$n.prototype.addShapeToModifier=function(u){u.pathsData=[]},$n.prototype.calculateShapeEdges=function(u,m,w,M,x){var I=[];m<=1?I.push({s:u,e:m}):u>=1?I.push({s:u-1,e:m-1}):(I.push({s:u,e:1}),I.push({s:0,e:m-1}));var q,$,ue=[],Ce=I.length;for(q=0;q<Ce;q+=1){var Ve,ee;($=I[q]).e*x<M||$.s*x>M+w||(Ve=$.s*x<=M?0:($.s*x-M)/w,ee=$.e*x>=M+w?1:($.e*x-M)/w,ue.push([Ve,ee]))}return ue.length||ue.push([0,0]),ue},$n.prototype.releasePathsData=function(u){var m,w=u.length;for(m=0;m<w;m+=1)ze.release(u[m]);return u.length=0,u},$n.prototype.processShapes=function(u){var m,w,M,x;if(this._mdf||u){var I=this.o.v%360/360;if(I<0&&(I+=1),(m=this.s.v>1?1+I:this.s.v<0?0+I:this.s.v+I)>(w=this.e.v>1?1+I:this.e.v<0?0+I:this.e.v+I)){var q=m;m=w,w=q}m=1e-4*Math.round(1e4*m),w=1e-4*Math.round(1e4*w),this.sValue=m,this.eValue=w}else m=this.sValue,w=this.eValue;var $,ue,Ce,Ve,ee,be=this.shapes.length,de=0;if(w===m)for(x=0;x<be;x+=1)this.shapes[x].localShapeCollection.releaseShapes(),this.shapes[x].shape._mdf=!0,this.shapes[x].shape.paths=this.shapes[x].localShapeCollection,this._mdf&&(this.shapes[x].pathsData.length=0);else if(w===1&&m===0||w===0&&m===1){if(this._mdf)for(x=0;x<be;x+=1)this.shapes[x].pathsData.length=0,this.shapes[x].shape._mdf=!0}else{var te,Ne,He=[];for(x=0;x<be;x+=1)if((te=this.shapes[x]).shape._mdf||this._mdf||u||this.m===2){if(ue=(M=te.shape.paths)._length,ee=0,!te.shape._mdf&&te.pathsData.length)ee=te.totalShapeLength;else{for(Ce=this.releasePathsData(te.pathsData),$=0;$<ue;$+=1)Ve=pt.getSegmentsLength(M.shapes[$]),Ce.push(Ve),ee+=Ve.totalLength;te.totalShapeLength=ee,te.pathsData=Ce}de+=ee,te.shape._mdf=!0}else te.shape.paths=te.localShapeCollection;var ie,G=m,N=w,W=0;for(x=be-1;x>=0;x-=1)if((te=this.shapes[x]).shape._mdf){for((Ne=te.localShapeCollection).releaseShapes(),this.m===2&&be>1?(ie=this.calculateShapeEdges(m,w,te.totalShapeLength,W,de),W+=te.totalShapeLength):ie=[[G,N]],ue=ie.length,$=0;$<ue;$+=1){G=ie[$][0],N=ie[$][1],He.length=0,N<=1?He.push({s:te.totalShapeLength*G,e:te.totalShapeLength*N}):G>=1?He.push({s:te.totalShapeLength*(G-1),e:te.totalShapeLength*(N-1)}):(He.push({s:te.totalShapeLength*G,e:te.totalShapeLength}),He.push({s:0,e:te.totalShapeLength*(N-1)}));var ne=this.addShapes(te,He[0]);if(He[0].s!==He[0].e){if(He.length>1)if(te.shape.paths.shapes[te.shape.paths._length-1].c){var we=ne.pop();this.addPaths(ne,Ne),ne=this.addShapes(te,He[1],we)}else this.addPaths(ne,Ne),ne=this.addShapes(te,He[1]);this.addPaths(ne,Ne)}}te.shape.paths=Ne}}},$n.prototype.addPaths=function(u,m){var w,M=u.length;for(w=0;w<M;w+=1)m.addShape(u[w])},$n.prototype.addSegment=function(u,m,w,M,x,I,q){x.setXYAt(m[0],m[1],"o",I),x.setXYAt(w[0],w[1],"i",I+1),q&&x.setXYAt(u[0],u[1],"v",I),x.setXYAt(M[0],M[1],"v",I+1)},$n.prototype.addSegmentFromArray=function(u,m,w,M){m.setXYAt(u[1],u[5],"o",w),m.setXYAt(u[2],u[6],"i",w+1),M&&m.setXYAt(u[0],u[4],"v",w),m.setXYAt(u[3],u[7],"v",w+1)},$n.prototype.addShapes=function(u,m,w){var M,x,I,q,$,ue,Ce,Ve,ee=u.pathsData,be=u.shape.paths.shapes,de=u.shape.paths._length,te=0,Ne=[],He=!0;for(w?($=w._length,Ve=w._length):(w=De.newElement(),$=0,Ve=0),Ne.push(w),M=0;M<de;M+=1){for(ue=ee[M].lengths,w.c=be[M].c,I=be[M].c?ue.length:ue.length+1,x=1;x<I;x+=1)if(te+(q=ue[x-1]).addedLength<m.s)te+=q.addedLength,w.c=!1;else{if(te>m.e){w.c=!1;break}m.s<=te&&m.e>=te+q.addedLength?(this.addSegment(be[M].v[x-1],be[M].o[x-1],be[M].i[x],be[M].v[x],w,$,He),He=!1):(Ce=pt.getNewSegment(be[M].v[x-1],be[M].v[x],be[M].o[x-1],be[M].i[x],(m.s-te)/q.addedLength,(m.e-te)/q.addedLength,ue[x-1]),this.addSegmentFromArray(Ce,w,$,He),He=!1,w.c=!1),te+=q.addedLength,$+=1}if(be[M].c&&ue.length){if(q=ue[x-1],te<=m.e){var ie=ue[x-1].addedLength;m.s<=te&&m.e>=te+ie?(this.addSegment(be[M].v[x-1],be[M].o[x-1],be[M].i[0],be[M].v[0],w,$,He),He=!1):(Ce=pt.getNewSegment(be[M].v[x-1],be[M].v[0],be[M].o[x-1],be[M].i[0],(m.s-te)/ie,(m.e-te)/ie,ue[x-1]),this.addSegmentFromArray(Ce,w,$,He),He=!1,w.c=!1)}else w.c=!1;te+=q.addedLength,$+=1}if(w._length&&(w.setXYAt(w.v[Ve][0],w.v[Ve][1],"i",Ve),w.setXYAt(w.v[w._length-1][0],w.v[w._length-1][1],"o",w._length-1)),te>m.e)break;M<de-1&&(w=De.newElement(),He=!0,Ne.push(w),$=0)}return Ne},ou.prototype={createMergeNode:function(u,m){var w,M,x=ke("feMerge");for(x.setAttribute("result",u),M=0;M<m.length;M+=1)(w=ke("feMergeNode")).setAttribute("in",m[M]),x.appendChild(w),x.appendChild(w);return x}},c([ou],hc),hc.prototype.renderFrame=function(u){if(u||this.filterManager._mdf){if((u||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),u||this.filterManager.effectElements[0].p._mdf){var m=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",ve(Math.round(255*m[0]),Math.round(255*m[1]),Math.round(255*m[2])))}if((u||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),u||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var w=this.filterManager.effectElements[3].p.v,M=(this.filterManager.effectElements[2].p.v-90)*k,x=w*Math.cos(M),I=w*Math.sin(M);this.feOffset.setAttribute("dx",x),this.feOffset.setAttribute("dy",I)}}},lu.prototype.renderFrame=function(u){if(u||this.filterManager._mdf){var m=.3,w=this.filterManager.effectElements[0].p.v*m,M=this.filterManager.effectElements[1].p.v,x=M==3?0:w,I=M==2?0:w;this.feGaussianBlur.setAttribute("stdDeviation",x+" "+I);var q=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",q)}},X("svg",cc),Pn.registerModifier("tm",$n),Kr(25,hc,!0),Kr(29,lu,!0),ut}());var zM=BM(Eh.exports);const VM=[/^https?:\/\/(.*[^.]\.)?lottielab\.com$/],xf={v:"5.7.5",fr:100,ip:0,op:300,w:300,h:225,nm:"Comp 1",ddd:0,assets:[],layers:[],markers:[]};let HM=class{constructor(e,t,i){this.root=e,this.initialize(t,i)}_initWithAnimation(e,t,i){this._animation=zM.loadAnimation({container:t,renderer:"svg",autoplay:!1,animationData:e,rendererSettings:{preserveAspectRatio:i}})}initialize(e,t){this.destroy();const i=document.createElement("div");if(i.style.width="100%",i.style.height="100%",typeof e=="string"){if(this.loadingSrc===e)return Promise.resolve();this.loadingSrc=e;const n=new XMLHttpRequest;n.open("GET",e,!0);try{VM.some(s=>new URL(e).origin.match(s))&&n.setRequestHeader("X-Lottie-Player","@lottielab/lottie-player 1.1.3")}catch{}return new Promise((s,a)=>{n.onload=()=>{if(this.loadingSrc!==e)return s();try{if(n.status===200){if(!n.response)return a(new Error(`Failed to load Lottie file ${e}: Empty response`));const r=JSON.parse(n.response);return this._initWithAnimation(r,i,t),this.root.innerHTML="",this.root.appendChild(i),s()}{let r=n.responseText;return r.length>300&&(r=r.slice(0,300)+"... (truncated)"),a(new Error(`Failed to load Lottie file ${e}: HTTP ${n.status} ${n.statusText}
Response:
${r}`))}}catch(r){return r.message&&(r.message=`Failed to load Lottie file ${e}: ${r.message}`),a(r)}finally{this.loadingSrc=void 0}},n.onerror=()=>{this.loadingSrc=void 0,a(new Error(`Failed to load Lottie file ${e}: Network error`))},n.send()})}return this._initWithAnimation(e??xf,i,t),this.root.innerHTML="",this.root.appendChild(i),this.loadingSrc=void 0,Promise.resolve()}get frameRate(){return this._animation?this._animation.frameRate:0}get duration(){return this._animation?this._animation.getDuration(!1):0}get durationFrames(){return this._animation?this._animation.getDuration(!0):0}get animation(){return this._animation}get animationData(){var e;const t=(e=this._animation)===null||e===void 0?void 0:e.animationData;if(t!==xf)return t}renderFrame(e){const t=Math.max(0,Math.min(this.durationFrames-1e-6,e*this.frameRate));this._animation.goToAndStop(t,!0)}get currentTime(){return this._animation.currentFrame/this.frameRate}get currentFrame(){return this._animation.currentFrame}destroy(){this._animation&&this._animation.destroy(),this.root.innerHTML=""}};function mo(o,e,t){var i,n,s,a;return o==null?e:e==null?o:typeof o=="number"?typeof e!="number"?t>.5?e:o:(1-t)*o+t*e:Array.isArray(o)||o instanceof Float32Array?Array.isArray(e)||e instanceof Float32Array?o.map((r,l)=>{var c;return mo(r,(c=e[l])!==null&&c!==void 0?c:r,t)}):t>.5?e:o:"i"in o&&"v"in o&&"o"in o&&typeof e=="object"&&"i"in e&&"v"in e&&"o"in e?{closed:o.closed&&e.closed,i:mo(o.i,e.i,t),o:mo(o.o,e.o,t),v:mo(o.v,e.v,t),length:Math.max((i=o.length)!==null&&i!==void 0?i:0,(n=e.length)!==null&&n!==void 0?n:0),_length:Math.max((s=o._length)!==null&&s!==void 0?s:0,(a=e._length)!==null&&a!==void 0?a:0)}:t>.5?e:o}class GM{constructor(e){var t;this.ops=[],this.lottie=e;const i=e.renderer,n=new WeakSet;((t=i==null?void 0:i.elements)!==null&&t!==void 0?t:[]).forEach(s=>this.attach(s,n))}attachToProp(e){var t;const i=this,n=e;if(!(!((t=e.effectsSequence)===null||t===void 0)&&t.length))return;const s=[];for(let a=0;a<8;a++)s[a]={_caching:structuredClone(e._caching),propType:n.propType,offsetTime:n.offsetTime,keyframes:n.keyframes,keyframesMetadata:n.keyframesMetadata,sh:n.sh,pv:structuredClone(n.pv)};e.addEffect(function(a){const r=i.ops.slice(-8);e.interpolateShape&&a==null&&(a=structuredClone(n.pv));for(let l=0;l<r.length;l++){const c=r[l],h=s[l];!h._caching&&e._caching&&(h._caching=structuredClone(e._caching)),!h.keyframes&&n.keyframes&&(h.keyframes=n.keyframes),!h.keyframesMetadata&&n.keyframesMetadata&&(h.keyframesMetadata=n.keyframesMetadata);const d=Math.min(Math.max(Math.round(c.time*i.lottie.frameRate),0),i.lottie.getDuration(!0)-1e-5);try{let f;h.offsetTime=e.offsetTime,e.interpolateValue?(h._caching.lastFrame>=d&&(h._caching._lastKeyframeIndex=-1,h._caching.lastIndex=0),f=e.interpolateValue.call(h,d,h._caching),h.pv=f):e.interpolateShape?(h._caching.lastIndex=h._caching.lastFrame<d?h._caching.lastIndex:0,e.interpolateShape.call(h,d,h.pv,h._caching),f=h.pv):f=0,h._caching.lastFrame=d,a=mo(a,f,c.strength)}catch(f){console.warn("[@lottielab/lottie-player:morph]",f)}}return a})}attach(e,t=new WeakSet){if(!t.has(e)&&typeof e=="object"&&e!=null)if(t.add(e),e.interpolateShape||e.interpolateValue||e.addEffect||e.effectsSequence)this.attachToProp(e);else for(const i of Object.values(e))this.attach(i,t)}detach(){}}let ga=class{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}removeListener(e){this.listeners=this.listeners.filter(t=>t!==e)}hasListeners(){return this.listeners.length>0}removeAllListeners(){this.listeners=[]}emit(e){for(const t of this.listeners)t(e)}};class WM{constructor(e,t,i,n){this.animationFrame=void 0,this.onFrameBound=this.onFrame.bind(this),this.timeMultiplier=1,this.timeEvent=new ga,this.renderer=new HM(e,t,n),this._state={time:0,lottie:this.renderer.animationData},i&&(this.animationFrame=requestAnimationFrame(this.onFrameBound),this.driver=i)}initialize(e,t){return this.renderer.initialize(e,t).then(()=>{this.animationFrame===void 0&&(this.animationFrame=requestAnimationFrame(this.onFrameBound)),this.advanceToNow(),this._state.lottie=this.renderer.animationData,this.refresh()}).catch(i=>{this._state.lottie=void 0})}get state(){return this._state}refresh(){var e;(e=this.morphing)===null||e===void 0||e.detach(),this.morphing=void 0,this.setState(this.state)}setState(e){var t,i,n,s;const a=this._state.time!==e.time;if(this._state=e,a&&this.renderer.renderFrame(e.time),e.morphs){if(!this.morphing&&this.renderer.animation&&(this.morphing=new GM(this.renderer.animation)),this.morphing){const r=this.morphing.ops.length!==e.morphs.length||this.morphing.ops.some((l,c)=>{const h=e.morphs[c];return!h||l.time!==h.time||l.strength!==h.strength});this.morphing.ops=e.morphs,r&&((i=(t=this.renderer.animation)===null||t===void 0?void 0:t.renderer)===null||i===void 0||i.renderFrame(null))}}else this.morphing&&this.morphing.ops.length>0&&(this.morphing.ops=[],(s=(n=this.renderer.animation)===null||n===void 0?void 0:n.renderer)===null||s===void 0||s.renderFrame(null))}set state(e){if(this.driver)throw new Error("Cannot set state directly when using a driver");this.setState(e)}get driver(){return this._driver}set driver(e){this.prevClock=void 0,this.animationFrame===void 0&&e?this.animationFrame=requestAnimationFrame(this.onFrameBound):this.animationFrame===void 0||e||(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0),this._driver=e,e!=null&&e.advance&&this.setState(e.advance(this._state,0))}get clock(){if(this.prevTime===void 0)return 0;const e=this.prevTime,t=(performance==null?void 0:performance.now())||new Date().getTime();return(e+(t-(this.prevRealTime||t)))/1e3}get duration(){return this.renderer.duration}get durationInFrames(){return this.renderer.durationFrames}get frameRate(){return this.renderer.frameRate}get animation(){return this.renderer.animation}get animationData(){return this.renderer.animationData}get currentTime(){return this.renderer.currentTime}get currentFrame(){return this.renderer.currentFrame}advanceToNow(){var e;const t=this.clock,i=this.prevClock!==void 0?t-this.prevClock:0;if(!((e=this.driver)===null||e===void 0)&&e.advance&&i>0){this._state.lottie=this.renderer.animationData;const n=i*this.timeMultiplier;this.setState(this.driver.advance(this._state,i*this.timeMultiplier)),this.timeEvent.emit({playhead:this.currentTime,clock:this.clock,elapsed:n}),this.renderer.renderFrame(this._state.time)}this.prevClock=t}destroy(){var e;this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0),(e=this.morphing)===null||e===void 0||e.detach(),this.renderer.destroy()}onFrame(e){this.prevTime=e,this.prevRealTime=(performance==null?void 0:performance.now())||new Date().getTime(),this.advanceToNow(),this.animationFrame=requestAnimationFrame(this.onFrameBound)}}function Sf(o){return o?o.fr:100}let Ch=class{constructor(){this.playing=!0,this.time=0,this.speed=1,this.direction=1,this._loop=!0,this._loopsRemaining=1/0,this.loopEvent=new ga,this.finishEvent=new ga}get effectiveSegment(){var e;return this.segment?this.segment:[0,(e=this._duration)!==null&&e!==void 0?e:0]}globalTimeToSegmentTime(e){const[t,i]=this.effectiveSegment;return Math.min(Math.max(e-t,0),i-t)}segmentTimeToGlobalTime(e){const[t]=this.effectiveSegment;return t+e}advance(e,t,i){const{lottie:n}=e;if(this._fps=Sf(n),this._duration=function(c){return c?(c.op-c.ip)/Sf(c):0}(n),!this.playing)return{time:this.time,lottie:n};const s=this.globalTimeToSegmentTime(this.time);let a;a=s+t*this.speed*this.direction;const r=[];if(this.durationOfSegment>0){const c=Math.abs(Math.floor(a/this.durationOfSegment)),h=this.durationOfSegment-s;for(let d=0;d<c;d++){this._loopsRemaining--;const f=h+d*this.durationOfSegment;if(!(this._loopsRemaining>0)){r.push({type:"finish",relativeTime:f}),a=Math.max(0,Math.min(a,this.durationOfSegment)),this._loopsRemaining=0,this.playing=!1;break}r.push({type:"loop",relativeTime:f}),a>=this.durationOfSegment?a-=this.durationOfSegment:a+=this.durationOfSegment}}else a=0,r.push({type:"loop",relativeTime:0});const l=this.segmentTimeToGlobalTime(a);if(this.time=l,r.length>0){i!=null&&i.push(...r);for(const c of r)c.type==="loop"?this.loopEvent.emit(void 0):c.type==="finish"&&this.finishEvent.emit(void 0)}return{time:l,lottie:n}}play(){this.playing=!0}pause(){this.playing=!1}stop(){this.playing=!1,this.seek(0),this.loop=this._loop}seek(e){this.time=e}seekToFrame(e){this.time=e/this.frameRate}loopBetween(e,t){this.segment=[e,t]}loopBetweenFrames(e,t){this.segment=[e/this.frameRate,t/this.frameRate]}get loop(){return this._loop}set loop(e){this._loop=e,this._loopsRemaining=typeof e=="number"?e:e?1/0:1}get currentTime(){return this.time}get currentFrame(){return this.time*this.frameRate}get timeInSegment(){return this.globalTimeToSegmentTime(this.time)}set timeInSegment(e){this.time=this.segmentTimeToGlobalTime(e)}get frameInSegment(){return this.timeInSegment*this.frameRate}get frameRate(){var e;return(e=this._fps)!==null&&e!==void 0?e:100}get duration(){var e;return(e=this._duration)!==null&&e!==void 0?e:0}get durationFrames(){return this.duration*this.frameRate}get durationOfSegment(){const[e,t]=this.effectiveSegment;return t-e}get animation(){throw new Error("This is just a driver and implements ILottie for clarity; you shouldn't directly call this function")}get animationData(){throw new Error("This is just a driver and implements ILottie for clarity; you shouldn't directly call this function")}toInteractive(){throw new Error("This is just a driver and implements ILottie for clarity; you shouldn't directly call this function")}toPlayback(){}on(e,t){throw new Error("This is just a driver and implements ILottie for clarity; you shouldn't directly call this function")}off(e,t){throw new Error("This is just a driver and implements ILottie for clarity; you shouldn't directly call this function")}};function jM(o){switch(o.event){case"finish":return"finish";case"click":case"mouseDown":case"mouseUp":case"mouseEnter":case"mouseLeave":return o.target?`${o.event}:${o.target}`:o.event;case"custom":return"custom:"+o.name}}function Er(o){throw new Error(`Unexpected ${o.name} at position ${o.position}.`)}const qM=(()=>{const o=[{name:"number",lbp:2,detect:t=>/^([1-9]\d*|0)(\.\d*)?$/.test(t),nud:(t,i)=>({type:0,value:parseFloat(i.value)})},{name:"identifier",lbp:2,detect:t=>/^[_a-zA-Z][_a-zA-Z0-9]*(\.[a-zA-Z]+)*$/.test(t),nud:(t,i)=>({type:1,name:i.value})},{name:"^",lbp:9,led:(t,i)=>({type:3,operator:"^",left:i,right:t.parse(8)})},{name:"!",lbp:10,nud:t=>({type:2,operator:"!",operand:t.parse(10)})},{name:"conditional-operator",detect:t=>t=="?",lbp:3,led:(t,i)=>{const n=t.parse(2),s=t.pop();return s.name!=":"&&Er(s),{type:4,condition:i,thenBranch:n,elseBranch:t.parse(2)}}},{name:"(",lbp:11,nud:t=>{const i=t.parse(1),n=t.pop();return n.name!=")"&&Er(n),i},led:(t,i,n)=>{i.type!=1&&Er(n);const s=[];if(t.peek().name==")")t.pop();else for(;;){s.push(t.parse(1));const a=t.pop();if(a.name==")")break;a.name!=","&&Er(a)}return{type:5,name:i.name,operands:s}}},{name:"end of input",lbp:0}];for(const t of["+","-"])o.push({name:t,lbp:7,nud:i=>({type:2,operator:t,operand:i.parse(7)}),led:(i,n)=>({type:3,operator:t,left:n,right:i.parse(7)})});const e=[["*",8],["/",8],["<",6],["<=",6],[">",6],[">=",6],["==",6],["&&",5],["||",4]];for(const[t,i]of e)o.push({name:t,lbp:i,led:(n,s)=>({type:3,operator:t,left:s,right:n.parse(i)})});for(const t of[",",")",":"])o.push({name:t,lbp:1});return o})();function XM(o){const e=function(n){const s=/^\s*$/,a=n.split(/([+\-*/^(),?:!]|<=|>=|==|>(?!=)|<(?!=)|\|\||&&|\s+)/g);a.push("end of input");let r=0;const l=[];for(const c of a){if(!qM.some(h=>{var d;if(((d=h.detect)!==null&&d!==void 0?d:f=>f==h.name)(c))return l.push(Object.assign(Object.assign({},h),{value:c,position:r})),!0})&&!s.test(c))throw new Error(`Invalid token ${c} at position ${r}`);r+=c.length}return l}(o);let t=0;const i={peek:()=>e[t],pop:()=>e[t++],parse:n=>{let s=i.pop();s.nud||Er(s);let a=s.nud(i,s);for(;i.peek().lbp>n;)s=i.pop(),s.led||Er(s),a=s.led(i,a,s);return a}};return i.parse(0)}const Af=Math;function Tf(o){throw new Error(`Symbol ${o} is not defined and not a built in symbol.`)}function Na(o,e){var t,i;switch(o.type){case 0:return o.value;case 1:{const n=o.name,s=(t=e[n])!==null&&t!==void 0?t:Af[n];if(s==null&&Tf(n),typeof s!="boolean"&&typeof s!="number")throw new Error(`Symbol ${n} is a function and must be used in a function call.`);return s}case 2:{const n=Na(o.operand,e);return function(s,a){switch(s){case"+":return+a;case"-":return-a;case"!":return!a}}(o.operator,n)}case 3:{const n=Na(o.left,e),s=Na(o.right,e);return function(a,r,l){switch(a){case"+":return r+l;case"-":return r-l;case"*":return r*l;case"/":return r/l;case"^":return Math.pow(r,l);case"<":return r<l;case"<=":return r<=l;case">":return r>l;case">=":return r>=l;case"==":return r==l;case"&&":return r&&l;case"||":return r||l}}(o.operator,n,s)}case 4:{const n=Na(o.condition,e);return Na(n?o.thenBranch:o.elseBranch,e)}case 5:{const n=o.name,s=(i=e[n])!==null&&i!==void 0?i:Af[n];if(s==null&&Tf(n),typeof s!="function")throw new Error(`Symbol ${n} has value ${s} and is not callable.`);if(s.length!=o.operands.length)throw new Error(`Expected ${s.length} operands for ${n}, received ${o.operands.length}`);const a=o.operands.map(r=>Na(r,e));return s.apply(null,a)}}}const $M={time:0,"time.diff":0,playhead:0,"playhead.progress":0,"playhead.abs":0,"mouse.x":0,"mouse.y":0,"mouse.progress.x":0,"mouse.progress.y":0,"mouse.abs.x":0,"mouse.abs.y":0,"mouse.buttons.left":!1,"mouse.buttons.right":!1,"mouse.buttons.middle":!1};function Ef(o,e){const t=Object.assign({},o);for(const i in e){if(!/^[a-zA-Z_][a-zA-Z0-9_.]*$/.test(i))continue;const n=e[i];typeof n=="object"&&"x"in n&&"y"in n&&typeof n.x=="number"&&typeof n.y=="number"?(t[i+".x"]=n.x,t[i+".y"]=n.y):t[i]=typeof n=="number"||typeof n=="boolean"?n:0}return t}function YM(o,e){return function(t,i){return function(n,s){return n.reduce((a,r,l)=>({x:a.x+s[l]*r.x,y:a.y+s[l]*r.y}),{x:0,y:0})}(function(n){return[n.start,n.controlPoint1,n.controlPoint2,n.end]}(t),[Math.pow(1-i,3),3*Math.pow(1-i,2)*i,3*(1-i)*Math.pow(i,2),Math.pow(i,3)])}(function(t){return{start:{x:0,y:0},end:{x:1,y:1},controlPoint1:t.o,controlPoint2:t.i}}(o),e).y}function Ph(o,e){try{const t=XM(o);return i=>{try{return+Na(t,i)}catch{return e}}}catch{return()=>e}}function Cf(o){var e;const t=new Ch;t.segment=o.segment,t.loop=(e=o.loop)===null||e===void 0||e,o.direction&&(t.direction=o.direction==="forward"?1:-1);const i={driver:t};return typeof o.speed=="number"?t.speed=o.speed:typeof o.speed=="string"&&(i.speedControl=Ph(o.speed,1)),o.playhead&&(i.playheadControl=Ph(o.playhead,0)),i}function Zl(o,e,t,i,n,s){var a,r;const l=o.playback,c=Object.assign(Object.assign({},n),{time:i,"time.diff":t,playhead:l.driver.timeInSegment,"playhead.progress":l.driver.durationOfSegment>0?l.driver.timeInSegment/l.driver.durationOfSegment:0,"playhead.abs":l.driver.currentTime});l.speedControl&&(l.driver.speed=l.speedControl(n));const h=l.driver.advance(e,t,s);l.playheadControl&&(h.time=l.playheadControl(c)*l.driver.durationOfSegment+((r=(a=l.driver.segment)===null||a===void 0?void 0:a[0])!==null&&r!==void 0?r:0));const d=function(f,p,b){var _,y;if(!f.morphing)return;const v=(y=(_=f.def.morphing)===null||_===void 0?void 0:_.timeRemap)!==null&&y!==void 0?y:"proportional";let S;const A=p.morphs?p.morphs[p.morphs.length-1].time:p.time;switch(v){case"proportional":S=um(A,f.def.segment,f.morphing.other.def.segment);break;case"wrap":S=dm(A,f.def.segment,f.morphing.other.def.segment);break;case"clamp":S=fm(A,f.def.segment,f.morphing.other.def.segment);break;default:return void console.warn(`[@lottielab/lottie-player:interactive] Unknown timeRemap: ${v}`)}return{time:S,strength:typeof f.morphing.strength=="number"?f.morphing.strength:f.morphing.strength(b)}}(o,h,n);return d&&(h.morphs=[d]),h}function um(o,e,t,i=1){const n=e[1]-e[0],s=t[1]-t[0];let a=n>0?(o-e[0])/n:0;return a=Math.min(1,Math.max(0,a))*i,t[0]+a*s}function dm(o,e,t){const i=t[1]-t[0],n=o-e[0],s=t[0]+(i>0?n%(t[1]-t[0]):0);return Math.min(t[1],Math.max(t[0],s))}function fm(o,e,t){const i=o-e[0]+t[0];return Math.min(t[1],Math.max(t[0],i))}function pm(o,e,t,i,n,s=!0,a=8){var r;let l=e.next?Zl(e.next,o,t,i,n):o;if(e&&e.def.duration){let c;c=e.prev.type==="state"?Zl(e.prev,o,t,i,n):pm(o,e.prev,t,i,n,!1,a-1),s&&(e.progress+=t/e.def.duration),e.progress=Math.min(1,e.progress);let h=e.progress;if(e.def.easing&&(h=YM(e.def.easing,h)),h===1)l=Object.assign(Object.assign({},c),{morphs:o.morphs,time:l.time});else if(a>0){const d=l.time;l=Object.assign({},c),l.morphs=((r=l.morphs)!==null&&r!==void 0?r:[]).concat([{time:d,strength:h}]),o.morphs&&o.morphs.length>0&&(l.morphs=[...o.morphs,{time:l.time,strength:1-l.morphs[0].strength}],l.time=o.time)}else l=Object.assign(Object.assign({},c),{time:h>.5?l.time:c.time})}else e.def.duration||console.warn("[@lottielab/lottie-player:interactive] Transition duration of 0/unset is not expected here");return l}class ZM{constructor(e){this.builtinVariables=Object.assign({},$M),this.userVariables={},this.variables={},this.clock=0,this.transitionStartEvent=new ga,this.transitionEndEvent=new ga,this._definition=e;const t=e.states[e.initialState];if(!t)throw new Error(`Initial state ${e.initialState} does not exist`);this.enterState(t)}setupMorphingForCurrentState(e){e!=null&&e.force&&(this.state.morphing=void 0);const t=this.state.def;if(t.morphing&&!this.state.morphing){const i=this._definition.states[t.morphing.otherState];i?this.state.morphing={other:{type:"state",def:i,playback:Cf(i)},strength:typeof t.morphing.strength=="number"?t.morphing.strength:Ph(t.morphing.strength,0)}:console.warn(`[@lottielab/lottie-player:interactivity] State '${t.morphing.otherState}' to morph with does not exist`)}else!t.morphing&&this.state.morphing&&(this.state.morphing=void 0)}enterState(e){const t=Cf(e);this.state={type:"state",def:e,playback:t,remainingDuration:e.duration},this.setupMorphingForCurrentState({force:!0})}getCurrentState(){return this.state}goToState(e,t){const i=this.state,n=i.def.segment;this.transition&&this.transitionEndEvent.emit({from:this.transition.from,to:this.state.def,transition:this.transition.def});const s=this.state.playback.driver.time;this.enterState(e),t=t??{startAt:"start"},this.transitionStartEvent.emit({from:i.def,to:e,transition:t});const a=e.segment;switch(t==null?void 0:t.startAt){case"start":case void 0:this.state.playback.driver.time=a[0];break;case"end":this.state.playback.driver.time=a[1];break;case"proportional":this.state.playback.driver.time=um(s,n,a);break;case"wrap":this.state.playback.driver.time=dm(s,n,a);break;case"clamp":this.state.playback.driver.time=fm(s,n,a);break;default:console.warn(`[@lottielab/lottie-player:interactive] Unknown startAt value in ttransition: ${t.startAt}`)}if(t.duration){const r=this.transition?Object.assign(Object.assign({},this.transition),{next:i}):i;this.transition={type:"transition",prev:r,progress:0,def:t,from:i.def}}else this.transition=void 0,this.transitionEndEvent.emit({from:i.def,to:e,transition:t})}get definition(){return this._definition}set definition(e){var t;const i=(t=Object.entries(this._definition.states).find(([n,s])=>s===this.state.def))===null||t===void 0?void 0:t[0];if(this._definition=e,i&&this._definition.states[i])this.enterState(e.states[i]);else{if(!e.states[e.initialState])throw this.enterState({segment:[0,0],loop:!1,speed:1,direction:"forward"}),new Error(`Initial state ${e.initialState} does not exist`);const n=this.state.playback.driver.time;this.enterState(e.states[e.initialState]),this.state.playback.driver.time=n,this.transition=void 0}}updateVariables(e){this.builtinVariables=Object.assign(Object.assign({},this.builtinVariables),e),this.variables=Ef(this.builtinVariables,this.userVariables)}setUserVariables(e){this.userVariables=e,this.variables=Ef(this.builtinVariables,this.userVariables)}handle(e){var t;const i=(t=this.state.def.on)===null||t===void 0?void 0:t[jM(e)];if(!i)return;const n=this._definition.states[i.goTo];n?this.goToState(n,i):console.warn(`[@lottielab/lottie-player:interactive] State ${i.goTo} does not exist`)}getEffectiveState(e){return e.type==="state"||e.progress<1?e:e.next?e.next:this.state}applyTransition(e,t,i){let n=e;return this.transition&&(n=pm(e,this.transition,t,i,this.variables),this.transition.progress>=1?(this.transitionEndEvent.emit({from:this.transition.from,to:this.state.def,transition:this.transition.def}),this.transition=void 0):this.transition.prev=this.getEffectiveState(this.transition.prev)),n}advance(e,t){let i=Object.assign({},e);const n=this.clock+=t;this.setupMorphingForCurrentState();const s=[];if(this.state.remainingDuration===void 0)i=Zl(this.state,Object.assign(Object.assign({},e),{morphs:void 0}),t,n,this.variables,s);else{const a=this.state.remainingDuration;if(a>0){const r=Math.min(a,t);this.state.remainingDuration-=r,i=Zl(this.state,Object.assign(Object.assign({},e),{morphs:void 0}),r,n,this.variables,s),this.state.remainingDuration<=0&&(this.state.remainingDuration=0,this.handle({event:"finish"}))}}for(const a of s)a.type==="finish"&&this.handle({event:"finish"});return i=this.applyTransition(i,t,n),i}get currentTime(){return this.state.playback.playheadControl?this.state.playback.playheadControl(this.variables):this.state.playback.driver.currentTime}get currentFrame(){return this.currentTime/this.state.playback.driver.frameRate}}const xl="ll-enclosing-rect";function Pf(o,e,t){return Math.min(Math.max(o,e),t)}class kf{attachContinuousListeners(e){const t=s=>{var a;const r=e.getBoundingClientRect();(a=this.handler)===null||a===void 0||a.updateVariables({"mouse.x":s.clientX-r.left,"mouse.y":s.clientY-r.top,"mouse.abs.x":s.clientX,"mouse.abs.y":s.clientY,"mouse.progress.x":Pf((s.clientX-r.left)/r.width,0,1),"mouse.progress.y":Pf((s.clientY-r.top)/r.height,0,1)})};window.addEventListener("mousemove",t),this.disposers.push(()=>window.removeEventListener("mousemove",t));const i=s=>{var a;(a=this.handler)===null||a===void 0||a.updateVariables({"mouse.buttons.left":(1&s.buttons)!=0,"mouse.buttons.right":(2&s.buttons)!=0,"mouse.buttons.middle":(4&s.buttons)!=0})};window.addEventListener("mousedown",i),this.disposers.push(()=>window.removeEventListener("mousedown",i));const n=()=>{var s;(s=this.handler)===null||s===void 0||s.updateVariables({"mouse.buttons.left":!1,"mouse.buttons.right":!1,"mouse.buttons.middle":!1})};window.addEventListener("mouseup",n),this.disposers.push(()=>window.removeEventListener("mouseup",n))}attachListener(e,t,i){let n;switch(i){case"click":n="click";break;case"mouseEnter":n="mouseenter";break;case"mouseLeave":n="mouseleave";break;case"mouseDown":n="mousedown";break;case"mouseUp":n="mouseup";break;default:throw new Error("InteractiveEventDispatcher: not a DOM event: "+i)}const s=a=>{var r,l;t===xl?(r=this.handler)===null||r===void 0||r.handle({event:i}):(l=this.handler)===null||l===void 0||l.handle({event:i,target:t??void 0})};e.addEventListener(n,s),this.disposers.push(()=>{e.removeEventListener(n,s)})}constructor(e,t=[]){var i,n;this.container=e,this.disposers=[],this.currentClickableClassNames=[];const s=e.querySelector("svg"),a=(n=(i=s==null?void 0:s.getAttribute("viewBox"))===null||i===void 0?void 0:i.split(" ").map(h=>parseFloat(h)))!==null&&n!==void 0?n:[1200,900],r=s==null?void 0:s.querySelector("svg > g"),l=document.createElementNS("http://www.w3.org/2000/svg","rect");[["x","0"],["y","0"],["width",a[2].toString()],["height",a[3].toString()],["fill","transparent"],["pointer-events","bounding-box"],["class",xl]].forEach(([h,d])=>{l.setAttribute(h,d)}),r==null||r.insertBefore(l,r.firstChild),this.disposers.push(()=>l.remove());const c=new Set;for(const h of[xl].concat(t)){c.has(h)&&console.warn(`[@lottielab/lottie-player:interactive] Duplicate class name ${h} in reactivity event dispatcher`),c.add(h);const d=h===xl?r:this.container.querySelector(`.${h}`);if(d)for(const f of["click","mouseDown","mouseUp","mouseEnter","mouseLeave"])this.attachListener(d,h,f);else console.warn(`[@lottielab/lottie-player:interactive] Could not find element with class name ${h}`)}this.attachContinuousListeners(l)}setClickableClassNames(e){const t=(i,n)=>{const s=i==="full"?this.container:this.container.querySelector(`.${i}`);s&&(s.style.cursor=n)};this.currentClickableClassNames.forEach(i=>t(i,"initial")),this.currentClickableClassNames=e,e.forEach(i=>t(i,"pointer"))}destroy(){this.setClickableClassNames([]),this.disposers.forEach(e=>e())}}var If;(function(o){o.Linear={i:{x:.75,y:.75},o:{x:.25,y:.25}},o.Natural={o:{x:.4,y:0},i:{x:.8,y:1}},o.BounceIn={o:{x:.8,y:0},i:{x:.5,y:1.5}},o.BounceOut={o:{x:.5,y:-.5},i:{x:.2,y:1}},o.Accelerate={o:{x:.42,y:0},i:{x:1,y:1}},o.SlowDown={o:{x:0,y:0},i:{x:.58,y:1}}})(If||(If={}));class KM{constructor(e){this.onUpdate=e,this.variables={}}set(e,t){this.variables[e]=t,this.onUpdate(this.variables)}get(e){return this.variables[e]}delete(e){delete this.variables[e],this.onUpdate(this.variables)}clear(){this.variables={},this.onUpdate(this.variables)}}class QM{constructor(e,t){this._transitionStartEvent=new ga,this._transitionEndEvent=new ga,this._userProvidedDefinition={set:!1},this._rootElement=e,this._lottie=t;const i=this.effectiveDefinition();this._driver=new ZM(i),this._dispatcher=new kf(this._rootElement,this.getObservedClassNames(i)),this._dispatcher.setClickableClassNames(this.getClickableClassNames()),this._dispatcher.handler=this._driver,this._driver.transitionStartEvent.addListener(n=>{this._transitionStartEvent.emit(this.translateTransitionEvent(n)),this._dispatcher.setClickableClassNames(this.getClickableClassNames())}),this._driver.transitionEndEvent.addListener(n=>this._transitionEndEvent.emit(this.translateTransitionEvent(n))),this.inputs=new KM(n=>this._driver.setUserVariables(n))}get definition(){var e,t;return this._userProvidedDefinition.set?this._userProvidedDefinition.value:(t=(e=this._lottie)===null||e===void 0?void 0:e.metadata)===null||t===void 0?void 0:t.lottielabInteractivity}set definition(e){this._userProvidedDefinition={set:!0,value:e},this.updateReactivity()}get state(){const e=this._driver.getCurrentState().def,t=this.lookupStateName(e);return Object.assign(Object.assign({},e),{name:t??"<custom>"})}set state(e){this._driver.goToState(this.findState(e))}goToState(e,t){this._driver.goToState(this.findState(e),t)}hasUserProvidedDefinition(){return this._userProvidedDefinition.set}resetDefinition(){this._userProvidedDefinition={set:!1},this.updateReactivity()}on(e,t){switch(e){case"transitionstart":this._transitionStartEvent.addListener(t);break;case"transitionend":this._transitionEndEvent.addListener(t)}}off(e,t){switch(e){case"transitionstart":this._transitionStartEvent.removeListener(t);break;case"transitionend":this._transitionEndEvent.removeListener(t)}}trigger(e){this._driver.handle({event:"custom",name:e})}_destroy(){var e;(e=this._dispatcher)===null||e===void 0||e.destroy()}_getDriver(){return this._driver}translateTransitionEvent(e){var t,i;return{from:Object.assign(Object.assign({},e.from),{name:(t=this.lookupStateName(e.from))!==null&&t!==void 0?t:"<custom>"}),to:Object.assign(Object.assign({},e.to),{name:(i=this.lookupStateName(e.to))!==null&&i!==void 0?i:"<custom>"}),transition:e.transition}}effectiveDefinition(){var e;const t=this._lottie?this._lottie.op/this._lottie.fr:0;return(e=this.definition)!==null&&e!==void 0?e:{__version:"v1",initialState:"default",states:{default:{segment:[0,t]}}}}lookupStateName(e){var t;return(t=Object.entries(this.effectiveDefinition().states).find(([i,n])=>n===e))===null||t===void 0?void 0:t[0]}findState(e){let t;if(t=typeof e=="string"?this.effectiveDefinition().states[e]:e,!e)throw new Error(`State ${e} not found`);return t}getObservedClassNames(e){return e?[...new Set(Object.values(e.states).flatMap(t=>{var i;return Object.keys((i=t.on)!==null&&i!==void 0?i:{})}).flatMap(t=>{const[i,n]=t.split(":");return i!=="custom"&&n?[n]:[]}))]:[]}getClickableClassNames(){var e;return[...new Set(Object.keys((e=this.state.on)!==null&&e!==void 0?e:{}).flatMap(t=>{const[i,n]=t.split(":");return["click","mouseDown","mouseUp"].includes(i)?n?[n]:["full"]:[]}))]}updateReactivity(){var e;const t=this.effectiveDefinition();this._driver.definition=t,(e=this._dispatcher)===null||e===void 0||e.destroy(),this._dispatcher=new kf(this._rootElement,this.getObservedClassNames(t)),this._dispatcher.handler=this._driver}}class JM{constructor(e,t,i,n){this.timeEvent=new ga,this.timeEventListener=a=>{this._impl.type==="playback"?this.timeEvent.emit(a):this.timeEvent.emit(Object.assign(Object.assign({},a),{playhead:this.currentTime}))},this.root=e,this._renderer=new WM(e,t,void 0,n);const s=new Ch;i?s.play():s.pause(),this._impl={type:"playback",driver:s},this._renderer.driver=s,this.initialize(t,i,n)}initialize(e,t,i){return this._renderer.timeEvent.removeListener(this.timeEventListener),this._renderer.initialize(e,i).then(()=>{var n,s,a;if(this._renderer.timeEvent.addListener(this.timeEventListener),((n=this.interactivity)===null||n===void 0?void 0:n.hasUserProvidedDefinition())||function(r){var l,c;return!!(!((l=r==null?void 0:r.metadata)===null||l===void 0)&&l.lottielabInteractivity)&&((c=r==null?void 0:r.metadata)===null||c===void 0?void 0:c.lottielabInteractivity.__version)==="v1"}(this._renderer.animationData)){const r=(s=this.interactivity)===null||s===void 0?void 0:s.hasUserProvidedDefinition(),l=(a=this.interactivity)===null||a===void 0?void 0:a.definition;this.destroyImpl(),this.createInteractiveImpl(),r&&(this.interactivity.definition=l)}else this.interactivity&&this.toPlayback();t?this.play():this.pause()})}destroyImpl(){this._impl.type==="interactive"&&this._impl.interactivity._destroy()}createPlaybackImpl(){this._impl={type:"playback",driver:new Ch},this._renderer.driver=this._impl.driver,this._updateTimeMultiplier()}createInteractiveImpl(){this._impl={type:"interactive",interactivity:new QM(this.root,this._renderer.animationData),playback:{direction:1,speed:1,playing:!0}},this._renderer.driver=this._impl.interactivity._getDriver(),this._updateTimeMultiplier()}toInteractive(){this._impl.type!=="interactive"&&(this.destroyImpl(),this.createInteractiveImpl())}toPlayback(){this._impl.type!=="playback"&&(this.destroyImpl(),this.createPlaybackImpl())}destroy(){this.destroyImpl(),this._renderer.timeEvent.removeListener(this.timeEventListener),this._renderer.destroy(),this.root.innerHTML=""}get interactivity(){return this._impl.type==="interactive"?this._impl.interactivity:void 0}_updateTimeMultiplier(){this._impl.type==="playback"?this._renderer.timeMultiplier=1:this._impl.playback.playing?this._renderer.timeMultiplier=this._impl.playback.speed*this._impl.playback.direction:this._renderer.timeMultiplier=0}play(){this._impl.type==="playback"?this._impl.driver.play():(this._impl.playback.playing=!0,this._updateTimeMultiplier())}stop(){this._impl.type==="playback"?this._impl.driver.stop():this.pause()}pause(){this._impl.type==="playback"?this._impl.driver.pause():(this._impl.playback.playing=!1,this._updateTimeMultiplier())}seek(e){this._impl.type==="playback"?(this._impl.driver.seek(e),this._renderer.advanceToNow()):console.warn("[@lottielab/lottie-player] Cannot seek an interactive Lottie")}seekToFrame(e){this._impl.type==="playback"?(this._impl.driver.seekToFrame(e),this._renderer.advanceToNow()):console.warn("[@lottielab/lottie-player] Cannot seek an interactive Lottie")}loopBetween(e,t){this._impl.type==="playback"?this._impl.driver.loopBetween(e,t):console.warn("[@lottielab/lottie-player] Cannot loop an interactive Lottie")}loopBetweenFrames(e,t){this._impl.type==="playback"?this._impl.driver.loopBetweenFrames(e,t):console.warn("[@lottielab/lottie-player] Cannot loop an interactive Lottie")}on(e,t){switch(e){case"loop":if(this._impl.type==="interactive")throw new Error("Cannot listen to 'loop' event on an interactive Lottie");this._impl.driver.loopEvent.addListener(t);break;case"finish":if(this._impl.type==="interactive")throw new Error("Cannot listen to 'finish' event on an interactive Lottie");this._impl.driver.finishEvent.addListener(t);case"time":this.timeEvent.addListener(t)}}off(e,t){switch(e){case"time":this.timeEvent.removeListener(t);break;case"loop":if(this._impl.type==="interactive")return;this._impl.driver.loopEvent.removeListener(t);break;case"finish":if(this._impl.type==="interactive")return;this._impl.driver.finishEvent.removeListener(t)}}get playing(){return this._impl.type==="playback"?this._impl.driver.playing:this._impl.playback.playing}set playing(e){this._impl.type==="playback"?this._impl.driver.playing=e:(this._impl.playback.playing=e,this._updateTimeMultiplier())}get loop(){return this._impl.type==="playback"&&this._impl.driver.loop}set loop(e){this._impl.type==="playback"?this._impl.driver.loop=e:console.warn("[@lottielab/lottie-player] Cannot set loop on an interactive Lottie")}get currentTime(){switch(this._impl.type){case"playback":return this._impl.driver.currentTime;case"interactive":return this._impl.interactivity._getDriver().currentTime}}set currentTime(e){this.seek(e)}get currentFrame(){switch(this._impl.type){case"playback":return this._impl.driver.currentFrame;case"interactive":return this._impl.interactivity._getDriver().currentFrame}}set currentFrame(e){this.seekToFrame(e)}get frameRate(){return this._renderer.frameRate}get duration(){return this._renderer.duration}get durationFrames(){return this._renderer.durationInFrames}get direction(){return this._impl.type==="playback"?this._impl.driver.direction:this._impl.playback.direction}set direction(e){this._impl.type==="playback"?this._impl.driver.direction=e:(this._impl.playback.direction=e,this._updateTimeMultiplier())}get speed(){return this._impl.type==="playback"?this._impl.driver.speed:this._impl.playback.speed}set speed(e){this._impl.type==="playback"?this._impl.driver.speed=e:(this._impl.playback.speed=e,this._updateTimeMultiplier())}get animation(){return this._renderer.animation}get animationData(){return this._renderer.animationData}}function ca(o){console.warn("[@lottielab/lottie-player/web]",typeof o=="string"?new Error(o):o)}class kh extends HTMLElement{static get observedAttributes(){return["src","loop","speed","direction","preserveAspectRatio"]}constructor(){super(),this.loadEvent=new CustomEvent("load",{bubbles:!0,cancelable:!1}),this.attachShadow({mode:"open"});const e=document.createElement("style"),t=document.createElement("div");t.style.width="100%",t.style.height="100%",this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(t),this.lottie=new JM(t),this.updateStyles()}updateStyles(){const[e,t]=this.intrinsicSize;this.shadowRoot.querySelector("style").textContent=`
      :host { display: inline-block; width: ${e}px; height: ${t}px; }
    `}get intrinsicSize(){return this.lottie.animationData?[this.lottie.animationData.w,this.lottie.animationData.h]:[300,225]}attributeChangedCallback(e,t,i){var n;if(t!==i)switch(e){case"src":try{this.lottie.initialize(i,this.getAttribute("autoplay")!=="false",(n=this.getAttribute("preserveAspectRatio"))!==null&&n!==void 0?n:void 0).then(()=>this.dispatchEvent(this.loadEvent)).catch(a=>{ca(a),this.dispatchEvent(new CustomEvent("error",{bubbles:!0,cancelable:!1,detail:a}))}).finally(()=>this.updateStyles())}catch(a){ca(a),this.dispatchEvent(new CustomEvent("error",{bubbles:!0,cancelable:!1,detail:a}))}break;case"loop":this.lottie.loop=this.convertLoopAttribute(i);break;case"direction":this.lottie.direction=this.convertDirectionAttribute(i);break;case"speed":const s=parseFloat(i);isNaN(s)?(ca(`Invalid speed value: ${i}`),this.lottie.speed=1):this.lottie.speed=parseFloat(i)}}convertLoopAttribute(e){switch(e){case"true":case"":return!0;case"false":return!1;default:const t=+e;return isNaN(t)?(ca(`Invalid loop value: ${e}`),!0):t<0?(ca(`Invalid loop value (negative): ${e}`),!0):(Math.floor(t)!==t&&ca(`Non-integer loop values are not supported: ${e}`),Math.round(t))}}convertDirectionAttribute(e){if(["normal","forwards"].includes(e))return 1;if(["reverse","backwards"].includes(e))return-1;const t=+e;return isNaN(t)?(ca(`Invalid direction value: ${e}`),1):t===1||t===-1?t:(ca(`Invalid direction value: ${e}`),1)}disconnectedCallback(){this.lottie.destroy()}play(){this.lottie.play()}stop(){this.lottie.stop()}pause(){this.lottie.pause()}seek(e){this.lottie.seek(e)}seekToFrame(e){this.lottie.seekToFrame(e)}loopBetween(e,t){this.lottie.loopBetween(1e3*e,1e3*t)}loopBetweenFrames(e,t){this.lottie.loopBetweenFrames(e,t)}toInteractive(){this.lottie.toInteractive()}toPlayback(){this.lottie.toPlayback()}on(e,t){switch(e){case"time":case"loop":case"finish":this.lottie.on(e,t)}}off(e,t){this.lottie.off(e,t)}get playing(){return this.lottie.playing}set playing(e){this.lottie.playing=e}get loop(){return this.lottie.loop}set loop(e){this.lottie.loop=e}get currentTime(){return this.lottie.currentTime}set currentTime(e){this.lottie.currentTime=e}get currentFrame(){return this.lottie.currentFrame}set currentFrame(e){this.lottie.currentFrame=e}get frameRate(){return this.lottie.frameRate}get duration(){return this.lottie.duration}get durationFrames(){return this.lottie.durationFrames}get direction(){return this.lottie.direction}set direction(e){this.lottie.direction=e}get speed(){return this.lottie.speed}set speed(e){this.lottie.speed=e}get animation(){return this.lottie.animation}get animationData(){return this.lottie.animationData}get interactivity(){return this.lottie.interactivity}}typeof window>"u"||window.customElements.get("lottie-player")||window.customElements.define("lottie-player",kh);var _o=(o=>(o.INACTIVE="inactive",o.ACTIVE="active",o.COMPLETE="complete",o))(_o||{});class mm{constructor(e){g(this,"elementId");g(this,"size");g(this,"strokeWidth");g(this,"colour");g(this,"animationDuration");g(this,"completionIcon");g(this,"iconSize");g(this,"state","active");g(this,"currentProgress",0);g(this,"targetProgress",0);g(this,"animationStartTime",null);g(this,"animationStartProgress",0);g(this,"totalBytes",0);g(this,"currentLabel","");g(this,"iconElement",null);g(this,"animationFrameId",null);g(this,"initialiseLoader",()=>{const e=document.getElementById(this.elementId);if(!e)return;const t=(this.size-this.strokeWidth)/2,i=2*Math.PI*t,n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("class","radial-loader"),n.setAttribute("width",`${this.size}`),n.setAttribute("height",`${this.size}`),n.setAttribute("viewBox",`0 0 ${this.size} ${this.size}`);const s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttribute("class","loader-background"),s.setAttribute("cx",`${this.size/2}`),s.setAttribute("cy",`${this.size/2}`),s.setAttribute("r",`${t}`),s.setAttribute("stroke",this.colour),s.setAttribute("stroke-opacity","0.3"),s.setAttribute("fill","none"),s.setAttribute("stroke-width",`${this.strokeWidth}`);const a=document.createElementNS("http://www.w3.org/2000/svg","circle");if(a.setAttribute("class","loader-progress"),a.setAttribute("cx",`${this.size/2}`),a.setAttribute("cy",`${this.size/2}`),a.setAttribute("r",`${t}`),a.setAttribute("stroke",this.colour),a.setAttribute("stroke-dasharray",`${i}`),a.setAttribute("stroke-dashoffset",`${i}`),a.setAttribute("fill","none"),a.setAttribute("stroke-width",`${this.strokeWidth}`),a.setAttribute("transform",`rotate(-90 ${this.size/2} ${this.size/2})`),this.completionIcon){const c=new DOMParser().parseFromString(this.completionIcon,"image/svg+xml").documentElement,h=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttribute("class","completion-icon"),h.setAttribute("opacity","0"),h.setAttribute("transform","translate(0,0)");const d=c.getAttribute("viewBox")||"0 0 45 45";c.setAttribute("width",`${this.size}`),c.setAttribute("height",`${this.size}`),c.setAttribute("viewBox",d),c.setAttribute("x","0"),c.setAttribute("y","0"),c.setAttribute("fill",this.colour),c.setAttribute("preserveAspectRatio","xMidYMid meet"),h.appendChild(c),this.iconElement=h,n.insertBefore(h,a),n.classList.add("has-completion-icon")}n.appendChild(s),n.appendChild(a),e.appendChild(n),this.updateLoaderDisplay()});g(this,"updateProgress",e=>{if(this.state==="active"){if(this.targetProgress=Math.min(Math.max(e,0),100),this.targetProgress>=100){this.complete();return}this.animationFrameId===null&&(this.animationStartTime=performance.now(),this.animationStartProgress=this.currentProgress,this.animate())}});g(this,"updateFromLoadGroupProgress",e=>{this.updateProgress(e.percentage),e.totalBytes&&e.totalBytes>0&&(this.totalBytes=e.totalBytes),e.currentItem&&this.updateLabel(`Loading ${e.currentItem}...`)});g(this,"animate",()=>{if(!this.animationStartTime)return;const t=performance.now()-this.animationStartTime,i=Math.min(t/this.animationDuration,1),n=kt.easeInOutCubic(i);this.currentProgress=this.animationStartProgress+(this.targetProgress-this.animationStartProgress)*n,this.updateLoaderDisplay(),i<1?this.animationFrameId=requestAnimationFrame(this.animate):(this.animationFrameId=null,this.animationStartTime=null)});g(this,"updateLoaderDisplay",()=>{const e=document.getElementById(this.elementId);if(!e)return;const t=(this.size-this.strokeWidth)/2,n=2*Math.PI*t*(1-this.currentProgress/100),s=e.querySelector(".radial-loader");s instanceof SVGElement&&(s.classList.remove("loader-state-inactive","loader-state-active","loader-state-complete"),s.classList.add(`loader-state-${this.state.toLowerCase()}`));const a=e.querySelector(".loader-progress");a instanceof SVGElement&&(a.style.strokeDashoffset=n.toString()),this.iconElement&&(this.state==="complete"?(this.iconElement.style.opacity="1",this.iconElement.style.transition="opacity 0.3s ease-in-out"):this.iconElement.style.opacity="0")});g(this,"updateLabel",e=>{this.currentLabel=e});g(this,"getCurrentProgress",()=>this.currentProgress);g(this,"getLabel",()=>this.currentLabel);g(this,"cleanup",()=>{this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId),this.state="inactive",this.iconElement=null;const e=document.getElementById(this.elementId);e&&(e.innerHTML="")});g(this,"complete",()=>{this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null,this.animationStartTime=null),this.currentProgress=100,this.targetProgress=100,this.state="complete",this.updateLoaderDisplay()});this.elementId=e.elementId,this.size=e.size||45,this.strokeWidth=e.strokeWidth||4,this.colour=e.colour||"#ffffff",this.animationDuration=e.animationDuration||300,this.state=e.initialState||"inactive",this.completionIcon=e.completionIcon||null,this.iconSize=e.iconSize||Math.floor(this.size*.5),e.label&&(this.currentLabel=e.label),this.initialiseLoader()}setState(e){const t=this.state,i=typeof e=="string"?_o[e.toUpperCase()]:e;switch(this.state=i,i){case"complete":this.complete();break;case"inactive":this.updateProgress(0);break;case"active":t==="inactive"&&this.updateProgress(0);break}this.updateLoaderDisplay()}setCompletionIcon(e){if(!e)return;const t=document.getElementById(this.elementId);if(!t)return;const i=t.querySelector(".radial-loader");if(!(i instanceof SVGElement))return;const n=i.querySelector(".loader-progress");if(!n)return;const s=i.querySelector(".completion-icon");s&&i.removeChild(s);const l=new DOMParser().parseFromString(e,"image/svg+xml").documentElement,c=document.createElementNS("http://www.w3.org/2000/svg","g");c.setAttribute("class","completion-icon"),c.setAttribute("opacity","0"),c.setAttribute("transform","translate(0,0)");const h=l.getAttribute("viewBox")||"0 0 36 36";l.setAttribute("width",`${this.size}`),l.setAttribute("height",`${this.size}`),l.setAttribute("viewBox",h),l.setAttribute("x","0"),l.setAttribute("y","0"),l.setAttribute("preserveAspectRatio","xMidYMid meet"),c.appendChild(l),this.iconElement=c,i.insertBefore(c,n),i.classList.add("has-completion-icon"),this.state==="complete"&&(this.iconElement.style.opacity="1")}getState(){return this.state}setAnimationDuration(e){this.animationDuration=e}}class ex{constructor(e){g(this,"containerId");g(this,"contextLabelId");g(this,"defaultLoaderSize");g(this,"defaultAnimationDuration");g(this,"autoUpdateContextLabel");g(this,"defaultState");g(this,"loaders",new Map);g(this,"progressData",new Map);g(this,"container",null);g(this,"loadersContainer",null);g(this,"statusElement",null);g(this,"initialiseDOM",()=>{if(this.container=document.getElementById(this.containerId),!this.container){console.warn(`Container #${this.containerId} not found`);return}this.setupContainerStyles(),this.createLoadersContainer(),this.setupStatusElement()});g(this,"setupContainerStyles",()=>{this.container&&(this.container.style.display="flex",this.container.style.flexDirection="column",this.container.style.alignItems="center",this.container.style.gap="1rem")});g(this,"createLoadersContainer",()=>{this.container&&(this.loadersContainer=document.createElement("div"),this.loadersContainer.className="radial-loaders",this.loadersContainer.style.display="flex",this.loadersContainer.style.gap="34px",this.loadersContainer.style.justifyContent="flex-start",this.loadersContainer.style.width="0px",this.loadersContainer.style.overflow="hidden",this.container.appendChild(this.loadersContainer))});g(this,"setupStatusElement",()=>{if(!this.showStatus||!this.container)return;const e=document.getElementById(this.contextLabelId);if(e){this.statusElement=e;return}this.statusElement=document.createElement("div"),this.statusElement.id=this.contextLabelId,this.statusElement.className="loader-status",this.statusElement.style.fontSize="0.875rem",this.statusElement.style.color="white",this.statusElement.style.textAlign="center",this.container.appendChild(this.statusElement)});g(this,"addLoader",e=>{if(!this.loadersContainer){console.warn("Cannot add loader - container not initialised");return}const t=document.createElement("div");t.className="radial-loader-container",t.id=`${this.containerId}-${e.id}`,t.style.flexShrink="0",t.style.flexGrow="0",t.style.width="45px",t.style.height="45px",this.loadersContainer.appendChild(t);const i=new mm({elementId:t.id,size:this.defaultLoaderSize,animationDuration:this.defaultAnimationDuration,initialState:e.state||this.defaultState,...e.options});this.loaders.set(e.id,i),e.initialProgress&&(this.progressData.set(e.id,e.initialProgress),i.updateFromLoadGroupProgress(e.initialProgress)),this.animateContainerWidth()});g(this,"updateLoaderProgress",(e,t)=>{const i=this.loaders.get(e);i&&(this.progressData.set(e,t),i.updateFromLoadGroupProgress(t),this.autoUpdateContextLabel&&t.currentItem&&this.setContextLabel(`Loading ${t.currentItem}...`))});g(this,"completeLoader",e=>{const t=this.loaders.get(e);if(!t)return;const i=this.progressData.get(e)||{loaded:0,total:1,percentage:0},n={...i,loaded:i.total>0?i.total:1,percentage:100};this.progressData.set(e,n),t.complete()});g(this,"setContextLabel",e=>{this.statusElement&&(this.statusElement.textContent=e)});g(this,"getLoaderProgress",e=>this.progressData.get(e));g(this,"getTotalProgress",()=>{let e=0,t=0,i=0,n=0;return this.progressData.forEach(s=>{s.bytesLoaded&&(t+=s.totalBytes||0),s.bytesLoaded&&(e+=s.bytesLoaded),s.total&&(i+=s.total,n+=s.loaded)}),{loaded:n,total:i,percentage:i>0?n/i*100:0,bytesLoaded:e,totalBytes:t}});g(this,"setLoaderLabel",(e,t)=>{const i=this.loaders.get(e);i&&i.updateLabel(t)});g(this,"cleanup",()=>{this.loaders.forEach(e=>e.cleanup()),this.loaders.clear(),this.progressData.clear(),this.container&&(this.container.innerHTML="",this.loadersContainer=null,this.statusElement=null)});g(this,"connectLoadGroup",(e,t)=>{if(!(t!=null&&t.getProgress)||typeof t.getProgress!="function"){console.warn("Invalid LoadGroup provided to connectLoadGroup");return}const i=t.getProgress();this.updateLoaderProgress(e,{loaded:i.loaded,total:i.total,percentage:i.percentage,currentItem:i.currentAsset,bytesLoaded:i.bytesLoaded,totalBytes:i.totalBytes,currentSpeed:i.currentSpeed,averageSpeed:i.averageSpeed,estimatedTimeRemaining:i.estimatedTimeRemaining})});this.containerId=e.containerId,this.contextLabelId=e.contextLabelId,this.defaultLoaderSize=e.loaderSize||45,this.defaultAnimationDuration=e.animationDuration||300,this.autoUpdateContextLabel=e.autoUpdateContextLabel??!0,this.defaultState=e.defaultState||_o.ACTIVE,this.initialiseDOM()}get showStatus(){return!!this.contextLabelId}setLoaderState(e,t){const i=this.loaders.get(e);i&&i.setState(t)}getLoaderState(e){const t=this.loaders.get(e);return t==null?void 0:t.getState()}hasLoadersInState(e){return Array.from(this.loaders.values()).some(t=>t.getState()===(typeof e=="string"?_o[e.toUpperCase()]:e))}getLoadersInState(e){return Array.from(this.loaders.entries()).filter(([t,i])=>i.getState()===(typeof e=="string"?_o[e.toUpperCase()]:e)).map(([t])=>t)}async setLoaderIconByIndex(e,t,i){const n=Array.from(this.loaders.keys());if(e<0||e>=n.length)return console.warn(`Invalid loader index: ${e}`),!1;const s=n[e];return this.setLoaderIcon(s,t,i)}async setLoaderIcon(e,t,i){const n=this.loaders.get(e);if(!n)return console.warn(`Loader not found with ID: ${e}`),!1;try{const s=await fetch(t);if(!s.ok)throw new Error(`Failed to fetch SVG: ${s.statusText}`);const a=await s.text();return n.setCompletionIcon(a,i),!0}catch(s){return console.error(`Error setting loader icon: ${s}`),!1}}getLoaderByIndex(e){const t=Array.from(this.loaders.keys());if(e<0||e>=t.length)return null;const i=t[e];return this.loaders.get(i)||null}getLoaderCount(){return this.loaders.size}calculateContainerWidth(){const e=this.loaders.size;return`${this.defaultLoaderSize*e+34*(e-1)}px`}animateContainerWidth(){if(!this.loadersContainer)return;const e=this.loadersContainer.offsetWidth,t=parseInt(this.calculateContainerWidth());this.loadersContainer.style.width||(this.loadersContainer.style.width=`${e}px`),this.loadersContainer.style.transition||(this.loadersContainer.style.transition="width 0.3s ease-in-out"),requestAnimationFrame(()=>{this.loadersContainer.style.width=`${t}px`})}}class tx{constructor(e){g(this,"settingsManager");g(this,"feedbackManager");g(this,"app");g(this,"preferenceManager");g(this,"prefetchedModalContent",{});g(this,"modalContentFiles",["disclaimer","feedback","settings","about","item-template"]);g(this,"modalBindingsApplied",new Set);g(this,"isModalOpen",!1);g(this,"currentFocusableElements",[]);g(this,"lottieSplashPlayer",new kh);g(this,"lottieOnboardingPlayer",new kh);g(this,"loaderOnboardingGroup",null);g(this,"cameraModeRadial",null);g(this,"cameraModeTimeout",null);g(this,"screenReaderAnnouncementTimeout",null);g(this,"currentActiveElement",null);g(this,"previousActiveElement",null);g(this,"focusElementBeforeModal",null);g(this,"preventOverscrollNavigation",()=>{function e(t){t.preventDefault();const i=document.getElementById("modal-content");i&&(i.scrollTop+=t.deltaY)}window.addEventListener("wheel",e,{passive:!1})});g(this,"openModal",async(e,t="default")=>{let i;const n=document.activeElement;n&&(this.focusElementBeforeModal=n),e.startsWith("item-")?i=await this.generateDynamicContent(e.replace("item-","")):i=await this.loadAndUpdateModalContent(e);const s=document.getElementById("modal-wrapper"),a=document.getElementById("modal-content"),r=document.getElementById("modal-overlay-blur"),l=document.getElementById("modal-content-inner-copy");s&&(Array.from(s.classList).filter(h=>h.startsWith("type-")).forEach(h=>s.classList.remove(h)),s.classList.add(`type-${t}`)),r&&r.classList.remove("no-blur"),l&&(l.innerHTML=i,l.setAttribute("data-modal-id",e)),setTimeout(()=>{this.uiAnimEnter("modal-wrapper"),this.uiAnimEnter("modal-content"),this.bindModalActions(e),this.isModalOpen=!0,this.updateFocusableElements("modal"),this.setActiveElement("modal-container"),a&&(a.scrollTop=0),this.app.setControlsActive(!1)},this.app.preferenceManager.getPreference("reduceMotion")?1:250)});g(this,"closeModal",()=>{const e=document.getElementById("modal-overlay-blur"),t=document.getElementById("modal-content-inner-copy");this.playUISound("clack");const i=this.app.actManager.getAct();if(i===3?this.updateFocusableElements("act-three"):i===2?this.updateFocusableElements("act-two"):i===1&&this.updateFocusableElements("splash-screen"),e&&e.classList.add("no-blur"),t){const n=t.getAttribute("data-modal-id");n&&(this.modalBindingsApplied.delete(n),this.unbindModalActions(n),this.settingsManager.cleanup(`settings-content-${n}`),this.feedbackManager.cleanup(`feedback-content-${n}`),this.app.setControlsActive(!0))}this.uiAnimExit("modal-wrapper"),this.uiAnimExit("modal-content"),this.previousActiveElement&&this.setActiveElement(this.previousActiveElement),this.focusElementBeforeModal&&setTimeout(()=>{this.focusElementBeforeModal.focus(),setTimeout(()=>{this.focusElementBeforeModal.blur()},100)},100),setTimeout(()=>{this.isModalOpen=!1},10)});g(this,"prefetchModalContent",async()=>{for(const e of this.modalContentFiles)try{const t=await fetch(Li(`/modal-content/${e}.html`));if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.text();Ye(`Modal content loaded for: ${e}`),this.prefetchedModalContent[e]=i}catch(t){console.error(`Failed to prefetch modal content for ${e}:`,t)}});g(this,"bindModalActions",e=>{const t=document.getElementById("modal-content-inner");if(!t||this.modalBindingsApplied.has(e))return;t.querySelectorAll(".modal-switch").forEach(s=>{var r;s.setAttribute("tabindex","0"),s.setAttribute("role","switch"),s.setAttribute("aria-label",`Toggle ${(r=s==null?void 0:s.dataset)!=null&&r.label?s.dataset.label:"switch"}`);const a=s.classList.contains("active");s.setAttribute("aria-checked",a.toString()),s.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),s.id)})});const n=t.querySelectorAll(".accordion");switch(setTimeout(()=>{n.forEach(s=>{this.updateAccordionFocus(s)})},100),t.addEventListener("pointerup",this.handleAccordionToggle),this.setupAccordionKeyboardControls(),e){case"about":this.bindAboutActions(t);break}this.modalBindingsApplied.add(e)});g(this,"unbindModalActions",e=>{const t=document.getElementById("modal-content-inner");t&&(t.removeEventListener("click",this.handleAccordionToggle),this.modalBindingsApplied.delete(e))});g(this,"handleAccordionToggle",e=>{const t=e.target;t.classList.contains("accordion-header")&&this.toggleAccordion(t)});g(this,"toggleAccordion",e=>{const t=e.closest(".accordion");if(t){const i=t.classList.toggle("collapsed"),n=t.querySelector("[aria-expanded]");n&&n.setAttribute("aria-expanded",(!i).toString());const s=t.querySelector(".accordion-content");s&&s.setAttribute("aria-hidden",i.toString()),i?this.playUISound("clack"):this.playUISound("click"),this.updateAccordionFocus(t)}});g(this,"updateAccordionFocus",e=>{if(!e)return;const t=e.querySelector(".accordion-content");if(!t)return;const i=t.querySelectorAll('button, [href], input, select, .modal-switch, textarea, [tabindex]:not([tabindex="-1"])'),n=e.classList.contains("collapsed");i.forEach(s=>{if(n){const a=s.getAttribute("tabindex")||"0";s.setAttribute("data-original-tabindex",a),s.setAttribute("tabindex","-1")}else{const a=s.getAttribute("data-original-tabindex");s.setAttribute("tabindex",a||"0"),s.removeAttribute("data-original-tabindex")}})});g(this,"initialiseAccordions",()=>{document.querySelectorAll(".accordion").forEach(t=>{this.updateAccordionFocus(t)})});g(this,"uiAnimCleanup",e=>{e.classList.remove("anim-enter","anim-enter-start","anim-exit","anim-exit-start","hidden","visible","initial-hide"),e.removeEventListener("transitionend",this.uiAnimHandleEnterTransistionEnd),e.removeEventListener("transitionend",this.uiAnimHandleExitTransistionEnd)});g(this,"uiAnimHandleEnterTransistionEnd",e=>{let t=e.target;t&&(this.uiAnimCleanup(t),t.classList.add("visible"))});g(this,"uiAnimHandleExitTransistionEnd",e=>{let t=e.target;t&&(this.uiAnimCleanup(t),t.classList.add("hidden"))});g(this,"uiAnimEnter",(e,t)=>{let i=document.getElementById(e);i&&(this.uiAnimCleanup(i),i.classList.add("anim-enter-start"),setTimeout(()=>{i.classList.add("anim-enter");const n=s=>{s.target===i&&(i.removeEventListener("transitionend",n),this.uiAnimHandleEnterTransistionEnd(s),t&&t(i))};i.addEventListener("transitionend",n)},10))});g(this,"uiAnimExit",(e,t)=>{let i=document.getElementById(e);i&&(this.uiAnimCleanup(i),i.classList.add("anim-exit-start"),setTimeout(()=>{i.classList.add("anim-exit");const n=s=>{s.target===i&&(i.removeEventListener("transitionend",n),this.uiAnimHandleExitTransistionEnd(s),t&&t(i))};i.addEventListener("transitionend",n)},10))});g(this,"bindSplashScreenActions",()=>{$t(["aoc-continue","aoc-copy"],()=>{this.hideAoc()},!1),$t(["loading-card__awards"],{start:e=>{e.classList.add("pause")},end:e=>{e.classList.remove("pause")}})});g(this,"makeScreenReaderAnnouncement",(e,t=!1)=>{const i=document.getElementById("sr-announcements");i&&(i.setAttribute("aria-live",t?"assertive":"polite"),i.innerText=e,clearTimeout(this.screenReaderAnnouncementTimeout),this.screenReaderAnnouncementTimeout=setTimeout(()=>{i.innerText=""},5e3))});g(this,"bindOnscreenControls",()=>{$t("move-hotspot-up",{start:()=>{const e=new KeyboardEvent("keydown",{key:"ArrowUp",code:"ArrowUp",keyCode:38,bubbles:!0});document.dispatchEvent(e)},end:()=>{const e=new KeyboardEvent("keyup",{key:"ArrowUp",code:"ArrowUp",keyCode:38,bubbles:!0});document.dispatchEvent(e)}}),$t("move-hotspot-down",{start:()=>{const e=new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown",keyCode:40,bubbles:!0});document.dispatchEvent(e)},end:()=>{const e=new KeyboardEvent("keyup",{key:"ArrowDown",code:"ArrowDown",keyCode:40,bubbles:!0});document.dispatchEvent(e)}}),$t("move-hotspot-left",{start:()=>{const e=new KeyboardEvent("keydown",{key:"ArrowLeft",code:"ArrowLeft",keyCode:37,bubbles:!0});document.dispatchEvent(e)},end:()=>{const e=new KeyboardEvent("keyup",{key:"ArrowLeft",code:"ArrowLeft",keyCode:37,bubbles:!0});document.dispatchEvent(e)}}),$t("move-hotspot-right",{start:()=>{const e=new KeyboardEvent("keydown",{key:"ArrowRight",code:"ArrowRight",keyCode:39,bubbles:!0});document.dispatchEvent(e)},end:()=>{const e=new KeyboardEvent("keyup",{key:"ArrowRight",code:"ArrowRight",keyCode:39,bubbles:!0});document.dispatchEvent(e)}}),$t("zoom-hotspot-in",{start:()=>{const e=new KeyboardEvent("keydown",{key:"ArrowUp",code:"ArrowUp",keyCode:38,bubbles:!0,shiftKey:!0});document.dispatchEvent(e)},end:()=>{const e=new KeyboardEvent("keyup",{key:"ArrowUp",code:"ArrowUp",keyCode:38,bubbles:!0,shiftKey:!0});document.dispatchEvent(e)}}),$t("zoom-hotspot-out",{start:()=>{const e=new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown",keyCode:37,bubbles:!0,shiftKey:!0});document.dispatchEvent(e)},end:()=>{const e=new KeyboardEvent("keyup",{key:"ArrowDown",code:"ArrowDown",keyCode:37,bubbles:!0,shiftKey:!0});document.dispatchEvent(e)}})});g(this,"bindUiActions",()=>{$t("aoc-show",()=>{this.uiAnimExit("loading-card-content"),this.uiAnimExit("loading-card-background"),this.uiAnimEnter("aoc-wrapper"),this.setActiveElement("aoc-wrapper"),document.body.classList.remove("skip-aoc"),this.updateFocusableElements("aoc")}),$t("toggle-footer",()=>{document.body.classList.toggle("footer-visible");const t=document.body.classList.contains("footer-visible"),i=document.getElementById("loading-card-footer"),n=document.getElementById("loading-card-footer-inner");if(!(!i||!n)){if(!t){n.style.maxHeight="0px";return}if(i&&n){n.style.maxHeight="unset";const s=i.clientHeight;n.style.maxHeight="0px",setTimeout(()=>{n.style.maxHeight=`${s}px`},10)}}}),$t(["splash-screen-toggle-sound","intro-sequence-toggle-sound","act-two__ui-toggle-sound","act-three__ui-toggle-sound"],()=>{this.app.toggleMute()}),$t("act-three__ui-toggle-overlay",()=>{document.body.classList.contains("letter-flipping")||this.app.letterOverlayManager.toggleLetterOverlay()}),$t("act-three__ui-flip-page",()=>{document.body.classList.contains("letter-flipping")||this.app.letterOverlayManager.flipPage()}),$t(["intro-sequence-toggle-ad"],()=>{this.app.toggleIntroSequenceTracks()}),$t(["act-two__ui-menu-highlight-action"],()=>{this.app.transitionToAct3()}),$t("loading-card-disclaimer",()=>{this.openModal("disclaimer"),this.app.sessionsManager.addSessionData("openModalDisclaimer",!0)}),$t("loading-card-feedback",()=>{this.openModal("feedback"),this.app.sessionsManager.addSessionData("openModalFeedback",!0)}),$t(["splash-screen-open-settings","act-two__ui-open-settings","act-three__ui-open-settings"],()=>{this.openModal("settings"),this.app.sessionsManager.addSessionData("openModalSettings",!0)}),$t("act-two__ui-open-menu",()=>{this.openModal("about"),this.app.sessionsManager.addSessionData("openModalAbout",!0)}),$t("act-two__sequence-skip",()=>{this.app.skipOnboarding(),this.app.sessionsManager.addSessionData("skipOnboarding",!0)}),$t(["act-two__ui-toggle-ad"],()=>{this.app.toggleActTwoAudioDescriptionPlayback()}),$t(["act-two__next-item"],()=>{this.app.navigateMenu("prev")}),$t(["act-two__prev-item"],()=>{this.app.navigateMenu("next")}),$t("act-three__ui-camera-mode__toggle",t=>{const i=t.closest(".camera-mode"),n=t.classList.contains("cinema");this.setCameraMode(n),this.makeScreenReaderAnnouncement(`Transitioning to ${n?"manual":"cinema"} mode`),this.app.sessionsManager.addSessionData("usedManualMode",!0),i&&i.classList.contains("letter")&&this.app.setLetterCameraMode(!n)}),$t("act-three__ui-open-info",()=>{const t=this.app.currentObject.userData.asset.key;this.openModal(`item-${t}`)}),$t(["act-three__ui-toggle-ad"],()=>{this.app.toggleActThreeAudioDescriptionPlayback()}),$t(["act-three__ui-toggle-captions","intro-sequence-toggle-captions"],()=>{this.toggleShowSubtitles()}),$t("modal-dismiss",()=>{this.closeModal()}),$t("act-three__ui-back",()=>{this.app.transitionToAct2()});const e=()=>{const t=document.getElementById("act-three__ui-camera-mode"),i=document.getElementById("act-three__ui-camera-mode__icon"),n=document.getElementById("act-three__ui-camera-mode__inner"),s=document.getElementById("act-three__ui-camera-mode__toggle");t==null||t.classList.remove("expanded"),this.makeScreenReaderAnnouncement("Camera mode settings hidden"),i&&i.setAttribute("aria-label","Open camera mode settings"),n&&n.setAttribute("aria-hidden","true"),s&&s.setAttribute("tabindex","-1"),R_(s)&&i.focus()};$t("act-three__ui-camera-mode__icon",()=>{const t=document.getElementById("act-three__ui-camera-mode"),i=t==null?void 0:t.classList.contains("expanded"),n=document.getElementById("act-three__ui-camera-mode__icon"),s=document.getElementById("act-three__ui-camera-mode__inner"),a=document.getElementById("act-three__ui-camera-mode__toggle");i?e():(t==null||t.classList.add("expanded"),s&&s.removeAttribute("aria-hidden"),a&&a.setAttribute("tabindex","0"),this.makeScreenReaderAnnouncement("Camera mode settings visible"),n&&n.setAttribute("aria-label","Close camera mode settings"),this.cameraModeTimeout!==null&&(clearTimeout(this.cameraModeTimeout),this.cameraModeTimeout=null),this.cameraModeTimeout=setTimeout(()=>{e()},3e3))}),document.addEventListener("keydown",t=>{if(t.key==="Escape"&&am(()=>{const i=document.getElementById("modal-wrapper");i&&i.classList.contains("visible")&&this.closeModal()}),t.code==="Space"){if(this.isModalOpen)return;if(this.app.actManager.getAct()===3){const i=document.activeElement;if(i&&(i.tagName==="BUTTON"||i.getAttribute("role")==="button"))return;t.preventDefault(),this.app.audioPlayer&&(this.app.audioPlayer.togglePlayback(n=>{}),this.app.updatePlayPauseButton())}}})});g(this,"screenWipeUp",()=>{const e=document.getElementById("screen-wipe");e&&(e.style.opacity="1")});g(this,"screenWipeDown",()=>{const e=document.getElementById("screen-wipe");e&&(e.style.opacity="0")});g(this,"disableListen",()=>{const e=document.getElementById("act-two__ui-menu-highlight-action");e==null||e.classList.add("hidden")});g(this,"enableListen",()=>{const e=document.getElementById("act-two__ui-menu-highlight-action");e==null||e.classList.remove("hidden")});g(this,"updateOnboardingPane",(e,t)=>{if(document.getElementById("act-two__ui-bottom-zone-icon"),t&&this.lottieOnboardingPlayer?this.lottieOnboardingPlayer.setAttribute("src",t):this.lottieOnboardingPlayer.removeAttribute("src"),e){const i=document.getElementById("act-two__ui-bottom-zone-label");i&&(i.innerHTML=e)}});g(this,"hideUI",()=>{document.body.classList.add("hide-ui"),this.forceUILabels(!1)});g(this,"showUI",()=>{document.body.classList.remove("hide-ui")});g(this,"animateInListenButton",()=>{const e=document.getElementById("act-two__ui-menu-highlight-inner"),t=document.getElementById("act-two__ui-menu-highlight-action-wrapper");if(!t||!e)return;const n=getComputedStyle(e).getPropertyValue("--menu-blur-amount");t.style.maxHeight="158px",document.body.style.setProperty("--menu-card-opacity","0"),e.style.setProperty("--menu-card-opacity","0"),e.style.setProperty("--menu-blur-amount","0px"),setTimeout(()=>{requestAnimationFrame(()=>{const s=performance.now(),a=750,r=l=>{const c=l-s,h=Math.min(c/a,1),d=kt.easeInOutCubic(h);document.body.style.setProperty("--menu-card-opacity",d.toString()),e.style.setProperty("--menu-card-opacity",d.toString()),e.style.setProperty("--menu-blur-amount",`${parseFloat(n)*d}px`),h<1?requestAnimationFrame(r):(document.body.style.removeProperty("--menu-card-opacity"),e.style.removeProperty("--menu-card-opacity"),e.style.removeProperty("--menu-blur-amount"))};requestAnimationFrame(r)})},250)});g(this,"getOnboardingLoaderState",e=>{if(this.loaderOnboardingGroup)return this.loaderOnboardingGroup.getLoaderState(`onboarding-loader-${e}`)});g(this,"showOnboardingPane",e=>{const t=document.getElementById("act-two__ui-bottom-zone"),i=document.getElementById("act-two__ui-bottom-zone-lower");if(!(!t||!i)){if(t.style.display="flex",i.style.display="flex",e){const n=s=>{s.propertyName==="opacity"&&(t.removeEventListener("transitionend",n),this.makeScreenReaderAnnouncement("Camera control onboarding started"),e())};t.addEventListener("transitionend",n)}t.style.opacity="1",i.style.opacity="1"}});g(this,"playSplashAnimation",()=>{this.lottieSplashPlayer&&this.lottieSplashPlayer.play()});g(this,"playSplashAnimationSegment",async()=>{this.lottieSplashPlayer&&(this.lottieSplashPlayer.play(),await bi(300),this.lottieSplashPlayer.pause())});g(this,"stopSplashAnimation",()=>{this.lottieSplashPlayer&&this.lottieSplashPlayer.stop()});g(this,"playOnboardingAnimation",()=>{this.lottieOnboardingPlayer&&this.lottieOnboardingPlayer.play()});g(this,"stopOnboardingAnimation",()=>{this.lottieOnboardingPlayer&&this.lottieOnboardingPlayer.stop()});g(this,"hideOnboardingPane",(e,t=!1)=>{const i=document.getElementById("act-two__ui-bottom-zone");if(i){if(e){const n=s=>{s.propertyName==="opacity"&&(i.removeEventListener("transitionend",n),e())};i.addEventListener("transitionend",n)}i.style.opacity="0",t&&(i.style.display="none")}});this.app=e,this.preferenceManager=Gs.getInstance(),this.setupUISoundTriggers(),this.settingsManager=new DM(this),this.feedbackManager=new FM(this),this.lottieOnboardingPlayer.setAttribute("autoplay","false"),this.lottieSplashPlayer.setAttribute("autoplay","false"),this.lottieSplashPlayer.setAttribute("role","presentation"),this.lottieSplashPlayer.setAttribute("aria-hidden","true"),this.lottieSplashPlayer.loop=!1,this.lottieSplashPlayer.id="lottie-title",this.lottieSplashPlayer.setAttribute("src",M_)}async loadAndUpdateModalContent(e){let t;if(this.prefetchedModalContent[e])t=this.prefetchedModalContent[e];else try{t=await(await fetch(`/modal-content/${e}.html`)).text(),this.prefetchedModalContent[e]=t}catch(s){console.error("Failed to load modal content:",s),t="<p>Error loading content. Please try again.</p>"}const i=document.createElement("div");if(i.innerHTML=t,["settings"].includes(e)){const s=i.querySelector("#settings-content-inject");s&&await this.settingsManager.injectSettingsContent(s,`settings-content-${e}`)}if(["about","feedback"].includes(e)){const s=i.querySelector("#feedback-content-inject");s&&await this.feedbackManager.injectFeedbackContent(s,`feedback-content-${e}`)}const n=i.querySelector("#controls-list-inject");return n&&(n.innerHTML=this.generateControlsHTML()),i.innerHTML}initialiseSettingsSwitches(){const e=document.getElementById("switch-reduce-motion"),t=document.getElementById("switch-keyboard-invert-x"),i=document.getElementById("switch-keyboard-invert-y");e&&e.classList.toggle("active",this.getReduceMotion()),t&&t.classList.toggle("active",this.getKeyboardInvertX()),i&&i.classList.toggle("active",this.getKeyboardInvertY())}showOnboardingSkipButton(){const e=document.getElementById("act-two__sequence-skip");e&&e.classList.remove("hidden")}initialiseVolumeControls(){["master","background","ui","voice"].forEach(t=>{var s;const i=document.getElementById(`volume-${t}`),n=(s=i==null?void 0:i.parentElement)==null?void 0:s.querySelector(".volume-number");if(i&&n){const a=this.preferenceManager.getPreference(`volume-${t}`,1),r=xn(a,0,1,0,100);i.value=r.toString(),n.textContent=Math.round(r).toString(),i.addEventListener("input",()=>{const l=Math.round(parseFloat(i.value));n.textContent=l.toString();const c=xn(parseFloat(i.value),0,100,0,1);this.handleVolumeChange(t,c)}),this.handleVolumeChange(t,a)}})}updateVolumeDisplay(e,t){const i=e.nextElementSibling;if(i){const n=Math.round(t*100);i.textContent=`${n}%`}}handleVolumeChange(e,t){this.preferenceManager.setPreference(`volume-${e}`,t),e==="master"?this.app.audioManager.setMasterVolume(t):this.app.audioManager.setGroupVolume(e,t)}async bindAboutActions(e){const t=e.querySelector("#image-credits");if(t)try{const n=await this.generateImageCredits();t.innerHTML=n}catch(n){console.error("Error generating image credits:",n),t.innerHTML="Unable to load image credits."}const i=e.querySelector("#restart-button");i&&i.addEventListener("pointerup",()=>{window.location.reload()})}async generateImageCredits(){try{const t=await(await fetch(Li("/intro-sequence/sequence.json"))).json(),i=new Map;return t.sequence.forEach(s=>{s.info&&!i.has(s.url)&&i.set(s.url,s.info)}),Array.from(i.entries()).filter(([s,a])=>!a.hideCredit).map(([s,a])=>{let r="";return r+=`<div class="image-credit-creator">${a!=null&&a.creator?a==null?void 0:a.creator:"Photographer Unknown"}</div>`,a.description&&(r+=`<div class="image-credit-description">${a.description}</div>`),a.date&&(r+=`<div class="image-credit-date">${a.date}</div>`),a.link&&(r+=`<div class="image-credit-link"><a href="${a.link}" target="_blank">View in catalogue</a></div>`),`
            <div class="image-credit-container">
              <div class="image-credit-image" style="background-image: url(${Un(s,pf(100),pf(100))});"></div>
              <div class="image-credit-content">
                ${r}
              </div>
            </div>
          `}).join("")}catch(e){throw console.error("Error fetching or parsing sequence.json:",e),e}}setKeyboardInvertX(e){this.preferenceManager.setPreference("keyboardInvertX",e),this.app.updateKeyboardInversion()}setKeyboardInvertY(e){this.preferenceManager.setPreference("keyboardInvertY",e),this.app.updateKeyboardInversion()}getKeyboardInvertX(){return this.preferenceManager.getPreference("keyboardInvertX",!0)}getKeyboardInvertY(){return this.preferenceManager.getPreference("keyboardInvertY",!0)}getHighContrast(){const e=this.preferenceManager.getPreference("highContrast",!1);return this.handleHighContrast(e),e}setHighContrast(e){this.preferenceManager.setPreference("highContrast",e),this.handleHighContrast(e)}handleHighContrast(e){e?(document.body.classList.add("high-contrast"),this.bindOnscreenControls()):document.body.classList.remove("high-contrast")}getShowOnscreenControls(){const e=this.preferenceManager.getPreference("showOnscreenControls",!1);return this.handleShowOnscreenControls(e),e}setShowOnscreenControls(e){this.preferenceManager.setPreference("showOnscreenControls",e),this.handleShowOnscreenControls(e)}handleShowOnscreenControls(e){const t=document.getElementById("switch-onscreen-controls-left-setting"),i=document.getElementById("switch-onscreen-controls-top-setting");e?(document.body.classList.add("onscreen-controls-visible"),this.bindOnscreenControls(),t&&t.removeAttribute("aria-hidden"),i&&i.removeAttribute("aria-hidden")):(document.body.classList.remove("onscreen-controls-visible"),t&&t.setAttribute("aria-hidden","true"),i&&i.setAttribute("aria-hidden","true"))}getOnscreenControlsLeft(){const e=this.preferenceManager.getPreference("onscreenControlsLeft",!1);return this.handleOnscreenControlsLeft(e),e}setOnscreenControlsLeft(e){this.preferenceManager.setPreference("onscreenControlsLeft",e),this.handleOnscreenControlsLeft(e)}handleOnscreenControlsLeft(e){e?document.body.classList.add("onscreen-controls-left"):document.body.classList.remove("onscreen-controls-left")}getOnscreenControlsTop(){const e=this.preferenceManager.getPreference("onscreenControlsTop",!1);return this.handleOnscreenControlsTop(e),e}handleOnscreenControlsTop(e){e?document.body.classList.add("onscreen-controls-top"):document.body.classList.remove("onscreen-controls-top")}setOnscreenControlsTop(e){this.preferenceManager.setPreference("onscreenControlsTop",e),this.handleOnscreenControlsTop(e)}setReduceMotion(e){this.preferenceManager.setPreference("reduceMotion",e),document.documentElement.setAttribute("data-reduced-motion",e.toString()),this.app.updateReducedMotion()}getShowSubtitles(){const e=this.preferenceManager.getPreference("showSubtitles",!0);return this.handleShowSubtitles(e),e}toggleShowSubtitles(){const e=this.getShowSubtitles();this.setShowSubtitles(!e),this.handleShowSubtitles(!e),this.makeScreenReaderAnnouncement(e?"Subtitles hidden":"Subtitles visible")}setShowSubtitles(e){this.preferenceManager.setPreference("showSubtitles",e),this.handleShowSubtitles(e)}handleShowSubtitles(e){e?document.body.classList.remove("hide-subtitles"):document.body.classList.add("hide-subtitles"),document.querySelectorAll(".caption-button").forEach(i=>{i.setAttribute("aria-label",e?"Hide Subtitles":"Show subtitles")})}getReduceMotion(){const e=this.preferenceManager.getPreference("reduceMotion")||!1;return document.documentElement.setAttribute("data-reduced-motion",e.toString()),e}getEnableSplat(){return this.preferenceManager.getPreference("enable-splat",!0)}setEnableSplat(e){this.preferenceManager.setPreference("enable-splat",e)}setGraphicsPreset(e){this.preferenceManager.setPreference("graphics-preset",e)}setFpsLimit(e){this.preferenceManager.setPreference("fps-limit",e)}enableAudio(){window.audioContext||(window.audioContext=new(window.AudioContext||window.webkitAudioContext)),window.audioContext.state==="suspended"&&window.audioContext.resume();const e=window.audioContext.createOscillator(),t=window.audioContext.createGain();t.gain.value=1,e.connect(t),t.connect(window.audioContext.destination),e.start(0)}hideAoc(e=!1){const t=document.getElementById("aoc-wrapper"),i=document.getElementById("loading-card"),n=document.getElementById("loading-card-content"),s=document.getElementById("loading-card-background");this.app.onWindowResize(),t&&i&&n&&s&&(this.app.aocVisible=!1,t.classList.remove("visible"),t.classList.add("anim-exit-start"),i.classList.add("anim-enter-start"),n.classList.add("anim-enter-start"),s.classList.add("anim-enter-start"),i.classList.remove("hidden"),n.classList.remove("hidden"),s.classList.remove("hidden"),this.preferenceManager.setPreference("aoc",!0),setTimeout(()=>{t.classList.add("anim-exit");const a=()=>{t.classList.add("hidden"),i.classList.add("anim-enter"),n.classList.add("anim-enter"),setTimeout(()=>{s.classList.add("anim-enter")},150),t.classList.remove("anim-exit-start"),t.classList.remove("anim-exit"),t.removeEventListener("transitionend",a);const r=async()=>{n.removeEventListener("transitionend",r),i.classList.remove("anim-enter-start"),i.classList.remove("anim-enter"),n.classList.remove("anim-enter-start"),n.classList.remove("anim-enter"),this.updateFocusableElements("splash-screen"),this.setActiveElement("loading-card","loading-card-content"),this.app.toastManager.setIsActive(!0),await bi(10),this.app.playTitleAnimation()};n.addEventListener("transitionend",r)};t.addEventListener("transitionend",a)},10))}setCameraMode(e,t=4e3){const i=document.getElementById("act-three__ui-camera-mode__toggle");i&&(e?(i.classList.remove("cinema"),i.classList.add("manual"),i.setAttribute("aria-label","Switch to cinema camera mode")):(i.classList.add("cinema"),i.classList.remove("manual"),i.setAttribute("aria-label","Switch to manual camera mode")),this.app.setActThreeCameraMode(!e,t))}setupAccordionKeyboardControls(){const e=document.querySelectorAll(".accordion-header");e.forEach((t,i)=>{t.addEventListener("keydown",n=>{if(n.key==="ArrowUp"||n.key==="ArrowDown"){n.preventDefault();const s=n.key==="ArrowUp"?-1:1,a=(i+s+e.length)%e.length;e[a].focus()}(n.key===" "||n.key==="Enter")&&(n.preventDefault(),this.toggleAccordion(e[i])),n.key==="Home"&&(n.preventDefault(),e[0].focus()),n.key==="End"&&(n.preventDefault(),e[e.length-1].focus())})})}updateFocusableElements(e,t=!0){this.currentFocusableElements.forEach(s=>{s.setAttribute("tabindex","-1")}),this.currentFocusableElements=[];let i;switch(e){case"aoc":i="#aoc-wrapper, #aoc-inner, #aoc-copy, #aoc-continue";break;case"scene-loader":i="#scene-loader button";break;case"splash-screen":i="#splash-screen button, #splash-screen a, #loading-card-feedback, #loading-card-disclaimer";break;case"content-warning":i="#content-warning";break;case"intro-sequence":i="#act-one, #intro-sequence button, #intro-sequence-skip, #intro-sequence-toggle-sound, #intro-sequence-progress-bar";break;case"act-two":i="#act-two, #act-two button, #act-two__ui-open-menu, #act-two__ui-toggle-sound, #act-two__ui-menu-highlight-listen";break;case"act-three":i="#act-three button, #act-three__ui-back, #act-three__ui-open-info, #act-three__ui-toggle-sound, #act-three__ui-camera-mode__icon, #act-three__ui-progress-bar";break;case"modal":i="#modal-content-inner button, #modal-content-inner a, #modal-dismiss";break;default:i='button, a, [tabindex="0"]'}Array.from(document.querySelectorAll(i)).forEach(s=>{s.setAttribute("tabindex","0"),this.currentFocusableElements.push(s)}),t&&this.currentFocusableElements.length>0&&this.currentFocusableElements[0].focus()}addLetterScreenReaderDescriptions(){const e=document.getElementById("act-three__object-description-detail");if(!e||(e.removeAttribute("aria-hidden"),e!=null&&e.children.length))return;const t=this.app.letterOverlayManager.letterContentArray;for(let i=0;i<t.length;i++){const n=document.createElement("div");n.setAttribute("aria-label",`Page ${i+1}`),n.innerText=U_(t[i].copy),n.classList.add("sro"),e.append(n)}}removeLetterScreenReaderDescriptions(){const e=document.getElementById("act-three__object-description-detail");e&&e.setAttribute("aria-hidden","true")}async generateDynamicContent(e){var a;const t=(a=this.app.assetManager.assets.find(r=>r.key===e))==null?void 0:a.params;if(!t)return"<p>Error: Item not found</p>";let i=this.prefetchedModalContent["item-template"];i=i.replace('id="modal-title">',`id="modal-title">${t.title?t.title:""}`),i=i.replace('id="modal-author">',`id="modal-author">by ${t.author?t.author:""}`),i=i.replace('id="modal-maker">',`id="modal-maker">${t.maker?t.maker:""}`),i=i.replace('id="modal-material">',`id="modal-material">${t.material?t.material:""}`),i=i.replace('id="modal-acc-no">',`id="modal-acc-no">${t.accNo?t.accNo:""}`),t!=null&&t.catLink&&(i=i.replace('id="modal-cat-link">',`id="modal-cat-link" class="modal-link-url"><a target="_blank" href="${t.catLink}">View in catalogue</a>`)),i=i.replace('id="modal-credit">',`id="modal-credit">${t.credit?t.credit:""}`),i=i.replace('id="modal-detail">',`id="modal-detail">${t.detail?t.detail:""}`),i=i.replace('id="modal-writing-title">',`id="modal-writing-title">${t.writing.title?t.writing.title:""}`),i=i.replace('id="modal-bio">',`id="modal-bio">${t.bio?t.bio:""}`),t!=null&&t.authorLink?i=i.replace('id="modal-bio-link">',`id="modal-bio-link" class="modal-link-url"><a target="_blank" href="${t.authorLink?t.authorLink:""}">${t.authorLink?t.authorLink:""}</a>`):i=i.replace('id="modal-bio-link">','id="modal-bio-link" class="modal-link-url" aria-hidden="true">');const n=await fetch(Li(`/modal-content/${t.writing.copyFile}.html`));if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.text();return i=i.replace('id="modal-transcript">',`id="modal-transcript">${s}`),i}setupUISoundTriggers(){const e=(n,s)=>{Array.from(n.classList).filter(r=>r.startsWith("ui-sound__")).forEach(r=>{const[l,c]=r.replace("ui-sound__","").split("--");(c===s||!c&&s==="up")&&this.playUISound(l)})},t=n=>{const a=n.target.closest(".ui-sound-trigger");a&&e(a,"down")},i=n=>{const s=n.target;if(!(s!=null&&s.closest))return;const a=s.closest(".ui-sound-trigger");a&&e(a,"up")};document.addEventListener("mousedown",t),document.addEventListener("touchstart",t,{passive:!0}),document.addEventListener("mouseup",i),document.addEventListener("touchend",i,{passive:!0})}generateControlsHTML(){const e=iu();return NM(__,e,this.preferenceManager.getPreference("is-touch",!1)).map(i=>`
      <section class="controls-list">
        <h3>${i.title}</h3>
        ${i.controls.map(n=>`
          <div class="modal-setting control-setting">
            <div class="modal-label" ${n!=null&&n.screenReader?'aria-label="'+hm(n.screenReader,e)+'"':null}>${n.label}</div>
            <div class="modal-value" aria-hidden="true">
              ${n!=null&&n.icon?`<span class="icon"><img src="${n.icon}" /></span>`:""}
              ${n!=null&&n.value?`<span class="value control-value">${n.value}</span>`:""}
              ${n.description?`<span class="description">${n.description}</span>`:""}
            </div>
          </div>
        `).join("")}
      </section>
      <div class="spacer x3"></div>
    `).join("")}playUISound(e){switch(e){case"click":this.app.audioManager.playTrack("uiClick",{createInstance:!0});break;case"clack":this.app.audioManager.playTrack("uiClack",{createInstance:!0});break;case"release01":this.app.audioManager.playTrack("uiRelease01",{createInstance:!0});break;case"release02":this.app.audioManager.playTrack("uiRelease02",{createInstance:!0});break;case"release03":this.app.audioManager.playTrack("uiRelease03",{createInstance:!0});break;case"release04":this.app.audioManager.playTrack("uiRelease04",{createInstance:!0});break;case"release05":this.app.audioManager.playTrack("uiRelease05",{createInstance:!0});break}}setupKeyboardShortcuts(){document.addEventListener("keydown",e=>{const t=document.activeElement;t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||(e.ctrlKey||e.metaKey)&&e.shiftKey&&(e.key==="M"||e.key==="m")&&(e.preventDefault(),this.app.toggleMute())})}showCameraMode(){const e=document.getElementById("act-three__ui-camera-mode");e&&e.classList.remove("letter")}hideCameraMode(){const e=document.getElementById("act-three__ui-camera-mode");e&&e.classList.add("letter")}updateOnboardingProgress(e,t){this.loaderOnboardingGroup&&this.loaderOnboardingGroup.updateLoaderProgress(`onboarding-loader-${e}`,{loaded:t,total:100,percentage:t})}updateOnboardingBarProgress(e){const t=document.getElementById("act-two__ui-bottom-zone-progress");t&&(t.style.width=`${e}%`);const i=document.getElementById("act-two__ui-bottom-zone-progress-number");i&&(i.innerText=`${parseInt(e)}%`)}initOnboardingLoaders(e,t){const i=document.getElementById("act-two__ui-bottom-zone-progress-icons");if(!i)return;this.loaderOnboardingGroup&&t&&(this.loaderOnboardingGroup.cleanup(),this.loaderOnboardingGroup=null),this.loaderOnboardingGroup||(this.loaderOnboardingGroup=new ex({containerId:i.id,loaderSize:45,defaultState:"inactive"}));const n=this.loaderOnboardingGroup.getLoaderCount();for(let s=n;s<n+e;s++)this.loaderOnboardingGroup.addLoader({id:`onboarding-loader-${s}`,options:{animationDuration:1}})}bindActionToLoader(e,t,i){if(!this.loaderOnboardingGroup)return;const n=this.loaderOnboardingGroup.getLoaderByIndex(e),s=document.getElementById(n==null?void 0:n.elementId);s&&(s.setAttribute("aria-label",`Jump to ${t}`),s.classList.add("ui-no-button")),$t([n.elementId],i)}completeOnboardingLoader(e){this.loaderOnboardingGroup&&this.loaderOnboardingGroup.completeLoader(`onboarding-loader-${e}`)}forceUILabels(e=!0){e?document.body.classList.add("force-ui-labels"):document.body.classList.remove("force-ui-labels")}setOnboardingLoaderState(e,t){this.loaderOnboardingGroup&&this.loaderOnboardingGroup.setLoaderState(`onboarding-loader-${e}`,t)}async initSplash(){const e=document.getElementById("loading-card__title");e&&e.appendChild(this.lottieSplashPlayer);const t=document.getElementById("loading-card-background");t&&(t.style.backgroundImage=`url(${Un("slv-a-mouthful-of-dust/media/images/1746661108ce0/splash-02.jpg")})`)}async initUi(){this.initSplash(),this.initCameraModeRadialLoader()}initCameraModeRadialLoader(){this.cameraModeRadial=new mm({elementId:"act-three__ui-camera-transition-radial",size:28,strokeWidth:6})}updateCameraModeTransitionProgress(e){this.cameraModeRadial.set}async initOnboarding(){const e=document.getElementById("act-two__ui-bottom-zone-icon");if(!e)return;const t=this.app.preferenceManager.getPreference("is-mobile");e.appendChild(this.lottieOnboardingPlayer),this.updateOnboardingPane(t?"1. Pinch to zoom":"1. Scroll to zoom",t?A_:x_),this.initOnboardingLoaders(1),this.loaderOnboardingGroup.setLoaderIconByIndex(0,Li("/images/Onboard-Helmet-S.svg")),await bi(100),this.showOnboardingPane(()=>{this.playOnboardingAnimation()})}cleanupOnboardingLoaders(){this.loaderOnboardingGroup&&(this.loaderOnboardingGroup.cleanup(),this.loaderOnboardingGroup=null)}showTriggerWarning(){const e=document.getElementById("content-warning");e&&(this.setActiveElement("content-warning","content-warning-inner"),e.style.opacity="1")}hideTriggerWarning(){const e=document.getElementById("content-warning");e&&(e.style.opacity="0",setTimeout(()=>{e.remove()},1500))}resetSplashSubtitle(){this.stopSplashAnimation(),this.hideSplashSubtitle()}showSplashSubtitle(){const e=document.getElementById("loading-card__subtitle");e&&e.classList.remove("transparent")}hideSplashSubtitle(){const e=document.getElementById("loading-card__subtitle");e&&(e.classList.add("fast"),e.classList.add("transparent"))}hideOnboardingProgress(){const e=document.getElementById("act-two__ui-bottom-zone-progress-wrapper-inner");e&&(e.style.opacity="0")}setActiveElement(e,t,i=!0){this.currentActiveElement&&this.currentActiveElement!==e&&(this.previousActiveElement=this.currentActiveElement),this.currentActiveElement=e,E_.forEach(n=>{if(n!==e&&!i)return;const s=document.getElementById(n);s&&(n===e?(s.removeAttribute("aria-hidden"),setTimeout(()=>{const a=t?document.getElementById(t):s;a&&(a.setAttribute("tabindex","0"),a.focus())},100)):s.setAttribute("aria-hidden","true"))})}updateMenuDot(e){const t=L_(e),i=document.getElementById("act-two__ui-bottom-zone-dot");i&&(i.style.left=`${t*100}%`)}}function ix(){var o=Object.create(null);function e(n,s){var a=n.id,r=n.name,l=n.dependencies;l===void 0&&(l=[]);var c=n.init;c===void 0&&(c=function(){});var h=n.getTransferables;if(h===void 0&&(h=null),!o[a])try{l=l.map(function(f){return f&&f.isWorkerModule&&(e(f,function(p){if(p instanceof Error)throw p}),f=o[f.id].value),f}),c=i("<"+r+">.init",c),h&&(h=i("<"+r+">.getTransferables",h));var d=null;typeof c=="function"?d=c.apply(void 0,l):console.error("worker module init function failed to rehydrate"),o[a]={id:a,value:d,getTransferables:h},s(d)}catch(f){f&&f.noLog||console.error(f),s(f)}}function t(n,s){var a,r=n.id,l=n.args;(!o[r]||typeof o[r].value!="function")&&s(new Error("Worker module "+r+": not found or its 'init' did not return a function"));try{var c=(a=o[r]).value.apply(a,l);c&&typeof c.then=="function"?c.then(h,function(d){return s(d instanceof Error?d:new Error(""+d))}):h(c)}catch(d){s(d)}function h(d){try{var f=o[r].getTransferables&&o[r].getTransferables(d);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),s(d,f)}catch(p){console.error(p),s(p)}}}function i(n,s){var a=void 0;self.troikaDefine=function(l){return a=l};var r=URL.createObjectURL(new Blob(["/** "+n.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(r)}catch(l){console.error(l)}return URL.revokeObjectURL(r),delete self.troikaDefine,a}self.addEventListener("message",function(n){var s=n.data,a=s.messageId,r=s.action,l=s.data;try{r==="registerModule"&&e(l,function(c){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:{isCallable:typeof c=="function"}})}),r==="callModule"&&t(l,function(c,h){c instanceof Error?postMessage({messageId:a,success:!1,error:c.message}):postMessage({messageId:a,success:!0,result:c},h||void 0)})}catch(c){postMessage({messageId:a,success:!1,error:c.stack})}})}function nx(o){var e=function(){for(var t=[],i=arguments.length;i--;)t[i]=arguments[i];return e._getInitResult().then(function(n){if(typeof n=="function")return n.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=o.dependencies,i=o.init;t=Array.isArray(t)?t.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var n=Promise.all(t).then(function(s){return i.apply(null,s)});return e._getInitResult=function(){return n},n},e}var gm=function(){var o=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),o=!0}catch(t){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return gm=function(){return o},o},sx=0,ax=0,oh=!1,Mo=Object.create(null),xo=Object.create(null),Ih=Object.create(null);function Xr(o){if((!o||typeof o.init!="function")&&!oh)throw new Error("requires `options.init` function");var e=o.dependencies,t=o.init,i=o.getTransferables,n=o.workerId,s=nx(o);n==null&&(n="#default");var a="workerModule"+ ++sx,r=o.name||a,l=null;e=e&&e.map(function(h){return typeof h=="function"&&!h.workerModuleData&&(oh=!0,h=Xr({workerId:n,name:"<"+r+"> function dependency: "+h.name,init:`function(){return (
`+kl(h)+`
)}`}),oh=!1),h&&h.workerModuleData&&(h=h.workerModuleData),h});function c(){for(var h=[],d=arguments.length;d--;)h[d]=arguments[d];if(!gm())return s.apply(void 0,h);if(!l){l=Lf(n,"registerModule",c.workerModuleData);var f=function(){l=null,xo[n].delete(f)};(xo[n]||(xo[n]=new Set)).add(f)}return l.then(function(p){var b=p.isCallable;if(b)return Lf(n,"callModule",{id:a,args:h});throw new Error("Worker module function was called but `init` did not return a callable function")})}return c.workerModuleData={isWorkerModule:!0,id:a,name:r,dependencies:e,init:kl(t),getTransferables:i&&kl(i)},c.onMainThread=s,c}function rx(o){xo[o]&&xo[o].forEach(function(e){e()}),Mo[o]&&(Mo[o].terminate(),delete Mo[o])}function kl(o){var e=o.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function ox(o){var e=Mo[o];if(!e){var t=kl(ix);e=Mo[o]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+o.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(i){var n=i.data,s=n.messageId,a=Ih[s];if(!a)throw new Error("WorkerModule response with empty or unknown messageId");delete Ih[s],a(n)}}return e}function Lf(o,e,t){return new Promise(function(i,n){var s=++ax;Ih[s]=function(a){a.success?i(a.result):n(new Error("Error in worker "+e+" call: "+a.error))},ox(o).postMessage({messageId:s,action:e,data:t})})}function ym(){var o=function(e){function t(fe,he,Q,pe,ve,K,se,Ee){var me=1-se;Ee.x=me*me*fe+2*me*se*Q+se*se*ve,Ee.y=me*me*he+2*me*se*pe+se*se*K}function i(fe,he,Q,pe,ve,K,se,Ee,me,Oe){var Ze=1-me;Oe.x=Ze*Ze*Ze*fe+3*Ze*Ze*me*Q+3*Ze*me*me*ve+me*me*me*se,Oe.y=Ze*Ze*Ze*he+3*Ze*Ze*me*pe+3*Ze*me*me*K+me*me*me*Ee}function n(fe,he){for(var Q=/([MLQCZ])([^MLQCZ]*)/g,pe,ve,K,se,Ee;pe=Q.exec(fe);){var me=pe[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Oe){return parseFloat(Oe)});switch(pe[1]){case"M":se=ve=me[0],Ee=K=me[1];break;case"L":(me[0]!==se||me[1]!==Ee)&&he("L",se,Ee,se=me[0],Ee=me[1]);break;case"Q":{he("Q",se,Ee,se=me[2],Ee=me[3],me[0],me[1]);break}case"C":{he("C",se,Ee,se=me[4],Ee=me[5],me[0],me[1],me[2],me[3]);break}case"Z":(se!==ve||Ee!==K)&&he("L",se,Ee,ve,K);break}}}function s(fe,he,Q){Q===void 0&&(Q=16);var pe={x:0,y:0};n(fe,function(ve,K,se,Ee,me,Oe,Ze,le,ke){switch(ve){case"L":he(K,se,Ee,me);break;case"Q":{for(var Fe=K,ht=se,at=1;at<Q;at++)t(K,se,Oe,Ze,Ee,me,at/(Q-1),pe),he(Fe,ht,pe.x,pe.y),Fe=pe.x,ht=pe.y;break}case"C":{for(var Ke=K,tt=se,lt=1;lt<Q;lt++)i(K,se,Oe,Ze,le,ke,Ee,me,lt/(Q-1),pe),he(Ke,tt,pe.x,pe.y),Ke=pe.x,tt=pe.y;break}}})}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",r="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",l=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function h(fe,he){var Q=fe.getContext?fe.getContext("webgl",c):fe,pe=l.get(Q);if(!pe){let Ze=function(Ke){var tt=K[Ke];if(!tt&&(tt=K[Ke]=Q.getExtension(Ke),!tt))throw new Error(Ke+" not supported");return tt},le=function(Ke,tt){var lt=Q.createShader(tt);return Q.shaderSource(lt,Ke),Q.compileShader(lt),lt},ke=function(Ke,tt,lt,qe){if(!se[Ke]){var X={},F={},re=Q.createProgram();Q.attachShader(re,le(tt,Q.VERTEX_SHADER)),Q.attachShader(re,le(lt,Q.FRAGMENT_SHADER)),Q.linkProgram(re),se[Ke]={program:re,transaction:function(ce){Q.useProgram(re),ce({setUniform:function(Ge,$e){for(var Qe=[],je=arguments.length-2;je-- >0;)Qe[je]=arguments[je+2];var ze=F[$e]||(F[$e]=Q.getUniformLocation(re,$e));Q["uniform"+Ge].apply(Q,[ze].concat(Qe))},setAttribute:function(Ge,$e,Qe,je,ze){var st=X[Ge];st||(st=X[Ge]={buf:Q.createBuffer(),loc:Q.getAttribLocation(re,Ge),data:null}),Q.bindBuffer(Q.ARRAY_BUFFER,st.buf),Q.vertexAttribPointer(st.loc,$e,Q.FLOAT,!1,0,0),Q.enableVertexAttribArray(st.loc),ve?Q.vertexAttribDivisor(st.loc,je):Ze("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(st.loc,je),ze!==st.data&&(Q.bufferData(Q.ARRAY_BUFFER,ze,Qe),st.data=ze)}})}}}se[Ke].transaction(qe)},Fe=function(Ke,tt){me++;try{Q.activeTexture(Q.TEXTURE0+me);var lt=Ee[Ke];lt||(lt=Ee[Ke]=Q.createTexture(),Q.bindTexture(Q.TEXTURE_2D,lt),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.NEAREST),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.NEAREST)),Q.bindTexture(Q.TEXTURE_2D,lt),tt(lt,me)}finally{me--}},ht=function(Ke,tt,lt){var qe=Q.createFramebuffer();Oe.push(qe),Q.bindFramebuffer(Q.FRAMEBUFFER,qe),Q.activeTexture(Q.TEXTURE0+tt),Q.bindTexture(Q.TEXTURE_2D,Ke),Q.framebufferTexture2D(Q.FRAMEBUFFER,Q.COLOR_ATTACHMENT0,Q.TEXTURE_2D,Ke,0);try{lt(qe)}finally{Q.deleteFramebuffer(qe),Q.bindFramebuffer(Q.FRAMEBUFFER,Oe[--Oe.length-1]||null)}},at=function(){K={},se={},Ee={},me=-1,Oe.length=0};var ve=typeof WebGL2RenderingContext<"u"&&Q instanceof WebGL2RenderingContext,K={},se={},Ee={},me=-1,Oe=[];Q.canvas.addEventListener("webglcontextlost",function(Ke){at(),Ke.preventDefault()},!1),l.set(Q,pe={gl:Q,isWebGL2:ve,getExtension:Ze,withProgram:ke,withTexture:Fe,withTextureFramebuffer:ht,handleContextLoss:at})}he(pe)}function d(fe,he,Q,pe,ve,K,se,Ee){se===void 0&&(se=15),Ee===void 0&&(Ee=null),h(fe,function(me){var Oe=me.gl,Ze=me.withProgram,le=me.withTexture;le("copy",function(ke,Fe){Oe.texImage2D(Oe.TEXTURE_2D,0,Oe.RGBA,ve,K,0,Oe.RGBA,Oe.UNSIGNED_BYTE,he),Ze("copy",a,r,function(ht){var at=ht.setUniform,Ke=ht.setAttribute;Ke("aUV",2,Oe.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),at("1i","image",Fe),Oe.bindFramebuffer(Oe.FRAMEBUFFER,Ee||null),Oe.disable(Oe.BLEND),Oe.colorMask(se&8,se&4,se&2,se&1),Oe.viewport(Q,pe,ve,K),Oe.scissor(Q,pe,ve,K),Oe.drawArrays(Oe.TRIANGLES,0,3)})})})}function f(fe,he,Q){var pe=fe.width,ve=fe.height;h(fe,function(K){var se=K.gl,Ee=new Uint8Array(pe*ve*4);se.readPixels(0,0,pe,ve,se.RGBA,se.UNSIGNED_BYTE,Ee),fe.width=he,fe.height=Q,d(se,Ee,0,0,pe,ve)})}var p=Object.freeze({__proto__:null,withWebGLContext:h,renderImageData:d,resizeWebGLCanvasWithoutClearing:f});function b(fe,he,Q,pe,ve,K){K===void 0&&(K=1);var se=new Uint8Array(fe*he),Ee=pe[2]-pe[0],me=pe[3]-pe[1],Oe=[];s(Q,function(Ke,tt,lt,qe){Oe.push({x1:Ke,y1:tt,x2:lt,y2:qe,minX:Math.min(Ke,lt),minY:Math.min(tt,qe),maxX:Math.max(Ke,lt),maxY:Math.max(tt,qe)})}),Oe.sort(function(Ke,tt){return Ke.maxX-tt.maxX});for(var Ze=0;Ze<fe;Ze++)for(var le=0;le<he;le++){var ke=ht(pe[0]+Ee*(Ze+.5)/fe,pe[1]+me*(le+.5)/he),Fe=Math.pow(1-Math.abs(ke)/ve,K)/2;ke<0&&(Fe=1-Fe),Fe=Math.max(0,Math.min(255,Math.round(Fe*255))),se[le*fe+Ze]=Fe}return se;function ht(Ke,tt){for(var lt=1/0,qe=1/0,X=Oe.length;X--;){var F=Oe[X];if(F.maxX+qe<=Ke)break;if(Ke+qe>F.minX&&tt-qe<F.maxY&&tt+qe>F.minY){var re=v(Ke,tt,F.x1,F.y1,F.x2,F.y2);re<lt&&(lt=re,qe=Math.sqrt(lt))}}return at(Ke,tt)&&(qe=-qe),qe}function at(Ke,tt){for(var lt=0,qe=Oe.length;qe--;){var X=Oe[qe];if(X.maxX<=Ke)break;var F=X.y1>tt!=X.y2>tt&&Ke<(X.x2-X.x1)*(tt-X.y1)/(X.y2-X.y1)+X.x1;F&&(lt+=X.y1<X.y2?1:-1)}return lt!==0}}function _(fe,he,Q,pe,ve,K,se,Ee,me,Oe){K===void 0&&(K=1),Ee===void 0&&(Ee=0),me===void 0&&(me=0),Oe===void 0&&(Oe=0),y(fe,he,Q,pe,ve,K,se,null,Ee,me,Oe)}function y(fe,he,Q,pe,ve,K,se,Ee,me,Oe,Ze){K===void 0&&(K=1),me===void 0&&(me=0),Oe===void 0&&(Oe=0),Ze===void 0&&(Ze=0);for(var le=b(fe,he,Q,pe,ve,K),ke=new Uint8Array(le.length*4),Fe=0;Fe<le.length;Fe++)ke[Fe*4+Ze]=le[Fe];d(se,ke,me,Oe,fe,he,1<<3-Ze,Ee)}function v(fe,he,Q,pe,ve,K){var se=ve-Q,Ee=K-pe,me=se*se+Ee*Ee,Oe=me?Math.max(0,Math.min(1,((fe-Q)*se+(he-pe)*Ee)/me)):0,Ze=fe-(Q+Oe*se),le=he-(pe+Oe*Ee);return Ze*Ze+le*le}var S=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:_,generateIntoFramebuffer:y}),A="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",E="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",O="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",R=new Float32Array([0,0,2,0,0,2]),k=null,U=!1,C={},T=new WeakMap;function Z(fe){if(!U&&!Y(fe))throw new Error("WebGL generation not supported")}function z(fe,he,Q,pe,ve,K,se){if(K===void 0&&(K=1),se===void 0&&(se=null),!se&&(se=k,!se)){var Ee=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!Ee)throw new Error("OffscreenCanvas or DOM canvas not supported");se=k=Ee.getContext("webgl",{depth:!1})}Z(se);var me=new Uint8Array(fe*he*4);h(se,function(ke){var Fe=ke.gl,ht=ke.withTexture,at=ke.withTextureFramebuffer;ht("readable",function(Ke,tt){Fe.texImage2D(Fe.TEXTURE_2D,0,Fe.RGBA,fe,he,0,Fe.RGBA,Fe.UNSIGNED_BYTE,null),at(Ke,tt,function(lt){V(fe,he,Q,pe,ve,K,Fe,lt,0,0,0),Fe.readPixels(0,0,fe,he,Fe.RGBA,Fe.UNSIGNED_BYTE,me)})})});for(var Oe=new Uint8Array(fe*he),Ze=0,le=0;Ze<me.length;Ze+=4)Oe[le++]=me[Ze];return Oe}function B(fe,he,Q,pe,ve,K,se,Ee,me,Oe){K===void 0&&(K=1),Ee===void 0&&(Ee=0),me===void 0&&(me=0),Oe===void 0&&(Oe=0),V(fe,he,Q,pe,ve,K,se,null,Ee,me,Oe)}function V(fe,he,Q,pe,ve,K,se,Ee,me,Oe,Ze){K===void 0&&(K=1),me===void 0&&(me=0),Oe===void 0&&(Oe=0),Ze===void 0&&(Ze=0),Z(se);var le=[];s(Q,function(ke,Fe,ht,at){le.push(ke,Fe,ht,at)}),le=new Float32Array(le),h(se,function(ke){var Fe=ke.gl,ht=ke.isWebGL2,at=ke.getExtension,Ke=ke.withProgram,tt=ke.withTexture,lt=ke.withTextureFramebuffer,qe=ke.handleContextLoss;if(tt("rawDistances",function(X,F){(fe!==X._lastWidth||he!==X._lastHeight)&&Fe.texImage2D(Fe.TEXTURE_2D,0,Fe.RGBA,X._lastWidth=fe,X._lastHeight=he,0,Fe.RGBA,Fe.UNSIGNED_BYTE,null),Ke("main",A,E,function(re){var Ie=re.setAttribute,ce=re.setUniform,Se=!ht&&at("ANGLE_instanced_arrays"),Ge=!ht&&at("EXT_blend_minmax");Ie("aUV",2,Fe.STATIC_DRAW,0,R),Ie("aLineSegment",4,Fe.DYNAMIC_DRAW,1,le),ce.apply(void 0,["4f","uGlyphBounds"].concat(pe)),ce("1f","uMaxDistance",ve),ce("1f","uExponent",K),lt(X,F,function($e){Fe.enable(Fe.BLEND),Fe.colorMask(!0,!0,!0,!0),Fe.viewport(0,0,fe,he),Fe.scissor(0,0,fe,he),Fe.blendFunc(Fe.ONE,Fe.ONE),Fe.blendEquationSeparate(Fe.FUNC_ADD,ht?Fe.MAX:Ge.MAX_EXT),Fe.clear(Fe.COLOR_BUFFER_BIT),ht?Fe.drawArraysInstanced(Fe.TRIANGLES,0,3,le.length/4):Se.drawArraysInstancedANGLE(Fe.TRIANGLES,0,3,le.length/4)})}),Ke("post",a,O,function(re){re.setAttribute("aUV",2,Fe.STATIC_DRAW,0,R),re.setUniform("1i","tex",F),Fe.bindFramebuffer(Fe.FRAMEBUFFER,Ee),Fe.disable(Fe.BLEND),Fe.colorMask(Ze===0,Ze===1,Ze===2,Ze===3),Fe.viewport(me,Oe,fe,he),Fe.scissor(me,Oe,fe,he),Fe.drawArrays(Fe.TRIANGLES,0,3)})}),Fe.isContextLost())throw qe(),new Error("webgl context lost")})}function Y(fe){var he=!fe||fe===k?C:fe.canvas||fe,Q=T.get(he);if(Q===void 0){U=!0;var pe=null;try{var ve=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],K=z(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,fe);Q=K&&ve.length===K.length&&K.every(function(se,Ee){return se===ve[Ee]}),Q||(pe="bad trial run results",console.info(ve,K))}catch(se){Q=!1,pe=se.message}pe&&console.warn("WebGL SDF generation not supported:",pe),U=!1,T.set(he,Q)}return Q}var J=Object.freeze({__proto__:null,generate:z,generateIntoCanvas:B,generateIntoFramebuffer:V,isSupported:Y});function Te(fe,he,Q,pe,ve,K){ve===void 0&&(ve=Math.max(pe[2]-pe[0],pe[3]-pe[1])/2),K===void 0&&(K=1);try{return z.apply(J,arguments)}catch(se){return console.info("WebGL SDF generation failed, falling back to JS",se),b.apply(S,arguments)}}function ge(fe,he,Q,pe,ve,K,se,Ee,me,Oe){ve===void 0&&(ve=Math.max(pe[2]-pe[0],pe[3]-pe[1])/2),K===void 0&&(K=1),Ee===void 0&&(Ee=0),me===void 0&&(me=0),Oe===void 0&&(Oe=0);try{return B.apply(J,arguments)}catch(Ze){return console.info("WebGL SDF generation failed, falling back to JS",Ze),_.apply(S,arguments)}}return e.forEachPathCommand=n,e.generate=Te,e.generateIntoCanvas=ge,e.javascript=S,e.pathToLineSegments=s,e.webgl=J,e.webglUtils=p,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return o}function lx(){var o=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},i={},n={};i.L=1,n[1]="L",Object.keys(t).forEach(function(qe,X){i[qe]=1<<X+1,n[i[qe]]=qe}),Object.freeze(i);var s=i.LRI|i.RLI|i.FSI,a=i.L|i.R|i.AL,r=i.B|i.S|i.WS|i.ON|i.FSI|i.LRI|i.RLI|i.PDI,l=i.BN|i.RLE|i.LRE|i.RLO|i.LRO|i.PDF,c=i.S|i.WS|i.B|s|i.PDI|l,h=null;function d(){if(!h){h=new Map;var qe=function(F){if(t.hasOwnProperty(F)){var re=0;t[F].split(",").forEach(function(Ie){var ce=Ie.split("+"),Se=ce[0],Ge=ce[1];Se=parseInt(Se,36),Ge=Ge?parseInt(Ge,36):0,h.set(re+=Se,i[F]);for(var $e=0;$e<Ge;$e++)h.set(++re,i[F])})}};for(var X in t)qe(X)}}function f(qe){return d(),h.get(qe.codePointAt(0))||i.L}function p(qe){return n[f(qe)]}var b={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function _(qe,X){var F=36,re=0,Ie=new Map,ce=X&&new Map,Se;return qe.split(",").forEach(function Ge($e){if($e.indexOf("+")!==-1)for(var Qe=+$e;Qe--;)Ge(Se);else{Se=$e;var je=$e.split(">"),ze=je[0],st=je[1];ze=String.fromCodePoint(re+=parseInt(ze,F)),st=String.fromCodePoint(re+=parseInt(st,F)),Ie.set(ze,st),X&&ce.set(st,ze)}}),{map:Ie,reverseMap:ce}}var y,v,S;function A(){if(!y){var qe=_(b.pairs,!0),X=qe.map,F=qe.reverseMap;y=X,v=F,S=_(b.canonical,!1).map}}function E(qe){return A(),y.get(qe)||null}function O(qe){return A(),v.get(qe)||null}function R(qe){return A(),S.get(qe)||null}var k=i.L,U=i.R,C=i.EN,T=i.ES,Z=i.ET,z=i.AN,B=i.CS,V=i.B,Y=i.S,J=i.ON,Te=i.BN,ge=i.NSM,fe=i.AL,he=i.LRO,Q=i.RLO,pe=i.LRE,ve=i.RLE,K=i.PDF,se=i.LRI,Ee=i.RLI,me=i.FSI,Oe=i.PDI;function Ze(qe,X){for(var F=125,re=new Uint32Array(qe.length),Ie=0;Ie<qe.length;Ie++)re[Ie]=f(qe[Ie]);var ce=new Map;function Se(Xi,pn){var $i=re[Xi];re[Xi]=pn,ce.set($i,ce.get($i)-1),$i&r&&ce.set(r,ce.get(r)-1),ce.set(pn,(ce.get(pn)||0)+1),pn&r&&ce.set(r,(ce.get(r)||0)+1)}for(var Ge=new Uint8Array(qe.length),$e=new Map,Qe=[],je=null,ze=0;ze<qe.length;ze++)je||Qe.push(je={start:ze,end:qe.length-1,level:X==="rtl"?1:X==="ltr"?0:Jr(ze,!1)}),re[ze]&V&&(je.end=ze,je=null);for(var st=ve|pe|Q|he|s|Oe|K|V,pt=function(Xi){return Xi+(Xi&1?1:2)},dt=function(Xi){return Xi+(Xi&1?2:1)},rt=0;rt<Qe.length;rt++){je=Qe[rt];var it=[{_level:je.level,_override:0,_isolate:0}],mt=void 0,Mt=0,wt=0,L=0;ce.clear();for(var ye=je.start;ye<=je.end;ye++){var _e=re[ye];if(mt=it[it.length-1],ce.set(_e,(ce.get(_e)||0)+1),_e&r&&ce.set(r,(ce.get(r)||0)+1),_e&st)if(_e&(ve|pe)){Ge[ye]=mt._level;var Ue=(_e===ve?dt:pt)(mt._level);Ue<=F&&!Mt&&!wt?it.push({_level:Ue,_override:0,_isolate:0}):Mt||wt++}else if(_e&(Q|he)){Ge[ye]=mt._level;var Xe=(_e===Q?dt:pt)(mt._level);Xe<=F&&!Mt&&!wt?it.push({_level:Xe,_override:_e&Q?U:k,_isolate:0}):Mt||wt++}else if(_e&s){_e&me&&(_e=Jr(ye+1,!0)===1?Ee:se),Ge[ye]=mt._level,mt._override&&Se(ye,mt._override);var Pt=(_e===Ee?dt:pt)(mt._level);Pt<=F&&Mt===0&&wt===0?(L++,it.push({_level:Pt,_override:0,_isolate:1,_isolInitIndex:ye})):Mt++}else if(_e&Oe){if(Mt>0)Mt--;else if(L>0){for(wt=0;!it[it.length-1]._isolate;)it.pop();var bt=it[it.length-1]._isolInitIndex;bt!=null&&($e.set(bt,ye),$e.set(ye,bt)),it.pop(),L--}mt=it[it.length-1],Ge[ye]=mt._level,mt._override&&Se(ye,mt._override)}else _e&K?(Mt===0&&(wt>0?wt--:!mt._isolate&&it.length>1&&(it.pop(),mt=it[it.length-1])),Ge[ye]=mt._level):_e&V&&(Ge[ye]=je.level);else Ge[ye]=mt._level,mt._override&&_e!==Te&&Se(ye,mt._override)}for(var _t=[],Ot=null,St=je.start;St<=je.end;St++){var At=re[St];if(!(At&l)){var Lt=Ge[St],pi=At&s,ii=At===Oe;Ot&&Lt===Ot._level?(Ot._end=St,Ot._endsWithIsolInit=pi):_t.push(Ot={_start:St,_end:St,_level:Lt,_startsWithPDI:ii,_endsWithIsolInit:pi})}}for(var Qt=[],mi=0;mi<_t.length;mi++){var Ri=_t[mi];if(!Ri._startsWithPDI||Ri._startsWithPDI&&!$e.has(Ri._start)){for(var Ki=[Ot=Ri],En=void 0;Ot&&Ot._endsWithIsolInit&&(En=$e.get(Ot._end))!=null;)for(var un=mi+1;un<_t.length;un++)if(_t[un]._start===En){Ki.push(Ot=_t[un]);break}for(var Qi=[],ft=0;ft<Ki.length;ft++)for(var gi=Ki[ft],j=gi._start;j<=gi._end;j++)Qi.push(j);for(var Me=Ge[Qi[0]],De=je.level,Re=Qi[0]-1;Re>=0;Re--)if(!(re[Re]&l)){De=Ge[Re];break}var Le=Qi[Qi.length-1],gt=Ge[Le],vt=je.level;if(!(re[Le]&s)){for(var xt=Le+1;xt<=je.end;xt++)if(!(re[xt]&l)){vt=Ge[xt];break}}Qt.push({_seqIndices:Qi,_sosType:Math.max(De,Me)%2?U:k,_eosType:Math.max(vt,gt)%2?U:k})}}for(var ut=0;ut<Qt.length;ut++){var Nt=Qt[ut],nt=Nt._seqIndices,Bt=Nt._sosType,_i=Nt._eosType,vi=Ge[nt[0]]&1?U:k;if(ce.get(ge))for(var Pi=0;Pi<nt.length;Pi++){var dn=nt[Pi];if(re[dn]&ge){for(var Zt=Bt,Ut=Pi-1;Ut>=0;Ut--)if(!(re[nt[Ut]]&l)){Zt=re[nt[Ut]];break}Se(dn,Zt&(s|Oe)?J:Zt)}}if(ce.get(C))for(var Cn=0;Cn<nt.length;Cn++){var li=nt[Cn];if(re[li]&C)for(var Ji=Cn-1;Ji>=-1;Ji--){var Ws=Ji===-1?Bt:re[nt[Ji]];if(Ws&a){Ws===fe&&Se(li,z);break}}}if(ce.get(fe))for(var Gn=0;Gn<nt.length;Gn++){var As=nt[Gn];re[As]&fe&&Se(As,U)}if(ce.get(T)||ce.get(B))for(var Mi=1;Mi<nt.length-1;Mi++){var en=nt[Mi];if(re[en]&(T|B)){for(var Ni=0,Di=0,Ts=Mi-1;Ts>=0&&(Ni=re[nt[Ts]],!!(Ni&l));Ts--);for(var os=Mi+1;os<nt.length&&(Di=re[nt[os]],!!(Di&l));os++);Ni===Di&&(re[en]===T?Ni===C:Ni&(C|z))&&Se(en,Ni)}}if(ce.get(C))for(var ji=0;ji<nt.length;ji++){var $r=nt[ji];if(re[$r]&C){for(var ja=ji-1;ja>=0&&re[nt[ja]]&(Z|l);ja--)Se(nt[ja],C);for(ji++;ji<nt.length&&re[nt[ji]]&(Z|l|C);ji++)re[nt[ji]]!==C&&Se(nt[ji],C)}}if(ce.get(Z)||ce.get(T)||ce.get(B))for(var wa=0;wa<nt.length;wa++){var Lo=nt[wa];if(re[Lo]&(Z|T|B)){Se(Lo,J);for(var qa=wa-1;qa>=0&&re[nt[qa]]&l;qa--)Se(nt[qa],J);for(var Xa=wa+1;Xa<nt.length&&re[nt[Xa]]&l;Xa++)Se(nt[Xa],J)}}if(ce.get(C))for(var Yr=0,Ro=Bt;Yr<nt.length;Yr++){var Do=nt[Yr],$a=re[Do];$a&C?Ro===k&&Se(Do,k):$a&a&&(Ro=$a)}if(ce.get(r)){var Wn=U|C|z,jn=Wn|k,bn=[];{for(var tn=[],Ci=0;Ci<nt.length;Ci++)if(re[nt[Ci]]&r){var Si=qe[nt[Ci]],Zr=void 0;if(E(Si)!==null)if(tn.length<63)tn.push({char:Si,seqIndex:Ci});else break;else if((Zr=O(Si))!==null)for(var _a=tn.length-1;_a>=0;_a--){var ls=tn[_a].char;if(ls===Zr||ls===O(R(Si))||E(R(ls))===Si){bn.push([tn[_a].seqIndex,Ci]),tn.length=_a;break}}}bn.sort(function(Xi,pn){return Xi[0]-pn[0]})}for(var qn=0;qn<bn.length;qn++){for(var Ma=bn[qn],cs=Ma[0],Ya=Ma[1],xa=!1,fn=0,Sa=cs+1;Sa<Ya;Sa++){var Kr=nt[Sa];if(re[Kr]&jn){xa=!0;var js=re[Kr]&Wn?U:k;if(js===vi){fn=js;break}}}if(xa&&!fn){fn=Bt;for(var hs=cs-1;hs>=0;hs--){var qs=nt[hs];if(re[qs]&jn){var Xs=re[qs]&Wn?U:k;Xs!==vi?fn=Xs:fn=vi;break}}}if(fn){if(re[nt[cs]]=re[nt[Ya]]=fn,fn!==vi){for(var Aa=cs+1;Aa<nt.length;Aa++)if(!(re[nt[Aa]]&l)){f(qe[nt[Aa]])&ge&&(re[nt[Aa]]=fn);break}}if(fn!==vi){for(var $s=Ya+1;$s<nt.length;$s++)if(!(re[nt[$s]]&l)){f(qe[nt[$s]])&ge&&(re[nt[$s]]=fn);break}}}}for(var Pn=0;Pn<nt.length;Pn++)if(re[nt[Pn]]&r){for(var us=Pn,Za=Pn,Ka=Bt,Ys=Pn-1;Ys>=0;Ys--)if(re[nt[Ys]]&l)us=Ys;else{Ka=re[nt[Ys]]&Wn?U:k;break}for(var Qr=_i,ds=Pn+1;ds<nt.length;ds++)if(re[nt[ds]]&(r|l))Za=ds;else{Qr=re[nt[ds]]&Wn?U:k;break}for(var Qa=us;Qa<=Za;Qa++)re[nt[Qa]]=Ka===Qr?Ka:vi;Pn=Za}}}for(var qi=je.start;qi<=je.end;qi++){var Fo=Ge[qi],fs=re[qi];if(Fo&1?fs&(k|C|z)&&Ge[qi]++:fs&U?Ge[qi]++:fs&(z|C)&&(Ge[qi]+=2),fs&l&&(Ge[qi]=qi===0?je.level:Ge[qi-1]),qi===je.end||f(qe[qi])&(Y|V))for(var Xn=qi;Xn>=0&&f(qe[Xn])&c;Xn--)Ge[Xn]=je.level}}return{levels:Ge,paragraphs:Qe};function Jr(Xi,pn){for(var $i=Xi;$i<qe.length;$i++){var ci=re[$i];if(ci&(U|fe))return 1;if(ci&(V|k)||pn&&ci===Oe)return 0;if(ci&s){var Ja=oc($i);$i=Ja===-1?qe.length:Ja}}return 0}function oc(Xi){for(var pn=1,$i=Xi+1;$i<qe.length;$i++){var ci=re[$i];if(ci&V)break;if(ci&Oe){if(--pn===0)return $i}else ci&s&&pn++}return-1}}var le="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",ke;function Fe(){if(!ke){var qe=_(le,!0),X=qe.map,F=qe.reverseMap;F.forEach(function(re,Ie){X.set(Ie,re)}),ke=X}}function ht(qe){return Fe(),ke.get(qe)||null}function at(qe,X,F,re){var Ie=qe.length;F=Math.max(0,F==null?0:+F),re=Math.min(Ie-1,re==null?Ie-1:+re);for(var ce=new Map,Se=F;Se<=re;Se++)if(X[Se]&1){var Ge=ht(qe[Se]);Ge!==null&&ce.set(Se,Ge)}return ce}function Ke(qe,X,F,re){var Ie=qe.length;F=Math.max(0,F==null?0:+F),re=Math.min(Ie-1,re==null?Ie-1:+re);var ce=[];return X.paragraphs.forEach(function(Se){var Ge=Math.max(F,Se.start),$e=Math.min(re,Se.end);if(Ge<$e){for(var Qe=X.levels.slice(Ge,$e+1),je=$e;je>=Ge&&f(qe[je])&c;je--)Qe[je]=Se.level;for(var ze=Se.level,st=1/0,pt=0;pt<Qe.length;pt++){var dt=Qe[pt];dt>ze&&(ze=dt),dt<st&&(st=dt|1)}for(var rt=ze;rt>=st;rt--)for(var it=0;it<Qe.length;it++)if(Qe[it]>=rt){for(var mt=it;it+1<Qe.length&&Qe[it+1]>=rt;)it++;it>mt&&ce.push([mt+Ge,it+Ge])}}}),ce}function tt(qe,X,F,re){var Ie=lt(qe,X,F,re),ce=[].concat(qe);return Ie.forEach(function(Se,Ge){ce[Ge]=(X.levels[Se]&1?ht(qe[Se]):null)||qe[Se]}),ce.join("")}function lt(qe,X,F,re){for(var Ie=Ke(qe,X,F,re),ce=[],Se=0;Se<qe.length;Se++)ce[Se]=Se;return Ie.forEach(function(Ge){for(var $e=Ge[0],Qe=Ge[1],je=ce.slice($e,Qe+1),ze=je.length;ze--;)ce[Qe-ze]=je[ze]}),ce}return e.closingToOpeningBracket=O,e.getBidiCharType=f,e.getBidiCharTypeName=p,e.getCanonicalBracket=R,e.getEmbeddingLevels=Ze,e.getMirroredCharacter=ht,e.getMirroredCharactersMap=at,e.getReorderSegments=Ke,e.getReorderedIndices=lt,e.getReorderedString=tt,e.openingToClosingBracket=E,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return o}const vm=/\bvoid\s+main\s*\(\s*\)\s*{/g;function Lh(o){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(i,n){let s=jt[n];return s?Lh(s):i}return o.replace(e,t)}const Hi=[];for(let o=0;o<256;o++)Hi[o]=(o<16?"0":"")+o.toString(16);function cx(){const o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Hi[o&255]+Hi[o>>8&255]+Hi[o>>16&255]+Hi[o>>24&255]+"-"+Hi[e&255]+Hi[e>>8&255]+"-"+Hi[e>>16&15|64]+Hi[e>>24&255]+"-"+Hi[t&63|128]+Hi[t>>8&255]+"-"+Hi[t>>16&255]+Hi[t>>24&255]+Hi[i&255]+Hi[i>>8&255]+Hi[i>>16&255]+Hi[i>>24&255]).toUpperCase()}const Oa=Object.assign||function(){let o=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let i=arguments[e];if(i)for(let n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o[n]=i[n])}return o},hx=Date.now(),Rf=new WeakMap,Df=new Map;let ux=1e10;function Rh(o,e){const t=mx(e);let i=Rf.get(o);if(i||Rf.set(o,i=Object.create(null)),i[t])return new i[t];const n=`_onBeforeCompile${t}`,s=function(c,h){o.onBeforeCompile.call(this,c,h);const d=this.customProgramCacheKey()+"|"+c.vertexShader+"|"+c.fragmentShader;let f=Df[d];if(!f){const p=dx(this,c,e,t);f=Df[d]=p}c.vertexShader=f.vertexShader,c.fragmentShader=f.fragmentShader,Oa(c.uniforms,this.uniforms),e.timeUniform&&(c.uniforms[e.timeUniform]={get value(){return Date.now()-hx}}),this[n]&&this[n](c)},a=function(){return r(e.chained?o:o.clone())},r=function(c){const h=Object.create(c,l);return Object.defineProperty(h,"baseMaterial",{value:o}),Object.defineProperty(h,"id",{value:ux++}),h.uuid=cx(),h.uniforms=Oa({},c.uniforms,e.uniforms),h.defines=Oa({},c.defines,e.defines),h.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",h.extensions=Oa({},c.extensions,e.extensions),h._listeners=void 0,h},l={constructor:{value:a},isDerivedMaterial:{value:!0},type:{get:()=>o.type,set:c=>{o.type=c}},isDerivedFrom:{writable:!0,configurable:!0,value:function(c){const h=this.baseMaterial;return c===h||h.isDerivedMaterial&&h.isDerivedFrom(c)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return o.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(c){this[n]=c}},copy:{writable:!0,configurable:!0,value:function(c){return o.copy.call(this,c),!o.isShaderMaterial&&!o.isDerivedMaterial&&(Oa(this.extensions,c.extensions),Oa(this.defines,c.defines),Oa(this.uniforms,Jl.clone(c.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const c=new o.constructor;return r(c).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let c=this._depthMaterial;return c||(c=this._depthMaterial=Rh(o.isDerivedMaterial?o.getDepthMaterial():new Bp({depthPacking:bp}),e),c.defines.IS_DEPTH_MATERIAL="",c.uniforms=this.uniforms),c}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let c=this._distanceMaterial;return c||(c=this._distanceMaterial=Rh(o.isDerivedMaterial?o.getDistanceMaterial():new zp,e),c.defines.IS_DISTANCE_MATERIAL="",c.uniforms=this.uniforms),c}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:c,_distanceMaterial:h}=this;c&&c.dispose(),h&&h.dispose(),o.dispose.call(this)}}};return i[t]=a,new a}function dx(o,{vertexShader:e,fragmentShader:t},i,n){let{vertexDefs:s,vertexMainIntro:a,vertexMainOutro:r,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:h,fragmentMainOutro:d,fragmentColorTransform:f,customRewriter:p,timeUniform:b}=i;if(s=s||"",a=a||"",r=r||"",c=c||"",h=h||"",d=d||"",(l||p)&&(e=Lh(e)),(f||p)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=Lh(t)),p){let _=p({vertexShader:e,fragmentShader:t});e=_.vertexShader,t=_.fragmentShader}if(f){let _=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,y=>(_.push(y),"")),d=`${f}
${_.join(`
`)}
${d}`}if(b){const _=`
uniform float ${b};
`;s=_+s,c=_+c}return l&&(e=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${e}
`,s=`${s}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,a=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${a}
`,e=e.replace(/\b(position|normal|uv)\b/g,(_,y,v,S)=>/\battribute\s+vec[23]\s+$/.test(S.substr(0,v))?y:`troika_${y}_${n}`),o.map&&o.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),e=Ff(e,n,s,a,r),t=Ff(t,n,c,h,d),{vertexShader:e,fragmentShader:t}}function Ff(o,e,t,i,n){return(i||n||t)&&(o=o.replace(vm,`
${t}
void troikaOrigMain${e}() {`),o+=`
void main() {
  ${i}
  troikaOrigMain${e}();
  ${n}
}`),o}function fx(o,e){return o==="uniforms"?void 0:typeof e=="function"?e.toString():e}let px=0;const Of=new Map;function mx(o){const e=JSON.stringify(o,fx);let t=Of.get(e);return t==null&&Of.set(e,t=++px),t}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function gx(){return typeof window>"u"&&(self.window=self),function(o){var e={parse:function(n){var s=e._bin,a=new Uint8Array(n);if(s.readASCII(a,0,4)=="ttcf"){var r=4;s.readUshort(a,r),r+=2,s.readUshort(a,r),r+=2;var l=s.readUint(a,r);r+=4;for(var c=[],h=0;h<l;h++){var d=s.readUint(a,r);r+=4,c.push(e._readFont(a,d))}return c}return[e._readFont(a,0)]},_readFont:function(n,s){var a=e._bin,r=s;a.readFixed(n,s),s+=4;var l=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],h={_data:n,_offset:r},d={},f=0;f<l;f++){var p=a.readASCII(n,s,4);s+=4,a.readUint(n,s),s+=4;var b=a.readUint(n,s);s+=4;var _=a.readUint(n,s);s+=4,d[p]={offset:b,length:_}}for(f=0;f<c.length;f++){var y=c[f];d[y]&&(h[y.trim()]=e[y.trim()].parse(n,d[y].offset,d[y].length,h))}return h},_tabOffset:function(n,s,a){for(var r=e._bin,l=r.readUshort(n,a+4),c=a+12,h=0;h<l;h++){var d=r.readASCII(n,c,4);c+=4,r.readUint(n,c),c+=4;var f=r.readUint(n,c);if(c+=4,r.readUint(n,c),c+=4,d==s)return f}return 0}};e._bin={readFixed:function(n,s){return(n[s]<<8|n[s+1])+(n[s+2]<<8|n[s+3])/65540},readF2dot14:function(n,s){return e._bin.readShort(n,s)/16384},readInt:function(n,s){return e._bin._view(n).getInt32(s)},readInt8:function(n,s){return e._bin._view(n).getInt8(s)},readShort:function(n,s){return e._bin._view(n).getInt16(s)},readUshort:function(n,s){return e._bin._view(n).getUint16(s)},readUshorts:function(n,s,a){for(var r=[],l=0;l<a;l++)r.push(e._bin.readUshort(n,s+2*l));return r},readUint:function(n,s){return e._bin._view(n).getUint32(s)},readUint64:function(n,s){return 4294967296*e._bin.readUint(n,s)+e._bin.readUint(n,s+4)},readASCII:function(n,s,a){for(var r="",l=0;l<a;l++)r+=String.fromCharCode(n[s+l]);return r},readUnicode:function(n,s,a){for(var r="",l=0;l<a;l++){var c=n[s++]<<8|n[s++];r+=String.fromCharCode(c)}return r},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(n,s,a){var r=e._bin._tdec;return r&&s==0&&a==n.length?r.decode(n):e._bin.readASCII(n,s,a)},readBytes:function(n,s,a){for(var r=[],l=0;l<a;l++)r.push(n[s+l]);return r},readASCIIArray:function(n,s,a){for(var r=[],l=0;l<a;l++)r.push(String.fromCharCode(n[s+l]));return r},_view:function(n){return n._dataView||(n._dataView=n.buffer?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(new Uint8Array(n).buffer))}},e._lctf={},e._lctf.parse=function(n,s,a,r,l){var c=e._bin,h={},d=s;c.readFixed(n,s),s+=4;var f=c.readUshort(n,s);s+=2;var p=c.readUshort(n,s);s+=2;var b=c.readUshort(n,s);return s+=2,h.scriptList=e._lctf.readScriptList(n,d+f),h.featureList=e._lctf.readFeatureList(n,d+p),h.lookupList=e._lctf.readLookupList(n,d+b,l),h},e._lctf.readLookupList=function(n,s,a){var r=e._bin,l=s,c=[],h=r.readUshort(n,s);s+=2;for(var d=0;d<h;d++){var f=r.readUshort(n,s);s+=2;var p=e._lctf.readLookupTable(n,l+f,a);c.push(p)}return c},e._lctf.readLookupTable=function(n,s,a){var r=e._bin,l=s,c={tabs:[]};c.ltype=r.readUshort(n,s),s+=2,c.flag=r.readUshort(n,s),s+=2;var h=r.readUshort(n,s);s+=2;for(var d=c.ltype,f=0;f<h;f++){var p=r.readUshort(n,s);s+=2;var b=a(n,d,l+p,c);c.tabs.push(b)}return c},e._lctf.numOfOnes=function(n){for(var s=0,a=0;a<32;a++)n>>>a&1&&s++;return s},e._lctf.readClassDef=function(n,s){var a=e._bin,r=[],l=a.readUshort(n,s);if(s+=2,l==1){var c=a.readUshort(n,s);s+=2;var h=a.readUshort(n,s);s+=2;for(var d=0;d<h;d++)r.push(c+d),r.push(c+d),r.push(a.readUshort(n,s)),s+=2}if(l==2){var f=a.readUshort(n,s);for(s+=2,d=0;d<f;d++)r.push(a.readUshort(n,s)),s+=2,r.push(a.readUshort(n,s)),s+=2,r.push(a.readUshort(n,s)),s+=2}return r},e._lctf.getInterval=function(n,s){for(var a=0;a<n.length;a+=3){var r=n[a],l=n[a+1];if(n[a+2],r<=s&&s<=l)return a}return-1},e._lctf.readCoverage=function(n,s){var a=e._bin,r={};r.fmt=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);return s+=2,r.fmt==1&&(r.tab=a.readUshorts(n,s,l)),r.fmt==2&&(r.tab=a.readUshorts(n,s,3*l)),r},e._lctf.coverageIndex=function(n,s){var a=n.tab;if(n.fmt==1)return a.indexOf(s);if(n.fmt==2){var r=e._lctf.getInterval(a,s);if(r!=-1)return a[r+2]+(s-a[r])}return-1},e._lctf.readFeatureList=function(n,s){var a=e._bin,r=s,l=[],c=a.readUshort(n,s);s+=2;for(var h=0;h<c;h++){var d=a.readASCII(n,s,4);s+=4;var f=a.readUshort(n,s);s+=2;var p=e._lctf.readFeatureTable(n,r+f);p.tag=d.trim(),l.push(p)}return l},e._lctf.readFeatureTable=function(n,s){var a=e._bin,r=s,l={},c=a.readUshort(n,s);s+=2,c>0&&(l.featureParams=r+c);var h=a.readUshort(n,s);s+=2,l.tab=[];for(var d=0;d<h;d++)l.tab.push(a.readUshort(n,s+2*d));return l},e._lctf.readScriptList=function(n,s){var a=e._bin,r=s,l={},c=a.readUshort(n,s);s+=2;for(var h=0;h<c;h++){var d=a.readASCII(n,s,4);s+=4;var f=a.readUshort(n,s);s+=2,l[d.trim()]=e._lctf.readScriptTable(n,r+f)}return l},e._lctf.readScriptTable=function(n,s){var a=e._bin,r=s,l={},c=a.readUshort(n,s);s+=2,c>0&&(l.default=e._lctf.readLangSysTable(n,r+c));var h=a.readUshort(n,s);s+=2;for(var d=0;d<h;d++){var f=a.readASCII(n,s,4);s+=4;var p=a.readUshort(n,s);s+=2,l[f.trim()]=e._lctf.readLangSysTable(n,r+p)}return l},e._lctf.readLangSysTable=function(n,s){var a=e._bin,r={};a.readUshort(n,s),s+=2,r.reqFeature=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);return s+=2,r.features=a.readUshorts(n,s,l),r},e.CFF={},e.CFF.parse=function(n,s,a){var r=e._bin;(n=new Uint8Array(n.buffer,s,a))[s=0],n[++s],n[++s],n[++s],s++;var l=[];s=e.CFF.readIndex(n,s,l);for(var c=[],h=0;h<l.length-1;h++)c.push(r.readASCII(n,s+l[h],l[h+1]-l[h]));s+=l[l.length-1];var d=[];s=e.CFF.readIndex(n,s,d);var f=[];for(h=0;h<d.length-1;h++)f.push(e.CFF.readDict(n,s+d[h],s+d[h+1]));s+=d[d.length-1];var p=f[0],b=[];s=e.CFF.readIndex(n,s,b);var _=[];for(h=0;h<b.length-1;h++)_.push(r.readASCII(n,s+b[h],b[h+1]-b[h]));if(s+=b[b.length-1],e.CFF.readSubrs(n,s,p),p.CharStrings){s=p.CharStrings,b=[],s=e.CFF.readIndex(n,s,b);var y=[];for(h=0;h<b.length-1;h++)y.push(r.readBytes(n,s+b[h],b[h+1]-b[h]));p.CharStrings=y}if(p.ROS){s=p.FDArray;var v=[];for(s=e.CFF.readIndex(n,s,v),p.FDArray=[],h=0;h<v.length-1;h++){var S=e.CFF.readDict(n,s+v[h],s+v[h+1]);e.CFF._readFDict(n,S,_),p.FDArray.push(S)}s+=v[v.length-1],s=p.FDSelect,p.FDSelect=[];var A=n[s];if(s++,A!=3)throw A;var E=r.readUshort(n,s);for(s+=2,h=0;h<E+1;h++)p.FDSelect.push(r.readUshort(n,s),n[s+2]),s+=3}return p.Encoding&&(p.Encoding=e.CFF.readEncoding(n,p.Encoding,p.CharStrings.length)),p.charset&&(p.charset=e.CFF.readCharset(n,p.charset,p.CharStrings.length)),e.CFF._readFDict(n,p,_),p},e.CFF._readFDict=function(n,s,a){var r;for(var l in s.Private&&(r=s.Private[1],s.Private=e.CFF.readDict(n,r,r+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(n,r+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(l)!=-1&&(s[l]=a[s[l]-426+35])},e.CFF.readSubrs=function(n,s,a){var r=e._bin,l=[];s=e.CFF.readIndex(n,s,l);var c,h=l.length;c=h<1240?107:h<33900?1131:32768,a.Bias=c,a.Subrs=[];for(var d=0;d<l.length-1;d++)a.Subrs.push(r.readBytes(n,s+l[d],l[d+1]-l[d]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(n,s){for(var a=0;a<n.charset.length;a++)if(n.charset[a]==s)return a;return-1},e.CFF.glyphBySE=function(n,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(n,e.CFF.tableSE[s])},e.CFF.readEncoding=function(n,s,a){e._bin;var r=[".notdef"],l=n[s];if(s++,l!=0)throw"error: unknown encoding format: "+l;var c=n[s];s++;for(var h=0;h<c;h++)r.push(n[s+h]);return r},e.CFF.readCharset=function(n,s,a){var r=e._bin,l=[".notdef"],c=n[s];if(s++,c==0)for(var h=0;h<a;h++){var d=r.readUshort(n,s);s+=2,l.push(d)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;l.length<a;){d=r.readUshort(n,s),s+=2;var f=0;for(c==1?(f=n[s],s++):(f=r.readUshort(n,s),s+=2),h=0;h<=f;h++)l.push(d),d++}}return l},e.CFF.readIndex=function(n,s,a){var r=e._bin,l=r.readUshort(n,s)+1,c=n[s+=2];if(s++,c==1)for(var h=0;h<l;h++)a.push(n[s+h]);else if(c==2)for(h=0;h<l;h++)a.push(r.readUshort(n,s+2*h));else if(c==3)for(h=0;h<l;h++)a.push(16777215&r.readUint(n,s+3*h-1));else if(l!=1)throw"unsupported offset size: "+c+", count: "+l;return(s+=l*c)-1},e.CFF.getCharString=function(n,s,a){var r=e._bin,l=n[s],c=n[s+1];n[s+2],n[s+3],n[s+4];var h=1,d=null,f=null;l<=20&&(d=l,h=1),l==12&&(d=100*l+c,h=2),21<=l&&l<=27&&(d=l,h=1),l==28&&(f=r.readShort(n,s+1),h=3),29<=l&&l<=31&&(d=l,h=1),32<=l&&l<=246&&(f=l-139,h=1),247<=l&&l<=250&&(f=256*(l-247)+c+108,h=2),251<=l&&l<=254&&(f=256*-(l-251)-c-108,h=2),l==255&&(f=r.readInt(n,s+1)/65535,h=5),a.val=f??"o"+d,a.size=h},e.CFF.readCharString=function(n,s,a){for(var r=s+a,l=e._bin,c=[];s<r;){var h=n[s],d=n[s+1];n[s+2],n[s+3],n[s+4];var f=1,p=null,b=null;h<=20&&(p=h,f=1),h==12&&(p=100*h+d,f=2),h!=19&&h!=20||(p=h,f=2),21<=h&&h<=27&&(p=h,f=1),h==28&&(b=l.readShort(n,s+1),f=3),29<=h&&h<=31&&(p=h,f=1),32<=h&&h<=246&&(b=h-139,f=1),247<=h&&h<=250&&(b=256*(h-247)+d+108,f=2),251<=h&&h<=254&&(b=256*-(h-251)-d-108,f=2),h==255&&(b=l.readInt(n,s+1)/65535,f=5),c.push(b??"o"+p),s+=f}return c},e.CFF.readDict=function(n,s,a){for(var r=e._bin,l={},c=[];s<a;){var h=n[s],d=n[s+1];n[s+2],n[s+3],n[s+4];var f=1,p=null,b=null;if(h==28&&(b=r.readShort(n,s+1),f=3),h==29&&(b=r.readInt(n,s+1),f=5),32<=h&&h<=246&&(b=h-139,f=1),247<=h&&h<=250&&(b=256*(h-247)+d+108,f=2),251<=h&&h<=254&&(b=256*-(h-251)-d-108,f=2),h==255)throw b=r.readInt(n,s+1)/65535,f=5,"unknown number";if(h==30){var _=[];for(f=1;;){var y=n[s+f];f++;var v=y>>4,S=15&y;if(v!=15&&_.push(v),S!=15&&_.push(S),S==15)break}for(var A="",E=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],O=0;O<_.length;O++)A+=E[_[O]];b=parseFloat(A)}h<=21&&(p=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][h],f=1,h==12&&(p=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][d],f=2)),p!=null?(l[p]=c.length==1?c[0]:c,c=[]):c.push(b),s+=f}return l},e.cmap={},e.cmap.parse=function(n,s,a){n=new Uint8Array(n.buffer,s,a),s=0;var r=e._bin,l={};r.readUshort(n,s),s+=2;var c=r.readUshort(n,s);s+=2;var h=[];l.tables=[];for(var d=0;d<c;d++){var f=r.readUshort(n,s);s+=2;var p=r.readUshort(n,s);s+=2;var b=r.readUint(n,s);s+=4;var _="p"+f+"e"+p,y=h.indexOf(b);if(y==-1){var v;y=l.tables.length,h.push(b);var S=r.readUshort(n,b);S==0?v=e.cmap.parse0(n,b):S==4?v=e.cmap.parse4(n,b):S==6?v=e.cmap.parse6(n,b):S==12?v=e.cmap.parse12(n,b):console.debug("unknown format: "+S,f,p,b),l.tables.push(v)}if(l[_]!=null)throw"multiple tables for one platform+encoding";l[_]=y}return l},e.cmap.parse0=function(n,s){var a=e._bin,r={};r.format=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2,r.map=[];for(var c=0;c<l-6;c++)r.map.push(n[s+c]);return r},e.cmap.parse4=function(n,s){var a=e._bin,r=s,l={};l.format=a.readUshort(n,s),s+=2;var c=a.readUshort(n,s);s+=2,a.readUshort(n,s),s+=2;var h=a.readUshort(n,s);s+=2;var d=h/2;l.searchRange=a.readUshort(n,s),s+=2,l.entrySelector=a.readUshort(n,s),s+=2,l.rangeShift=a.readUshort(n,s),s+=2,l.endCount=a.readUshorts(n,s,d),s+=2*d,s+=2,l.startCount=a.readUshorts(n,s,d),s+=2*d,l.idDelta=[];for(var f=0;f<d;f++)l.idDelta.push(a.readShort(n,s)),s+=2;for(l.idRangeOffset=a.readUshorts(n,s,d),s+=2*d,l.glyphIdArray=[];s<r+c;)l.glyphIdArray.push(a.readUshort(n,s)),s+=2;return l},e.cmap.parse6=function(n,s){var a=e._bin,r={};r.format=a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,a.readUshort(n,s),s+=2,r.firstCode=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2,r.glyphIdArray=[];for(var c=0;c<l;c++)r.glyphIdArray.push(a.readUshort(n,s)),s+=2;return r},e.cmap.parse12=function(n,s){var a=e._bin,r={};r.format=a.readUshort(n,s),s+=2,s+=2,a.readUint(n,s),s+=4,a.readUint(n,s),s+=4;var l=a.readUint(n,s);s+=4,r.groups=[];for(var c=0;c<l;c++){var h=s+12*c,d=a.readUint(n,h+0),f=a.readUint(n,h+4),p=a.readUint(n,h+8);r.groups.push([d,f,p])}return r},e.glyf={},e.glyf.parse=function(n,s,a,r){for(var l=[],c=0;c<r.maxp.numGlyphs;c++)l.push(null);return l},e.glyf._parseGlyf=function(n,s){var a=e._bin,r=n._data,l=e._tabOffset(r,"glyf",n._offset)+n.loca[s];if(n.loca[s]==n.loca[s+1])return null;var c={};if(c.noc=a.readShort(r,l),l+=2,c.xMin=a.readShort(r,l),l+=2,c.yMin=a.readShort(r,l),l+=2,c.xMax=a.readShort(r,l),l+=2,c.yMax=a.readShort(r,l),l+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var h=0;h<c.noc;h++)c.endPts.push(a.readUshort(r,l)),l+=2;var d=a.readUshort(r,l);if(l+=2,r.length-l<d)return null;c.instructions=a.readBytes(r,l,d),l+=d;var f=c.endPts[c.noc-1]+1;for(c.flags=[],h=0;h<f;h++){var p=r[l];if(l++,c.flags.push(p),(8&p)!=0){var b=r[l];l++;for(var _=0;_<b;_++)c.flags.push(p),h++}}for(c.xs=[],h=0;h<f;h++){var y=(2&c.flags[h])!=0,v=(16&c.flags[h])!=0;y?(c.xs.push(v?r[l]:-r[l]),l++):v?c.xs.push(0):(c.xs.push(a.readShort(r,l)),l+=2)}for(c.ys=[],h=0;h<f;h++)y=(4&c.flags[h])!=0,v=(32&c.flags[h])!=0,y?(c.ys.push(v?r[l]:-r[l]),l++):v?c.ys.push(0):(c.ys.push(a.readShort(r,l)),l+=2);var S=0,A=0;for(h=0;h<f;h++)S+=c.xs[h],A+=c.ys[h],c.xs[h]=S,c.ys[h]=A}else{var E;c.parts=[];do{E=a.readUshort(r,l),l+=2;var O={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(O),O.glyphIndex=a.readUshort(r,l),l+=2,1&E){var R=a.readShort(r,l);l+=2;var k=a.readShort(r,l);l+=2}else R=a.readInt8(r,l),l++,k=a.readInt8(r,l),l++;2&E?(O.m.tx=R,O.m.ty=k):(O.p1=R,O.p2=k),8&E?(O.m.a=O.m.d=a.readF2dot14(r,l),l+=2):64&E?(O.m.a=a.readF2dot14(r,l),l+=2,O.m.d=a.readF2dot14(r,l),l+=2):128&E&&(O.m.a=a.readF2dot14(r,l),l+=2,O.m.b=a.readF2dot14(r,l),l+=2,O.m.c=a.readF2dot14(r,l),l+=2,O.m.d=a.readF2dot14(r,l),l+=2)}while(32&E);if(256&E){var U=a.readUshort(r,l);for(l+=2,c.instr=[],h=0;h<U;h++)c.instr.push(r[l]),l++}}return c},e.GDEF={},e.GDEF.parse=function(n,s,a,r){var l=s;s+=4;var c=e._bin.readUshort(n,s);return{glyphClassDef:c===0?null:e._lctf.readClassDef(n,l+c)}},e.GPOS={},e.GPOS.parse=function(n,s,a,r){return e._lctf.parse(n,s,a,r,e.GPOS.subt)},e.GPOS.subt=function(n,s,a,r){var l=e._bin,c=a,h={};if(h.fmt=l.readUshort(n,a),a+=2,s==1||s==2||s==3||s==7||s==8&&h.fmt<=2){var d=l.readUshort(n,a);a+=2,h.coverage=e._lctf.readCoverage(n,d+c)}if(s==1&&h.fmt==1){var f=l.readUshort(n,a);a+=2,f!=0&&(h.pos=e.GPOS.readValueRecord(n,a,f))}else if(s==2&&h.fmt>=1&&h.fmt<=2){f=l.readUshort(n,a),a+=2;var p=l.readUshort(n,a);a+=2;var b=e._lctf.numOfOnes(f),_=e._lctf.numOfOnes(p);if(h.fmt==1){h.pairsets=[];var y=l.readUshort(n,a);a+=2;for(var v=0;v<y;v++){var S=c+l.readUshort(n,a);a+=2;var A=l.readUshort(n,S);S+=2;for(var E=[],O=0;O<A;O++){var R=l.readUshort(n,S);S+=2,f!=0&&(z=e.GPOS.readValueRecord(n,S,f),S+=2*b),p!=0&&(B=e.GPOS.readValueRecord(n,S,p),S+=2*_),E.push({gid2:R,val1:z,val2:B})}h.pairsets.push(E)}}if(h.fmt==2){var k=l.readUshort(n,a);a+=2;var U=l.readUshort(n,a);a+=2;var C=l.readUshort(n,a);a+=2;var T=l.readUshort(n,a);for(a+=2,h.classDef1=e._lctf.readClassDef(n,c+k),h.classDef2=e._lctf.readClassDef(n,c+U),h.matrix=[],v=0;v<C;v++){var Z=[];for(O=0;O<T;O++){var z=null,B=null;f!=0&&(z=e.GPOS.readValueRecord(n,a,f),a+=2*b),p!=0&&(B=e.GPOS.readValueRecord(n,a,p),a+=2*_),Z.push({val1:z,val2:B})}h.matrix.push(Z)}}}else if(s==4&&h.fmt==1)h.markCoverage=e._lctf.readCoverage(n,l.readUshort(n,a)+c),h.baseCoverage=e._lctf.readCoverage(n,l.readUshort(n,a+2)+c),h.markClassCount=l.readUshort(n,a+4),h.markArray=e.GPOS.readMarkArray(n,l.readUshort(n,a+6)+c),h.baseArray=e.GPOS.readBaseArray(n,l.readUshort(n,a+8)+c,h.markClassCount);else if(s==6&&h.fmt==1)h.mark1Coverage=e._lctf.readCoverage(n,l.readUshort(n,a)+c),h.mark2Coverage=e._lctf.readCoverage(n,l.readUshort(n,a+2)+c),h.markClassCount=l.readUshort(n,a+4),h.mark1Array=e.GPOS.readMarkArray(n,l.readUshort(n,a+6)+c),h.mark2Array=e.GPOS.readBaseArray(n,l.readUshort(n,a+8)+c,h.markClassCount);else{if(s==9&&h.fmt==1){var V=l.readUshort(n,a);a+=2;var Y=l.readUint(n,a);if(a+=4,r.ltype==9)r.ltype=V;else if(r.ltype!=V)throw"invalid extension substitution";return e.GPOS.subt(n,r.ltype,c+Y)}console.debug("unsupported GPOS table LookupType",s,"format",h.fmt)}return h},e.GPOS.readValueRecord=function(n,s,a){var r=e._bin,l=[];return l.push(1&a?r.readShort(n,s):0),s+=1&a?2:0,l.push(2&a?r.readShort(n,s):0),s+=2&a?2:0,l.push(4&a?r.readShort(n,s):0),s+=4&a?2:0,l.push(8&a?r.readShort(n,s):0),s+=8&a?2:0,l},e.GPOS.readBaseArray=function(n,s,a){var r=e._bin,l=[],c=s,h=r.readUshort(n,s);s+=2;for(var d=0;d<h;d++){for(var f=[],p=0;p<a;p++)f.push(e.GPOS.readAnchorRecord(n,c+r.readUshort(n,s))),s+=2;l.push(f)}return l},e.GPOS.readMarkArray=function(n,s){var a=e._bin,r=[],l=s,c=a.readUshort(n,s);s+=2;for(var h=0;h<c;h++){var d=e.GPOS.readAnchorRecord(n,a.readUshort(n,s+2)+l);d.markClass=a.readUshort(n,s),r.push(d),s+=4}return r},e.GPOS.readAnchorRecord=function(n,s){var a=e._bin,r={};return r.fmt=a.readUshort(n,s),r.x=a.readShort(n,s+2),r.y=a.readShort(n,s+4),r},e.GSUB={},e.GSUB.parse=function(n,s,a,r){return e._lctf.parse(n,s,a,r,e.GSUB.subt)},e.GSUB.subt=function(n,s,a,r){var l=e._bin,c=a,h={};if(h.fmt=l.readUshort(n,a),a+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&h.fmt<=2||s==6&&h.fmt<=2){var d=l.readUshort(n,a);a+=2,h.coverage=e._lctf.readCoverage(n,c+d)}if(s==1&&h.fmt>=1&&h.fmt<=2){if(h.fmt==1)h.delta=l.readShort(n,a),a+=2;else if(h.fmt==2){var f=l.readUshort(n,a);a+=2,h.newg=l.readUshorts(n,a,f),a+=2*h.newg.length}}else if(s==2&&h.fmt==1){f=l.readUshort(n,a),a+=2,h.seqs=[];for(var p=0;p<f;p++){var b=l.readUshort(n,a)+c;a+=2;var _=l.readUshort(n,b);h.seqs.push(l.readUshorts(n,b+2,_))}}else if(s==4)for(h.vals=[],f=l.readUshort(n,a),a+=2,p=0;p<f;p++){var y=l.readUshort(n,a);a+=2,h.vals.push(e.GSUB.readLigatureSet(n,c+y))}else if(s==5&&h.fmt==2){if(h.fmt==2){var v=l.readUshort(n,a);a+=2,h.cDef=e._lctf.readClassDef(n,c+v),h.scset=[];var S=l.readUshort(n,a);for(a+=2,p=0;p<S;p++){var A=l.readUshort(n,a);a+=2,h.scset.push(A==0?null:e.GSUB.readSubClassSet(n,c+A))}}}else if(s==6&&h.fmt==3){if(h.fmt==3){for(p=0;p<3;p++){f=l.readUshort(n,a),a+=2;for(var E=[],O=0;O<f;O++)E.push(e._lctf.readCoverage(n,c+l.readUshort(n,a+2*O)));a+=2*f,p==0&&(h.backCvg=E),p==1&&(h.inptCvg=E),p==2&&(h.ahedCvg=E)}f=l.readUshort(n,a),a+=2,h.lookupRec=e.GSUB.readSubstLookupRecords(n,a,f)}}else{if(s==7&&h.fmt==1){var R=l.readUshort(n,a);a+=2;var k=l.readUint(n,a);if(a+=4,r.ltype==9)r.ltype=R;else if(r.ltype!=R)throw"invalid extension substitution";return e.GSUB.subt(n,r.ltype,c+k)}console.debug("unsupported GSUB table LookupType",s,"format",h.fmt)}return h},e.GSUB.readSubClassSet=function(n,s){var a=e._bin.readUshort,r=s,l=[],c=a(n,s);s+=2;for(var h=0;h<c;h++){var d=a(n,s);s+=2,l.push(e.GSUB.readSubClassRule(n,r+d))}return l},e.GSUB.readSubClassRule=function(n,s){var a=e._bin.readUshort,r={},l=a(n,s),c=a(n,s+=2);s+=2,r.input=[];for(var h=0;h<l-1;h++)r.input.push(a(n,s)),s+=2;return r.substLookupRecords=e.GSUB.readSubstLookupRecords(n,s,c),r},e.GSUB.readSubstLookupRecords=function(n,s,a){for(var r=e._bin.readUshort,l=[],c=0;c<a;c++)l.push(r(n,s),r(n,s+2)),s+=4;return l},e.GSUB.readChainSubClassSet=function(n,s){var a=e._bin,r=s,l=[],c=a.readUshort(n,s);s+=2;for(var h=0;h<c;h++){var d=a.readUshort(n,s);s+=2,l.push(e.GSUB.readChainSubClassRule(n,r+d))}return l},e.GSUB.readChainSubClassRule=function(n,s){for(var a=e._bin,r={},l=["backtrack","input","lookahead"],c=0;c<l.length;c++){var h=a.readUshort(n,s);s+=2,c==1&&h--,r[l[c]]=a.readUshorts(n,s,h),s+=2*r[l[c]].length}return h=a.readUshort(n,s),s+=2,r.subst=a.readUshorts(n,s,2*h),s+=2*r.subst.length,r},e.GSUB.readLigatureSet=function(n,s){var a=e._bin,r=s,l=[],c=a.readUshort(n,s);s+=2;for(var h=0;h<c;h++){var d=a.readUshort(n,s);s+=2,l.push(e.GSUB.readLigature(n,r+d))}return l},e.GSUB.readLigature=function(n,s){var a=e._bin,r={chain:[]};r.nglyph=a.readUshort(n,s),s+=2;var l=a.readUshort(n,s);s+=2;for(var c=0;c<l-1;c++)r.chain.push(a.readUshort(n,s)),s+=2;return r},e.head={},e.head.parse=function(n,s,a){var r=e._bin,l={};return r.readFixed(n,s),s+=4,l.fontRevision=r.readFixed(n,s),s+=4,r.readUint(n,s),s+=4,r.readUint(n,s),s+=4,l.flags=r.readUshort(n,s),s+=2,l.unitsPerEm=r.readUshort(n,s),s+=2,l.created=r.readUint64(n,s),s+=8,l.modified=r.readUint64(n,s),s+=8,l.xMin=r.readShort(n,s),s+=2,l.yMin=r.readShort(n,s),s+=2,l.xMax=r.readShort(n,s),s+=2,l.yMax=r.readShort(n,s),s+=2,l.macStyle=r.readUshort(n,s),s+=2,l.lowestRecPPEM=r.readUshort(n,s),s+=2,l.fontDirectionHint=r.readShort(n,s),s+=2,l.indexToLocFormat=r.readShort(n,s),s+=2,l.glyphDataFormat=r.readShort(n,s),s+=2,l},e.hhea={},e.hhea.parse=function(n,s,a){var r=e._bin,l={};return r.readFixed(n,s),s+=4,l.ascender=r.readShort(n,s),s+=2,l.descender=r.readShort(n,s),s+=2,l.lineGap=r.readShort(n,s),s+=2,l.advanceWidthMax=r.readUshort(n,s),s+=2,l.minLeftSideBearing=r.readShort(n,s),s+=2,l.minRightSideBearing=r.readShort(n,s),s+=2,l.xMaxExtent=r.readShort(n,s),s+=2,l.caretSlopeRise=r.readShort(n,s),s+=2,l.caretSlopeRun=r.readShort(n,s),s+=2,l.caretOffset=r.readShort(n,s),s+=2,s+=8,l.metricDataFormat=r.readShort(n,s),s+=2,l.numberOfHMetrics=r.readUshort(n,s),s+=2,l},e.hmtx={},e.hmtx.parse=function(n,s,a,r){for(var l=e._bin,c={aWidth:[],lsBearing:[]},h=0,d=0,f=0;f<r.maxp.numGlyphs;f++)f<r.hhea.numberOfHMetrics&&(h=l.readUshort(n,s),s+=2,d=l.readShort(n,s),s+=2),c.aWidth.push(h),c.lsBearing.push(d);return c},e.kern={},e.kern.parse=function(n,s,a,r){var l=e._bin,c=l.readUshort(n,s);if(s+=2,c==1)return e.kern.parseV1(n,s-2,a,r);var h=l.readUshort(n,s);s+=2;for(var d={glyph1:[],rval:[]},f=0;f<h;f++){s+=2,a=l.readUshort(n,s),s+=2;var p=l.readUshort(n,s);s+=2;var b=p>>>8;if((b&=15)!=0)throw"unknown kern table format: "+b;s=e.kern.readFormat0(n,s,d)}return d},e.kern.parseV1=function(n,s,a,r){var l=e._bin;l.readFixed(n,s),s+=4;var c=l.readUint(n,s);s+=4;for(var h={glyph1:[],rval:[]},d=0;d<c;d++){l.readUint(n,s),s+=4;var f=l.readUshort(n,s);s+=2,l.readUshort(n,s),s+=2;var p=f>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;s=e.kern.readFormat0(n,s,h)}return h},e.kern.readFormat0=function(n,s,a){var r=e._bin,l=-1,c=r.readUshort(n,s);s+=2,r.readUshort(n,s),s+=2,r.readUshort(n,s),s+=2,r.readUshort(n,s),s+=2;for(var h=0;h<c;h++){var d=r.readUshort(n,s);s+=2;var f=r.readUshort(n,s);s+=2;var p=r.readShort(n,s);s+=2,d!=l&&(a.glyph1.push(d),a.rval.push({glyph2:[],vals:[]}));var b=a.rval[a.rval.length-1];b.glyph2.push(f),b.vals.push(p),l=d}return s},e.loca={},e.loca.parse=function(n,s,a,r){var l=e._bin,c=[],h=r.head.indexToLocFormat,d=r.maxp.numGlyphs+1;if(h==0)for(var f=0;f<d;f++)c.push(l.readUshort(n,s+(f<<1))<<1);if(h==1)for(f=0;f<d;f++)c.push(l.readUint(n,s+(f<<2)));return c},e.maxp={},e.maxp.parse=function(n,s,a){var r=e._bin,l={},c=r.readUint(n,s);return s+=4,l.numGlyphs=r.readUshort(n,s),s+=2,c==65536&&(l.maxPoints=r.readUshort(n,s),s+=2,l.maxContours=r.readUshort(n,s),s+=2,l.maxCompositePoints=r.readUshort(n,s),s+=2,l.maxCompositeContours=r.readUshort(n,s),s+=2,l.maxZones=r.readUshort(n,s),s+=2,l.maxTwilightPoints=r.readUshort(n,s),s+=2,l.maxStorage=r.readUshort(n,s),s+=2,l.maxFunctionDefs=r.readUshort(n,s),s+=2,l.maxInstructionDefs=r.readUshort(n,s),s+=2,l.maxStackElements=r.readUshort(n,s),s+=2,l.maxSizeOfInstructions=r.readUshort(n,s),s+=2,l.maxComponentElements=r.readUshort(n,s),s+=2,l.maxComponentDepth=r.readUshort(n,s),s+=2),l},e.name={},e.name.parse=function(n,s,a){var r=e._bin,l={};r.readUshort(n,s),s+=2;var c=r.readUshort(n,s);s+=2,r.readUshort(n,s);for(var h,d=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=s+=2,p=0;p<c;p++){var b=r.readUshort(n,s);s+=2;var _=r.readUshort(n,s);s+=2;var y=r.readUshort(n,s);s+=2;var v=r.readUshort(n,s);s+=2;var S=r.readUshort(n,s);s+=2;var A=r.readUshort(n,s);s+=2;var E,O=d[v],R=f+12*c+A;if(b==0)E=r.readUnicode(n,R,S/2);else if(b==3&&_==0)E=r.readUnicode(n,R,S/2);else if(_==0)E=r.readASCII(n,R,S);else if(_==1)E=r.readUnicode(n,R,S/2);else if(_==3)E=r.readUnicode(n,R,S/2);else{if(b!=1)throw"unknown encoding "+_+", platformID: "+b;E=r.readASCII(n,R,S),console.debug("reading unknown MAC encoding "+_+" as ASCII")}var k="p"+b+","+y.toString(16);l[k]==null&&(l[k]={}),l[k][O!==void 0?O:v]=E,l[k]._lang=y}for(var U in l)if(l[U].postScriptName!=null&&l[U]._lang==1033)return l[U];for(var U in l)if(l[U].postScriptName!=null&&l[U]._lang==0)return l[U];for(var U in l)if(l[U].postScriptName!=null&&l[U]._lang==3084)return l[U];for(var U in l)if(l[U].postScriptName!=null)return l[U];for(var U in l){h=U;break}return console.debug("returning name table with languageID "+l[h]._lang),l[h]},e["OS/2"]={},e["OS/2"].parse=function(n,s,a){var r=e._bin.readUshort(n,s);s+=2;var l={};if(r==0)e["OS/2"].version0(n,s,l);else if(r==1)e["OS/2"].version1(n,s,l);else if(r==2||r==3||r==4)e["OS/2"].version2(n,s,l);else{if(r!=5)throw"unknown OS/2 table version: "+r;e["OS/2"].version5(n,s,l)}return l},e["OS/2"].version0=function(n,s,a){var r=e._bin;return a.xAvgCharWidth=r.readShort(n,s),s+=2,a.usWeightClass=r.readUshort(n,s),s+=2,a.usWidthClass=r.readUshort(n,s),s+=2,a.fsType=r.readUshort(n,s),s+=2,a.ySubscriptXSize=r.readShort(n,s),s+=2,a.ySubscriptYSize=r.readShort(n,s),s+=2,a.ySubscriptXOffset=r.readShort(n,s),s+=2,a.ySubscriptYOffset=r.readShort(n,s),s+=2,a.ySuperscriptXSize=r.readShort(n,s),s+=2,a.ySuperscriptYSize=r.readShort(n,s),s+=2,a.ySuperscriptXOffset=r.readShort(n,s),s+=2,a.ySuperscriptYOffset=r.readShort(n,s),s+=2,a.yStrikeoutSize=r.readShort(n,s),s+=2,a.yStrikeoutPosition=r.readShort(n,s),s+=2,a.sFamilyClass=r.readShort(n,s),s+=2,a.panose=r.readBytes(n,s,10),s+=10,a.ulUnicodeRange1=r.readUint(n,s),s+=4,a.ulUnicodeRange2=r.readUint(n,s),s+=4,a.ulUnicodeRange3=r.readUint(n,s),s+=4,a.ulUnicodeRange4=r.readUint(n,s),s+=4,a.achVendID=[r.readInt8(n,s),r.readInt8(n,s+1),r.readInt8(n,s+2),r.readInt8(n,s+3)],s+=4,a.fsSelection=r.readUshort(n,s),s+=2,a.usFirstCharIndex=r.readUshort(n,s),s+=2,a.usLastCharIndex=r.readUshort(n,s),s+=2,a.sTypoAscender=r.readShort(n,s),s+=2,a.sTypoDescender=r.readShort(n,s),s+=2,a.sTypoLineGap=r.readShort(n,s),s+=2,a.usWinAscent=r.readUshort(n,s),s+=2,a.usWinDescent=r.readUshort(n,s),s+=2},e["OS/2"].version1=function(n,s,a){var r=e._bin;return s=e["OS/2"].version0(n,s,a),a.ulCodePageRange1=r.readUint(n,s),s+=4,a.ulCodePageRange2=r.readUint(n,s),s+=4},e["OS/2"].version2=function(n,s,a){var r=e._bin;return s=e["OS/2"].version1(n,s,a),a.sxHeight=r.readShort(n,s),s+=2,a.sCapHeight=r.readShort(n,s),s+=2,a.usDefault=r.readUshort(n,s),s+=2,a.usBreak=r.readUshort(n,s),s+=2,a.usMaxContext=r.readUshort(n,s),s+=2},e["OS/2"].version5=function(n,s,a){var r=e._bin;return s=e["OS/2"].version2(n,s,a),a.usLowerOpticalPointSize=r.readUshort(n,s),s+=2,a.usUpperOpticalPointSize=r.readUshort(n,s),s+=2},e.post={},e.post.parse=function(n,s,a){var r=e._bin,l={};return l.version=r.readFixed(n,s),s+=4,l.italicAngle=r.readFixed(n,s),s+=4,l.underlinePosition=r.readShort(n,s),s+=2,l.underlineThickness=r.readShort(n,s),s+=2,l},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(n,s){var a=n.cmap,r=-1;if(a.p0e4!=null?r=a.p0e4:a.p3e1!=null?r=a.p3e1:a.p1e0!=null?r=a.p1e0:a.p0e3!=null&&(r=a.p0e3),r==-1)throw"no familiar platform and encoding!";var l=a.tables[r];if(l.format==0)return s>=l.map.length?0:l.map[s];if(l.format==4){for(var c=-1,h=0;h<l.endCount.length;h++)if(s<=l.endCount[h]){c=h;break}return c==-1||l.startCount[c]>s?0:65535&(l.idRangeOffset[c]!=0?l.glyphIdArray[s-l.startCount[c]+(l.idRangeOffset[c]>>1)-(l.idRangeOffset.length-c)]:s+l.idDelta[c])}if(l.format==12){if(s>l.groups[l.groups.length-1][1])return 0;for(h=0;h<l.groups.length;h++){var d=l.groups[h];if(d[0]<=s&&s<=d[1])return d[2]+(s-d[0])}return 0}throw"unknown cmap table format "+l.format},e.U.glyphToPath=function(n,s){var a={cmds:[],crds:[]};if(n.SVG&&n.SVG.entries[s]){var r=n.SVG.entries[s];return r==null?a:(typeof r=="string"&&(r=e.SVG.toPath(r),n.SVG.entries[s]=r),r)}if(n.CFF){var l={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:n.CFF.Private?n.CFF.Private.defaultWidthX:0,open:!1},c=n.CFF,h=n.CFF.Private;if(c.ROS){for(var d=0;c.FDSelect[d+2]<=s;)d+=2;h=c.FDArray[c.FDSelect[d+1]].Private}e.U._drawCFF(n.CFF.CharStrings[s],l,c,h,a)}else n.glyf&&e.U._drawGlyf(s,n,a);return a},e.U._drawGlyf=function(n,s,a){var r=s.glyf[n];r==null&&(r=s.glyf[n]=e.glyf._parseGlyf(s,n)),r!=null&&(r.noc>-1?e.U._simpleGlyph(r,a):e.U._compoGlyph(r,s,a))},e.U._simpleGlyph=function(n,s){for(var a=0;a<n.noc;a++){for(var r=a==0?0:n.endPts[a-1]+1,l=n.endPts[a],c=r;c<=l;c++){var h=c==r?l:c-1,d=c==l?r:c+1,f=1&n.flags[c],p=1&n.flags[h],b=1&n.flags[d],_=n.xs[c],y=n.ys[c];if(c==r)if(f){if(!p){e.U.P.moveTo(s,_,y);continue}e.U.P.moveTo(s,n.xs[h],n.ys[h])}else p?e.U.P.moveTo(s,n.xs[h],n.ys[h]):e.U.P.moveTo(s,(n.xs[h]+_)/2,(n.ys[h]+y)/2);f?p&&e.U.P.lineTo(s,_,y):b?e.U.P.qcurveTo(s,_,y,n.xs[d],n.ys[d]):e.U.P.qcurveTo(s,_,y,(_+n.xs[d])/2,(y+n.ys[d])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(n,s,a){for(var r=0;r<n.parts.length;r++){var l={cmds:[],crds:[]},c=n.parts[r];e.U._drawGlyf(c.glyphIndex,s,l);for(var h=c.m,d=0;d<l.crds.length;d+=2){var f=l.crds[d],p=l.crds[d+1];a.crds.push(f*h.a+p*h.b+h.tx),a.crds.push(f*h.c+p*h.d+h.ty)}for(d=0;d<l.cmds.length;d++)a.cmds.push(l.cmds[d])}},e.U._getGlyphClass=function(n,s){var a=e._lctf.getInterval(s,n);return a==-1?0:s[a+2]},e.U._applySubs=function(n,s,a,r){for(var l=n.length-s-1,c=0;c<a.tabs.length;c++)if(a.tabs[c]!=null){var h,d=a.tabs[c];if(!d.coverage||(h=e._lctf.coverageIndex(d.coverage,n[s]))!=-1){if(a.ltype==1)n[s],d.fmt==1?n[s]=n[s]+d.delta:n[s]=d.newg[h];else if(a.ltype==4)for(var f=d.vals[h],p=0;p<f.length;p++){var b=f[p],_=b.chain.length;if(!(_>l)){for(var y=!0,v=0,S=0;S<_;S++){for(;n[s+v+(1+S)]==-1;)v++;b.chain[S]!=n[s+v+(1+S)]&&(y=!1)}if(y){for(n[s]=b.nglyph,S=0;S<_+v;S++)n[s+S+1]=-1;break}}}else if(a.ltype==5&&d.fmt==2)for(var A=e._lctf.getInterval(d.cDef,n[s]),E=d.cDef[A+2],O=d.scset[E],R=0;R<O.length;R++){var k=O[R],U=k.input;if(!(U.length>l)){for(y=!0,S=0;S<U.length;S++){var C=e._lctf.getInterval(d.cDef,n[s+1+S]);if(A==-1&&d.cDef[C+2]!=U[S]){y=!1;break}}if(y){var T=k.substLookupRecords;for(p=0;p<T.length;p+=2)T[p],T[p+1]}}}else if(a.ltype==6&&d.fmt==3){if(!e.U._glsCovered(n,d.backCvg,s-d.backCvg.length)||!e.U._glsCovered(n,d.inptCvg,s)||!e.U._glsCovered(n,d.ahedCvg,s+d.inptCvg.length))continue;var Z=d.lookupRec;for(R=0;R<Z.length;R+=2){A=Z[R];var z=r[Z[R+1]];e.U._applySubs(n,s+A,z,r)}}}}},e.U._glsCovered=function(n,s,a){for(var r=0;r<s.length;r++)if(e._lctf.coverageIndex(s[r],n[a+r])==-1)return!1;return!0},e.U.glyphsToPath=function(n,s,a){for(var r={cmds:[],crds:[]},l=0,c=0;c<s.length;c++){var h=s[c];if(h!=-1){for(var d=c<s.length-1&&s[c+1]!=-1?s[c+1]:0,f=e.U.glyphToPath(n,h),p=0;p<f.crds.length;p+=2)r.crds.push(f.crds[p]+l),r.crds.push(f.crds[p+1]);for(a&&r.cmds.push(a),p=0;p<f.cmds.length;p++)r.cmds.push(f.cmds[p]);a&&r.cmds.push("X"),l+=n.hmtx.aWidth[h],c<s.length-1&&(l+=e.U.getPairAdjustment(n,h,d))}}return r},e.U.P={},e.U.P.moveTo=function(n,s,a){n.cmds.push("M"),n.crds.push(s,a)},e.U.P.lineTo=function(n,s,a){n.cmds.push("L"),n.crds.push(s,a)},e.U.P.curveTo=function(n,s,a,r,l,c,h){n.cmds.push("C"),n.crds.push(s,a,r,l,c,h)},e.U.P.qcurveTo=function(n,s,a,r,l){n.cmds.push("Q"),n.crds.push(s,a,r,l)},e.U.P.closePath=function(n){n.cmds.push("Z")},e.U._drawCFF=function(n,s,a,r,l){for(var c=s.stack,h=s.nStems,d=s.haveWidth,f=s.width,p=s.open,b=0,_=s.x,y=s.y,v=0,S=0,A=0,E=0,O=0,R=0,k=0,U=0,C=0,T=0,Z={val:0,size:0};b<n.length;){e.CFF.getCharString(n,b,Z);var z=Z.val;if(b+=Z.size,z=="o1"||z=="o18")c.length%2!=0&&!d&&(f=c.shift()+r.nominalWidthX),h+=c.length>>1,c.length=0,d=!0;else if(z=="o3"||z=="o23")c.length%2!=0&&!d&&(f=c.shift()+r.nominalWidthX),h+=c.length>>1,c.length=0,d=!0;else if(z=="o4")c.length>1&&!d&&(f=c.shift()+r.nominalWidthX,d=!0),p&&e.U.P.closePath(l),y+=c.pop(),e.U.P.moveTo(l,_,y),p=!0;else if(z=="o5")for(;c.length>0;)_+=c.shift(),y+=c.shift(),e.U.P.lineTo(l,_,y);else if(z=="o6"||z=="o7")for(var B=c.length,V=z=="o6",Y=0;Y<B;Y++){var J=c.shift();V?_+=J:y+=J,V=!V,e.U.P.lineTo(l,_,y)}else if(z=="o8"||z=="o24"){B=c.length;for(var Te=0;Te+6<=B;)v=_+c.shift(),S=y+c.shift(),A=v+c.shift(),E=S+c.shift(),_=A+c.shift(),y=E+c.shift(),e.U.P.curveTo(l,v,S,A,E,_,y),Te+=6;z=="o24"&&(_+=c.shift(),y+=c.shift(),e.U.P.lineTo(l,_,y))}else{if(z=="o11")break;if(z=="o1234"||z=="o1235"||z=="o1236"||z=="o1237")z=="o1234"&&(S=y,A=(v=_+c.shift())+c.shift(),T=E=S+c.shift(),R=E,U=y,_=(k=(O=(C=A+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(l,v,S,A,E,C,T),e.U.P.curveTo(l,O,R,k,U,_,y)),z=="o1235"&&(v=_+c.shift(),S=y+c.shift(),A=v+c.shift(),E=S+c.shift(),C=A+c.shift(),T=E+c.shift(),O=C+c.shift(),R=T+c.shift(),k=O+c.shift(),U=R+c.shift(),_=k+c.shift(),y=U+c.shift(),c.shift(),e.U.P.curveTo(l,v,S,A,E,C,T),e.U.P.curveTo(l,O,R,k,U,_,y)),z=="o1236"&&(v=_+c.shift(),S=y+c.shift(),A=v+c.shift(),T=E=S+c.shift(),R=E,k=(O=(C=A+c.shift())+c.shift())+c.shift(),U=R+c.shift(),_=k+c.shift(),e.U.P.curveTo(l,v,S,A,E,C,T),e.U.P.curveTo(l,O,R,k,U,_,y)),z=="o1237"&&(v=_+c.shift(),S=y+c.shift(),A=v+c.shift(),E=S+c.shift(),C=A+c.shift(),T=E+c.shift(),O=C+c.shift(),R=T+c.shift(),k=O+c.shift(),U=R+c.shift(),Math.abs(k-_)>Math.abs(U-y)?_=k+c.shift():y=U+c.shift(),e.U.P.curveTo(l,v,S,A,E,C,T),e.U.P.curveTo(l,O,R,k,U,_,y));else if(z=="o14"){if(c.length>0&&!d&&(f=c.shift()+a.nominalWidthX,d=!0),c.length==4){var ge=c.shift(),fe=c.shift(),he=c.shift(),Q=c.shift(),pe=e.CFF.glyphBySE(a,he),ve=e.CFF.glyphBySE(a,Q);e.U._drawCFF(a.CharStrings[pe],s,a,r,l),s.x=ge,s.y=fe,e.U._drawCFF(a.CharStrings[ve],s,a,r,l)}p&&(e.U.P.closePath(l),p=!1)}else if(z=="o19"||z=="o20")c.length%2!=0&&!d&&(f=c.shift()+r.nominalWidthX),h+=c.length>>1,c.length=0,d=!0,b+=h+7>>3;else if(z=="o21")c.length>2&&!d&&(f=c.shift()+r.nominalWidthX,d=!0),y+=c.pop(),_+=c.pop(),p&&e.U.P.closePath(l),e.U.P.moveTo(l,_,y),p=!0;else if(z=="o22")c.length>1&&!d&&(f=c.shift()+r.nominalWidthX,d=!0),_+=c.pop(),p&&e.U.P.closePath(l),e.U.P.moveTo(l,_,y),p=!0;else if(z=="o25"){for(;c.length>6;)_+=c.shift(),y+=c.shift(),e.U.P.lineTo(l,_,y);v=_+c.shift(),S=y+c.shift(),A=v+c.shift(),E=S+c.shift(),_=A+c.shift(),y=E+c.shift(),e.U.P.curveTo(l,v,S,A,E,_,y)}else if(z=="o26")for(c.length%2&&(_+=c.shift());c.length>0;)v=_,S=y+c.shift(),_=A=v+c.shift(),y=(E=S+c.shift())+c.shift(),e.U.P.curveTo(l,v,S,A,E,_,y);else if(z=="o27")for(c.length%2&&(y+=c.shift());c.length>0;)S=y,A=(v=_+c.shift())+c.shift(),E=S+c.shift(),_=A+c.shift(),y=E,e.U.P.curveTo(l,v,S,A,E,_,y);else if(z=="o10"||z=="o29"){var K=z=="o10"?r:a;if(c.length==0)console.debug("error: empty stack");else{var se=c.pop(),Ee=K.Subrs[se+K.Bias];s.x=_,s.y=y,s.nStems=h,s.haveWidth=d,s.width=f,s.open=p,e.U._drawCFF(Ee,s,a,r,l),_=s.x,y=s.y,h=s.nStems,d=s.haveWidth,f=s.width,p=s.open}}else if(z=="o30"||z=="o31"){var me=c.length,Oe=(Te=0,z=="o31");for(Te+=me-(B=-3&me);Te<B;)Oe?(S=y,A=(v=_+c.shift())+c.shift(),y=(E=S+c.shift())+c.shift(),B-Te==5?(_=A+c.shift(),Te++):_=A,Oe=!1):(v=_,S=y+c.shift(),A=v+c.shift(),E=S+c.shift(),_=A+c.shift(),B-Te==5?(y=E+c.shift(),Te++):y=E,Oe=!0),e.U.P.curveTo(l,v,S,A,E,_,y),Te+=4}else{if((z+"").charAt(0)=="o")throw console.debug("Unknown operation: "+z,n),z;c.push(z)}}}s.x=_,s.y=y,s.nStems=h,s.haveWidth=d,s.width=f,s.open=p};var t=e,i={Typr:t};return o.Typr=t,o.default=i,Object.defineProperty(o,"__esModule",{value:!0}),o}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function yx(){return function(o){var e=Uint8Array,t=Uint16Array,i=Uint32Array,n=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=function(z,B){for(var V=new t(31),Y=0;Y<31;++Y)V[Y]=B+=1<<z[Y-1];var J=new i(V[30]);for(Y=1;Y<30;++Y)for(var Te=V[Y];Te<V[Y+1];++Te)J[Te]=Te-V[Y]<<5|Y;return[V,J]},l=r(n,2),c=l[0],h=l[1];c[28]=258,h[258]=28;for(var d=r(s,0)[0],f=new t(32768),p=0;p<32768;++p){var b=(43690&p)>>>1|(21845&p)<<1;b=(61680&(b=(52428&b)>>>2|(13107&b)<<2))>>>4|(3855&b)<<4,f[p]=((65280&b)>>>8|(255&b)<<8)>>>1}var _=function(z,B,V){for(var Y=z.length,J=0,Te=new t(B);J<Y;++J)++Te[z[J]-1];var ge,fe=new t(B);for(J=0;J<B;++J)fe[J]=fe[J-1]+Te[J-1]<<1;{ge=new t(1<<B);var he=15-B;for(J=0;J<Y;++J)if(z[J])for(var Q=J<<4|z[J],pe=B-z[J],ve=fe[z[J]-1]++<<pe,K=ve|(1<<pe)-1;ve<=K;++ve)ge[f[ve]>>>he]=Q}return ge},y=new e(288);for(p=0;p<144;++p)y[p]=8;for(p=144;p<256;++p)y[p]=9;for(p=256;p<280;++p)y[p]=7;for(p=280;p<288;++p)y[p]=8;var v=new e(32);for(p=0;p<32;++p)v[p]=5;var S=_(y,9),A=_(v,5),E=function(z){for(var B=z[0],V=1;V<z.length;++V)z[V]>B&&(B=z[V]);return B},O=function(z,B,V){var Y=B/8|0;return(z[Y]|z[Y+1]<<8)>>(7&B)&V},R=function(z,B){var V=B/8|0;return(z[V]|z[V+1]<<8|z[V+2]<<16)>>(7&B)},k=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],U=function(z,B,V){var Y=new Error(B||k[z]);if(Y.code=z,Error.captureStackTrace&&Error.captureStackTrace(Y,U),!V)throw Y;return Y},C=function(z,B,V){var Y=z.length;if(!Y||V&&!V.l&&Y<5)return B||new e(0);var J=!B||V,Te=!V||V.i;V||(V={}),B||(B=new e(3*Y));var ge,fe=function(mt){var Mt=B.length;if(mt>Mt){var wt=new e(Math.max(2*Mt,mt));wt.set(B),B=wt}},he=V.f||0,Q=V.p||0,pe=V.b||0,ve=V.l,K=V.d,se=V.m,Ee=V.n,me=8*Y;do{if(!ve){V.f=he=O(z,Q,1);var Oe=O(z,Q+1,3);if(Q+=3,!Oe){var Ze=z[(F=((ge=Q)/8|0)+(7&ge&&1)+4)-4]|z[F-3]<<8,le=F+Ze;if(le>Y){Te&&U(0);break}J&&fe(pe+Ze),B.set(z.subarray(F,le),pe),V.b=pe+=Ze,V.p=Q=8*le;continue}if(Oe==1)ve=S,K=A,se=9,Ee=5;else if(Oe==2){var ke=O(z,Q,31)+257,Fe=O(z,Q+10,15)+4,ht=ke+O(z,Q+5,31)+1;Q+=14;for(var at=new e(ht),Ke=new e(19),tt=0;tt<Fe;++tt)Ke[a[tt]]=O(z,Q+3*tt,7);Q+=3*Fe;var lt=E(Ke),qe=(1<<lt)-1,X=_(Ke,lt);for(tt=0;tt<ht;){var F,re=X[O(z,Q,qe)];if(Q+=15&re,(F=re>>>4)<16)at[tt++]=F;else{var Ie=0,ce=0;for(F==16?(ce=3+O(z,Q,3),Q+=2,Ie=at[tt-1]):F==17?(ce=3+O(z,Q,7),Q+=3):F==18&&(ce=11+O(z,Q,127),Q+=7);ce--;)at[tt++]=Ie}}var Se=at.subarray(0,ke),Ge=at.subarray(ke);se=E(Se),Ee=E(Ge),ve=_(Se,se),K=_(Ge,Ee)}else U(1);if(Q>me){Te&&U(0);break}}J&&fe(pe+131072);for(var $e=(1<<se)-1,Qe=(1<<Ee)-1,je=Q;;je=Q){var ze=(Ie=ve[R(z,Q)&$e])>>>4;if((Q+=15&Ie)>me){Te&&U(0);break}if(Ie||U(2),ze<256)B[pe++]=ze;else{if(ze==256){je=Q,ve=null;break}var st=ze-254;if(ze>264){var pt=n[tt=ze-257];st=O(z,Q,(1<<pt)-1)+c[tt],Q+=pt}var dt=K[R(z,Q)&Qe],rt=dt>>>4;if(dt||U(3),Q+=15&dt,Ge=d[rt],rt>3&&(pt=s[rt],Ge+=R(z,Q)&(1<<pt)-1,Q+=pt),Q>me){Te&&U(0);break}J&&fe(pe+131072);for(var it=pe+st;pe<it;pe+=4)B[pe]=B[pe-Ge],B[pe+1]=B[pe+1-Ge],B[pe+2]=B[pe+2-Ge],B[pe+3]=B[pe+3-Ge];pe=it}}V.l=ve,V.p=je,V.b=pe,ve&&(he=1,V.m=se,V.d=K,V.n=Ee)}while(!he);return pe==B.length?B:function(mt,Mt,wt){(wt==null||wt>mt.length)&&(wt=mt.length);var L=new(mt instanceof t?t:mt instanceof i?i:e)(wt-Mt);return L.set(mt.subarray(Mt,wt)),L}(B,0,pe)},T=new e(0),Z=typeof TextDecoder<"u"&&new TextDecoder;try{Z.decode(T,{stream:!0})}catch{}return o.convert_streams=function(z){var B=new DataView(z),V=0;function Y(){var ke=B.getUint16(V);return V+=2,ke}function J(){var ke=B.getUint32(V);return V+=4,ke}function Te(ke){Ze.setUint16(le,ke),le+=2}function ge(ke){Ze.setUint32(le,ke),le+=4}for(var fe={signature:J(),flavor:J(),length:J(),numTables:Y(),reserved:Y(),totalSfntSize:J(),majorVersion:Y(),minorVersion:Y(),metaOffset:J(),metaLength:J(),metaOrigLength:J(),privOffset:J(),privLength:J()},he=0;Math.pow(2,he)<=fe.numTables;)he++;he--;for(var Q=16*Math.pow(2,he),pe=16*fe.numTables-Q,ve=12,K=[],se=0;se<fe.numTables;se++)K.push({tag:J(),offset:J(),compLength:J(),origLength:J(),origChecksum:J()}),ve+=16;var Ee,me=new Uint8Array(12+16*K.length+K.reduce(function(ke,Fe){return ke+Fe.origLength+4},0)),Oe=me.buffer,Ze=new DataView(Oe),le=0;return ge(fe.flavor),Te(fe.numTables),Te(Q),Te(he),Te(pe),K.forEach(function(ke){ge(ke.tag),ge(ke.origChecksum),ge(ve),ge(ke.origLength),ke.outOffset=ve,(ve+=ke.origLength)%4!=0&&(ve+=4-ve%4)}),K.forEach(function(ke){var Fe,ht=z.slice(ke.offset,ke.offset+ke.compLength);if(ke.compLength!=ke.origLength){var at=new Uint8Array(ke.origLength);Fe=new Uint8Array(ht,2),C(Fe,at)}else at=new Uint8Array(ht);me.set(at,ke.outOffset);var Ke=0;(ve=ke.outOffset+ke.origLength)%4!=0&&(Ke=4-ve%4),me.set(new Uint8Array(Ke).buffer,ke.outOffset+ke.origLength),Ee=ve+Ke}),Oe.slice(0,Ee)},Object.defineProperty(o,"__esModule",{value:!0}),o}({}).convert_streams}function vx(o,e){const t={M:2,L:2,Q:4,C:6,Z:0},i={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},n=1,s=2,a=4,r=8,l=16,c=32;let h;function d(k){if(!h){const U={R:s,L:n,D:a,C:l,U:c,T:r};h=new Map;for(let C in i){let T=0;i[C].split(",").forEach(Z=>{let[z,B]=Z.split("+");z=parseInt(z,36),B=B?parseInt(B,36):0,h.set(T+=z,U[C]);for(let V=B;V--;)h.set(++T,U[C])})}}return h.get(k)||c}const f=1,p=2,b=3,_=4,y=[null,"isol","init","fina","medi"];function v(k){const U=new Uint8Array(k.length);let C=c,T=f,Z=-1;for(let z=0;z<k.length;z++){const B=k.codePointAt(z);let V=d(B)|0,Y=f;V&r||(C&(n|a|l)?V&(s|a|l)?(Y=b,(T===f||T===b)&&U[Z]++):V&(n|c)&&(T===p||T===_)&&U[Z]--:C&(s|c)&&(T===p||T===_)&&U[Z]--,T=U[z]=Y,C=V,Z=z,B>65535&&z++)}return U}function S(k,U){const C=[];for(let Z=0;Z<U.length;Z++){const z=U.codePointAt(Z);z>65535&&Z++,C.push(o.U.codeToGlyph(k,z))}const T=k.GSUB;if(T){const{lookupList:Z,featureList:z}=T;let B;const V=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,Y=[];z.forEach(J=>{if(V.test(J.tag))for(let Te=0;Te<J.tab.length;Te++){if(Y[J.tab[Te]])continue;Y[J.tab[Te]]=!0;const ge=Z[J.tab[Te]],fe=/^(isol|init|fina|medi)$/.test(J.tag);fe&&!B&&(B=v(U));for(let he=0;he<C.length;he++)(!B||!fe||y[B[he]]===J.tag)&&o.U._applySubs(C,he,ge,Z)}})}return C}function A(k,U){const C=new Int16Array(U.length*3);let T=0;for(;T<U.length;T++){const V=U[T];if(V===-1)continue;C[T*3+2]=k.hmtx.aWidth[V];const Y=k.GPOS;if(Y){const J=Y.lookupList;for(let Te=0;Te<J.length;Te++){const ge=J[Te];for(let fe=0;fe<ge.tabs.length;fe++){const he=ge.tabs[fe];if(ge.ltype===1){if(o._lctf.coverageIndex(he.coverage,V)!==-1&&he.pos){B(he.pos,T);break}}else if(ge.ltype===2){let Q=null,pe=Z();if(pe!==-1){const ve=o._lctf.coverageIndex(he.coverage,U[pe]);if(ve!==-1){if(he.fmt===1){const K=he.pairsets[ve];for(let se=0;se<K.length;se++)K[se].gid2===V&&(Q=K[se])}else if(he.fmt===2){const K=o.U._getGlyphClass(U[pe],he.classDef1),se=o.U._getGlyphClass(V,he.classDef2);Q=he.matrix[K][se]}if(Q){Q.val1&&B(Q.val1,pe),Q.val2&&B(Q.val2,T);break}}}}else if(ge.ltype===4){const Q=o._lctf.coverageIndex(he.markCoverage,V);if(Q!==-1){const pe=Z(z),ve=pe===-1?-1:o._lctf.coverageIndex(he.baseCoverage,U[pe]);if(ve!==-1){const K=he.markArray[Q],se=he.baseArray[ve][K.markClass];C[T*3]=se.x-K.x+C[pe*3]-C[pe*3+2],C[T*3+1]=se.y-K.y+C[pe*3+1];break}}}else if(ge.ltype===6){const Q=o._lctf.coverageIndex(he.mark1Coverage,V);if(Q!==-1){const pe=Z();if(pe!==-1){const ve=U[pe];if(E(k,ve)===3){const K=o._lctf.coverageIndex(he.mark2Coverage,ve);if(K!==-1){const se=he.mark1Array[Q],Ee=he.mark2Array[K][se.markClass];C[T*3]=Ee.x-se.x+C[pe*3]-C[pe*3+2],C[T*3+1]=Ee.y-se.y+C[pe*3+1];break}}}}}}}}else if(k.kern&&!k.cff){const J=Z();if(J!==-1){const Te=k.kern.glyph1.indexOf(U[J]);if(Te!==-1){const ge=k.kern.rval[Te].glyph2.indexOf(V);ge!==-1&&(C[J*3+2]+=k.kern.rval[Te].vals[ge])}}}}return C;function Z(V){for(let Y=T-1;Y>=0;Y--)if(U[Y]!==-1&&(!V||V(U[Y])))return Y;return-1}function z(V){return E(k,V)===1}function B(V,Y){for(let J=0;J<3;J++)C[Y*3+J]+=V[J]||0}}function E(k,U){const C=k.GDEF&&k.GDEF.glyphClassDef;return C?o.U._getGlyphClass(U,C):0}function O(...k){for(let U=0;U<k.length;U++)if(typeof k[U]=="number")return k[U]}function R(k){const U=Object.create(null),C=k["OS/2"],T=k.hhea,Z=k.head.unitsPerEm,z=O(C&&C.sTypoAscender,T&&T.ascender,Z),B={unitsPerEm:Z,ascender:z,descender:O(C&&C.sTypoDescender,T&&T.descender,0),capHeight:O(C&&C.sCapHeight,z),xHeight:O(C&&C.sxHeight,z),lineGap:O(C&&C.sTypoLineGap,T&&T.lineGap),supportsCodePoint(V){return o.U.codeToGlyph(k,V)>0},forEachGlyph(V,Y,J,Te){let ge=0;const fe=1/B.unitsPerEm*Y,he=S(k,V);let Q=0;const pe=A(k,he);return he.forEach((ve,K)=>{if(ve!==-1){let se=U[ve];if(!se){const{cmds:Ee,crds:me}=o.U.glyphToPath(k,ve);let Oe="",Ze=0;for(let at=0,Ke=Ee.length;at<Ke;at++){const tt=t[Ee[at]];Oe+=Ee[at];for(let lt=1;lt<=tt;lt++)Oe+=(lt>1?",":"")+me[Ze++]}let le,ke,Fe,ht;if(me.length){le=ke=1/0,Fe=ht=-1/0;for(let at=0,Ke=me.length;at<Ke;at+=2){let tt=me[at],lt=me[at+1];tt<le&&(le=tt),lt<ke&&(ke=lt),tt>Fe&&(Fe=tt),lt>ht&&(ht=lt)}}else le=Fe=ke=ht=0;se=U[ve]={index:ve,advanceWidth:k.hmtx.aWidth[ve],xMin:le,yMin:ke,xMax:Fe,yMax:ht,path:Oe}}Te.call(null,se,ge+pe[K*3]*fe,pe[K*3+1]*fe,Q),ge+=pe[K*3+2]*fe,J&&(ge+=J*Y)}Q+=V.codePointAt(Q)>65535?2:1}),ge}};return B}return function(U){const C=new Uint8Array(U,0,4),T=o._bin.readASCII(C,0,4);if(T==="wOFF")U=e(U);else if(T==="wOF2")throw new Error("woff2 fonts not supported");return R(o.parse(U)[0])}}const bx=Xr({name:"Typr Font Parser",dependencies:[gx,yx,vx],init(o,e,t){const i=o(),n=e();return t(i,n)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function wx(){return function(o){var e=function(){this.buckets=new Map};e.prototype.add=function(A){var E=A>>5;this.buckets.set(E,(this.buckets.get(E)||0)|1<<(31&A))},e.prototype.has=function(A){var E=this.buckets.get(A>>5);return E!==void 0&&(E&1<<(31&A))!=0},e.prototype.serialize=function(){var A=[];return this.buckets.forEach(function(E,O){A.push((+O).toString(36)+":"+E.toString(36))}),A.join(",")},e.prototype.deserialize=function(A){var E=this;this.buckets.clear(),A.split(",").forEach(function(O){var R=O.split(":");E.buckets.set(parseInt(R[0],36),parseInt(R[1],36))})};var t=Math.pow(2,8),i=t-1,n=~i;function s(A){var E=function(R){return R&n}(A).toString(16),O=function(R){return(R&n)+t-1}(A).toString(16);return"codepoint-index/plane"+(A>>16)+"/"+E+"-"+O+".json"}function a(A,E){var O=A&i,R=E.codePointAt(O/6|0);return((R=(R||48)-48)&1<<O%6)!=0}function r(A,E){var O;(O=A,O.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(R){return R.split("-").map(function(k){return parseInt(k.trim(),16)})})).forEach(function(R){var k=R[0],U=R[1];U===void 0&&(U=k),E(k,U)})}function l(A,E){r(A,function(O,R){for(var k=O;k<=R;k++)E(k)})}var c={},h={},d=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function p(A){var E=d.get(A);return E||(E=new e,l(A.ranges,function(O){return E.add(O)}),d.set(A,E)),E}var b,_=new Map;function y(A,E,O){return A[E]?E:A[O]?O:function(R){for(var k in R)return k}(A)}function v(A,E){var O=E;if(!A.includes(O)){O=1/0;for(var R=0;R<A.length;R++)Math.abs(A[R]-E)<Math.abs(O-E)&&(O=A[R])}return O}function S(A){return b||(b=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(E){b.add(E)})),b.has(A)}return o.CodePointSet=e,o.clearCache=function(){c={},h={}},o.getFontsForString=function(A,E){E===void 0&&(E={});var O,R=E.lang;R===void 0&&(R=new RegExp("\\p{Script=Hangul}","u").test(O=A)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(O)?"ja":"en");var k=E.category;k===void 0&&(k="sans-serif");var U=E.style;U===void 0&&(U="normal");var C=E.weight;C===void 0&&(C=400);var T=(E.dataUrl||f).replace(/\/$/g,""),Z=new Map,z=new Uint8Array(A.length),B={},V={},Y=new Array(A.length),J=new Map,Te=!1;function ge(Q){var pe=_.get(Q);return pe||(pe=fetch(T+"/"+Q).then(function(ve){if(!ve.ok)throw new Error(ve.statusText);return ve.json().then(function(K){if(!Array.isArray(K)||K[0]!==1)throw new Error("Incorrect schema version; need 1, got "+K[0]);return K[1]})}).catch(function(ve){if(T!==f)return Te||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+T+'", trying default CDN. '+ve.message),Te=!0),T=f,_.delete(Q),ge(Q);throw ve}),_.set(Q,pe)),pe}for(var fe=function(Q){var pe=A.codePointAt(Q),ve=s(pe);Y[Q]=ve,c[ve]||J.has(ve)||J.set(ve,ge(ve).then(function(K){c[ve]=K})),pe>65535&&(Q++,he=Q)},he=0;he<A.length;he++)fe(he);return Promise.all(J.values()).then(function(){J.clear();for(var Q=function(ve){var K=A.codePointAt(ve),se=null,Ee=c[Y[ve]],me=void 0;for(var Oe in Ee){var Ze=V[Oe];if(Ze===void 0&&(Ze=V[Oe]=new RegExp(Oe).test(R||"en")),Ze){for(var le in me=Oe,Ee[Oe])if(a(K,Ee[Oe][le])){se=le;break}break}}if(!se){e:for(var ke in Ee)if(ke!==me){for(var Fe in Ee[ke])if(a(K,Ee[ke][Fe])){se=Fe;break e}}}se||(console.debug("No font coverage for U+"+K.toString(16)),se="latin"),Y[ve]=se,h[se]||J.has(se)||J.set(se,ge("font-meta/"+se+".json").then(function(ht){h[se]=ht})),K>65535&&(ve++,pe=ve)},pe=0;pe<A.length;pe++)Q(pe);return Promise.all(J.values())}).then(function(){for(var Q,pe=null,ve=0;ve<A.length;ve++){var K=A.codePointAt(ve);if(pe&&(S(K)||p(pe).has(K)))z[ve]=z[ve-1];else{pe=h[Y[ve]];var se=B[pe.id];if(!se){var Ee=pe.typeforms,me=y(Ee,k,"sans-serif"),Oe=y(Ee[me],U,"normal"),Ze=v((Q=Ee[me])===null||Q===void 0?void 0:Q[Oe],C);se=B[pe.id]=T+"/font-files/"+pe.id+"/"+me+"."+Oe+"."+Ze+".woff"}var le=Z.get(se);le==null&&(le=Z.size,Z.set(se,le)),z[ve]=le}K>65535&&(ve++,z[ve]=z[ve-1])}return{fontUrls:Array.from(Z.keys()),chars:z}})},Object.defineProperty(o,"__esModule",{value:!0}),o}({})}function _x(o,e){const t=Object.create(null),i=Object.create(null);function n(a,r){const l=c=>{console.error(`Failure loading font ${a}`,c)};try{const c=new XMLHttpRequest;c.open("get",a,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)l(new Error(c.statusText));else if(c.status>0)try{const h=o(c.response);h.src=a,r(h)}catch(h){l(h)}},c.onerror=l,c.send()}catch(c){l(c)}}function s(a,r){let l=t[a];l?r(l):i[a]?i[a].push(r):(i[a]=[r],n(a,c=>{c.src=a,t[a]=c,i[a].forEach(h=>h(c)),delete i[a]}))}return function(a,r,{lang:l,fonts:c=[],style:h="normal",weight:d="normal",unicodeFontsURL:f}={}){const p=new Uint8Array(a.length),b=[];a.length||S();const _=new Map,y=[];if(h!=="italic"&&(h="normal"),typeof d!="number"&&(d=d==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(E=>!E.lang||E.lang.test(l)).reverse(),c.length){let k=0;(function U(C=0){for(let T=C,Z=a.length;T<Z;T++){const z=a.codePointAt(T);if(k===1&&b[p[T-1]].supportsCodePoint(z)||T>0&&/\s/.test(a[T]))p[T]=p[T-1],k===2&&(y[y.length-1][1]=T);else for(let B=p[T],V=c.length;B<=V;B++)if(B===V){const Y=k===2?y[y.length-1]:y[y.length]=[T,T];Y[1]=T,k=2}else{p[T]=B;const{src:Y,unicodeRange:J}=c[B];if(!J||A(z,J)){const Te=t[Y];if(!Te){s(Y,()=>{U(T)});return}if(Te.supportsCodePoint(z)){let ge=_.get(Te);typeof ge!="number"&&(ge=b.length,b.push(Te),_.set(Te,ge)),p[T]=ge,k=1;break}}}z>65535&&T+1<Z&&(p[T+1]=p[T],T++,k===2&&(y[y.length-1][1]=T))}v()})()}else y.push([0,a.length-1]),v();function v(){if(y.length){const E=y.map(O=>a.substring(O[0],O[1]+1)).join(`
`);e.getFontsForString(E,{lang:l||void 0,style:h,weight:d,dataUrl:f}).then(({fontUrls:O,chars:R})=>{const k=b.length;let U=0;y.forEach(T=>{for(let Z=0,z=T[1]-T[0];Z<=z;Z++)p[T[0]+Z]=R[U++]+k;U++});let C=0;O.forEach((T,Z)=>{s(T,z=>{b[Z+k]=z,++C===O.length&&S()})})})}else S()}function S(){r({chars:p,fonts:b})}function A(E,O){for(let R=0;R<O.length;R++){const[k,U=k]=O[R];if(k<=E&&E<=U)return!0}return!1}}}const Mx=Xr({name:"FontResolver",dependencies:[_x,bx,wx],init(o,e,t){return o(e,t())}});function xx(o,e){const i=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n="[^\\S\\u00A0]",s=new RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function a({text:b,lang:_,fonts:y,style:v,weight:S,preResolvedFonts:A,unicodeFontsURL:E},O){const R=({chars:k,fonts:U})=>{let C,T;const Z=[];for(let z=0;z<k.length;z++)k[z]!==T?(T=k[z],Z.push(C={start:z,end:z,fontObj:U[k[z]]})):C.end=z;O(Z)};A?R(A):o(b,R,{lang:_,fonts:y,style:v,weight:S,unicodeFontsURL:E})}function r({text:b="",font:_,lang:y,sdfGlyphSize:v=64,fontSize:S=400,fontWeight:A=1,fontStyle:E="normal",letterSpacing:O=0,lineHeight:R="normal",maxWidth:k=1/0,direction:U,textAlign:C="left",textIndent:T=0,whiteSpace:Z="normal",overflowWrap:z="normal",anchorX:B=0,anchorY:V=0,metricsOnly:Y=!1,unicodeFontsURL:J,preResolvedFonts:Te=null,includeCaretPositions:ge=!1,chunkedBoundsSize:fe=8192,colorRanges:he=null,justifyMinThreshold:Q=.33},pe){const ve=d(),K={fontLoad:0,typesetting:0};b.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),b=b.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),S=+S,O=+O,k=+k,R=R||"normal",T=+T,a({text:b,lang:y,style:E,weight:A,fonts:typeof _=="string"?[{src:_}]:_,unicodeFontsURL:J,preResolvedFonts:Te},se=>{K.fontLoad=d()-ve;const Ee=isFinite(k);let me=null,Oe=null,Ze=null,le=null,ke=null,Fe=null,ht=null,at=null,Ke=0,tt=0,lt=Z!=="nowrap";const qe=new Map,X=d();let F=T,re=0,Ie=new f;const ce=[Ie];se.forEach(je=>{const{fontObj:ze}=je,{ascender:st,descender:pt,unitsPerEm:dt,lineGap:rt,capHeight:it,xHeight:mt}=ze;let Mt=qe.get(ze);if(!Mt){const Ue=S/dt,Xe=R==="normal"?(st-pt+rt)*Ue:R*S,Pt=(Xe-(st-pt)*Ue)/2,bt=Math.min(Xe,(st-pt)*Ue),_t=(st+pt)/2*Ue+bt/2;Mt={index:qe.size,src:ze.src,fontObj:ze,fontSizeMult:Ue,unitsPerEm:dt,ascender:st*Ue,descender:pt*Ue,capHeight:it*Ue,xHeight:mt*Ue,lineHeight:Xe,baseline:-Pt-st*Ue,caretTop:_t,caretBottom:_t-bt},qe.set(ze,Mt)}const{fontSizeMult:wt}=Mt,L=b.slice(je.start,je.end+1);let ye,_e;ze.forEachGlyph(L,S,O,(Ue,Xe,Pt,bt)=>{Xe+=re,bt+=je.start,ye=Xe,_e=Ue;const _t=b.charAt(bt),Ot=Ue.advanceWidth*wt,St=Ie.count;let At;if("isEmpty"in Ue||(Ue.isWhitespace=!!_t&&new RegExp(n).test(_t),Ue.canBreakAfter=!!_t&&s.test(_t),Ue.isEmpty=Ue.xMin===Ue.xMax||Ue.yMin===Ue.yMax||i.test(_t)),!Ue.isWhitespace&&!Ue.isEmpty&&tt++,lt&&Ee&&!Ue.isWhitespace&&Xe+Ot+F>k&&St){if(Ie.glyphAt(St-1).glyphObj.canBreakAfter)At=new f,F=-Xe;else for(let pi=St;pi--;)if(pi===0&&z==="break-word"){At=new f,F=-Xe;break}else if(Ie.glyphAt(pi).glyphObj.canBreakAfter){At=Ie.splitAt(pi+1);const ii=At.glyphAt(0).x;F-=ii;for(let Qt=At.count;Qt--;)At.glyphAt(Qt).x-=ii;break}At&&(Ie.isSoftWrapped=!0,Ie=At,ce.push(Ie),Ke=k)}let Lt=Ie.glyphAt(Ie.count);Lt.glyphObj=Ue,Lt.x=Xe+F,Lt.y=Pt,Lt.width=Ot,Lt.charIndex=bt,Lt.fontData=Mt,_t===`
`&&(Ie=new f,ce.push(Ie),F=-(Xe+Ot+O*S)+T)}),re=ye+_e.advanceWidth*wt+O*S});let Se=0;ce.forEach(je=>{let ze=!0;for(let st=je.count;st--;){const pt=je.glyphAt(st);ze&&!pt.glyphObj.isWhitespace&&(je.width=pt.x+pt.width,je.width>Ke&&(Ke=je.width),ze=!1);let{lineHeight:dt,capHeight:rt,xHeight:it,baseline:mt}=pt.fontData;dt>je.lineHeight&&(je.lineHeight=dt);const Mt=mt-je.baseline;Mt<0&&(je.baseline+=Mt,je.cap+=Mt,je.ex+=Mt),je.cap=Math.max(je.cap,je.baseline+rt),je.ex=Math.max(je.ex,je.baseline+it)}je.baseline-=Se,je.cap-=Se,je.ex-=Se,Se+=je.lineHeight});let Ge=0,$e=0;if(B&&(typeof B=="number"?Ge=-B:typeof B=="string"&&(Ge=-Ke*(B==="left"?0:B==="center"?.5:B==="right"?1:c(B)))),V&&(typeof V=="number"?$e=-V:typeof V=="string"&&($e=V==="top"?0:V==="top-baseline"?-ce[0].baseline:V==="top-cap"?-ce[0].cap:V==="top-ex"?-ce[0].ex:V==="middle"?Se/2:V==="bottom"?Se:V==="bottom-baseline"?-ce[ce.length-1].baseline:c(V)*Se)),!Y){const je=e.getEmbeddingLevels(b,U);me=new Uint16Array(tt),Oe=new Uint8Array(tt),Ze=new Float32Array(tt*2),le={},ht=[1/0,1/0,-1/0,-1/0],at=[],ge&&(Fe=new Float32Array(b.length*4)),he&&(ke=new Uint8Array(tt*3));let ze=0,st=-1,pt=-1,dt,rt;if(ce.forEach((it,mt)=>{let{count:Mt,width:wt}=it;if(Mt>0){let L=0;for(let bt=Mt;bt--&&it.glyphAt(bt).glyphObj.isWhitespace;)L++;let ye=0,_e=0;if(C==="center")ye=(Ke-wt)/2;else if(C==="right")ye=Ke-wt;else if(C==="justify"&&it.isSoftWrapped||C==="hard-justify"){const bt=C==="hard-justify"?k:Ke;if(wt/bt>=Q){let Ot=0;for(let St=Mt-L;St--;)it.glyphAt(St).glyphObj.isWhitespace&&Ot++;_e=(bt-wt)/Ot}}if(_e||ye){let bt=0;for(let _t=0;_t<Mt;_t++){let Ot=it.glyphAt(_t);const St=Ot.glyphObj;Ot.x+=ye+bt,_e!==0&&St.isWhitespace&&_t<Mt-L&&(bt+=_e,Ot.width+=_e)}}const Ue=e.getReorderSegments(b,je,it.glyphAt(0).charIndex,it.glyphAt(it.count-1).charIndex);for(let bt=0;bt<Ue.length;bt++){const[_t,Ot]=Ue[bt];let St=1/0,At=-1/0;for(let Lt=0;Lt<Mt;Lt++)if(it.glyphAt(Lt).charIndex>=_t){let pi=Lt,ii=Lt;for(;ii<Mt;ii++){let Qt=it.glyphAt(ii);if(Qt.charIndex>Ot)break;ii<Mt-L&&(St=Math.min(St,Qt.x),At=Math.max(At,Qt.x+Qt.width))}for(let Qt=pi;Qt<ii;Qt++){const mi=it.glyphAt(Qt);mi.x=At-(mi.x+mi.width-St)}break}}let Xe;const Pt=bt=>Xe=bt;for(let bt=0;bt<Mt;bt++){const _t=it.glyphAt(bt);Xe=_t.glyphObj;const Ot=Xe.index,St=je.levels[_t.charIndex]&1;if(St){const At=e.getMirroredCharacter(b[_t.charIndex]);At&&_t.fontData.fontObj.forEachGlyph(At,0,0,Pt)}if(ge){const{charIndex:At,fontData:Lt}=_t,pi=_t.x+Ge,ii=_t.x+_t.width+Ge;Fe[At*4]=St?ii:pi,Fe[At*4+1]=St?pi:ii,Fe[At*4+2]=it.baseline+Lt.caretBottom+$e,Fe[At*4+3]=it.baseline+Lt.caretTop+$e;const Qt=At-st;Qt>1&&h(Fe,st,Qt),st=At}if(he){const{charIndex:At}=_t;for(;At>pt;)pt++,he.hasOwnProperty(pt)&&(rt=he[pt])}if(!Xe.isWhitespace&&!Xe.isEmpty){const At=ze++,{fontSizeMult:Lt,src:pi,index:ii}=_t.fontData,Qt=le[pi]||(le[pi]={});Qt[Ot]||(Qt[Ot]={path:Xe.path,pathBounds:[Xe.xMin,Xe.yMin,Xe.xMax,Xe.yMax]});const mi=_t.x+Ge,Ri=_t.y+it.baseline+$e;Ze[At*2]=mi,Ze[At*2+1]=Ri;const Ki=mi+Xe.xMin*Lt,En=Ri+Xe.yMin*Lt,un=mi+Xe.xMax*Lt,Qi=Ri+Xe.yMax*Lt;Ki<ht[0]&&(ht[0]=Ki),En<ht[1]&&(ht[1]=En),un>ht[2]&&(ht[2]=un),Qi>ht[3]&&(ht[3]=Qi),At%fe===0&&(dt={start:At,end:At,rect:[1/0,1/0,-1/0,-1/0]},at.push(dt)),dt.end++;const ft=dt.rect;if(Ki<ft[0]&&(ft[0]=Ki),En<ft[1]&&(ft[1]=En),un>ft[2]&&(ft[2]=un),Qi>ft[3]&&(ft[3]=Qi),me[At]=Ot,Oe[At]=ii,he){const gi=At*3;ke[gi]=rt>>16&255,ke[gi+1]=rt>>8&255,ke[gi+2]=rt&255}}}}}),Fe){const it=b.length-st;it>1&&h(Fe,st,it)}}const Qe=[];qe.forEach(({index:je,src:ze,unitsPerEm:st,ascender:pt,descender:dt,lineHeight:rt,capHeight:it,xHeight:mt})=>{Qe[je]={src:ze,unitsPerEm:st,ascender:pt,descender:dt,lineHeight:rt,capHeight:it,xHeight:mt}}),K.typesetting=d()-X,pe({glyphIds:me,glyphFontIndices:Oe,glyphPositions:Ze,glyphData:le,fontData:Qe,caretPositions:Fe,glyphColors:ke,chunkedBounds:at,fontSize:S,topBaseline:$e+ce[0].baseline,blockBounds:[Ge,$e-Se,Ge+Ke,$e],visibleBounds:ht,timings:K})})}function l(b,_){r({...b,metricsOnly:!0},y=>{const[v,S,A,E]=y.blockBounds;_({width:A-v,height:E-S})})}function c(b){let _=b.match(/^([\d.]+)%$/),y=_?parseFloat(_[1]):NaN;return isNaN(y)?0:y/100}function h(b,_,y){const v=b[_*4],S=b[_*4+1],A=b[_*4+2],E=b[_*4+3],O=(S-v)/y;for(let R=0;R<y;R++){const k=(_+R)*4;b[k]=v+O*R,b[k+1]=v+O*(R+1),b[k+2]=A,b[k+3]=E}}function d(){return(self.performance||Date).now()}function f(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(b){let _=f.flyweight;return _.data=this.data,_.index=b,_},splitAt(b){let _=new f;return _.data=this.data.splice(b*p.length),_}},f.flyweight=p.reduce((b,_,y,v)=>(Object.defineProperty(b,_,{get(){return this.data[this.index*p.length+y]},set(S){this.data[this.index*p.length+y]=S}}),b),{data:null,index:0}),{typeset:r,measure:l}}const Ha=()=>(self.performance||Date).now(),ac=ym();let Uf;function Sx(o,e,t,i,n,s,a,r,l,c,h=!0){return h?Tx(o,e,t,i,n,s,a,r,l,c).then(null,d=>(Uf||(console.warn("WebGL SDF generation failed, falling back to JS",d),Uf=!0),Bf(o,e,t,i,n,s,a,r,l,c))):Bf(o,e,t,i,n,s,a,r,l,c)}const Il=[],Ax=5;let Dh=0;function bm(){const o=Ha();for(;Il.length&&Ha()-o<Ax;)Il.shift()();Dh=Il.length?setTimeout(bm,0):0}const Tx=(...o)=>new Promise((e,t)=>{Il.push(()=>{const i=Ha();try{ac.webgl.generateIntoCanvas(...o),e({timing:Ha()-i})}catch(n){t(n)}}),Dh||(Dh=setTimeout(bm,0))}),Ex=4,Cx=2e3,Nf={};let Px=0;function Bf(o,e,t,i,n,s,a,r,l,c){const h="TroikaTextSDFGenerator_JS_"+Px++%Ex;let d=Nf[h];return d||(d=Nf[h]={workerModule:Xr({name:h,workerId:h,dependencies:[ym,Ha],init(f,p){const b=f().javascript.generate;return function(..._){const y=p();return{textureData:b(..._),timing:p()-y}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),d.requests++,clearTimeout(d.idleTimer),d.workerModule(o,e,t,i,n,s).then(({textureData:f,timing:p})=>{const b=Ha(),_=new Uint8Array(f.length*4);for(let y=0;y<f.length;y++)_[y*4+c]=f[y];return ac.webglUtils.renderImageData(a,_,r,l,o,e,1<<3-c),p+=Ha()-b,--d.requests===0&&(d.idleTimer=setTimeout(()=>{rx(h)},Cx)),{timing:p}})}function kx(o){o._warm||(ac.webgl.isSupported(o),o._warm=!0)}const Ix=ac.webglUtils.resizeWebGLCanvasWithoutClearing,xr={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},Lx=new Dt;function Mr(){return(self.performance||Date).now()}const zf=Object.create(null);function Rx(o,e){o=Fx({},o);const t=Mr(),{defaultFontURL:i}=xr,n=[];if(i&&n.push({label:"default",src:Vf(i)}),o.font&&n.push({label:"user",src:Vf(o.font)}),o.font=n,o.text=""+o.text,o.sdfGlyphSize=o.sdfGlyphSize||xr.sdfGlyphSize,o.unicodeFontsURL=o.unicodeFontsURL||xr.unicodeFontsURL,o.colorRanges!=null){let p={};for(let b in o.colorRanges)if(o.colorRanges.hasOwnProperty(b)){let _=o.colorRanges[b];typeof _!="number"&&(_=Lx.set(_).getHex()),p[b]=_}o.colorRanges=p}Object.freeze(o);const{textureWidth:s,sdfExponent:a}=xr,{sdfGlyphSize:r}=o,l=s/r*4;let c=zf[r];if(!c){const p=document.createElement("canvas");p.width=s,p.height=r*256/l,c=zf[r]={glyphCount:0,sdfGlyphSize:r,sdfCanvas:p,sdfTexture:new Fi(p,void 0,void 0,void 0,wi,wi),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,Dx(c)}const{sdfTexture:h,sdfCanvas:d}=c;Mm(o).then(p=>{const{glyphIds:b,glyphFontIndices:_,fontData:y,glyphPositions:v,fontSize:S,timings:A}=p,E=[],O=new Float32Array(b.length*4);let R=0,k=0;const U=Mr(),C=y.map(V=>{let Y=c.glyphsByFont.get(V.src);return Y||c.glyphsByFont.set(V.src,Y=new Map),Y});b.forEach((V,Y)=>{const J=_[Y],{src:Te,unitsPerEm:ge}=y[J];let fe=C[J].get(V);if(!fe){const{path:K,pathBounds:se}=p.glyphData[Te][V],Ee=Math.max(se[2]-se[0],se[3]-se[1])/r*(xr.sdfMargin*r+.5),me=c.glyphCount++,Oe=[se[0]-Ee,se[1]-Ee,se[2]+Ee,se[3]+Ee];C[J].set(V,fe={path:K,atlasIndex:me,sdfViewBox:Oe}),E.push(fe)}const{sdfViewBox:he}=fe,Q=v[k++],pe=v[k++],ve=S/ge;O[R++]=Q+he[0]*ve,O[R++]=pe+he[1]*ve,O[R++]=Q+he[2]*ve,O[R++]=pe+he[3]*ve,b[Y]=fe.atlasIndex}),A.quads=(A.quads||0)+(Mr()-U);const T=Mr();A.sdf={};const Z=d.height,z=Math.ceil(c.glyphCount/l),B=Math.pow(2,Math.ceil(Math.log2(z*r)));B>Z&&(console.info(`Increasing SDF texture size ${Z}->${B}`),Ix(d,s,B),h.dispose()),Promise.all(E.map(V=>wm(V,c,o.gpuAccelerateSDF).then(({timing:Y})=>{A.sdf[V.atlasIndex]=Y}))).then(()=>{E.length&&!c.contextLost&&(_m(c),h.needsUpdate=!0),A.sdfTotal=Mr()-T,A.total=Mr()-t,e(Object.freeze({parameters:o,sdfTexture:h,sdfGlyphSize:r,sdfExponent:a,glyphBounds:O,glyphAtlasIndices:b,glyphColors:p.glyphColors,caretPositions:p.caretPositions,chunkedBounds:p.chunkedBounds,ascender:p.ascender,descender:p.descender,lineHeight:p.lineHeight,capHeight:p.capHeight,xHeight:p.xHeight,topBaseline:p.topBaseline,blockBounds:p.blockBounds,visibleBounds:p.visibleBounds,timings:p.timings}))})}),Promise.resolve().then(()=>{c.contextLost||kx(d)})}function wm({path:o,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:i,sdfCanvas:n,contextLost:s},a){if(s)return Promise.resolve({timing:-1});const{textureWidth:r,sdfExponent:l}=xr,c=Math.max(t[2]-t[0],t[3]-t[1]),h=Math.floor(e/4),d=h%(r/i)*i,f=Math.floor(h/(r/i))*i,p=e%4;return Sx(i,i,o,t,c,l,n,d,f,p,a)}function Dx(o){const e=o.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),o.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),o.contextLost=!1;const i=[];o.glyphsByFont.forEach(n=>{n.forEach(s=>{i.push(wm(s,o,!0))})}),Promise.all(i).then(()=>{_m(o),o.sdfTexture.needsUpdate=!0})})}function Fx(o,e){for(let t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o}let Sl;function Vf(o){return Sl||(Sl=typeof document>"u"?{}:document.createElement("a")),Sl.href=o,Sl.href}function _m(o){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=o,{width:i,height:n}=e,s=o.sdfCanvas.getContext("webgl");let a=t.image.data;(!a||a.length!==i*n*4)&&(a=new Uint8Array(i*n*4),t.image={width:i,height:n,data:a},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,i,n,s.RGBA,s.UNSIGNED_BYTE,a)}}const Ox=Xr({name:"Typesetter",dependencies:[xx,Mx,lx],init(o,e,t){return o(e,t())}}),Mm=Xr({name:"Typesetter",dependencies:[Ox],init(o){return function(e){return new Promise(t=>{o.typeset(e,t)})}},getTransferables(o){const e=[];for(let t in o)o[t]&&o[t].buffer&&e.push(o[t].buffer);return e}});Mm.onMainThread;const Hf={};function Ux(o){let e=Hf[o];return e||(e=Hf[o]=new ba(1,1,o,o).translate(.5,.5,0)),e}const Nx="aTroikaGlyphBounds",Gf="aTroikaGlyphIndex",Bx="aTroikaGlyphColor";class zx extends Cw{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new rs,this.boundingBox=new Hn}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=Ux(e);["position","normal","uv"].forEach(i=>{this.attributes[i]=t.attributes[i].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,i,n,s){this.updateAttributeData(Nx,e,4),this.updateAttributeData(Gf,t,1),this.updateAttributeData(Bx,s,3),this._blockBounds=i,this._chunkedBounds=n,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:i}=this;if(t){const{PI:n,floor:s,min:a,max:r,sin:l,cos:c}=Math,h=n/2,d=n*2,f=Math.abs(t),p=e[0]/f,b=e[2]/f,_=s((p+h)/d)!==s((b+h)/d)?-f:a(l(p)*f,l(b)*f),y=s((p-h)/d)!==s((b-h)/d)?f:r(l(p)*f,l(b)*f),v=s((p+n)/d)!==s((b+n)/d)?f*2:r(f-c(p)*f,f-c(b)*f);i.min.set(_,e[1],t<0?-v:0),i.max.set(y,e[3],t<0?0:v)}else i.min.set(e[0],e[1],0),i.max.set(e[2],e[3],0);i.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(Gf).count,i=this._chunkedBounds;if(i)for(let n=i.length;n--;){t=i[n].end;let s=i[n].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,i){const n=this.getAttribute(e);t?n&&n.array.length===t.length?(n.array.set(t),n.needsUpdate=!0):(this.setAttribute(e,new Vl(t,i)),delete this._maxInstanceCount,this.dispose()):n&&this.deleteAttribute(e)}}const Vx=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,Hx=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,Gx=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,Wx=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function jx(o){const e=Rh(o,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new et},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ui(0,0,0,0)},uTroikaClipRect:{value:new ui(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new et},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Dt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Wt},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:Vx,vertexTransform:Hx,fragmentDefs:Gx,fragmentColorTransform:Wx,customRewriter({vertexShader:t,fragmentShader:i}){let n=/\buniform\s+vec3\s+diffuse\b/;return n.test(i)&&(i=i.replace(n,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),n.test(t)||(t=t.replace(vm,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:i}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const su=new qt({color:16777215,side:Ai,transparent:!0}),Wf=8421504,jf=new Ft,Al=new D,lh=new D,ho=[],qx=new D,ch="+x+y";function qf(o){return Array.isArray(o)?o[0]:o}let xm=()=>{const o=new It(new ba(1,1),su);return xm=()=>o,o},Sm=()=>{const o=new It(new ba(1,1,32,1),su);return Sm=()=>o,o};const Xx={type:"syncstart"},$x={type:"synccomplete"},Am=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],Yx=Am.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class Fh extends It{constructor(){const e=new zx;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=Wf,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=ch,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(Xx),Rx({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const i=this._queuedSyncs;i&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{i.forEach(n=>n&&n())})),this.dispatchEvent($x),e&&e()})))}onBeforeRender(e,t,i,n,s,a){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return jx(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=su.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function i(){t.removeEventListener("dispose",i),e.dispose()})),this.hasOutline()){let i=e._outlineMtl;return i||(i=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),i.isTextOutlineMaterial=!0,i.depthWrite=!1,i.map=null,e.addEventListener("dispose",function n(){e.removeEventListener("dispose",n),i.dispose()})),[i,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return qf(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return qf(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,i=e.uniforms,n=this.textRenderInfo;if(n){const{sdfTexture:r,blockBounds:l}=n;i.uTroikaSDFTexture.value=r,i.uTroikaSDFTextureSize.value.set(r.image.width,r.image.height),i.uTroikaSDFGlyphSize.value=n.sdfGlyphSize,i.uTroikaSDFExponent.value=n.sdfExponent,i.uTroikaTotalBounds.value.fromArray(l),i.uTroikaUseGlyphColors.value=!t&&!!n.glyphColors;let c=0,h=0,d=0,f,p,b,_=0,y=0;if(t){let{outlineWidth:S,outlineOffsetX:A,outlineOffsetY:E,outlineBlur:O,outlineOpacity:R}=this;c=this._parsePercent(S)||0,h=Math.max(0,this._parsePercent(O)||0),f=R,_=this._parsePercent(A)||0,y=this._parsePercent(E)||0}else d=Math.max(0,this._parsePercent(this.strokeWidth)||0),d&&(b=this.strokeColor,i.uTroikaStrokeColor.value.set(b??Wf),p=this.strokeOpacity,p==null&&(p=1)),f=this.fillOpacity;i.uTroikaEdgeOffset.value=c,i.uTroikaPositionOffset.value.set(_,y),i.uTroikaBlurRadius.value=h,i.uTroikaStrokeWidth.value=d,i.uTroikaStrokeOpacity.value=p,i.uTroikaFillOpacity.value=f??1,i.uTroikaCurveRadius.value=this.curveRadius||0;let v=this.clipRect;if(v&&Array.isArray(v)&&v.length===4)i.uTroikaClipRect.value.fromArray(v);else{const S=(this.fontSize||.1)*100;i.uTroikaClipRect.value.set(l[0]-S,l[1]-S,l[2]+S,l[3]+S)}this.geometry.applyClipRect(i.uTroikaClipRect.value)}i.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const r=e.hasOwnProperty("color")?e.color:e.color=new Dt;(s!==r._input||typeof s=="object")&&r.set(r._input=s)}let a=this.orientation||ch;if(a!==e._orientation){let r=i.uTroikaOrient.value;a=a.replace(/[^-+xyz]/g,"");let l=a!==ch&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(l){let[,c,h,d,f]=l;Al.set(0,0,0)[h]=c==="-"?1:-1,lh.set(0,0,0)[f]=d==="-"?-1:1,jf.lookAt(qx,Al.cross(lh),lh),r.setFromMatrix4(jf)}else r.identity();e._orientation=a}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),i=t?parseFloat(t[1]):NaN;e=(isNaN(i)?0:i/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new et){t.copy(e);const i=this.curveRadius;return i&&(t.x=Math.atan2(e.x,Math.abs(i)-Math.abs(e.z))*Math.abs(i)),t}worldPositionToTextCoords(e,t=new et){return Al.copy(e),this.localPositionToTextCoords(this.worldToLocal(Al),t)}raycast(e,t){const{textRenderInfo:i,curveRadius:n}=this;if(i){const s=i.blockBounds,a=n?Sm():xm(),r=a.geometry,{position:l,uv:c}=r.attributes;for(let h=0;h<c.count;h++){let d=s[0]+c.getX(h)*(s[2]-s[0]);const f=s[1]+c.getY(h)*(s[3]-s[1]);let p=0;n&&(p=n-Math.cos(d/n)*n,d=Math.sin(d/n)*n),l.setXYZ(h,d,f,p)}r.boundingSphere=this.geometry.boundingSphere,r.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,ho.length=0,a.raycast(e,ho);for(let h=0;h<ho.length;h++)ho[h].object=this,t.push(ho[h])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,Yx.forEach(i=>{this[i]=e[i]}),this}clone(){return new this.constructor().copy(this)}}Am.forEach(o=>{const e="_private_"+o;Object.defineProperty(Fh.prototype,o,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new Hn;new Dt;class Zx{constructor(){g(this,"letterMaterialMap",{});g(this,"retainMap",[]);g(this,"highResRetainCount",2)}getMaterial(e,t,i){var n,s,a,r,l,c,h,d,f,p,b,_;return i?{material:(a=(s=(n=this.letterMaterialMap)==null?void 0:n[e])==null?void 0:s[t])==null?void 0:a[i],quality:i}:{material:(f=(l=(r=this.letterMaterialMap)==null?void 0:r[e])==null?void 0:l[t])==null?void 0:f[(d=(h=(c=this.letterMaterialMap)==null?void 0:c[e])==null?void 0:h[t])==null?void 0:d.active],quality:(_=(b=(p=this.letterMaterialMap)==null?void 0:p[e])==null?void 0:b[t])==null?void 0:_.active}}applyMaterial(e,t,i,n){var s,a,r;(r=(a=(s=this.letterMaterialMap)==null?void 0:s[e])==null?void 0:a[t])!=null&&r[i]&&(n.material[t==="front"?0:1]=this.letterMaterialMap[e][t][i],this.letterMaterialMap[e][t].active=i,i==="high"&&this.addToRetainMap(e,t))}setMaterial(e,t,i,n,s=null){this.letterMaterialMap[e]||this.initialisePageStruct(e),this.letterMaterialMap[e][t][i]=n,s&&(this.letterMaterialMap[e].geo=s,this.applyMaterial(e,t,i,s))}addToRetainMap(e,t){this.retainMap.push({page:e,side:t}),this.retainMap.length>this.highResRetainCount&&this.retainMap.shift(),this.updateMaterialsFromMap()}updateMaterialsFromMap(){var e,t,i,n,s,a,r,l,c,h;for(const[d]of Object.entries(this.letterMaterialMap)){let f=!1,p=!1;this.retainMap.forEach(b=>{b.page===d&&(b.side==="front"&&(f=!0),b.side==="back"&&(p=!0))}),f||((i=(t=(e=this.letterMaterialMap)==null?void 0:e[d])==null?void 0:t.front)==null?void 0:i.active)==="high"&&((s=(n=this.letterMaterialMap)==null?void 0:n[d])!=null&&s.geo)&&this.applyMaterial(d,"front","low",this.letterMaterialMap[d].geo),p||((l=(r=(a=this.letterMaterialMap)==null?void 0:a[d])==null?void 0:r.back)==null?void 0:l.active)==="high"&&((h=(c=this.letterMaterialMap)==null?void 0:c[d])!=null&&h.geo)&&this.applyMaterial(d,"back","low",this.letterMaterialMap[d].geo)}}applyManualModeMaterials(){var e,t;for(const[i]of Object.entries(this.letterMaterialMap))(t=(e=this.letterMaterialMap)==null?void 0:e[i])!=null&&t.geo&&(this.applyMaterial(i,"front","low",this.letterMaterialMap[i].geo),this.applyMaterial(i,"back","low",this.letterMaterialMap[i].geo))}applyCinemaModeMaterials(){var e,t,i,n,s,a,r,l;for(const[c]of Object.entries(this.letterMaterialMap))(t=(e=this.letterMaterialMap)==null?void 0:e[c])!=null&&t.geo&&((s=(n=(i=this.letterMaterialMap)==null?void 0:i[c])==null?void 0:n.back)!=null&&s.cinema||(l=(r=(a=this.letterMaterialMap)==null?void 0:a[c])==null?void 0:r.front)!=null&&l.cinema?(this.applyMaterial(c,"front","cinema",this.letterMaterialMap[c].geo),this.applyMaterial(c,"back","cinema",this.letterMaterialMap[c].geo)):(this.applyMaterial(c,"front","low",this.letterMaterialMap[c].geo),this.applyMaterial(c,"back","low",this.letterMaterialMap[c].geo)))}initialisePageStruct(e){this.letterMaterialMap[e]={},this.letterMaterialMap[e].front={},this.letterMaterialMap[e].back={}}}class Nn{constructor(e,t,i){g(this,"camera");g(this,"letterOverlays");g(this,"indexOverlays");g(this,"skinnedAnimationController");g(this,"odds",!0);g(this,"isFlipping",!1);g(this,"letterAsset");g(this,"letterMaterialManager");g(this,"materialSwitchQueue",[]);g(this,"manualQueueProgress",!1);g(this,"overlayMaterial");g(this,"enableLetterManualMode",()=>{if(document.body.classList.add("show-pan-ui"),!this.letterOverlays||!this.indexOverlays){this.letterOverlays=new cn,this.letterOverlays.visible=!1,this.indexOverlays=new cn,this.indexOverlays.visible=!0;const e=this.skinnedAnimationController.getSkinnedMesh();e.add(this.letterOverlays),e.add(this.indexOverlays),this.letterOverlays.position.z+=875e-6;const t=1.55978674791,i=.1313;this.generateLetterPanModeOverlayPlanes(i,i*t,.0187,.017782,.014025,.0187,this.letterOverlays,this.indexOverlays,this.letterContentArray)}else this.letterOverlays.visible=!1,this.indexOverlays.visible=!0});g(this,"disableLetterManualMode",(e=!1)=>{document.body.classList.remove("show-pan-ui","pan-mode","pan-mode-half"),this.letterOverlays&&(this.letterOverlays.visible=!1,this.indexOverlays.visible=!1),this.odds||this.flipPage(e)});g(this,"toggleLetterOverlay",()=>{this.letterOverlays&&(this.letterOverlays.visible?(this.letterOverlays.visible=!1,document.body.classList.remove("letter-overlays"),this.camera.app.uiManager.makeScreenReaderAnnouncement("Text overlay hidden")):(this.letterOverlays.visible=!0,document.body.classList.add("letter-overlays"),this.camera.app.uiManager.makeScreenReaderAnnouncement("Text overlay visible")))});g(this,"getMeshChildren",e=>{const t=[];return e.traverse(i=>{i instanceof It&&i.geometry&&t.push(i)}),t});g(this,"flipPage",(e=!1)=>{if(this.isFlipping||!this.skinnedAnimationController)return;const t=this.letterOverlays.visible;this.letterOverlays.visible=!1;const n=this.skinnedAnimationController.getSkinnedMesh().children.find(a=>a.name==="Paper_Clone"),s=this.raycastFromCenter(this.camera.camera,n.children);if(s){const a=s.object.parent.parent.parent;this.isFlipping=!0,document.body.classList.add("letter-flipping"),this.flipPageWithAutoRipple(a,{duration:e?1:1200,direction:"backward",onComplete:()=>{t&&(this.letterOverlays.visible=!0),this.isFlipping=!1,document.body.classList.remove("letter-flipping")}}),this.togglePageSides()}});g(this,"togglePageSides",async()=>{this.odds=!this.odds,this.odds&&document.body.classList.add("letter-odds-start"),await bi(500),this.odds?(document.body.classList.remove("letter-evens"),this.camera.app.uiManager.makeScreenReaderAnnouncement("Pages flipped to odd side")):(document.body.classList.add("letter-evens"),this.camera.app.uiManager.makeScreenReaderAnnouncement("Pages flipped to even side")),setTimeout(()=>{this.toggleTextContent()},150),await bi(1e3),document.body.classList.remove("letter-odds-start")});g(this,"pageLayout",[["Paper_61","Paper_62","Paper_63","Paper_7","Paper_71","Paper_72","Paper_73"],["Paper_42","Paper_43-CU1","Paper_5","Paper_51","Paper_52-CU3","Paper_53","Paper_6"],["Paper_23","Paper_3-CU3","Paper_31-CU2","Paper_32","Paper_33","Paper_4","Paper_41"],["Paper_1","Paper_11","Paper_12","Paper_13","Paper_2","Paper_21","Paper_22"]]);g(this,"letterContentArray",[{copy:`Dear Sir
I wish to acquaint you with
some of the occurrences of the present
past and future. In or about the
spring of 1870 the ground was
very soft a hawker named Mr Gould
got his waggon bogged between Greta
and my mothers house on the eleven
mile creek, the ground was that rotten
it would bog a duck in places so
Mr Gould had abandon his waggon
for fear of loosing his horses in the
spewy ground. he was stopping at
my Mothers awaiting finer or dryer
weather Mr McCormack and his
wife. hawkers also, were camped
in Greta the mosquitoes were
very bad which they generally are
in a wet spring and to help them`,lineHeight:1.675,paddingTop:.00875},{copy:`Mr John had a horse called Ruita
Cruta, although a gelding was as
clever as old Wombat or any other
Stallion at running horses away
and taking them on his beat
which was from Greta swamp
to the seven mile creek conse-
quently he enticed McCormacks
horse away from Greta. Mr
Gould was up early feeding his horses
heard a bell and seen McCormack
horse for he knew the horse well
he sent his boy to take him back
to Greta. When McCormacks got
the horse they came straight out
to Goold and accused him of
working the horse; this was false
and Goold was amazed at the
idea I could not help laughing
to hear Mrs McCormack`,lineHeight:1.675,paddingTop:0},{copy:`accusing him of using the horse
after him being so kind as to send
his boy to take him from the Ruta
Cruta and take him back to them.
I pleaded Goulds innocence and
Mrs McCormack turned on me
and accused me of bringing the
horse from Greta to Goolds waggon
to pull him out of the bog I did
not say much to the woman as
my Mother was present but that
same day me and my uncle
was cutting calves Gould wrapped
up a note and a pair of the
calves testicles and gave them
to me to give them to Mrs Mc
Cormack. I did not see her
and I gave the parcel to a boy
to give to her when she would
come instead of giving it`,lineHeight:1.675},{copy:`to her he gave it to her husband
consequently McCormack said
he would summons me I told
him neither me or Gould used
their horse. he said I was a liar
and he could welt me or any of my
breed I was about 14 years of age
but accepted the challenge and
dismounting when Mrs McCormack
struck my horse in the flank with
a bullocks shin it jumped
forward and my fist came in
collision with McCormacks nose
and caused him to loose his equil-
librium and fall postrate I tied
up my horse to finish the battle
but McCormack got up and ran
to the Police camp. Constable
Hall asked me what the row
was about I told him they`,lineHeight:1.675},{copy:`accused me and Gould of
using their horse and I hit him
and I would do the same to him
if he challenged me McCormack
pulled me and swore their lies
against me I was sentenced to
three months for hitting him and
three months for the parcel and
bound to keep the peace for 12
months. Mrs McCormack gave
good substantial evidence as
she is well acquainted with
that place called Tasmania
better known as the Dervon
or Vandiemans land and
McCormack being a Policeman
over the convicts and women
being scarce released her from
that land of bondage and
tyranny, and they came to`,lineHeight:1.675},{copy:`Victoria and are at present residents
of Greta and on the 29th of
March I was released from prison
and came home Wild Wright came
to the Eleven Mile to see Mr Gunn
stopped all night and lost his
mare both him and me looked
all day for her and could not
get her Wright who was a stranger
to me was in a hurry to get back
to Mansfield and I gave him
another mare and he told me
if I found his mare to keep her
until he brought mine back
I was going to Wangaratta
and seen the mare I caught
her and took her with me
all the Police and Detective
Berrill seen her as Martains
girls used to ride her about`,lineHeight:1.675},{copy:`the town during several days that I
stopped at Petre Martains Star Hotel
in Wangaratta, She was a chestnut
mare white face docked tail very re-
markable branded M as plain as the
hands on a town clock. The property
of a Telegraph Master in Mansfield
he lost her on the 6th gazetted her on
the 12th of March and I was a prisoner
in Beechworth Gaol until the 29 of
March therefore I could not have
Stole the mare. I was riding the
mare through Greta Constable
Hall came to me and said he
wanted me to sign some papers
that I did not sign at Beechworth
concerning my bail bonds I thought
it was the truth he said the papers
was at the Barracks and I had no
idea he wanted to arrest me or I`,lineHeight:1.675},{copy:`would have quietly rode away in-
stead of going to the Barracks. I
was getting off when Hall caught
hold of me and thought to throw me
but made a mistake and came on
the broad of his back himself in the
dust the mare galloped away. and in-
stead of me putting my foot on Halls
neck and taking his revolver and
putting him in the lock up. I tried to
catch the mare, Hall got up and snapped
three or four caps at me and would
have shot me but the Colts patent
refused. This is well known in Greta
Hall never told me he wanted to arrest me
until after he tried to shoot me when
I heard the caps snapping I stood
until Hall came close he had me
covered and was shaking with fear
and I knew he would pull the`,lineHeight:1.675},{copy:`trigger before he would be game to put
his hand on me so I duped, and jumped
at him caught the revolver with one
hand and Hall by the collar with
the other. I dare not strike him or
my sureties would loose the bond money
I used to trip him and let him take a mouth-
ful of dust now and again as he was as
helpless as a big guano after leaving a dead
bullock or a horse. I kept throwing him in
the dust until I got him across the street
the very spot where Mrs. O,Briens Hotel
stands now the cellar was just dug then
there was some brush fencing where the
post and rail was taking down and
on this I threw big cowardly Hall on
his belly I straddled him and rooted
both spurs onto his thighs he roared like
a big calf attacked by dogs and shifted
several yards of the fence I got his`,lineHeight:1.675},{copy:`hands at the back of his neck and trid to
make him let the revolver go but he stuck
to it like grim death to a dead volunteer
he called for assistance to a man named
Cohen and Barnett, Lewis, Thompson, Jewitt
two blacksmiths who was looking on
I dare not strike any of them as I was
bound to keep the peace or I could have
spread those curs like dung in a paddock
they got ropes tied my hands and feet
and Hall beat me over the head with
his six chambered colts revolver nine
stitches were put in some of the cuts
by Dr Hastings And when Wild Wright
and my mother came they could trace us
across the street by the blood in the dust
and which spoiled the lustre of the paint
on the gate-post of the Barracks Hall sent
for more Police and Doctor Hastings.
Next morning I was handcuffed`,lineHeight:1.675},{copy:`a rope tied from them to my legs
and to the seat of the cart and
taken to Wangaratta. Hall was fright-
ened I would throw him out of the
cart so he tied me whilst Constable
Arthur laughed at his cowardice for
it was he who escorted me and Hall
to Wangaratta. I was tried and com-
mitted as Hall swore I claimed the
mare the Doctor died or he would
have proved Hall a perjurer Hall has
been tried several times for perjury
but got clear. as this is no crime in
the Police force it is a credit to a Police-
man to convict an innocent man
but any muff can pot a guilty one
Halls character is well known about
El Dorado and Snowy Creek and
Hall was considerably in debt to
Mr. L. O.Brien and as he was going`,lineHeight:1.675},{copy:`to leave Greta Mr. O.Brien seen no
other chance of getting his money so there
was a subscription collected for Hall
and with the aid of this money he got
James Murdock who was recently hung
in Wagga Wagga to give false evidence
against me but I was aquitted on
the charge of horsestealing and on
Hall and Murdocks evidence
I was found guilty of receiving and
got 3 years experience in Beechworth
Pentridges dungeons. this is the only
charge ever proved against me
Therefore I can say I never was
convicted of horse or cattle stealing.
My Brother Dan was never charged
with assaulting a woman but he
was sentenced to three months
without the option of a fine and
one month and two pound fine`,lineHeight:1.675},{copy:`for damaging property by Mr Butler P.M.
a sentence that there is no law to uphold
therefore the minister of Justice neglected
his duty in that case, but there never was
such a thing as Justice in the English
laws but any amount of injustice
to be had. Out of over thirty head of
the very best horses the land could produce
I could only find one when I got my
liberty. Constable Flood stole and sold
the most of them to the navvies on
the railway line one bay cob he
stole and sold four different times
the line was completed and the men
all gone when I came out and
Flood was shifted to Oxley. he carried
on the same game there all the stray
horses that was any time without
an owner and not in the Police
Gazette Flood used to claim`,lineHeight:1.675},{copy:`He was doing a good trade at Oxley
until Mr Brown of the Laceby Station
got him shifted as he was always run-
ning his horses about. Flood is different
to Sergeant Steel, Strachan, Hall
and the most of Police a they have got
to hire cads and if they fail the Police
are quite helpless. But Flood can
make a cheque single-handed. he is
the greatest horsestealer with the
exception of myself and George King
I know of. I never worked on a farm
a horse and saddle was never traced
to me after leaving employment
since February 1873 I worked as a
faller at Mr J. Saunders and R
Rules sawmills then for Heach
and Dockendorf I never worked
for less than two pound ten a
week since I left Pentridge`,lineHeight:1.675},{copy:`and in 1875 or 1876 I was overseer for
Saunders and Rule. Bourkes water-holes
sawmills in Victoria since then I was
on the King River, during my stay there
I ran in a wild bull which I gave
to Lydicher a farmer he sold him
to Carr a Publican and Butcher
who killed him for beef, sometime
afterwards I was blamed for stealing
this bull from James Whitty Boggy Creek
I asked Whitty Oxley racecourse why
he blamed me for stealing his bull
he said he had found his bull and
never blamed me but his son-in-law
Farrell told him he heard I sold
the bull to Carr not long afterwards
I heard again I was blamed for
stealing a mob of calves from Whitty
and Farrell which I knew nothing
about. I began to think they wanted`,lineHeight:1.675},{copy:`me to give them something to talk
about. Therefore I started wholesale
and retail horse and cattle dealing.
Whitty and Burns not being satisfied
with all the picked land on the Boggy
Creek and King River and the run
of their stock on the certificate ground
free and no one interfering with
them paid heavy rent to the banks
for all the open ground so as a poor
man could keep no stock, and impound-
ded every beast they could get, even off
Government roads. If a poor man
happened to leave his horse or bit of
a poddy calf outside his paddock
they would be impounded. I have
known over 60 head of horses impoun-
ded in one day by Whitty and
Burns all belonging to poor farmers
they would have to leave their`,lineHeight:1.675},{copy:`ploughing or harvest or other employment
to go to Oxley. when they would get
there perhaps not have money enough
to release them and have to give a
bill of sale or borrow the money which
is no easy matter. And along with all
this sort of work, Farrell the Policeman
stole a horse from George King. And
had him in Whitty and Farrells
Paddocks until he left the force. And
all this was the cause of me and
my step-father George King taking
their horses and selling them to
Baumgarten and Kennedy. the pick
of them was taken to a good market
and the culls were kept in Petersons pad-
dock and their brands altered by me
two was sold to Kennedy and the rest
to Baumgarten who were strangers to
me and I believe honest men.`,lineHeight:1.675},{copy:`They paid me full value for the horses
and could not have known they were
stolen. no person had anything to do
with the stealing and selling of the horses
but me and George King. William
Cooke who was convicted for Whittys horses
was innocent he was not in my com-
pany at Petersons. But it is not the
place of the Police to convict guilty men
as it is by them they get their living
had the right parties been convicted
it would have been a bad job for
the Police as Berry would have
sacked a great many of them
only I came to their aid and
kept them in their bilits and good
employment and got them double
pay and yet the ungrateful articles
convicted my mother and an infant
my brother-in-law and another man`,lineHeight:1.675},{copy:`who was innocent and still annoy
my brothers and sisters and the ignorant
unicorns even threaten to shoot myself
But as soon as I am dead they will be
heels up in the muroo. there will be
no more police required they will be
sacked and supplanted by soldiers
on low pay in the towns and special
constables made of some of the farmers
to make up for this double pay and
expence. It will pay Government
to give those people who are suffering
innocence, justice and liberty. if
not I will be compelled to show
some colonial stratagem which
will open the eyes of not only the
Victorian Police and inhabitants
but also the whole British army
and now doubt they will acknowledge
their hounds were barking at the`,lineHeight:1.675},{copy:`wrong stump. And that Fitzpatrick
will be the cause of greater slaughter
to the Union Jack than Saint Patrick
was to the snakes and toads in
Ireland. The Queen of England was as
guilty as Baumgarten and Kennedy
Williamson and Skillion of what they
were convicted for When the horses
were found on the Murray River
I wrote a letter to Mr Swanhill of
Lake Rowan to acquaint the Auction-
eer and to advertize my horses for sale
I brought some of them to that place but
did not sell I sold some of them in
Benalla Melbourne and other
places and left the colony and
became a rambling gambler
soon after I left there was a
warrant for me and the Police
searched the place and watched`,lineHeight:1.675},{copy:`night and day for two or three weeks
and when they could not snare me
they got a warrant against my
brother Dan And on the 15 of April
Fitzpatrick came to the Eleven Mile
Creek to arrest him he had some
conversation with a horse dealer
whom he swore was William Skillion
this man was not called in
Beechworth, besides several other
Witnesses, who alone could have
proved Fitzpatricks falsehood
after leaving this man he went
to the house asked was Dan in
Dan came out. I hear previous
to this Fitzpatrick had some con
versation with Williamson on
the hill. he asked Dan to come
to Greta with him as he had
a warrant for him for stealing`,lineHeight:1.675},{copy:`Whittys horses Dan said all right
they both went inside Dan was
having something to eat his mother
asked Fitzpatrick what he wanted
Dan for. the trooper said he
had a warrant for him Dan
then asked him to produce
it he said it was only a telegram
sent from Chiltren but Sergeant
Whelan ordered him to releive
Steel at Greta and call and
arrest Dan and take him into
Wangaratta next morning and
get him remanded Dans mother
said Dan need not go without
a warrant unless he liked and
that the trooper had no business
on her premises without some
Authority besides his own word.
The trooper pulled out his`,lineHeight:1.675},{copy:`revolver and said he would blow
her brains out if she interfered.
in the arrest she told him it
was a good job for him Ned was
not there or he would ram the
revolver down his throat Dan
looked out and said Ned is com-
ing now. the trooper being off his
guard looked out and when Dan
got his attention drawn he dropped
the knife and fork which showed
he had no murderous intent
and slapped heeuaus hug on him
took his revolver and kept him
there until Skillion and Ryan
came with horses which Dan
sold that night. The trooper left
and invented some scheme to say
that he got shot which any man
can see is false, he told Dan to`,lineHeight:1.675},{copy:`clear out that Sergeant Steel and Detec-
tive Brown and Strachan would
be there before morning Strachan
had been over the Murray trying
to get up a case against him and
they would convict him if they
caught him as the stock society
offared an enticement for wit-
nesses to swear anything and the
germans over the Murray would
swear to the wrong man as well
as the right, Next day Williamson
and my mother was arrested and
Skillion the day after who was not
there at all at the time of the row
which can be proved by 8 or 9 witnesses
And the Police got great credit and
praise in the papers for arresting the
mother of 12 children one an infant
on her breast and those two quiet`,lineHeight:1.675},{copy:`hard working innocent men who would
not know the difference a revolver
and a saucepan handle and kept
them six months awaiting trial and
then convicted them on the evidence
of the meanest article that ever the
sun shone on it seems that the
jury was well chosen by the Police
as there was a discharged Sergeant
amongst them which is contrary to
law they thought it impossible for a
Policeman to swear a lie but I can
assure them it is by that means
and hiring cads they get promoted
I have heard from a trooper
that he never knew Fitzpatrick
to be one night sober and that he
sold his sister to a chinaman
but he looks a young strapping
rather genteel more fit to be a`,lineHeight:1.675},{copy:`starcher to a laundress than a Policeman.
For to a keen observer he has the wrong
appearance or a manly heart the
deceit and cowardice is too plain
to be seen in the puny cabbage heart-
ed looking face. I heard nothing of
this transaction until very close on
the trial I being then over 400 miles
from Greta when I heard I was
outlawed and a hundred pound
reward for me for shooting at a
trooper in Victoria and a hund-
red pound for any man that could
prove a conviction of horse-stealing
against me so I came back to
Victoria knew I would get no
justice if I gave myself up I
enquired after my brother Dan
and found him digging on Bul-
lock Creek heard how the Polic`,lineHeight:1.675},{copy:`used to be blowing that they would
not ask me to stand they would
shoot me first and then cry sur-
render and how they used to rush
into the house upset all the milk
dishes break tins of eggs empty the
flour out of the bags onto the ground
and even the meat out of the cask
and destroy all the provisions and
shove the girls in front of them into
the rooms like dogs so as if any-
one was there they would shoot the
girls first but they knew well
I was not there or I would have
scattered their blood and brains
like rain I would manure the
Eleven mile with their bloated
carcasses and yet remember there
is not one drop of murderous
blood in my Veins.`,lineHeight:1.675},{copy:`Superintendent Smith used to say
to my sisters, see all the men
all I have out today I will have
as many more tomorrow and we
will blow him into pieces as small
as paper that is in our guns Det-
ective Ward and Constable Hayes
took out their revolvers and threat-
hened to shoot the girls and children
in Mrs Skillions absence the greatest
ruffians and murderers no matter
how deprived would not be guilty
of such a cowardly action, and
this sort of cruelty and disgraceful
and cowardly conduct to my brothers
and sisters who had no protection
coupled with the conviction of
my mother and those men certainly
made my blood boil as I dont think
there is a man born could have`,lineHeight:1.675},{copy:`the patience to suffer it as long as I did
or ever allow his blood to get cold while
such insults as these were unavenged
and yet in every paper that is printed
I am called the blackest and coldest
blooded murderer ever on record.
But if I hear any more of it I will
not exactly show them what cold-
blooded murder is but wholesale
and retail slaughter, something
different to shooting three troopers
in self defence and robbing a
bank. I would have been rather
hot-blooded to throw down my
rifle and let them shoot me and
my innocent brother, they were
not satisfied with frightening
my sisters night and day and
destroying their provisions and
lagging my mother and an infant`,lineHeight:1.675},{copy:`and those innocent men but should
follow me and my brother into
the wilds where he had been quietly
digging neither molesting or inter-
efering with anyone he was making
good wages as the creek is very rich
within half a mile from where I
shot Kennedy. I was not there
long and on the 25 of October
I came on Police tracks between
Tabletop and the bogs. I crossed
them and returning in the evening
I came on a dif-ferent lot of tracks
making for the shingle hut I went
to our camp and told my brother
and his two mates me and
my brother went and found
their camp at the shingle hut
about a mile from my brothers
house, saw they carried long`,lineHeight:1.675},{copy:`firearms and we knew our doom
was sealed if we could not beat
those before the others would come
as I knew the other party of Police
would soon join them and if they
came on us at our camp they
would shoot us down like dogs
at our work as we had only two
guns. we thought it best to try and
bail those up take their firearms
and ammunition and horses
and we could stand a chance
with the rest We approached the
spring as close as we could get to
the camp as the intervening space
being clear ground and no battery
We saw two men at the logs they
got up and one took a double barrel-
ed fowling-piece and fetched a horse
down and hobbled him at the tent`,lineHeight:1.675},{copy:`we thought there were more men in the
tent asleep those being on sentry we
could have shot those two men with-
out speaking but not wishing
to take their lives we waited. Mc
Intyre laid the gun against a
stump and Lonigan sat on the log
I advanced, my brother Dan keep-
in McIntyre covered which he took
to be constable Flood and had he
not obeyed my orders, or attempted
to reach for the gun or draw his
revolver he would have been shot
dead. but when I called on them
to throw up their hands McIntyre
obeyed and Lonigan ran some
six or seven yards to a battery
of logs insted of dropping behind
the one he was sitting on, he
had just got to the logs and put`,lineHeight:1.675},{copy:`his head up to take aim when I
shot him that instant or he would
have shot me as I took him to be
Strachan the man who said he would
not ask me to stand he would
shoot me first like a dog. But it
happened to be Lonigan the man
who in company with Sergeant Whelan
Fitzpatrick and King the Boot maker
and constable O. Day that tried to
put a pair of hand-cuffs on me in
Benalla but could not, and had
to allow McInnis the miller to
put them on, previous to Fitzpatrick
swearing he was shot, I was fined
two pounds for hitting Fitzpatrick
and two pounds for not allowing
five curs like Sergeant Whelan
O. Day Fitzpatrick King and Lonigan
who caught me by the privates`,lineHeight:1.675},{copy:`and would have sent me to Kingdom
come only I was not ready and he
is the man that blowed before he
left Violet Town. if Ned Kelly was to
be shot he was the man would
shoot him and no doubt he would
shoot me even if I threw up my
arms and laid down as he knew
four of them could not arrest me
single-handed not to talk of the
rest of my mates, also either me
or him would have to die, this he
knew well, therefore he had a right to
keep out of my road, Fitzpatrick
is the only one I hit out of the five
in Benalla, this shows my feeling
towards him as he said we were
good friends and even swore it
but he was the biggest enemy I had
in the country with the exception`,lineHeight:1.675},{copy:`of Lonigan and he can be thankful
I was not there when he took a
revolver and threathened to shoot
my mother in her own house it
is not fire three shots and miss him
at a yard and a half I dont think
I would use a revolver to shoot a
man like him when I was within
a yard and a half of him or att-
empt to fire into a house where
my mother brothers and sisters
was. and according to Fitzpatricks
statement all around him a man
that is such a bad shot as to miss
a man three times at a yard and
a half would never attempt to
fire into a house among a house
full of women and children while
I had a pair of arms and bunch
of fives on the end of them`,lineHeight:1.675},{copy:`that never failed to peg out any-
thing they came in contact with
and Fitzpatrick knew the weight
of one of them only too well, as it run
against him once in Benalla. and
cost me two pound odd as he is very
subject to fainting. As soon as I shot
Lonigan he jumped up and stag-
gered some distance from the logs
with his hands raised and then fell
he surrendered but too late I asked
McIntyre who was in the tent he
replied no one. I advanced and
took possession of their two revolvers
and fowling-piece which I loaded
with bullets instead of shot. I asked
McIntyre where his mates was he
said they had gone down the
creek, and he did not expect them
that night he asked me was I`,lineHeight:1.675},{copy:`going to shoot him and his mates. I told
him no. I would shoot no man if he
gave up his arms and leave the force
he said the police all knew Fitzpatrick had
wronged us. And he intended to leave the
force, as he had bad health, and his life
was insured, he told me he intended
going home. And that Kennedy and
Scanlan were out looking for our camp
And also about the other Police he told
me the N.S.W Police had shot a man
for shooting Sergeant Walling I told him
if they did, they had shot the wrong man
And I expect your gang came to do the
same with me he said no they did
not come to shoot me they came to
apprehend me I asked him what
they carried spenceir rifles and breech-
loading fowling pieces and so much
ammunition for as the Police was`,lineHeight:1.675},{copy:`Only supposed to carry one revolver and
6 cartridges in the revolver but they had
eighteen rounds of revolver cartridges
each three dozen for the fowling piece
and twenty one spenceir-rifle cartridges
and God Knows how many they
had away with the rifle this looked
as if they meant not only to shoot
me only to riddle me but I dont
know either Kennedy Scanlan or
him and had nothing against
them, he said he would get them
to give up their arms if I would
not shoot them as I could not
blame them, they had to do their
duty I said I did not blame them
for doing honest duty but I could
not suffer them blowing me to pieces
in my own native land and
they knew Fitzpatrick wronged`,lineHeight:1.675},{copy:`us and why not make it public and
convict him but no they would
rather riddle poor unfortunate creoles.
but they will rue the day ever Fitz-
patrick got among them, Our two
mates came over when they heard the
shot fired but went back again
for fear the Police might come to
our camp while we were all away
and manure bullock flat with
us on our arrival. I stopped at
the logs and Dan went back to
the spring for fear the tropers would
come in that way but I soon heard
them coming up the creek. I told
McIntyre to tell them to give up
their arms he spoke to Kennedy
who was some distance in front
of Scanlan he reached for his
revolver and jumped off, on the off`,lineHeight:1.675},{copy:`side of his horse and got behind a tree
when I called on them to throw up
their arms and Scanlan who carried
the rifle slewed his horse around to
gallop away but the horse would not
go and as quick as thought fired
at me with the rifle without unsling-
ing it and was in the act of firing
again when I had to shoot him
and he fell from his horse. I could
have shot them without speaking but
their lives was no good to me. Mc
Intyre jumped on Kennedys horse
and I allowed him to go as I did
not like to shoot him after he surren-
dered or I would have shot him as
he was between me and Kennedy
therefore I could not shoot
Kennedy without shooting him
first Kennedy kept firing from`,lineHeight:1.675},{copy:`behind the tree my brother Dan advanced
and Kennedy ran I followed him he
stopped behind another tree and
fired again I shot him in the arm-
pit and he dropped his revolver and
ran I fired again with the gun as
he slewed around to surrender I did
not know he had dropped his revolver.
the bullet passed through the right
side of his chest and he could not live
or I would have let him go had they
been my own brothers I could not help
shooting them or else let them shoot me
which they would have done had their
bullets been directed as they intended
them. But as for handcuffing Kennedy
to a tree or cutting his ear off or bru-
tally treating any of them is a false-
hood, if Kennedys ear was cut off
it was not done by me and none`,lineHeight:1.675},{copy:`of my mates was near him after he was
shot I put his cloak over him and left him
as well as I could and were they my
own brothers I could not have been more
sorry for them this cannot be called wil-
ful murder for I was compelled to shoot
them, or lie down and let them shoot
me it would not be wilful murder
if they packed our remains in, shattered
into a mass of animated gore to Mans-
field. They would have got great praise
and credit as well as promotion but
I am reconed a horrid brute because
I had not been cowardly enough to
lie down for them under such trying
circumstances and insults to my
people certainly their wives and
children are to be pitied but they
must remember those men came
into the bush with the intention`,lineHeight:1.675},{copy:`of scattering pieces of me and my
brother all over the bush and yet they
know and acknowledge I have been
wronged and my mother and four
or five men lagged innocent and
is my brothers and sisters and my mother
not to be pitied also who has no
alternative only to put up with the
brutal and cowardly conduct of a
parcel of big ugly fat-necked wombat
headed big bellied magpie legged
narrow hipped splaw-footed sons of Irish
Bailiffs or english landlords which
is better known as Officers of Justice
or Victorian Police who some calls
honest gentlemen but I would
like to know what business an
honest man would have in the
Police as it is an old saying It takes
a rogue to catch a rogue and a`,lineHeight:1.675},{copy:`man that knows nothing about roguery
would never enter the force an take an
oath to arrest brother sister father or
mother if required and to have a
case and conviction if possible.
Any man knows it is possible to
swear a lie and if a policeman
looses a conviction for the sake
of swearing a lie he has broke his
oath therefore he is a perjurer either
ways. A Policeman is a disgrace to his
country, not alone to the mother that
suckled him, in the first place he
is a rogue in his heart but too cowardly
to follow it up without having the force
to disguise it. Next he is traitor to his
country ancestors and religion
as they were all catholics before the
Saxons and Cranmore yoke held
sway since then they were perse-`,lineHeight:1.675},{copy:`cuted massacreed thrown into
martrydom and tortured beyond
the ideas of the present generation
What would people say if they saw a
strapping big lump of an Irishman
shepherding sheep for fifteen bob a week
or tailing turkeys in Tallarook ranges
for a smile from Julia or even
begging his tucker, they would say
he ought to be ashamed of himself
and tar-and-feather him. But
he would be a king to a policeman
who for a lazy loafing cowardly
bilit left the ash corner deserted the
shamrock, the emblem of true
wit and beauty to serve under a
flag and nation that has destroyed
massacreed, and murdered their forefathers by the
greatest of torture as rolling them
down hill in spiked barrels`,lineHeight:1.675},{copy:`pulling their toe and finger nails and on
the wheel. and every torture imaginable
more was transported to Van Diemands
Land to pine their young lives away in
starvation and misery among tyrants
worse than the promised hell itself all
of true blood bone and beauty, that
was not murdered on their own soil,
or had fled to America or other count-
ries to bloom again another day, were
doomed to Port Mcquarie Toweringabbie
and norfolk island and Emu plains
And in those places of tyranny and con-
demnation many a blooming Irish-
man rather than subdue to the Saxon
yoke, Were flogged to death And bravely
died in servile chains but true to
the shamrock and a credit to Paddys
land. What would people say if I
became a policeman and took`,lineHeight:1.675},{copy:`an oath to arrest my brothers and
sisters and relations and convict
them by fair or foul means after
the conviction of my mother and
the persecutions and insults offered to
myself and people Would they say
I was a decent gentleman. And yet
a policeman is still in worse and
guilty of meaner actions than that
The Queen must surely be proud of
such herioc men as the Police
and Irish soldiers as It takes eight
or eleven of the biggest mud crushers
in Melbourne to take one poor
little half starved larrakin to a
watch house. I have seen as many
as eleven, big and ugly enough to lift
Mount Macedon out of a crab hole
more like the species of a baboon
or Guerilla than a man.`,lineHeight:1.675},{copy:`actually come into a court house
and swear they could not arrest one
eight stone larrakin and them armed
with battens and neddies without
some civilians assistance and
some of them going to the hospital
from the affects of hits from the
fists of the larrakin and the
Magistrate would send the poor
little Larrakin into a dungeon
for being a better man than such
a parcel of armed curs. What would
England do if America declared war
and hoisted a green flag as its all
Irishmen that has got command of her
armies forts and batteries even her
very life guards and beef tasters are
Irish would they not slew around
and fight her with their own arms
for the sake of the colour they dare not wear`,lineHeight:1.675},{copy:`for years. and to reinstate it and rise
old Erins isle once more, from the pressure
and tyrannism of the English yoke, which
has kept it in poverty and starvation.
and caused them to wear the enemys
coats. What else can England expect.
Is there not big fat-necked Unicorns
enough paid to torment and drive
me to do thing which I dont wish to
do, without the public assisting them
I have never interefered with any
person unless they deserved it. And
yet there are civilians who take
firearms against me, for what
reason I do not know, unless they
want me to turn on them and exter-
minate them without medicine. I
shall be compelled to make an exam-
ple of some of them if they cannot
find no other employment`,lineHeight:1.675},{copy:`If I had robbed and plundered ravished
and murdered everything I met young
and old, rich and poor. the public
could not do any more than take firearms
and assisting the police as they have
done, but by the light that shines
pegged on an ant-bed with their
bellies opened their fat taken out render-
ed and poured down their throat
boiling hot will be fool to what
pleasure I will give some of them
and any person aiding or harbouring
or assisting the Police in any way
whatever or employing any person
whom they know to be a detective
or cad or those who would be
so deprived as to take blood
money will be Outlawed and
declared unfit to be allowed
human buriel their property`,lineHeight:1.675},{copy:`either consumed or confiscated
and them theirs and all belonging
to them exterminated off the face of
the earth, the enemy I cannot catch
myself I shall give a payable reward
for, I would like to know who put
that article that reminds me of a
poodle dog half clipped in the lion
fashon called Brooke. E. Smith
Superintendent of Police he knows
as much about commanding
Police as Captain Standish does
about mustering mosquitoes and
boiling them down for their fat
on the back blocks of the Lachlan
for he has a head like a turnip
a stiff neck as big as his shoulders
narrow hipped and pointed towards
the feet like a vine stake And if
there is any one to be called a murderer`,lineHeight:1.675},{copy:`Regarding Kennedy, Scanlan and
Lonigan it is that misplaced poodle
he gets as much pay as a dozen good
troopers, if there is any good in them,
And what does he do for it he cannot
look behind him without turning
his whole frame. it takes three or
four police to keep sentry while he
sleeps in Wangaratta, for fear of body
snatchers do they think he is a
superior animal to the men that
has to guard him if so why not
send the men that gets big pay and
reconed superior to the common
police after me and you shall soon
save the country of high salaries
to men that is fit for nothing else
but getting better men than him-
self shot and sending orphan
children to the industrial school`,lineHeight:1.675},{copy:`to make prostitutes and cads of
them for the Detectives and other evil
disposed persons Send the high paid
and men that received big salaries
for years in a gang by themselves
after me As it makes no difference
to them but it will give them a chance
of showing whether they are worth more
pay than a common trooper or not
And I think the Public will soon find
they are only in the road of good men
and obtaining money under false
pretences, I do not call McIntyre
a coward for I reckon he is as
game a man as wears the jacket
as he had the presence of mind to know
his position, directly as he was spoken
to, and only foolishness to disobey, it
was cowardice that made Lonigan
and the others fight it is only`,lineHeight:1.675},{copy:`foolhardiness to disobey an outlaw
as any Policeman or other man
who do not throw up their arms directly
as I call on them knows the con-
sequence which is a speedy dispatch
to Kingdom Come, I wish those
men who joined the stock protection
society to withdraw their money and
give it and as much more to the widows
and orphans and poor of Greta district
wher I spent and will again spend many
a happy day fearless free and bold,
as it only aids the police to procure
false witnesses and go whacks with
men to steal horses and lag innocent
men it would suit them far better
to subscribe a sum and give
it to the poor of their district
and there is no fear of anyone
stealing their property for no man`,lineHeight:1.675},{copy:`could steal their horses without
the knowledge of the poor if any man
was mean enough to steal their property
the poor would rise out to a man
and find them if they were on the face
of the earth it will always pay a
rich man to be liberal with the poor
and make as little enemies as he can
as he shall find if the poor is on his
side he shall loose nothing by it.
If they depend in the police they shall be
drove to destruction, As they cannot
and will not protect them if duffing
and bushranging were abolished the
police would have to cadge for their
living I speak from experience as I have
sold horses and cattle innumerable
and yet eight head of the culls is all
ever was found. I never was interefered
with whilst I kept up this successful`,lineHeight:1.675},{copy:`trade. I give fair warning to all those
who has reason to fear me to sell out and give
10 out of every hundred towards the widow
and orphan fund and do not attempt to
reside in Victoria but as short a time as
possible after reading this notice, neglect this
and abide by the consequences, which shall
be worse than the rust in the wheat in
Victoria or the druth of a dry season to
the grasshoppers in New South Wales I do not
wish to give the order full force without
giving timely warning, but I am a widows son
outlawed and my orders must be obeyed.`,lineHeight:1.675}]);this.camera=e,this.skinnedAnimationController=t,this.letterAsset=i,this.letterMaterialManager=new Zx,this.overlayMaterial=new qt({color:0,transparent:!0,opacity:.8,polygonOffset:!0,polygonOffsetFactor:2,polygonOffsetUnits:1,depthTest:!1,depthWrite:!1})}raycastFromCenter(e,t,i={}){const{rings:n=[{radius:0,points:1},{radius:.05,points:8},{radius:.15,points:16},{radius:.3,points:24},{radius:.5,points:32}],layerMask:s=1,lineThreshold:a=.1,pointsThreshold:r=.1}=i,l=[];n.forEach(d=>{if(d.points===1)l.push(new et(0,0));else for(let f=0;f<d.points;f++){const p=f/d.points*Math.PI*2,b=Math.cos(p)*d.radius,_=Math.sin(p)*d.radius;l.push(new et(b,_))}});const c=[],h=new ys;return h.layers.set(s),h.params.Line.threshold=a,h.params.Points.threshold=r,l.forEach((d,f)=>{h.setFromCamera(d,e),i!=null&&i.distance&&(h.far=i.distance),h.intersectObjects(t,!0).forEach(b=>{const _=d.length();c.push({intersection:b,screenDistance:_,rayIndex:f})})}),c.length===0?null:(c.sort((d,f)=>d.screenDistance-f.screenDistance),c[0].intersection)}generateLetterPanModeOverlayPlanes(e,t,i,n,s,a,r,l,c){const f=(e+i)*7/2*-1+e/2+i/2,p=(t+n)*4/2-t/2-n/2;for(let b=0;b<4;b++)for(let _=0;_<7;_++){const y=f+(e+i)*_,v=p+(t+n)*b*-1,S=this.generateLetterOverlay(e,t,y,v);let A=(b*7+_)*2;const E=this.generateLetterText(e-s*2,t-a*2,y-e/2+s,v+t/2-a,c[A],A),O=this.generateLetterIndex(e,t,y,v-t/2,A+1);r.add(S),r.add(E),l.add(O)}}toggleTextContent(){this.letterOverlays&&(this.letterOverlays.children.forEach(e=>{let t=this.odds?e.userData.index:e.userData.index+1;if(e.name.includes("text-mesh__")&&t<this.letterContentArray.length){const i=this.letterContentArray[t];e.text=(i==null?void 0:i.copy)||"empty",i!=null&&i.lineHeight&&(e.lineHeight=i.lineHeight),(i==null?void 0:i.paddingTop)!==void 0&&(e.userData.baselineY===void 0&&(e.userData.baselineY=e.position.y),e.position.y=e.userData.baselineY-(i.paddingTop||0)),e.sync()}}),this.indexOverlays.children.forEach(e=>{let t=this.odds?e.userData.index:e.userData.index+1;e.text=t}))}generateLetterOverlay(e,t,i,n){const s=new ba(e,t),a=this.overlayMaterial,r=new It(s,a);return r.renderOrder=2,r.position.set(i,n,0),r}generateLetterText(e,t,i,n,s,a){const r=new Fh;return r.name=`text-mesh__${a}`,r.userData.index=a,r.text=(s==null?void 0:s.copy)||"empty",r.position.set(i,n-((s==null?void 0:s.paddingTop)||0),875e-6),r.userData.baselineY=n,r.font="https://d38p9xpr4rdpkc.cloudfront.net/slv-a-mouthful-of-dust/media/fonts/175082314a0e3/proximanova.otf",r.fontSize=.005,r.fontWeight="normal",r.textAlign="hard-justify",r.color=new Dt(4,4,4),r.lineHeight=(s==null?void 0:s.lineHeight)||1.2,r.maxWidth=e,r.depthOffset=-1,r.renderOrder=3,r.sync(),r}generateLetterIndex(e,t,i,n,s){const a=new Fh;return a.name=`index-mesh__${s}`,a.userData.index=s,a.text=`${s}`,a.position.set(i,n,875e-6),a.userData.baselineY=n,a.font="https://d38p9xpr4rdpkc.cloudfront.net/slv-a-mouthful-of-dust/media/fonts/175082314a0e3/proximanova.otf",a.fontSize=.01,a.fontWeight="normal",a.textAlign="center",a.anchorX="center",a.color=16777215,a.lineHeight=1.2,a.maxWidth=e,a.depthOffset=-1,a.renderOrder=4,a.sync(),a}static getPageGeo(e){let t=null;return e.traverse(i=>{t||i.name&&i.name.startsWith("Geo")&&i instanceof It&&(t=i)}),t}static async generateLetterPageMaterial(e,t="low"){if(e){let i,n=0;switch(Gs.getInstance().getPreference("graphics-preset","low")){case"high":t==="low"?(i=655,n=1024):(t==="high"||t=="cinema")&&(i=3862,n=6039);break;case"med":t==="low"?(i=328,n=512):t==="high"?(i=2620,n=4096):t==="cinema"&&(i=3862,n=6039);break;case"low":default:t==="low"?(i=328,n=512):t==="high"?(i=655,n=1024):t==="cinema"&&(i=2620,n=4096);break}const r=Un(e,i,n),l=new nc;return new Promise(c=>{l.load(r,h=>{h.flipY=!1;const d=new Sn({map:h,transparent:!0,depthWrite:!0,alphaTest:.5,side:zn});d.onBeforeCompile=f=>{f.uniforms.dimFactor={value:1},f.fragmentShader=`
                  uniform float dimFactor;
                  ${f.fragmentShader}
                `.replace("vec4 diffuseColor = vec4( diffuse, opacity );","vec4 diffuseColor = vec4( diffuse * dimFactor, opacity );"),d.userData.shader=f},c(d)},void 0,h=>{console.error("Failed to load texture:",r,h);const d=new qt({color:Math.random()*16777215,side:zn});c(d)})})}return Promise.resolve(new qt({color:Math.random()*16777215,side:zn}))}findPageMeshByName(e){const i=this.skinnedAnimationController.getSkinnedMesh().children.find(n=>n.name==="Paper_Clone");return(i==null?void 0:i.getObjectByName(e))||null}flipPageWithAutoRipple(e,t={}){const{direction:i="forward",duration:n=1200,curlIntensity:s=.15,rippleDelay:a=75,onComplete:r}=t,l=e.name;let c=0,h=0;const d=this.pageLayout.flat().length,f=()=>{h++,h>=d&&r&&r()},p=()=>{const b=this.getPagesAtDistance(l,c);b.length!==0&&(b.forEach(_=>{const y=this.findPageMeshByName(_);y&&this.animateFlip(y.children[0],i,n,s,f)}),c++,setTimeout(p,a))};if(d===0&&r){r();return}p()}animateFlip(e,t="forward",i=1200,n=.15,s=null){var _;if(e.userData.flipAnimating)return;e.userData.flipAnimating=!0;let a=null;e.traverse(y=>{y.isSkinnedMesh&&(a=y)});const r=((_=a==null?void 0:a.skeleton)==null?void 0:_.bones)||[],l=r.map(y=>({rotation:{x:y.rotation.x,y:y.rotation.y,z:y.rotation.z},position:{x:y.position.x,y:y.position.y,z:y.position.z}})),h=(e.rotation.z%(Math.PI*2)+Math.PI*2)%(Math.PI*2);let d;t==="forward"?d=h<Math.PI?Math.PI:Math.PI*2:d=h<Math.PI?Math.PI:0;const f=d===Math.PI*2?0:d,p=performance.now(),b=y=>{const v=y-p,S=Math.min(v/i,1),A=kt.smoothstep(S);if(e.rotation.z=h+(d-h)*A,e.position.y=0-Math.abs(Math.sin(Math.PI*A))*.1,r.length>0){const O=h>Math.PI/2&&h<3*Math.PI/2?-1:1;r.forEach((R,k)=>{if(k>0){const U=k/(r.length-1),C=U*.2,T=Math.max(0,(A-C)/(1-C)),Z=Math.max(0,Math.min(1,T)),z=Z*Math.PI;let B=Math.sin(z)*n;if(Z>.7){const Y=(Z-.7)/.3,J=1-kt.smoothstep(Y);B*=J}const V=B*Math.pow(U,.7)*O;R.rotation.x=l[k].rotation.x+V,R.rotation.z=l[k].rotation.z+V*4}}),a!=null&&a.skeleton&&a.skeleton.update()}S<1?requestAnimationFrame(b):(e.rotation.z=f,e.position.y=0,r.forEach((E,O)=>{E.rotation.x=l[O].rotation.x,E.rotation.y=l[O].rotation.y,E.rotation.z=l[O].rotation.z,E.position.x=l[O].position.x,E.position.y=l[O].position.y,E.position.z=l[O].position.z}),a!=null&&a.skeleton&&a.skeleton.update(),e.userData.flipAnimating=!1,s&&s())};requestAnimationFrame(b)}flipToSide(e,t=!0,i=1200,n=null){const r=(e.rotation.z%(Math.PI*2)+Math.PI*2)%(Math.PI*2)<Math.PI;if(t&&!r||!t&&r){const l=t?"backward":"forward";this.animateFlip(e,l,i,n)}else n&&n()}findPagePosition(e){for(let t=0;t<this.pageLayout.length;t++)for(let i=0;i<this.pageLayout[t].length;i++)if(this.pageLayout[t][i]===e)return{col:i,row:t};return null}getPositionDistance(e,t){return Math.abs(e.col-t.col)+Math.abs(e.row-t.row)}getPagesAtDistance(e,t){const i=this.findPagePosition(e);if(!i)return[];const n=[];for(let s=0;s<this.pageLayout.length;s++)for(let a=0;a<this.pageLayout[s].length;a++)this.getPositionDistance(i,{col:a,row:s})===t&&n.push(this.pageLayout[s][a]);return n}getPageAtPosition(e,t){return t>=0&&t<this.pageLayout.length&&e>=0&&e<this.pageLayout[t].length?this.pageLayout[t][e]:null}async handlePageDetection(e){var a,r;const t=this.odds?{label:"front",index:0}:{label:"back",index:1},i=this.letterMaterialManager.getMaterial(e.name,t.label,"high");if(i!=null&&i.material){const l=this.letterMaterialManager.getMaterial(e.name,t.label);if((l==null?void 0:l.quality)==="high")return;const c=Nn.getPageGeo(e);this.letterMaterialManager.applyMaterial(e.name,t.label,"high",c);return}if(this.materialSwitchQueue.includes(`${e.name}__${t.label}__high`))return;this.materialSwitchQueue.push(`${e.name}__${t.label}__high`);const n=(r=(a=this.letterAsset)==null?void 0:a.params)==null?void 0:r.pages[e.name][t.label].high,s=Nn.getPageGeo(e);Nn.generateLetterPageMaterial(n,"high").then(l=>{l.userData.name=`${e.name}__${t.label}__high`,this.queueMaterialSwitch(e.name,t.label,"high",l,s)})}queueMaterialSwitch(e,t,i,n,s){if(!this.camera.cameraController.getPanVelocity(!0)&&!this.camera.cameraController.getAbsPanVelocity(!0)||this.manualQueueProgress){this.manualQueueProgress=!1,this.letterMaterialManager.setMaterial(e,t,i,n,s);const a=this.materialSwitchQueue.indexOf(`${e}__${t}__${i}`);a>-1&&this.materialSwitchQueue.splice(a,1)}else setTimeout(()=>{this.queueMaterialSwitch(e,t,i,n,s)},10)}setCinemaModePages(){}setManualModePages(){}}class Kx{constructor(e,t){g(this,"app");g(this,"radius");g(this,"menuContainer",new ri);g(this,"menuCenter",new D(0,0,0));g(this,"globalScale");g(this,"menuItems",[]);g(this,"menuColliders",[]);g(this,"debugMode");g(this,"originalPositions",new Map);g(this,"standardColliderSize",new D(100,100,20));g(this,"highlightedItem",null);g(this,"elements",{menuCard:null,menuCardContent:null,menuCardAuthor:null,menuCardObject:null});g(this,"cardFadeAnimationId",null);g(this,"currentCardOpacity",0);g(this,"targetCardOpacity",0);g(this,"lastHighlightedItem",null);g(this,"lastAnnouncedItem",null);g(this,"fadeInProgress",!1);g(this,"debugMaterial");g(this,"debugSpheres",[]);g(this,"menuCollisionMesh",null);g(this,"checkMenuUiElements",()=>{var e,t,i,n;(e=this.elements)!=null&&e.menuCard||(this.elements.menuCard=document.getElementById("act-two__ui-menu-highlight")),(t=this.elements)!=null&&t.menuCardContent||(this.elements.menuCardContent=document.getElementById("act-two__ui-menu-highlight-content")),(i=this.elements)!=null&&i.menuCardAuthor||(this.elements.menuCardAuthor=document.getElementById("act-two__ui-menu-highlight-author")),(n=this.elements)!=null&&n.menuCardObject||(this.elements.menuCardObject=document.getElementById("act-two__ui-menu-highlight-object"))});g(this,"hideMenuHighlightCard",()=>{this.checkMenuUiElements(),this.elements.menuCard&&(this.elements.menuCard.style.display="none")});g(this,"showMenuHighlightCard",()=>{this.checkMenuUiElements(),this.elements.menuCard&&(this.elements.menuCard.style.display="flex")});g(this,"updateMenuHighlightCard",e=>{var i;if(!e)return;this.checkMenuUiElements();const t=e.userData.asset||((i=e.userData.menuItem)==null?void 0:i.userData.asset);t?(this.elements.menuCardAuthor&&(this.elements.menuCardAuthor.innerText=t.params.author),this.elements.menuCardAuthor.setAttribute("aria-label",ih(t.params.author)),this.elements.menuCardObject&&(this.elements.menuCardObject.innerText=t.params.label),this.elements.menuCardObject.setAttribute("aria-label",t.params.label)):console.warn("Asset information not found for highlighted item")});g(this,"startCardFadeAnimation",()=>{this.cardFadeAnimationId&&cancelAnimationFrame(this.cardFadeAnimationId),this.updateMenuHighlightCard(this.highlightedItem);const e=performance.now(),t=this.currentCardOpacity,i=300,n=s=>{const a=s-e,r=Math.min(a/i,1),c=(h=>h<.5?4*h*h*h:1-Math.pow(-2*h+2,3)/2)(r);this.currentCardOpacity=t+(this.targetCardOpacity-t)*c,this.updateCardOpacity(),r<1?(this.cardFadeAnimationId=requestAnimationFrame(n),this.fadeInProgress=!0):(this.cardFadeAnimationId=null,this.fadeInProgress=!1,this.currentCardOpacity=this.targetCardOpacity)};this.cardFadeAnimationId=requestAnimationFrame(n)});g(this,"updateCardOpacity",()=>{this.checkMenuUiElements(),this.elements.menuCard&&(this.elements.menuCard.style.opacity=this.currentCardOpacity.toString(),this.elements.menuCard.style.display=this.currentCardOpacity>0?"flex":"none")});g(this,"getHighlightedItem",e=>this.highlightedItem?this.highlightedItem:e?this.lastHighlightedItem:null);g(this,"showMenuItem",e=>{const t=this.getObjectByName(e);t&&this.showObject(t,2e3,new D(0,-2.5,0))});g(this,"setMenuItemBrightness",(e,t)=>{const i=this.getObjectByName(e);i&&this.setObjectBrightness(i,t)});g(this,"setLetterForTransition",e=>{var s,a;const t=(a=(s=this==null?void 0:this.app)==null?void 0:s.skinnedAnimationController)==null?void 0:a.getSkinnedMesh(),i=e?tu(e,0,.5):.5;if(!t)return;t.children.find(r=>r.name==="Paper_Clone").children.forEach(r=>{const l=Nn.getPageGeo(r);if(!l)return;const c=h=>{h.alphaTest=i||0,h.needsUpdate=!0};c(l.material[0]),c(l.material[1])})});g(this,"setLetterForOcclusion",()=>{var s;const e=this.getObjectByName("letter"),i=this.getAssetFromObject(e).getActiveQuality();((s=i==null?void 0:i.mesh)==null?void 0:s.children[0]).traverse(a=>{a instanceof It&&(a.material.alphaTest=.5,a.material.needsUpdate=!0)})});g(this,"animateToViewTransform",(e,t,i=1e3)=>new Promise(n=>{var _,y,v,S,A,E,O,R,k;const s=performance.now(),a=e.rotation.clone(),r=e.position.clone(),l=e.scale.clone(),c=new vn(di(((_=t.rotation)==null?void 0:_.x)||0),di(((y=t.rotation)==null?void 0:y.y)||0),di(((v=t.rotation)==null?void 0:v.z)||0)),h=new D(((S=t.position)==null?void 0:S.x)||0,((A=t.position)==null?void 0:A.y)||0,((E=t.position)==null?void 0:E.z)||0),d=typeof t.scale=="number"?new D(t.scale,t.scale,t.scale):new D(((O=t.scale)==null?void 0:O.x)||1,((R=t.scale)==null?void 0:R.y)||1,((k=t.scale)==null?void 0:k.z)||1),f=new ai().setFromEuler(a),p=new ai().setFromEuler(c),b=()=>{const U=performance.now()-s,C=Math.min(U/i,1),T=kt.easeInOutCubic(C),Z=new ai;Z.slerpQuaternions(f,p,T),e.quaternion.copy(Z),e.position.lerpVectors(r,h,T),e.scale.lerpVectors(l,d,T),C<1?requestAnimationFrame(b):n()};requestAnimationFrame(b)}));g(this,"animateAssetViewTransforms",(e,t)=>{const i=[];return e.params.models.forEach(n=>{var a;const s=(a=e.modelContainers.get(n.file))==null?void 0:a.container;s&&n.view&&i.push(this.animateToViewTransform(s,n.view,t))}),Promise.all(i)});g(this,"resetAssetViewTransforms",e=>{const t=[];return e.params.models.forEach(i=>{var s;const n=(s=e.modelContainers.get(i.file))==null?void 0:s.container;if(n){const a={rotation:i.rotation||{x:0,y:0,z:0},position:i.position||{x:0,y:0,z:0},scale:i.scale||1};t.push(this.animateToViewTransform(n,a,1))}}),Promise.all(t)});this.app=e,this.radius=t.radius,this.globalScale=t.globalScale,this.debugMode=t.debug||!1,this.app.scene.add(this.menuContainer),this.menuContainer.rotateY(di(110)),this.menuContainer.name="menu",this.debugMode&&this.createDebugMaterial()}createDebugMaterial(){this.debugMaterial=new qt({color:65280,wireframe:!0,transparent:!0,opacity:.5})}createObjectSelectMenu(e){const t=2*Math.PI/e.length;e.forEach((i,n)=>{var p;const s=n*t,a=this.radius*Math.cos(s),r=this.radius*Math.sin(s),l=new ri;l.position.set(a,0,r),l.userData.asset=i;const c=i.container;if(c.name=`${i.key}-asset`,l.name=`${i.key}-container`,l.lookAt(this.menuCenter),l.rotateY(Math.PI),i.params.transform){const{position:b,rotation:_,scale:y}=i.params.transform;b&&l.position.add(new D(b.x,b.y,b.z)),_&&(_.y!==void 0&&l.rotateY(di(_.y)),_.x!==void 0&&l.rotateX(di(_.x)),_.z!==void 0&&l.rotateZ(di(_.z))),y&&l.scale.multiply(new D(y.x,y.y,y.z))}l.add(c),this.originalPositions.set(l,l.position.clone());const h=i.getCameraCollisionMesh();h&&l.add(h);const d=((p=i.params.transform)==null?void 0:p.scale)||1;l.scale.setScalar(this.globalScale*d),this.menuContainer.add(l),this.menuItems.push(l);const f=this.createCollider(l,i,n,e.length);this.createDebugSphere(f),this.menuContainer.add(f),this.menuColliders.push(f)})}getCameraCollisionMeshForItem(e){const t=this.getAssetFromObject(e);if(t){const i=t.getCameraCollisionMesh();if(i)return i}return this.getDefaultCollisionMesh()}getMenuAssets(){return this.menuItems.map(e=>e.userData.asset).filter(e=>e!==void 0)}getDefaultCollisionMesh(){const e=new Wi(30,32,32),t=new qt({color:65280,wireframe:!0,visible:!0,side:Ai});return new It(e,t)}createCollider(e,t,i,n){var y;const s=new va(this.standardColliderSize.x,this.standardColliderSize.y,this.standardColliderSize.z);let a;this.debugMode?a=this.debugMaterial:a=new qt({visible:!1});const r=new It(s,a);r.name=`${t.key}-collider`;const l=i/n*Math.PI*2,c=this.radius*Math.cos(l),h=this.radius*Math.sin(l);r.position.set(c,0,h);const f=new D().subVectors(this.menuCenter,r.position).normalize().clone().negate(),p=new D(0,1,0),b=new D().crossVectors(p,f).normalize();if(r.userData.originalTorusPosition=new D(c,0,h),(y=t==null?void 0:t.params)!=null&&y.menuOffset){const v=new D;t.params.menuOffset.x&&v.add(f.clone().multiplyScalar(t.params.menuOffset.x)),t.params.menuOffset.y&&v.add(p.clone().multiplyScalar(t.params.menuOffset.y)),t.params.menuOffset.z&&v.add(b.clone().multiplyScalar(t.params.menuOffset.z)),r.position.add(v)}return r.lookAt(this.menuCenter),r.scale.setScalar(this.globalScale*1),r.userData.menuItem=e,r.userData.asset=t,r}createMenuCollisionMesh(e){const t=new Wi(this.radius,32,32),i=new qt({color:65280,wireframe:!0,visible:this.debugMode});this.menuCollisionMesh=new It(t,i),this.app.scene.add(this.menuCollisionMesh)}getMenuCollisionMesh(){return this.menuCollisionMesh}rotateObjects(e){this.menuItems.forEach(t=>{t.rotation.set(e.x,e.y,e.z)}),this.menuColliders.forEach(t=>{t.rotation.set(e.x,e.y,e.z)})}setHighlightedItem(e,t){this.highlightedItem&&(this.lastHighlightedItem=this.highlightedItem),this.highlightedItem!==e?(this.highlightedItem=e,this.updateHighlightCard(e,t)):this.updateHighlightedItemOpacity(t)}updateHighlightedItemOpacity(e){this.highlightedItem&&this.updateHighlightCard(this.highlightedItem,e)}updateHighlightCard(e,t){if(!t||(this.checkMenuUiElements(),!this.elements.menuCard))return;const i=this.getAssetFromObject(e);if(!i)return;this.elements.menuCardAuthor&&(this.elements.menuCardAuthor.innerHTML=i.params.author),this.elements.menuCardObject&&(this.elements.menuCardObject.innerText=i.params.label);const n=document.getElementById("act-two__ui-menu-highlight");n&&n.setAttribute("aria-label",`${ih(i.params.author)}  ${i.params.label}`),this.elements.menuCardContent&&(this.elements.menuCardContent.style.opacity=t.toString()),document.body.style.setProperty("--menu-card-opacity",t.toString()),this.elements.menuCard.style.setProperty("--menu-card-opacity",t.toString());const s=t*12;this.elements.menuCard.style.setProperty("--menu-blur-amount",`${s}px`),!n.getAttribute("aria-hidden")&&(!this.lastAnnouncedItem||this.lastAnnouncedItem!==this.highlightedItem)&&t>.9&&(this.app.uiManager.makeScreenReaderAnnouncement(`Looking at: ${ih(i.params.author)}  ${i.params.label}`),this.lastAnnouncedItem=this.highlightedItem),this.elements.menuCard.style.display=t>0?"flex":"none"}unsetHighlightedItem(){this.highlightedItem&&(this.lastHighlightedItem=this.highlightedItem),this.highlightedItem=null,this.hideHighlightCard()}hideHighlightCard(){this.checkMenuUiElements(),this.elements.menuCard&&(this.elements.menuCard.style.display="none")}forEachMenuItem(e){const t=this.menuItems.map(i=>e(i));return Promise.all(t)}showAll(e=500,t){const i=t?t.clone():void 0,n=this.menuItems.map(s=>this.showObject(s,e,i));return Promise.all(n)}showAllWithOpacity(e=500,t){const i=t?t.clone():void 0,n=this.menuItems.map(s=>this.showObjectWithOpacity(s,e,i));return Promise.all(n)}hideAllWithOpacity(e=500,t){const i=t?t.clone():void 0,n=this.menuItems.map(s=>this.hideObjectWithOpacity(s,e,i));return Promise.all(n)}hideAll(e=500,t){const i=t?t.clone():void 0,n=this.menuItems.map(s=>this.hideObject(s,e,i));return Promise.all(n)}async setAllBrightness(e){await this.forEachMenuItem(t=>this.setObjectBrightness(t,e))}hideAllExcept(e,t=500,i){const n=this.menuItems.map(s=>{if(s!==e.userData.menuItem){const a=i?i.clone():void 0;return this.hideObject(s,t,a)}return Promise.resolve()});return Promise.all(n)}calculateOffsetPosition(e,t){const i=this.getOriginalPosition(e);return i?i.clone().add(t):e.position.clone().add(t)}getOriginalPosition(e){const t=e.userData.menuItem||e;return this.originalPositions.get(t)||null}getObjectByName(e){for(const t of this.menuItems){const i=t.userData.asset;if(i&&i.key===e)return t}return console.warn(`No menu item found with name: ${e}`),null}getColliderByName(e){for(const t of this.menuColliders)if(t.name===`${e}-collider`)return t;return console.warn(`No collider found with name: ${e}-collider`),null}moveItemToOrigin(e,t){return new Promise(i=>{const n=e.userData.menuItem,s=n.position.clone(),a=performance.now(),r=()=>{const l=performance.now()-a,c=Math.min(l/t,1),h=kt.easeInOutCubic(c);n.position.lerpVectors(s,new D(0,0,0),h),c<1?requestAnimationFrame(r):i()};requestAnimationFrame(r)})}moveItemToOriginalPosition(e,t){return new Promise(i=>{const n=e.userData.menuItem,s=this.originalPositions.get(n);if(!s){console.error("Original position not found for item"),i();return}const a=n.position.clone(),r=performance.now(),l=()=>{const c=performance.now()-r,h=Math.min(c/t,1),d=kt.easeInOutCubic(h);n.position.lerpVectors(a,s,d),h<1?requestAnimationFrame(l):i()};requestAnimationFrame(l)})}updateLetterOpacity(e){var n,s;const t=(s=(n=this==null?void 0:this.app)==null?void 0:n.skinnedAnimationController)==null?void 0:s.getSkinnedMesh();if(!t)return;t.children.find(a=>a.name==="Paper_Clone").children.forEach(a=>{const r=Nn.getPageGeo(a);if(!r)return;const l=c=>{c.opacity=e,c.needsUpdate=!0};l(r.material[0]),l(r.material[1])})}updateLetterBrightness(e){var n,s;const t=(s=(n=this==null?void 0:this.app)==null?void 0:n.skinnedAnimationController)==null?void 0:s.getSkinnedMesh();if(!t)return;t.children.find(a=>a.name==="Paper_Clone").children.forEach(a=>{const r=Nn.getPageGeo(a);if(!r)return;const l=c=>{c.userData.shader&&(c.userData.shader.uniforms.dimFactor.value=e,c.needsUpdate=!0)};l(r.material[0]),l(r.material[1])})}showObject(e,t=500,i,n=kt.easeInOutCubic){return new Promise(s=>{var d;const a=this.getAssetFromObject(e);if(!a){s();return}if(e.userData.isAnimatingShow||a.isVisible()){s();return}(a==null?void 0:a.key)==="letter"&&this.setLetterForTransition(),e.userData.isAnimatingShow=!0;const r=this.getOriginalPosition(e)||e.position.clone(),l=i?this.calculateOffsetPosition(e,i):e.position.clone(),c=((d=a.params)==null?void 0:d.brightness)||1,h=0;e.position.copy(l),a.container.visible=!0,this.animateObjectTransform(e,l,r,h,c,t,()=>{e.userData.isAnimatingShow=!1,a.setVisible(!0),s()})})}showObjectWithOpacity(e,t=500,i,n=kt.easeInOutCubic){return new Promise(s=>{const a=this.getAssetFromObject(e);if(!a){s();return}if(e.userData.isAnimatingShow||a.isVisible()){s();return}(a==null?void 0:a.key)==="letter"&&this.setLetterForTransition(),e.userData.isAnimatingShow=!0;const r=this.getOriginalPosition(e)||e.position.clone(),l=i?this.calculateOffsetPosition(e,i):e.position.clone(),c=0,h=1;e.position.copy(l),a.updateOpacity(c),a.container.visible=!0,(a==null?void 0:a.key)==="letter"&&this.updateLetterOpacity(c);const d=()=>{const p=performance.now()-f,b=Math.min(p/t,1),_=n(b);e.position.lerpVectors(l,r,_);const y=c+(h-c)*_;a.updateOpacity(y),a.container.userData.opacity=y;let v;if(_<.5){const S=.3*(1-_*2);v=Math.max(0,y-S)}else v=y;(a==null?void 0:a.key)==="letter"&&(this.setLetterForTransition(v),this.updateLetterOpacity(v)),b<1?requestAnimationFrame(d):(e.userData.isAnimatingShow=!1,(a==null?void 0:a.key)==="letter"&&this.setLetterForOcclusion(),a.setVisible(!0),s())},f=performance.now();requestAnimationFrame(d)})}hideObject(e,t=500,i){return new Promise(n=>{var h;const s=this.getAssetFromObject(e);if(!s){n();return}if(!s.isVisible||e.userData.isAnimatingHide){n();return}e.userData.isAnimatingHide=!0;const a=e.position.clone(),r=i?this.calculateOffsetPosition(e,i):a,l=s.container.userData.brightness||((h=s.params)==null?void 0:h.brightness)||1;this.animateObjectTransform(e,a,r,l,0,t,()=>{i||e.position.copy(this.getOriginalPosition(e)||a),(s==null?void 0:s.key)==="letter"&&this.setLetterForOcclusion(),e.userData.isAnimatingHide=!1,s.setVisible(!1),n()})})}hideObjectWithOpacity(e,t=500,i){return new Promise(n=>{const s=this.getAssetFromObject(e);if(!s){n();return}if(!s.isVisible||e.userData.isAnimatingHide){n();return}e.userData.isAnimatingHide=!0;const a=e.position.clone(),r=i?this.calculateOffsetPosition(e,i):a,l=s.container.userData.opacity||1;this.animateObjectTransformWithOpacity(e,a,r,l,0,t,()=>{s.container.visible=!1,i||e.position.copy(this.getOriginalPosition(e)||a),(s==null?void 0:s.key)==="letter"&&this.setLetterForOcclusion(),e.userData.isAnimatingHide=!1,s.setVisible(!1),n()})})}animateObjectTransformWithOpacity(e,t,i,n,s,a,r){const l=this.getAssetFromObject(e);if(!l)return;const c=performance.now(),h=()=>{const d=performance.now()-c,f=Math.min(d/a,1),p=kt.easeInOutCubic(f);e.position.lerpVectors(t,i,p);const b=n+(s-n)*p;l.updateOpacity(b),l.container.userData.opacity=b;let _;if(p<.5){const y=.3*(1-p*2);_=Math.max(0,b-y)}else _=b;(l==null?void 0:l.key)==="letter"&&this.setLetterForTransition(_),f<1?requestAnimationFrame(h):r()};requestAnimationFrame(h)}setObjectBrightness(e,t){var h;const i=this.getAssetFromObject(e);if(!i)return;const n=((h=i==null?void 0:i.params)==null?void 0:h.brightness)||1,s=10,a=2,r=An(t,0,1,0,n),l=An(t,0,1,s,1),c=An(t,0,1,a,0);i.updateBrightness(r),i.updateRoughness(l),i.updateMetalness(c),i.key==="letter"&&this.updateLetterBrightness(r)}animateObjectTransform(e,t,i,n,s,a,r){const l=this.getAssetFromObject(e);if(!l)return;const c=performance.now(),h=l.container.userData.originalRoughness!==void 0?l.container.userData.originalRoughness:.5,d=l.container.userData.originalMetalness!==void 0?l.container.userData.originalMetalness:.5,f=s<n,p=f?10:h,b=f?2:d;if(l.container.userData.originalRoughness===void 0){let y=!1;l.container.traverse(v=>{!y&&v instanceof It&&v.material instanceof Sn&&(l.container.userData.originalRoughness=v.material.roughness,l.container.userData.originalMetalness=v.material.metalness,y=!0)})}const _=()=>{const y=performance.now()-c,v=Math.min(y/a,1),S=kt.easeInOutCubic(v);e.position.lerpVectors(t,i,S);const A=n+(s-n)*S,E=f?h+(p-h)*S:p+(h-p)*(1-S),O=f?d+(b-d)*S:b+(d-b)*(1-S);l.updateBrightness(A),l.updateRoughness(E),l.updateMetalness(O),l.container.userData.brightness=A,l.container.userData.roughness=E,l.container.userData.metalness=O,(l==null?void 0:l.key)==="letter"&&this.updateLetterBrightness(A),v>=1?(s===0?l.container.visible=!1:f||(l.updateRoughness(h),l.updateMetalness(d)),r()):requestAnimationFrame(_)};requestAnimationFrame(_)}getAssetFromObject(e){return this.app.assetManager.assets.find(t=>{var i;return t===((i=e==null?void 0:e.userData)==null?void 0:i.asset)})||null}jumpTo(e,t={}){var n;if(this.app.cameraPathAnimator.isAnimating)return;const i=this.findColliderForMenuItem(e)||e;if(i){const{duration:s=0,zoomLevel:a}=t,r=this.app.camera.getZoom(),l=a!==void 0?a:r,{position:c,intersectionPoint:h}=this.calculateCameraPositionForMenuItem(i,l);if(this.app.camera.cameraController){const d=c.clone().normalize();if(c.length(),Math.atan2(d.x,d.z),Math.acos(d.y),s>0){const f=new D(0,1,0),p=this.app.camera.camera.up.clone(),b=_=>{var y;if(this.app.camera.cameraController.synchroniseDistanceWithCamera(),this.app.camera.cameraController.triggerZoomChange(),_.progress!==void 0){const v=kt.easeInOutCubic(_.progress),{angleY:S}=this.app.camera.getCameraOrbitAngles(),A=sm(S,.93516308961);(y=this==null?void 0:this.app)==null||y.uiManager.updateMenuDot(A);const E=new D().lerpVectors(p,f,v).normalize();this.app.camera.camera.up.copy(E),_.progress>=.99&&this.app.cameraPathAnimator.setOnUpdateCallback(null)}};this.app.cameraPathAnimator.setOnUpdateCallback(b),this.animateCameraToPosition(c,h,s,1e-4)}else this.app.camera.camera.position.copy(c),this.app.camera.camera.lookAt(h)}else(n=this.app.camera.cameraController)==null||n.jumpToPosition(c,h)}else console.warn("No collider found for menu item")}getNextMenuItem(e){let t=-1;e&&(t=this.menuItems.findIndex(n=>n===e||n===e.userData.menuItem));const i=(t+1)%this.menuItems.length;return this.menuItems[i]}getPreviousMenuItem(e){let t=-1;e&&(t=this.menuItems.findIndex(n=>n===e||n===e.userData.menuItem));const i=(t-1+this.menuItems.length)%this.menuItems.length;return this.menuItems[i]}findColliderForMenuItem(e){return this.menuColliders.find(t=>t.userData.menuItem===e)||null}createDebugSphere(e){const{position:t,normal:i,intersectionPoint:n}=this.calculateCameraPositionForMenuItem(e),s=new Wi(2,32,32),a=new qt({color:16711680,visible:this.debugMode}),r=new It(s,a);r.position.copy(t),this.menuContainer.add(r);const l=new fi().setFromPoints([n,t]),c=new yn({color:16776960,visible:this.debugMode}),h=new Mn(l,c);this.menuContainer.add(h);const d=new Wi(1,32,32),f=new qt({color:65280,visible:this.debugMode}),p=new It(d,f);p.position.copy(n),this.menuContainer.add(p),e.userData.cameraJumpSphere=r,e.userData.cameraJumpRay=h,e.userData.intersectionSphere=p,this.debugMode&&(this.debugSpheres.push(r),this.debugSpheres.push(p))}calculateCameraPositionForMenuItem(e,t,i=!1){const n=new D(0,0,0),s=new D;e.getWorldPosition(s);let a=s.clone();if(i&&e.userData.originalTorusPosition){a=e.userData.originalTorusPosition.clone();const f=new Ft;e.parent&&f.copy(e.parent.matrixWorld),a.applyMatrix4(f)}const r=a.clone().sub(n).normalize(),l=a.distanceTo(n),h=Math.max(0,(t!==void 0?t:90)-l);return{position:a.clone().add(r.multiplyScalar(h)),normal:r.clone().negate(),intersectionPoint:s}}updateCameraJumpPositions(){this.menuColliders.forEach(e=>{if(e.userData.cameraJumpSphere){const t=this.calculateCameraPositionForMenuItem(e);e.userData.cameraJumpSphere.position.copy(t)}})}toggleDebugSpheresVisibility(e){this.debugSpheres.forEach(t=>{t.visible=e})}animateCameraToPosition(e,t,i,n){this.app.cameraPathAnimator.setIsAnimating(!0);const s=this.app.camera.camera.position.clone(),a=this.app.camera.controls.target.clone(),r=[{position:s,lookAt:a,duration:0},{position:e,lookAt:t,duration:i,easing:kt.linear}];this.app.cameraPathAnimator.setKeyframes(r,n||.5);const l=new et(0,0);this.app.cameraPathAnimator.setOnAnimationComplete(()=>{const c=this.app.cameraPathAnimator.getFinalVelocity();this.app.camera.resetMotionWithVelocity(c,l),this.app.cameraPathAnimator.setIsAnimating(!1),this.app.camera.controls.target.copy(a),this.app.camera.cameraController.synchroniseWithCamera()}),this.app.cameraPathAnimator.animatePath()}}class Qx{constructor(e,t,i,n={}){g(this,"renderer");g(this,"scene");g(this,"camera");g(this,"maxTestLights");g(this,"debug");g(this,"errorDetected",!1);g(this,"targetFrameRate");g(this,"performanceCallbacks",[]);g(this,"maxUpgradeAttempts");g(this,"downgradeIndex",0);g(this,"upgradeAttempts",0);g(this,"frameFailTrigger",3);g(this,"frameFailCount",0);g(this,"consecutiveGoodFrames",0);g(this,"isWindowFocused",!0);g(this,"handleVisibilityChange",()=>{this.isWindowFocused=!document.hidden});this.renderer=e,this.scene=t,this.camera=i,this.maxTestLights=n.maxTestLights??16,this.debug=n.debug??!1,this.targetFrameRate=n.targetFrameRate??60,this.maxUpgradeAttempts=n.maxUpgradeAttempts??3,this.frameFailTrigger=n.frameFailTrigger??3,document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("focus",()=>this.isWindowFocused=!0),window.addEventListener("blur",()=>this.isWindowFocused=!1);const s=console.error;console.error=(...a)=>{a[0].includes("THREE.WebGLProgram: Shader Error")&&(this.errorDetected=!0),s.apply(console,a)}}async runLightBenchmark(){const e=this.renderer.getContext(),t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.debug;let i=[];for(let n=0;n<this.maxTestLights;n++){if(this.errorDetected){this.debug;break}const s=new Qp(16777215,1);if(s.position.set(Math.random()*10,Math.random()*10,Math.random()*10),s.castShadow=!0,this.scene.add(s),i.push(s),await this.renderScene(),this.debug,this.errorDetected)return i.forEach(a=>this.scene.remove(a)),{maxLights:n,maxShaderSamplers:t}}return i.forEach(n=>this.scene.remove(n)),{maxLights:this.maxTestLights,maxShaderSamplers:t}}async renderScene(){return new Promise(e=>{requestAnimationFrame(()=>{this.renderer.render(this.scene,this.camera),e()})})}addPerformanceCallback(e){this.performanceCallbacks.push(e)}checkPerformance(e){this.isWindowFocused&&(e<this.targetFrameRate?(Ye(`Frame rate below target ${e}/${this.targetFrameRate}`),this.frameFailCount++,this.consecutiveGoodFrames=0,this.frameFailCount>=this.frameFailTrigger&&(this.downgradeSettings(e),this.frameFailCount=0)):(this.consecutiveGoodFrames++,this.consecutiveGoodFrames>=5&&(this.frameFailCount=0,this.consecutiveGoodFrames=0,e>this.targetFrameRate&&this.upgradeAttempts<this.maxUpgradeAttempts&&this.upgradeSettings())))}downgradeSettings(e){if(this.downgradeIndex<this.performanceCallbacks.length){const i=this.performanceCallbacks[this.downgradeIndex].activate(e);this.debug&&Ye(`Downgrade step ${this.downgradeIndex+1} activated. - ${i}`),this.downgradeIndex++}}upgradeSettings(){this.downgradeIndex>0&&(this.downgradeIndex--,this.performanceCallbacks[this.downgradeIndex].deactivate(),this.upgradeAttempts++,this.debug&&Ye(`Upgrade step ${this.downgradeIndex+1} deactivated.`))}dispose(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",()=>this.isWindowFocused=!0),window.removeEventListener("blur",()=>this.isWindowFocused=!1)}}class au{constructor(e){g(this,"connections",[]);this.position=e}addConnection(e){this.connections.includes(e)||(this.connections.push(e),e.connections.push(this))}}class rc{constructor(e){g(this,"points",[]);g(this,"mesh",null);g(this,"debugObjects",[]);e.mesh&&(this.mesh=e.mesh),e.points&&(this.points=e.points.map(t=>new au(t)))}findClosestPoint(e){if(this.points.length===0)return this.mesh?this.mesh.position.clone():new D;let t=this.points[0],i=e.distanceTo(this.getWorldPosition(t.position));for(let n=1;n<this.points.length;n++){const s=this.getWorldPosition(this.points[n].position),a=e.distanceTo(s);a<i&&(t=this.points[n],i=a)}return this.getWorldPosition(t.position)}findClosestSegment(e){if(this.points.length<2)return null;let t=null,i=1/0;for(const n of this.points)for(const s of n.connections){const a=this.getWorldPosition(n.position),r=this.getWorldPosition(s.position),l=new Jp(a,r),c=new D;l.closestPointToPoint(e,!0,c);const h=e.distanceTo(c);h<i&&(i=h,t=[a,r])}return t}getWorldPosition(e){return this.mesh?(this.mesh.updateMatrixWorld(!0),e.clone().applyMatrix4(this.mesh.matrixWorld)):e.clone()}static create(e,t){let i;switch(e){case ns.CENTRE_POINT:i=new Xf(t);break;case ns.POINTS_ARRAY:i=new Tm(t);break;case ns.POINTS_WITH_LINES:i=new Jx(t);break;case ns.FULL_SKELETON:i=new eS(t);break;default:i=new Xf(t)}return i.initialise(),i}addDebugVisualisation(e){this.removeDebugVisualisation(e),this.createDebugObjects(),this.debugObjects.forEach(t=>{var i;return(i=this.mesh)==null?void 0:i.add(t)})}removeDebugVisualisation(e){this.debugObjects.forEach(t=>{var i;return(i=this.mesh)==null?void 0:i.remove(t)}),this.debugObjects=[]}}class Xf extends rc{initialise(){if(this.mesh){const e=new D;this.mesh.geometry.computeBoundingBox(),this.mesh.geometry.boundingBox.getCenter(e),this.points=[new au(e)]}}createDebugObjects(){const e=new Wi(.1),t=new qt({color:16711935}),i=new It(e,t);i.position.copy(this.points[0].position),this.debugObjects.push(i),this.debugObjects.forEach(n=>{n.layers.set(3)})}}class Tm extends rc{initialise(){this.mesh&&(this.points=this.mesh.children.filter(e=>e.name.startsWith("CamPoint_")).map(e=>{const t=new D;return e.getWorldPosition(t),this.mesh.worldToLocal(t),new au(t)}))}createDebugObjects(){const e=new Wi(.05),t=new qt({color:65280});this.points.forEach(i=>{const n=new It(e,t);n.position.copy(i.position),this.debugObjects.push(n)}),this.debugObjects.forEach(i=>{i.layers.set(3)})}}class Jx extends Tm{initialise(){super.initialise(),this.createConnections()}createConnections(){for(let e=0;e<this.points.length;e++){let t=null,i=1/0;for(let n=0;n<this.points.length;n++)if(e!==n){const s=this.points[e].position.distanceTo(this.points[n].position);s<i&&(i=s,t=this.points[n])}t&&this.points[e].addConnection(t)}}createDebugObjects(){super.createDebugObjects();const e=new yn({color:255});this.points.forEach(t=>{t.connections.forEach(i=>{const n=new fi().setFromPoints([t.position,i.position]),s=new Mn(n,e);this.debugObjects.push(s)})}),this.debugObjects.forEach(t=>{t.layers.set(3)})}}class eS extends rc{initialise(){this.mesh instanceof Eo}createDebugObjects(){if(this.mesh instanceof Eo){const e=new Hw(this.mesh);this.debugObjects.push(e)}this.debugObjects.forEach(e=>{e.layers.set(3)})}}class $f{constructor(){g(this,"frictionPoints",[]);g(this,"addFrictionPoint",e=>{e.name&&this.getFrictionPoint(e.name)?this.updateFrictionPoint(e.name,e):this.frictionPoints.push(e)});g(this,"updateFrictionPoint",(e,t)=>{const i=this.getFrictionPoint(e);if(!i){console.warn(`No friction point found with name: ${e}`);return}Object.assign(i,t)});g(this,"getFrictionPoint",e=>this.frictionPoints.find(t=>t.name===e));g(this,"clearFrictionPoints",()=>{this.frictionPoints=[]});g(this,"calculateFriction",(e,t)=>{let i=0;const n=t<e;for(const s of this.frictionPoints){if(s.direction==="forward"&&!n||s.direction==="backward"&&n)continue;let a=0;if(a=s.direction==="forward"&&!(s!=null&&s.away)||s.direction==="backward"&&(s!=null&&s.away)?(e-s.position)/s.radius:(s.position-e)/s.radius,a>1)continue;let r=1-a*a*(3-2*a);a<0&&(r=1+Math.abs(a),s!=null&&s.beyond||(r=1));const l=s.strength*r;i=Math.max(i,l)}return i>1&&(i=1),1-i})}}class tS{constructor(){g(this,"springPoints",[]);g(this,"addSpringPoint",e=>{this.springPoints.push(e)});g(this,"clearSpringPoints",()=>{this.springPoints=[]});g(this,"calculateForce",(e,t)=>{let i=0;const n=performance.now();for(const s of this.springPoints){if(s.delay&&t&&n-t<s.delay)continue;const a=s.direction==="forward"?e-s.position:s.position-e;if(a>0){const r=a*s.stiffness;i+=s.direction==="forward"?-r:r}}return i>.001||i<-.001?i:0})}}class iS{average(e){if(e.length!==0)return e.reduce((t,i)=>t+i,0)/e.length}sum(e){if(e.length!==0)return e.reduce((t,i)=>t+i,0)}}class nS{average(e){if(e.length===0)return;const t=e.reduce((i,n)=>({x:i.x+n.x,y:i.y+n.y,z:i.z+n.z}),{x:0,y:0,z:0});return new D(t.x/e.length,t.y/e.length,t.z/e.length)}sum(e){if(e.length!==0)return e.reduce((t,i)=>({x:t.x+i.x,y:t.y+i.y,z:t.z+i.z}),{x:0,y:0,z:0})}}class sS{average(e){if(e.length===0)return;const t=e.reduce((i,n)=>(i[n]=(i[n]||0)+1,i),{});return Object.keys(t).reduce((i,n)=>t[i]>t[n]?i:n)}sum(e){return e.join("")}}class aS{constructor(e){g(this,"history",[]);g(this,"length",5);g(this,"operations",null);this.length=(e==null?void 0:e.length)||5}add(e){this.history.push(e),this.history.length>this.length&&this.history.shift(),this.operations||this.setOperations()}clear(){this.history=[]}sum(){if(this.operations)return this.operations.sum(this.history)}average(){if(this.operations)return this.operations.average(this.history)}setOperations(){var t;const e=this.history[0];typeof e=="number"?this.operations=new iS:typeof e=="string"?this.operations=new sS:e instanceof D?this.operations=new nS:console.warn("Operations not supported for type:",typeof e,(t=e==null?void 0:e.constructor)==null?void 0:t.name)}}class rS{constructor({camera:e,cameraClass:t,scene:i,collisionMesh:n,primitiveOptions:s,renderer:a,easingFactor:r=.05,initialZoomDistance:l=10,minZoomDistance:c=0,maxZoomDistance:h=400,debug:d=!1,originPosition:f,restingPosX:p=null,restingPosY:b=null,restingZoom:_=null,restingDeadzone:y=.02,skeleton:v}){g(this,"enabled",!0);g(this,"camera");g(this,"cameraClass");g(this,"scene");g(this,"collisionMesh");g(this,"renderer");g(this,"anchor");g(this,"easingFactor");g(this,"currentZoomDistance");g(this,"minZoomDistance");g(this,"maxZoomDistance");g(this,"minZoomBoundDistance");g(this,"maxZoomBoundDistance");g(this,"targetPosition");g(this,"targetRotation");g(this,"isDragging",!1);g(this,"dragJustEnded",!0);g(this,"isPinching",!1);g(this,"dragHasStarted");g(this,"debug");g(this,"originPosition");g(this,"collisionPoint");g(this,"reducedMotionPreference",!1);g(this,"keyboardInvertX",!1);g(this,"keyboardInvertY",!1);g(this,"pinchZoomSpeed",.4);g(this,"currentCursorPosition",null);g(this,"pinchDistanceStart",null);g(this,"currentPinchCenter",null);g(this,"lastPinchCenter",null);g(this,"isGesturing",!1);g(this,"lastGestureScale",1);g(this,"zoomInputType",null);g(this,"pendingZoomVelocity",new D);g(this,"idleTransitionDelay",7e3);g(this,"idleTransitionDuration",5e3);g(this,"idleForceMultiplier",.1);g(this,"maxRotationSpeed",.05);g(this,"zoomFriction");g(this,"rotationFriction");g(this,"zoomSpringForce");g(this,"previousLookDirection",new D);g(this,"previousUpVector",new D(0,1,0));g(this,"previousRightVector",new D(1,0,0));g(this,"controlStates",{zoom:{in:!0,out:!0},rotation:{left:!0,right:!0,up:!0,down:!0}});g(this,"keyboardState",{ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1});g(this,"keyboardForce",new et(0,0));g(this,"axisState",{x:{active:!1,startTime:0,targetForce:0},y:{active:!1,startTime:0,targetForce:0},zoom:{active:!1,startTime:0,targetForce:0}});g(this,"zoomForce",0);g(this,"maxKeyboardForce",.02);g(this,"maxZoomForce",2);g(this,"keyboardEaseTime",3e3);g(this,"keyboardDamping",.95);g(this,"keyboardPanForceMultiplier",150);g(this,"previousMousePosition");g(this,"anchorVelocity");g(this,"skeleton",null);g(this,"currentSkeletonPoint",null);g(this,"orbitalPosition");g(this,"debugAnchorMesh");g(this,"debugCollisionMesh");g(this,"debugCollisionEdges");g(this,"debugRay");g(this,"debugRayLine");g(this,"debugCollisionPoint");g(this,"debugAnchorDirection");g(this,"debugInterpolatedNormal");g(this,"debugSkeletonToAnchorLine",null);g(this,"closestPointMarkers",[]);g(this,"neighbouringFaceVertexMarkers",[]);g(this,"vertexMarkers",[]);g(this,"debugNeighbourNormalRays",[]);g(this,"debugInterpolatedNormalArrow");g(this,"useInterpolatedNormal",!0);g(this,"debugFaceCenter");g(this,"debugEdgeIntersections",[]);g(this,"debugLines",[]);g(this,"debugCrossPoint");g(this,"debugCrossPointLine");g(this,"act3CollisionMesh",null);g(this,"act3AnchorVisualization",null);g(this,"debugAct3CollisionMesh",null);g(this,"debugPositionMarker",null);g(this,"debugAct3NormalArrow",null);g(this,"lastPinchDistance",0);g(this,"rotationVelocity",new et);g(this,"maxRotationVelocity",.03);g(this,"rotationDamping",.95);g(this,"shouldApplyIdleOrbit",!0);g(this,"idleSpeedX",-5e-4);g(this,"idleSpeedY",0);g(this,"lastInteractionTime");g(this,"lastZoomInteractionTime");g(this,"idleOrbitDelay");g(this,"idleForce");g(this,"restingPosX");g(this,"restingPosY");g(this,"restingDeadzone");g(this,"restingZoom");g(this,"currentIdleSpeedX",0);g(this,"currentIdleSpeedY",0);g(this,"currentIdleSpeedZoom",0);g(this,"idleInterpolationFactor",.1);g(this,"maxRestingSpeed",.001);g(this,"originToAnchorRay");g(this,"rayPercentage",.5);g(this,"focusPosition");g(this,"interpolatedNormal",new D(0,1,0));g(this,"currentCameraDistance");g(this,"currentSmoothNormal");g(this,"currentMode","mesh");g(this,"targetOrbitalPosition");g(this,"debugFaceEdges",[]);g(this,"rayLength",100);g(this,"focusZoomRangeMin",5);g(this,"focusZoomRangeMax",10);g(this,"modeZoomRangeMin",10);g(this,"modeZoomRangeMax",15);g(this,"normalZoomRangeMin",5);g(this,"normalZoomRangeMax",7);g(this,"panModeOrigin",new ri);g(this,"panVelocity",new D);g(this,"absPanVelocity",new D);g(this,"previousPanVelocity",new aS({length:10}));g(this,"panDamping",.95);g(this,"panBounds",{xMin:-26,xMax:26,yMin:-21,yMax:21,zMin:-122,zMax:100});g(this,"motionSettings",{normal:{idleSpeedX:-5e-4,idleSpeedY:0,easingFactor:.5,rotationDamping:.95,keyboardDamping:.95,idleInterpolationFactor:.1},reduced:{idleSpeedX:0,idleSpeedY:0,easingFactor:.5,rotationDamping:.95,keyboardDamping:.95,idleInterpolationFactor:.1}});g(this,"getEasingFactor",()=>this.easingFactor);g(this,"setEasingFactor",e=>{this.easingFactor=e});g(this,"loggingEnabled",!1);g(this,"onMouseOut",e=>{!e.relatedTarget&&!e.toElement&&this.onMouseUp(e)});g(this,"setMaxRotationSpeed",e=>{this.maxRotationSpeed=e});g(this,"applyZoomDelta",e=>{const t=e*this.pinchZoomSpeed,i=this.currentZoomDistance+t,n=this.zoomFriction.calculateFriction(this.currentZoomDistance,i),s=t*n,a=this.currentZoomDistance+s;this.currentZoomDistance=Et.clamp(a,this.minZoomDistance,this.maxZoomDistance),this.targetOrbitalPosition.radius=this.currentZoomDistance,Math.abs(s)>2&&(this.lastZoomInteractionTime=performance.now()),this.triggerZoomChange(),window.dispatchEvent(new CustomEvent("userInteracting",{detail:null}))});g(this,"onGestureStart",e=>{this.enabled&&(e.preventDefault(),this.isGesturing=!0,this.lastGestureScale=e.scale||1,this.lastInteractionTime=performance.now(),this.currentPinchCenter=new et(e.pageX||e.clientX,e.pageY||e.clientY))});g(this,"onGestureChange",e=>{if(!this.enabled||!this.isGesturing)return;e.preventDefault();const t=e.scale||1,i=t-this.lastGestureScale;this.currentPinchCenter=new et(e.pageX||e.clientX,e.pageY||e.clientY);const n=i>0,s=i<0;if(n&&!this.controlStates.zoom.in||s&&!this.controlStates.zoom.out)return;this.lastInteractionTime=performance.now(),Math.abs(i)>.01&&(this.lastZoomInteractionTime=performance.now());const a=-i*C_,r=this.currentZoomDistance+a,l=this.zoomFriction.calculateFriction(this.currentZoomDistance,r),c=a*l,h=this.currentZoomDistance+c;this.currentZoomDistance=Et.clamp(h,this.cameraClass.getMinZoom(),this.cameraClass.getMaxZoom()),this.currentMode==="pan"?this.handlePanModeZoom(c,"gesture"):this.targetOrbitalPosition.radius=this.currentZoomDistance,this.lastGestureScale=t,this.triggerZoomChange(),window.dispatchEvent(new CustomEvent("userInteracting",{detail:this.rotationVelocity}))});g(this,"onGestureEnd",e=>{this.enabled&&(e.preventDefault(),this.isGesturing=!1,this.lastGestureScale=1)});g(this,"onTouchStart",e=>{if(this.enabled&&e.touches.length===2){this.isPinching=!0,this.isDragging=!1,this.lastPinchCenter=new et((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.previousMousePosition=this.lastPinchCenter.clone();const t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;this.pinchDistanceStart=Math.sqrt(t*t+i*i),this.lastPinchDistance=this.pinchDistanceStart}});g(this,"onTouchMove",e=>{if(this.enabled&&this.isPinching&&e.touches.length===2){const t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i),s=n-this.lastPinchDistance;if(this.currentPinchCenter=new et((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),s>0&&!this.controlStates.zoom.out||s<0&&!this.controlStates.zoom.in)return;this.lastInteractionTime=performance.now(),Math.abs(s)>20&&(this.lastZoomInteractionTime=performance.now());const r=-s*.2,l=this.currentZoomDistance+r,c=this.zoomFriction.calculateFriction(this.currentZoomDistance,l),h=r*c,d=this.currentZoomDistance+h;if(this.currentZoomDistance=Et.clamp(d,this.cameraClass.getMinZoom(),this.cameraClass.getMaxZoom()),this.currentMode==="pan"){this.handlePanModeZoom(h,"pinch");const f=this.currentPinchCenter.clone().sub(this.lastPinchCenter||this.currentPinchCenter);if(this.lastPinchCenter&&f.length()>1){const p=this.isDragging;this.isDragging=!0;const b=new MouseEvent("mousemove",{clientX:this.currentPinchCenter.x,clientY:this.currentPinchCenter.y,bubbles:!0,cancelable:!0});this.onMouseMove(b),this.isDragging=p}}else this.targetOrbitalPosition.radius=this.currentZoomDistance;this.lastPinchDistance=n,this.lastPinchCenter=this.currentPinchCenter.clone(),this.triggerZoomChange(),window.dispatchEvent(new CustomEvent("userInteracting",{detail:this.rotationVelocity}))}});g(this,"onTouchEnd",e=>{e.touches.length===0?(this.isPinching=!1,this.isDragging=!1,this.dragHasStarted=!1,this.lastPinchCenter=null,document.body.classList.remove("dragging")):e.touches.length===1&&this.isPinching?this.transitionFromPinchToPointer(e.touches[0]):this.isPinching&&e.touches.length<2&&(this.isPinching=!1,this.lastPinchCenter=null),this.lastInteractionTime=performance.now()});g(this,"transitionFromPinchToPointer",e=>{this.isPinching=!1,this.lastPinchCenter=null,this.isDragging=!0,this.dragHasStarted=!1,this.previousMousePosition=new et(e.clientX,e.clientY);const t=this.renderer.domElement.getBoundingClientRect();this.currentCursorPosition={x:e.clientX-t.left,y:e.clientY-t.top};const i=new PointerEvent("pointerdown",{pointerId:e.identifier,clientX:e.clientX,clientY:e.clientY,bubbles:!0,cancelable:!0,pointerType:"touch",isPrimary:!0});this.renderer.domElement.dispatchEvent(i)});g(this,"setZoomFrictionMax",e=>{this.zoomFriction.updateFrictionPoint("bound-zoom-max-back",{position:e}),this.zoomFriction.updateFrictionPoint("bound-zoom-max-forward",{position:e})});g(this,"setCollisionMeshScale",e=>{if(!this.collisionMesh)return;let t=1-.5-e;t>1&&(t=1),t<.1&&(t=.1),this.collisionMesh.scale.set(t,t,t)});g(this,"calculateDistanceToOrigin",()=>this.camera.position.distanceTo(this.originPosition));g(this,"getRestingZoom",()=>this.restingZoom);g(this,"setMaxZoomBound",e=>(this.maxZoomBoundDistance=e,this.setZoomFrictionToLimits(),this.setZoomSpringForceToLimits(),this.maxZoomBoundDistance));g(this,"setMinZoomBound",e=>(this.minZoomBoundDistance=e,this.setZoomFrictionToLimits(),this.setZoomSpringForceToLimits(),this.minZoomBoundDistance));g(this,"getZoom",()=>this.currentZoomDistance);g(this,"getZoomPercentage",()=>(this.currentZoomDistance-this.minZoomDistance)/(this.maxZoomDistance-this.minZoomDistance));g(this,"triggerZoomChange",()=>{const e=this.getZoomPercentage();window.dispatchEvent(new CustomEvent("cameraZoomChange",{detail:{zoomPercentage:e}}))});g(this,"handleKeyDown",e=>{if(!this.cameraClass.app.uiManager.isModalOpen&&this.keyboardState.hasOwnProperty(e.code)&&!this.keyboardState[e.code]){this.keyboardState[e.code]=!0;const t=performance.now(),i=this.keyboardInvertX?-1:1,n=this.keyboardInvertY?-1:1;switch(e.code){case"ArrowLeft":case"KeyA":!e.shiftKey&&this.controlStates.rotation.left&&(this.axisState.x.active=!0,this.axisState.x.startTime=t,this.axisState.x.targetForce=this.maxKeyboardForce*i);break;case"ArrowRight":case"KeyD":!e.shiftKey&&this.controlStates.rotation.right&&(this.axisState.x.active=!0,this.axisState.x.startTime=t,this.axisState.x.targetForce=-this.maxKeyboardForce*i);break;case"ArrowUp":case"KeyW":e.shiftKey?this.controlStates.zoom.in&&(this.axisState.zoom.active=!0,this.axisState.zoom.startTime=t,this.axisState.zoom.targetForce=-this.maxZoomForce):this.controlStates.rotation.up&&(this.axisState.y.active=!0,this.axisState.y.startTime=t,this.axisState.y.targetForce=this.maxKeyboardForce*n);break;case"ArrowDown":case"KeyS":e.shiftKey?this.controlStates.zoom.out&&(this.axisState.zoom.active=!0,this.axisState.zoom.startTime=t,this.axisState.zoom.targetForce=this.maxZoomForce):this.controlStates.rotation.down&&(this.axisState.y.active=!0,this.axisState.y.startTime=t,this.axisState.y.targetForce=-this.maxKeyboardForce*n);break}}});g(this,"handleKeyUp",e=>{if(this.keyboardState.hasOwnProperty(e.code)){e.preventDefault(),this.keyboardState[e.code]=!1;const t=this.keyboardInvertX?-1:1,i=this.keyboardInvertY?-1:1;switch(e.code){case"ArrowLeft":case"KeyA":this.axisState.x.targetForce*t>0&&(this.axisState.x.active=!1);break;case"ArrowRight":case"KeyD":this.axisState.x.targetForce*t<0&&(this.axisState.x.active=!1);break;case"ArrowUp":case"KeyW":e.shiftKey?this.axisState.zoom.targetForce<0&&(this.axisState.zoom.active=!1):this.axisState.y.targetForce*i>0&&(this.axisState.y.active=!1);break;case"ArrowDown":case"KeyS":e.shiftKey?this.axisState.zoom.targetForce>0&&(this.axisState.zoom.active=!1):this.axisState.y.targetForce*i<0&&(this.axisState.y.active=!1);break}}});this.camera=e,this.cameraClass=t,this.scene=i,this.renderer=a,this.easingFactor=r,this.currentZoomDistance=l,this.minZoomDistance=c,this.maxZoomDistance=h,this.debug=d,this.originPosition=f,this.collisionPoint=new D,this.zoomFriction=new $f,this.rotationFriction=new $f,this.zoomSpringForce=new tS,this.camera.layers.enable(0),this.camera.layers.enable(1),this.camera.layers.enable(2),this.camera.layers.enable(3),this.currentCameraDistance=this.currentZoomDistance,this.currentSmoothNormal=new D(0,1,0),this.anchor=new ri,this.scene.add(this.anchor),this.targetPosition=new D,this.targetRotation=new ai,this.isDragging=!1,this.previousMousePosition=new et,this.anchorVelocity=new D,n?this.setCollisionMesh(n):s?(this.collisionMesh=this.createPrimitive(s),this.collisionMesh.layers.set(2),this.collisionMesh.material.side=Ai):this.collisionMesh=null,this.lastInteractionTime=0,this.idleOrbitDelay=200,this.idleForce=new D,this.restingPosX=p,this.restingPosY=b,this.restingZoom=_,this.restingDeadzone=y,this.orbitalPosition=new Mh().setFromVector3(this.camera.position.clone().sub(this.originPosition)),this.targetOrbitalPosition=this.orbitalPosition.clone(),this.initEventListeners(),v&&(this.skeleton=v),this.focusPosition=new D,this.originToAnchorRay=new _s(this.originPosition.clone(),new D(0,0,-1)),this.initKeyboardControls(),this.reducedMotionPreference=this.cameraClass.app.preferenceManager.getPreference("reduceMotion"),this.applyMotionSettings(this.reducedMotionPreference),this.debug&&this.initDebugMode()}setEnabled(e){this.enabled=e,e||(this.isDragging=!1,this.keyboardState={ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.axisState={x:{active:!1,startTime:0,targetForce:0},y:{active:!1,startTime:0,targetForce:0},zoom:{active:!1,startTime:0,targetForce:0}},this.keyboardForce.set(0,0),this.zoomForce=0,this.rotationVelocity.set(0,0),this.anchorVelocity.set(0,0,0))}isEnabled(){return this.enabled}updateMotionPreference(e){this.reducedMotionPreference=e,this.applyMotionSettings(e)}applyMotionSettings(e){const t=e?this.motionSettings.reduced:this.motionSettings.normal;this.idleSpeedX=t.idleSpeedX,this.idleSpeedY=t.idleSpeedY,this.easingFactor=t.easingFactor,this.rotationDamping=t.rotationDamping,this.keyboardDamping=t.keyboardDamping,this.idleInterpolationFactor=t.idleInterpolationFactor,this.currentIdleSpeedX=0,this.currentIdleSpeedY=0,this.rotationVelocity.set(0,0),this.anchorVelocity.set(0,0,0)}createPrimitive(e){let t;switch(e.type){case"sphere":t=new Wi(1,32,32);break;case"capsule":t=new $h(1,2,4,8);break;default:throw new Error(`Unsupported primitive type: ${e.type}`)}t.scale(e.scale.x,e.scale.y,e.scale.z);const i=new qt({visible:this.debug,opacity:this.debug?.1:0,transparent:!0,side:Ai}),n=new It(t,i);n.position.copy(e.position),n.rotation.copy(e.rotation),this.scene.add(n),this.setCollisionMesh(n,ns.CENTRE_POINT)}initEventListeners(){const e=this.renderer.domElement;window.addEventListener("mouseout",this.onMouseOut.bind(this),!1),e.addEventListener("pointerdown",this.onMouseDown.bind(this),!1),e.addEventListener("pointermove",this.onMouseMove.bind(this),!1),e.addEventListener("pointerup",this.onMouseUp.bind(this),!1),e.addEventListener("wheel",this.onMouseWheel.bind(this),!1),e.addEventListener("touchstart",this.onTouchStart.bind(this),!1),e.addEventListener("touchmove",this.onTouchMove.bind(this),!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchEnd,!1),e.addEventListener("gesturestart",this.onGestureStart),e.addEventListener("gesturechange",this.onGestureChange),e.addEventListener("gestureend",this.onGestureEnd),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1),window.addEventListener("keydown",t=>{(t.key==="i"||t.key==="I")&&this.toggleInterpolatedNormal()})}onKeyDown(e){e.shiftKey&&(this.loggingEnabled=!0)}onKeyUp(e){e.shiftKey||(this.loggingEnabled=!1)}onMouseDown(e){this.enabled&&(this.isDragging=!0,this.lastInteractionTime=performance.now(),this.previousMousePosition.set(e.clientX,e.clientY),this.currentIdleSpeedX=0,this.currentIdleSpeedY=0,this.currentIdleSpeedZoom=0)}onMouseMove(e){const t=this.renderer.domElement.getBoundingClientRect();if(this.currentCursorPosition={x:e.clientX-t.left,y:e.clientY-t.top},!this.enabled||!this.isDragging)return;this.dragHasStarted||(this.dragHasStarted=!0,document.body.classList.add("dragging")),this.lastInteractionTime=performance.now();const i=new et(e.clientX,e.clientY),n=i.clone().sub(this.previousMousePosition);if(this.currentMode==="pan")this.handlePanModeTranslation(n,i);else{const{xMultiplier:s,yMultiplier:a}=this.calculateAxisDominance(n),r=n.clone();r.x*=s,r.y*=a,this.handleMouseMoveRotation(r,i)}}handleMouseMoveRotation(e,t){!this.controlStates.rotation.left&&e.x<0&&(e.x=0),!this.controlStates.rotation.right&&e.x>0&&(e.x=0),!this.controlStates.rotation.up&&e.y<0&&(e.y=0),!this.controlStates.rotation.down&&e.y>0&&(e.y=0);const i=this.calculateForceScalingFactor();this.rotationVelocity.x=Et.clamp(e.x*.001*i,-this.maxRotationSpeed,this.maxRotationSpeed),this.rotationVelocity.y=Et.clamp(e.y*.001*i,-this.maxRotationSpeed,this.maxRotationSpeed),this.rotationVelocity.clampLength(0,this.maxRotationVelocity*i),this.previousMousePosition.copy(t),window.dispatchEvent(new CustomEvent("userInteracting",{detail:this.rotationVelocity}));let n=1;if(Math.abs(this.rotationVelocity.x)>1e-5){const s=this.targetOrbitalPosition.theta-this.rotationVelocity.x;n=this.rotationFriction.calculateFriction(this.targetOrbitalPosition.theta,s)}if(this.targetOrbitalPosition.theta-=this.rotationVelocity.x*n,this.targetOrbitalPosition.phi-=this.rotationVelocity.y,this.targetOrbitalPosition.phi=Math.max(.1,Math.min(Math.PI-.1,this.targetOrbitalPosition.phi)),this.currentMode==="mesh"){const s=new D(-this.rotationVelocity.x*n,this.rotationVelocity.y,0);s.applyQuaternion(this.camera.quaternion).multiplyScalar(10),this.applyForceToAnchor(s)}}handlePanModeTranslation(e,t){const i=this.renderer.domElement.clientWidth,n=this.renderer.domElement.clientHeight,s=-(e.x/i)*2,a=e.y/n*2,r=this.calculateRayDistanceOptimised(),l=this.calculateWorldSpaceTranslation(s,a,r);this.panVelocity=l.clone(),this.absPanVelocity=l.clone(),this.previousMousePosition.copy(t),window.dispatchEvent(new CustomEvent("userInteracting",{detail:{translation:l,mode:"pan"}}))}calculateRayDistanceOptimised(){const t=this.camera.matrixWorld.clone().invert(),i=new D(0,0,0).applyMatrix4(t);return Math.abs(i.z)}calculateWorldSpaceTranslation(e,t,i){const n=this.camera,s=n.fov*Math.PI/180,a=n.aspect,r=this.previousMousePosition.x/this.renderer.domElement.clientWidth*2-1,l=-(this.previousMousePosition.y/this.renderer.domElement.clientHeight)*2+1,c=Math.atan(r*Math.tan(s/2)*a),h=Math.atan(l*Math.tan(s/2)),d=1/Math.cos(c),f=1/Math.cos(h),p=2*Math.tan(s/2)*i,b=p*a,_=e*(b/2)*d,y=t*(p/2)*f,v=new D,S=new D;v.setFromMatrixColumn(n.matrixWorld,0).normalize(),S.setFromMatrixColumn(n.matrixWorld,1).normalize();const A=new D;return A.addScaledVector(v,_),A.addScaledVector(S,y),A}snapShotPanModeOrigin(){this.panModeOrigin.position.copy(this.camera.position),this.panModeOrigin.quaternion.copy(this.camera.quaternion)}applyPanInertia(){var e,t,i,n,s,a;if(this.currentMode==="pan"&&!this.isDragging&&(this.panVelocity.length()>.001||((t=(e=this.previousPanVelocity)==null?void 0:e.average())==null?void 0:t.length())>.001)||this.absPanVelocity.length()>.001){this.absPanVelocity.length()<.001&&((n=(i=this.previousPanVelocity)==null?void 0:i.average())==null?void 0:n.length())>.001&&this.dragJustEnded&&this.absPanVelocity.copy(this.previousPanVelocity.average()),this.panVelocity.length()<.001&&((a=(s=this.previousPanVelocity)==null?void 0:s.average())==null?void 0:a.length())>.001&&this.dragJustEnded&&(this.panVelocity.copy(this.previousPanVelocity.average()),this.previousPanVelocity.clear()),this.dragJustEnded=!1;const r=this.panVelocity.length(),l=this.panDamping,c=.9,d=Math.min(r/.7,1),f=c+(l-c)*d;this.panVelocity.multiplyScalar(f),this.absPanVelocity.multiplyScalar(f),this.handlePanFloatingPointPrecision()}}handlePanFloatingPointPrecision(){this.panVelocity.length()<.0015&&this.panVelocity.set(0,0,0),this.absPanVelocity.length()<.0015&&this.absPanVelocity.set(0,0,0)}calculateAxisDominance(e){const t=Math.abs(e.x),i=Math.abs(e.y),n=t+i;if(n===0)return{dominantAxis:"both",xPercentage:0,yPercentage:0,xMultiplier:1,yMultiplier:1};const s=t/n*100,a=i/n*100,r=80,l=95;let c=1,h=1;if(s>r){const f=(s-r)/(l-r);h=Math.max(0,1-kt.easeOutCubic(Math.min(1,f)))}if(a>r){const f=(a-r)/(l-r);c=Math.max(0,1-kt.easeOutCubic(Math.min(1,f)))}let d="both";return s>l?d="x":a>l&&(d="y"),{dominantAxis:d,xPercentage:s,yPercentage:a,xMultiplier:c,yMultiplier:h}}onMouseUp(e){this.enabled&&(this.isDragging&&(this.dragHasStarted=!1,document.body.classList.remove("dragging"),this.idleSpeedX!==0&&(Math.sign(-this.rotationVelocity.x)===Math.sign(this.idleSpeedX)?this.currentIdleSpeedX=Math.min(Math.abs(this.rotationVelocity.x),Math.abs(this.idleSpeedX))*Math.sign(this.idleSpeedX):this.currentIdleSpeedX=0),this.idleSpeedY!==0&&(Math.sign(-this.rotationVelocity.y)===Math.sign(this.idleSpeedY)?this.currentIdleSpeedY=Math.min(Math.abs(this.rotationVelocity.y),Math.abs(this.idleSpeedY))*Math.sign(this.idleSpeedY):this.currentIdleSpeedY=0),this.restingPosX!==null&&(Math.sign(-this.rotationVelocity.x)===Math.sign(this.restingPosX-this.orbitalPosition.theta)?this.currentIdleSpeedX=Math.min(Math.abs(this.rotationVelocity.x),5e-4)*Math.sign(this.restingPosX-this.orbitalPosition.theta):this.currentIdleSpeedX=0),this.restingPosY!==null&&(Math.sign(-this.rotationVelocity.y)===Math.sign(this.restingPosY-this.orbitalPosition.phi)?this.currentIdleSpeedY=Math.min(Math.abs(this.rotationVelocity.y),5e-4)*Math.sign(this.restingPosY-this.orbitalPosition.phi):this.currentIdleSpeedY=0)),this.isDragging=!1,this.dragJustEnded=!0)}onMouseWheel(e){if(!this.enabled||e.deltaY<0&&!this.controlStates.zoom.in||e.deltaY>0&&!this.controlStates.zoom.out)return;let t=1;e.ctrlKey&&(t=5),this.lastInteractionTime=performance.now(),e.deltaY>20&&(this.lastZoomInteractionTime=performance.now());const n=e.deltaY*.1*t,s=this.currentZoomDistance+n,a=this.zoomFriction.calculateFriction(this.currentZoomDistance,s),r=n*a,l=this.currentZoomDistance+r;this.currentZoomDistance=Et.clamp(l,this.cameraClass.getMinZoom(),this.cameraClass.getMaxZoom()),this.currentMode==="pan"?this.handlePanModeZoom(r):this.targetOrbitalPosition.radius=this.currentZoomDistance,this.triggerZoomChange(),window.dispatchEvent(new CustomEvent("userInteracting",{detail:this.rotationVelocity}))}handlePanModeZoom(e,t="wheel"){this.zoomInputType=t;const i=new D(0,0,-1);i.applyQuaternion(this.camera.quaternion),i.normalize();const n=i.multiplyScalar(-e),s=e<0;this.pendingZoomVelocity.add(n),this.panVelocity.add(n),this.absPanVelocity.add(n);const a=this.panModeOrigin.worldToLocal(this.camera.position.clone()),r=An(a.z,this.panBounds.zMin,this.panBounds.zMax,0,1,!0),l=Et.clamp(r,0,1),h=((b,_)=>{if(b>=.35)return 1;const y=.35,v=.006;if(b<=v)return 0;const S=(y-b)/(y-v),E=1-kt.smoothstep(S);return _?E:1-(1-E)*.9})(l,s),d=2,f=.1,p=f+(d-f)*h;this.panVelocity.length()>p&&(this.panVelocity.normalize().multiplyScalar(p),this.absPanVelocity.normalize().multiplyScalar(p))}applyCursorBasedZoomOffset(){if(this.pendingZoomVelocity.length()===0)return;let e=null;if(this.zoomInputType==="wheel"&&this.currentCursorPosition?e=this.currentCursorPosition:(this.zoomInputType==="pinch"||this.zoomInputType==="gesture")&&this.currentPinchCenter&&(e=this.currentPinchCenter),!e){this.camera.position.add(this.pendingZoomVelocity),this.camera.updateMatrixWorld(),this.pendingZoomVelocity.set(0,0,0),this.consumeZoomVelocityComponent();return}const t=new et;t.x=e.x/window.innerWidth*2-1,t.y=-(e.y/window.innerHeight)*2+1;const i=new ys;i.setFromCamera(t,this.camera);const n=this.originPosition.clone();this.camera.worldToLocal(n);const s=Math.abs(n.z),a=this.getCursorWorldPositionAtDistance(i,s);this.camera.position.add(this.pendingZoomVelocity),this.camera.updateMatrixWorld();const r=new ys;r.setFromCamera(t,this.camera);const l=this.originPosition.clone();this.camera.worldToLocal(l);const c=Math.abs(l.z),h=this.getCursorWorldPositionAtDistance(r,c),d=a.clone().sub(h);this.panModeOrigin.worldToLocal(this.camera.position.clone()).z>this.panBounds.zMin&&(this.camera.position.add(d),this.camera.updateMatrixWorld()),this.pendingZoomVelocity.set(0,0,0),this.zoomInputType=null,this.consumeZoomVelocityComponent()}consumeZoomVelocityComponent(){const e=new D(0,0,-1);e.applyQuaternion(this.camera.quaternion),e.normalize();const t=this.panVelocity.dot(e),i=e.multiplyScalar(t);this.panVelocity.sub(i),this.handlePanFloatingPointPrecision(),this.applyPanBoundaries()}getCursorWorldPositionAtDistance(e,t){const i=e.ray.direction.clone();return e.ray.origin.clone().add(i.multiplyScalar(t))}applyForceToAnchor(e){if(!this.enabled)return;const t=new D().copy(e).projectOnPlane(this.interpolatedNormal);this.anchorVelocity.add(t),this.anchorVelocity.multiplyScalar(.98)}setZoomFrictionToLimits(){this.setZoomFriction([{name:"bound-zoom-min-forward",position:this.minZoomBoundDistance,radius:50,strength:.8,direction:"forward",beyond:!0},{name:"bound-zoom-min-back",position:this.minZoomBoundDistance,radius:30,strength:.8,direction:"backward",away:!0},{name:"bound-zoom-max-back",position:this.maxZoomBoundDistance,radius:50,strength:.8,direction:"backward",beyond:!0},{name:"bound-zoom-max-forward",position:this.maxZoomBoundDistance,radius:30,strength:.8,direction:"forward",away:!0}])}setZoomSpringForceToLimits(){this.setZoomSpringForce([{position:this.minZoomBoundDistance,stiffness:.01,damping:.8,direction:"backward",delay:10},{position:this.maxZoomBoundDistance,stiffness:.01,damping:.8,direction:"forward",delay:10}])}initDebugMode(){const e=new qt({color:16711680,opacity:.1,transparent:!0}),t=new yn({color:16711680});if(this.collisionMesh){this.debugCollisionMesh=this.collisionMesh.clone(),this.debugCollisionMesh.material=e,this.scene.add(this.debugCollisionMesh);const V=new $d(this.collisionMesh.geometry);this.debugCollisionEdges=new Wl(V,t),this.debugCollisionEdges.scale.copy(this.collisionMesh.scale),this.debugCollisionMesh.add(this.debugCollisionEdges)}const i=new fi,n=new yn({color:65280});this.debugSkeletonToAnchorLine=new Mn(i,n),this.scene.add(this.debugSkeletonToAnchorLine);const s=new Wi(1,16,16),a=new qt({color:65280,opacity:.1,transparent:!0});this.debugAnchorMesh=new It(s,a),this.scene.add(this.debugAnchorMesh);const r=new yn({color:65280}),l=new $d(s),c=new Wl(l,r);this.debugAnchorMesh.add(c);const h=new fi().setFromPoints([new D,new D]),d=new yn({color:255});this.debugRay=new Mn(h,d),this.scene.add(this.debugRay);const f=new Wi(.5,16,16),p=new qt({color:16776960});this.debugCollisionPoint=new It(f,p),this.scene.add(this.debugCollisionPoint);const b=new Wi(.1,16,16),_=new qt({color:255});this.debugFaceCenter=new It(b,_),this.scene.add(this.debugFaceCenter);const y=new fi().setFromPoints([new D,new D(0,0,5)]),v=new yn({color:16711935});this.debugAnchorDirection=new Mn(y,v),this.scene.add(this.debugAnchorDirection);const S=new fi().setFromPoints([new D,new D(0,0,5)]),A=new yn({color:65535});this.debugInterpolatedNormal=new Mn(S,A),this.scene.add(this.debugInterpolatedNormal),this.debugInterpolatedNormalArrow=new af(new D(0,1,0),new D,5,255),this.scene.add(this.debugInterpolatedNormalArrow);const E=new Wi(.2,16,16),O=new qt({color:65280});for(let V=0;V<50;V++){const Y=new It(E,O);this.closestPointMarkers.push(Y),this.scene.add(Y)}for(let V=0;V<50;V++){const Y=new af(new D(0,1,0),new D,2,16711935);this.debugNeighbourNormalRays.push(Y),this.scene.add(Y)}const R=new qt({color:16711935});for(let V=0;V<10;V++){const Y=new It(E,R);this.vertexMarkers.push(Y),this.scene.add(Y)}const k=new qt({color:65535});for(let V=0;V<50;V++){const Y=new It(E,k);this.neighbouringFaceVertexMarkers.push(Y),this.scene.add(Y)}const U=new qt({color:16711935});for(let V=0;V<50;V++){const Y=new It(E,U);this.debugEdgeIntersections.push(Y),this.scene.add(Y)}const C=new yn({color:65535});for(let V=0;V<50;V++){const Y=new fi().setFromPoints([new D,new D]),J=new Mn(Y,C);this.debugLines.push(J),this.scene.add(J)}for(let V=0;V<3;V++){const Y=new fi().setFromPoints([new D,new D]),J=new Mn(Y,C);this.debugFaceEdges.push(J),this.scene.add(J)}const T=new Wi(.5,16,16),Z=new qt({color:65535});this.debugCrossPoint=new It(T,Z),this.scene.add(this.debugCrossPoint);const z=new fi().setFromPoints([new D,new D]),B=new yn({color:65535});this.debugCrossPointLine=new Mn(z,B),this.scene.add(this.debugCrossPointLine)}initialiseAnchorPosition(e){if(!this.collisionMesh)return;const t=e||new D(0,.5,1).normalize(),i=new ys(this.originPosition,t);i.layers.set(2);const n=i.intersectObject(this.collisionMesh,!0);if(n.length>0){this.anchor.position.copy(n[0].point),this.collisionPoint.copy(n[0].point),this.interpolatedNormal=this.getInterpolatedNormal(n[0]);const s=this.interpolatedNormal.clone().multiplyScalar(this.currentZoomDistance);this.camera.position.copy(this.anchor.position).add(s),this.camera.lookAt(this.anchor.position)}else console.warn("No initial intersection found. Anchor not placed on mesh."),this.projectAnchorOntoMesh(this.collisionMesh)}setIdleSpeeds(e,t){this.idleSpeedX=e,this.idleSpeedY=t,this.currentIdleSpeedX=0,this.currentIdleSpeedY=0}applyIdleOrbit(){if(!this.shouldApplyIdleOrbit)return;const t=performance.now()-this.lastInteractionTime;if(t<this.idleTransitionDelay)return;const i=Math.min((t-this.idleTransitionDelay)/this.idleTransitionDuration,1),n=kt.easeOutCubic(i);let s=0,a=0,r=0;const l=5e-4,c=.05;if(this.restingPosX!==null){const h=Math.abs(this.idleSpeedX)||l;this.currentIdleSpeedX=this.interpolateTowardsTarget(this.currentIdleSpeedX,h),s=this.calculateRestingForce(this.orbitalPosition.theta,this.restingPosX,this.currentIdleSpeedX*this.calculateForceScalingFactor(!0))}else this.idleSpeedX!==0&&(this.currentIdleSpeedX=this.interpolateTowardsTarget(this.currentIdleSpeedX,this.idleSpeedX),s=this.currentIdleSpeedX*this.calculateForceScalingFactor(!0));if(this.restingPosY!==null){const h=Math.abs(this.idleSpeedY)||l;this.currentIdleSpeedY=this.interpolateTowardsTarget(this.currentIdleSpeedY,h),a=this.calculateRestingForce(this.orbitalPosition.phi,this.restingPosY,this.currentIdleSpeedY*this.calculateForceScalingFactor(!0))}else this.idleSpeedY!==0&&(this.currentIdleSpeedY=this.interpolateTowardsTarget(this.currentIdleSpeedY,this.idleSpeedY),a=this.currentIdleSpeedY*this.calculateForceScalingFactor(!0));if(this.restingZoom!==null&&(this.currentIdleSpeedZoom=this.interpolateTowardsTarget(this.currentIdleSpeedZoom,c),r=this.calculateRestingForce(this.currentZoomDistance,this.restingZoom,this.currentIdleSpeedZoom)),s*=n,a*=n,r*=n,this.currentMode==="mesh"&&this.collisionMesh){const h=new D(s*3,a,0).applyQuaternion(this.camera.quaternion);this.applyForceToAnchor(h)}else this.targetOrbitalPosition.theta+=s,this.targetOrbitalPosition.phi=Et.clamp(this.targetOrbitalPosition.phi+a,.1,Math.PI-.1);r!==0&&(this.currentZoomDistance=Et.clamp(this.currentZoomDistance+r,this.minZoomDistance,this.maxZoomDistance),this.targetOrbitalPosition.radius=this.currentZoomDistance),this.triggerZoomChange()}interpolateTowardsTarget(e,t){const i=this.idleInterpolationFactor,s=kt.easeInCubic(i)*Math.abs(t-e);return e+Math.sign(t-e)*s}getIdleSpeeds(){return{x:this.idleSpeedX,y:this.idleSpeedY}}setIdleOrbitDelay(e){this.idleOrbitDelay=e}getIdleOrbitDelay(){return this.idleOrbitDelay}update(){if(!this.enabled)return;if(performance.now(),this.collisionMesh&&this.collisionMesh.updateMatrixWorld(!0),this.updateKeyboardControls(),!this.isDragging){const t=this.calculateForceScalingFactor();let i=1;if(Math.abs(this.rotationVelocity.x)>1e-5){const s=this.targetOrbitalPosition.theta-this.rotationVelocity.x;i=this.rotationFriction.calculateFriction(this.targetOrbitalPosition.theta,s)}if(this.targetOrbitalPosition.theta-=this.rotationVelocity.x*i,this.targetOrbitalPosition.phi-=this.rotationVelocity.y,this.targetOrbitalPosition.phi=Math.max(.1,Math.min(Math.PI-.1,this.targetOrbitalPosition.phi)),this.rotationVelocity.multiplyScalar(this.rotationDamping),this.currentMode==="mesh"){const s=new D(-this.rotationVelocity.x*i,this.rotationVelocity.y,0).multiplyScalar(10*t);s.applyQuaternion(this.camera.quaternion),this.applyForceToAnchor(s)}const n=this.zoomSpringForce.calculateForce(this.currentZoomDistance,this.lastZoomInteractionTime);this.currentZoomDistance+=n,this.targetOrbitalPosition.radius=this.currentZoomDistance}if(this.applyPanInertia(),this.applyIdleOrbit(),this.anchorVelocity.multiplyScalar(.95),this.anchor.position.add(this.anchorVelocity),this.collisionMesh&&this.constrainAnchorToCollisionMesh(),this.debug&&this.debugAnchorMesh&&this.debugAnchorMesh.position.copy(this.anchor.position),this.debug&&this.debugAnchorDirection){const t=new D(0,0,-1).applyQuaternion(this.anchor.quaternion),i=[this.anchor.position.clone(),this.anchor.position.clone().add(t)];this.debugAnchorDirection.geometry.setFromPoints(i),this.debugAnchorDirection.geometry.attributes.position.needsUpdate=!0}const e=this.calculateEasingMultiplier();this.targetPosition.lerp(this.anchor.position,this.easingFactor*e),this.targetRotation.slerp(this.anchor.quaternion,.05*e),this.updateCamera()}calculateForceScalingFactor(e=!1){const t=e?this.idleForceMultiplier:1;if(this.currentMode==="mesh"){const i=this.calculateZoomBlendFactor(this.minZoomDistance+0,this.minZoomDistance+20);return Et.lerp(.05,.5,i)*t}else return 3*t}setIdleForceMultiplier(e){this.idleForceMultiplier=e}getIdleForceMultiplier(){return this.idleForceMultiplier}constrainAnchorToCollisionMesh(){if(!this.collisionMesh)return;const e=this.skeleton.findClosestPoint(this.anchor.position),t=this.skeleton.findClosestSegment(this.anchor.position);if(t){const[a,r]=t,l=new Jp(a,r);this.currentSkeletonPoint=new D,l.closestPointToPoint(this.anchor.position,!0,this.currentSkeletonPoint)}else this.currentSkeletonPoint=e;const i=new D().subVectors(this.anchor.position,this.currentSkeletonPoint).normalize(),n=new ys(this.currentSkeletonPoint,i);n.far=this.rayLength,n.layers.set(2);const s=n.intersectObject(this.collisionMesh,!0);if(s.length>0){let a=s[0],r=this.anchor.position.distanceTo(s[0].point);for(let c=1;c<s.length;c++){const h=this.anchor.position.distanceTo(s[c].point);h<r&&(r=h,a=s[c])}this.anchor.position.copy(a.point),this.collisionPoint.copy(a.point),this.interpolatedNormal=this.getInterpolatedNormal(a);let l=this.useInterpolatedNormal?this.interpolatedNormal:a.face.normal.clone().applyMatrix3(new Wt().getNormalMatrix(a.object.matrixWorld)).normalize();if(this.anchor.lookAt(this.anchor.position.clone().add(l)),this.originToAnchorRay=new _s(this.originPosition.clone(),this.anchor.position.clone().sub(this.originPosition).normalize()),this.debug){this.debugCollisionPoint.position.copy(a.point),this.debugInterpolatedNormalArrow&&(this.debugInterpolatedNormalArrow.position.copy(this.collisionPoint),this.debugInterpolatedNormalArrow.setDirection(this.interpolatedNormal),this.debugInterpolatedNormalArrow.visible=!0);const{a:c,b:h,c:d}=a.face,f=a.object.geometry.attributes.position,p=[c,h,d].map(v=>{const S=new D;return S.fromBufferAttribute(f,v),S.applyMatrix4(a.object.matrixWorld)});this.vertexMarkers.forEach((v,S)=>{S<p.length?(v.position.copy(p[S]),v.visible=!0):v.visible=!1});const b=[[p[0],p[1]],[p[1],p[2]],[p[2],p[0]]];this.debugFaceEdges.forEach((v,S)=>{S<b.length?(v.geometry.setFromPoints(b[S]),v.visible=!0):v.visible=!1});const _=this.getNeighbouringFaces(a);this.closestPointMarkers.forEach((v,S)=>{v.visible=!1});let y=0;_.forEach((v,S)=>{[v.a,v.b,v.c].map(E=>{const O=new D;return O.fromBufferAttribute(f,E),O.applyMatrix4(a.object.matrixWorld)}).forEach(E=>{y<this.neighbouringFaceVertexMarkers.length&&(this.neighbouringFaceVertexMarkers[y].position.copy(E),this.neighbouringFaceVertexMarkers[y].visible=!0,y++)}),this.closestPointMarkers[S].position.copy(v.closestPoint),this.closestPointMarkers[S].visible=!0})}}}setRayPercentage(e){this.rayPercentage=Et.clamp(e,0,1)}calculateRestingForce(e,t,i){const n=t-e,s=Math.abs(n),a=Math.sign(n);if(s<=this.restingDeadzone)return 0;const r=this.restingDeadzone*500;if(s<r){const l=s/r,c=l*(2-l),h=1-Math.pow(1-c,3),d=Math.min(1,s/(r*.5)),f=Et.lerp(h,c,d);return a*i*f}return a*i}setRestingDeadzone(e){this.restingDeadzone=Math.max(0,e)}getRestingDeadzone(){return this.restingDeadzone}getNeighbouringFaces(e){const t=[],{a:i,b:n,c:s}=e.face,a=e.object.geometry,r=a.index,l=a.attributes.position,c=h=>new D().fromBufferAttribute(l,h).applyMatrix4(e.object.matrixWorld);for(let h=0;h<r.count;h+=3){const d=r.getX(h),f=r.getX(h+1),p=r.getX(h+2);if([d,f,p].filter(_=>[i,n,s].includes(_)).length>1&&!(d===i&&f===n&&p===s)){const _=c(d),y=c(f),v=c(p),S=this.closestPointOnTriangle(e.point,_,y,v),A=e.point.distanceTo(S),E=Math.max(_.distanceTo(y),y.distanceTo(v),v.distanceTo(_)),O=new D().crossVectors(y.clone().sub(_),v.clone().sub(_)).normalize();t.push({a:d,b:f,c:p,normal:O,distance:A,maxDistance:E,closestPoint:S})}}return t}closestPointOnTriangle(e,t,i,n){const s=new On(t,i,n),a=new D;return s.closestPointToPoint(e,a),a}getBarycentricCoordinates(e,t,i,n){const s=new D().subVectors(i,t),a=new D().subVectors(n,t),r=new D().subVectors(e,t),l=s.dot(s),c=s.dot(a),h=a.dot(a),d=r.dot(s),f=r.dot(a),p=l*h-c*c,b=(h*d-c*f)/p,_=(l*f-c*d)/p,y=1-b-_;return new D(y,b,_)}getInterpolatedNormal(e){const t=e.object,i=t.geometry,n=i.attributes.normal,s=i.attributes.position,a=e.face,r=new D().fromBufferAttribute(s,a.a),l=new D().fromBufferAttribute(s,a.b),c=new D().fromBufferAttribute(s,a.c);r.applyMatrix4(t.matrixWorld),l.applyMatrix4(t.matrixWorld),c.applyMatrix4(t.matrixWorld);const h=this.getBarycentricCoordinates(e.point,r,l,c),d=new D().fromBufferAttribute(n,a.a),f=new D().fromBufferAttribute(n,a.b),p=new D().fromBufferAttribute(n,a.c),b=new Wt().getNormalMatrix(t.matrixWorld);return d.applyMatrix3(b),f.applyMatrix3(b),p.applyMatrix3(b),new D().addScaledVector(d,h.x).addScaledVector(f,h.y).addScaledVector(p,h.z).normalize()}applyPanBoundaries(){const e=this.panModeOrigin.worldToLocal(this.camera.position.clone()),t=new D(Et.clamp(e.x,this.panBounds.xMin,this.panBounds.xMax),Et.clamp(e.y,this.panBounds.yMin,this.panBounds.yMax),Et.clamp(e.z,this.panBounds.zMin,this.panBounds.zMax));this.panBounds.zMin===t.z?setTimeout(()=>{this.cameraClass.app.letterOverlayManager.manualQueueProgress=!0},10):this.cameraClass.app.letterOverlayManager.manualQueueProgress=!1,this.camera.position.copy(this.panModeOrigin.localToWorld(t))}updateCamera(){var s,a,r,l;if(!this.collisionMesh)this.currentMode=this.currentMode==="pan"?"pan":"radial";else{const c=this.calculateModeBlendFactor();this.currentMode=c<.5?"mesh":"radial";const h=this.getAssetFromCollisionMesh(this.collisionMesh);if(h!=null&&h.hasAnimatedCollision()){const f=1-this.calculateMeshAnimationBlendFactor();h.updateCollisionMeshAnimation(f)}}const e=this.calculateNormalBlendFactor(),t=this.calculateFocusBlendFactor();this.collisionMesh&&this.updateFocusPosition(t);let i=new D(0,0,0),n=new D(0,0,0);if(this.currentMode==="mesh"){const c=this.anchor.position.clone();new ys(this.currentSkeletonPoint,new D().subVectors(c,this.currentSkeletonPoint).normalize()).layers.set(2);const f=this.calculateBlendedNormal(e).clone().multiplyScalar(this.currentZoomDistance);i=this.focusPosition.clone().add(f),n=this.focusPosition,this.updateOrbitalPositionFromCamera(i);const p=this.camera.position.clone().sub(this.originPosition);this.orbitalPosition.setFromVector3(p),this.targetOrbitalPosition.copy(this.orbitalPosition)}else if(this.currentMode==="radial"){if(((a=(s=this==null?void 0:this.cameraClass)==null?void 0:s.app)==null?void 0:a.actManager.getAct())===2){const{angleY:d}=this.cameraClass.getCameraOrbitAngles(),f=sm(d,.93516308961);(l=(r=this==null?void 0:this.cameraClass)==null?void 0:r.app)==null||l.uiManager.updateMenuDot(f)}this.orbitalPosition.theta=Et.lerp(this.orbitalPosition.theta,this.targetOrbitalPosition.theta,this.easingFactor),this.orbitalPosition.phi=Et.lerp(this.orbitalPosition.phi,this.targetOrbitalPosition.phi,this.easingFactor),this.orbitalPosition.radius=Et.lerp(this.orbitalPosition.radius,this.targetOrbitalPosition.radius,this.easingFactor);const c=this.originPosition.clone();i=new D().setFromSpherical(this.orbitalPosition).add(c),n=c,this.collisionMesh&&this.updateAnchorPositionRadial(i)}else this.currentMode==="pan"?(this.applyCursorBasedZoomOffset(),this.panVelocity&&this.panVelocity.length()>0&&(this.camera.position.add(this.panVelocity),this.applyPanBoundaries(),this.currentZoomDistance=this.camera.position.clone().sub(this.originPosition).length()),this.isDragging&&(this.previousPanVelocity.add(new D(0,0,0).copy(this.panVelocity)),this.panVelocity.set(0,0,0),this.absPanVelocity.set(0,0,0))):(i=this.camera.position.clone(),n=this.originPosition);this.currentMode!=="pan"&&(this.camera.position.lerp(i,this.easingFactor/2),this.updateCameraOrientation(n,this.interpolatedNormal))}updateCameraOrientation(e,t){const i=new D(0,1,0);if(this.currentMode==="radial"){this.camera.up.copy(i),this.camera.lookAt(e),this.previousLookDirection.copy(new D().subVectors(e,this.camera.position).normalize());return}const n=t.angleTo(i),s=.3,a=.005,r=new D().subVectors(e,this.camera.position).normalize(),l=new D().crossVectors(this.previousUpVector,r).normalize();this.previousRightVector.lerp(l,a).normalize();const c=new D().crossVectors(r,this.previousRightVector).normalize();n<s||n>Math.PI-s?this.previousUpVector.lerp(c,a).normalize():this.previousUpVector.lerp(i,a).normalize(),this.camera.up.copy(this.previousUpVector),this.camera.lookAt(e),this.previousLookDirection.copy(r)}getAssetFromCollisionMesh(e){return e.userData.asset||null}setZoom(e){if(this.currentZoomDistance=Et.clamp(e,this.minZoomDistance,this.maxZoomDistance),this.orbitalPosition.radius=this.currentZoomDistance,this.targetOrbitalPosition.radius=this.currentZoomDistance,this.currentMode==="mesh"&&this.focusPosition){const n=this.calculateBlendedNormal(this.calculateNormalBlendFactor()).clone().multiplyScalar(this.currentZoomDistance);this.camera.position.copy(this.focusPosition.clone().add(n))}else{const i=this.camera.position.clone().sub(this.originPosition).normalize();this.camera.position.copy(this.originPosition.clone().add(i.multiplyScalar(this.currentZoomDistance)))}const t=this.currentMode==="mesh"&&this.focusPosition?this.focusPosition:this.originPosition;this.camera.lookAt(t),this.triggerZoomChange()}calculateMeshAnimationBlendFactor(){const e=this.minZoomDistance+0-this.minZoomDistance+2,t=(this.currentZoomDistance-this.minZoomDistance)/e;return Et.smoothstep(t,0,1)}calculateZoomBlendFactor(e,t){const i=t-e,n=(this.currentZoomDistance-e)/i;return Et.clamp(n,0,1)}calculateFocusBlendFactor(){const e=this.minZoomDistance+this.focusZoomRangeMin-this.minZoomDistance+this.focusZoomRangeMax,t=(this.currentZoomDistance-this.minZoomDistance)/e;return Et.smoothstep(t,0,1)}setFocusBlendRange(e,t){this.focusZoomRangeMin=e,this.focusZoomRangeMax=t}calculateModeBlendFactor(){const e=this.minZoomDistance+this.modeZoomRangeMin-this.minZoomDistance+this.modeZoomRangeMax,t=(this.currentZoomDistance-this.minZoomDistance)/e;return Et.smoothstep(t,0,1)}calculateNormalBlendFactor(){const e=this.minZoomDistance+this.normalZoomRangeMin-this.minZoomDistance+this.normalZoomRangeMax,t=(this.currentZoomDistance-this.minZoomDistance)/e;return Et.smoothstep(t,0,1)}setModeBlendRange(e,t){this.modeZoomRangeMin=e,this.modeZoomRangeMax=t}setNormalBlendRange(e,t){this.normalZoomRangeMin=e,this.normalZoomRangeMax=t}updateFocusPosition(e){this.originToAnchorRay||(this.originToAnchorRay=new _s(this.originPosition.clone(),this.anchor.position.clone().sub(this.originPosition).normalize()));const i=this.originPosition.distanceTo(this.anchor.position)*(1-e);this.focusPosition=this.originToAnchorRay.at(i,this.focusPosition||new D)}calculateBlendedNormal(e){const t=this.interpolatedNormal,i=new D().subVectors(this.anchor.position,this.originPosition).normalize();return new D().lerpVectors(t,i,e).normalize()}setCollisionMesh(e,t,i={}){this.collisionMesh=e,this.collisionMesh.layers.set(2),this.collisionMesh.updateMatrixWorld(!0),this.synchroniseWithCamera(),t===void 0&&(t=this.autoDetectSkeletonType(this.collisionMesh));const n={mesh:this.collisionMesh,...i};this.skeleton=rc.create(t,n),this.repositionAnchorToNearestPoint()}autoDetectSkeletonType(e){return e.children.filter(i=>i.name.startsWith("CamPoint_")).length>0?ns.POINTS_WITH_LINES:e instanceof Eo?ns.FULL_SKELETON:ns.CENTRE_POINT}updateAnchorPositionRadial(e){if(!this.collisionMesh)return;const t=new D().subVectors(this.originPosition,e).normalize(),i=new ys(e,t);i.layers.set(2);const n=i.intersectObject(this.collisionMesh,!0);if(n.length>0)this.anchor.position.copy(n[0].point);else{const s=this.originPosition.distanceTo(this.anchor.position);this.anchor.position.copy(t).multiplyScalar(-s).add(this.originPosition)}}updateOrbitalPositionFromCamera(e){const t=new D().subVectors(e,this.originPosition);this.orbitalPosition.setFromVector3(t)}repositionAnchorToNearestPoint(){if(!this.collisionMesh)return;const e=new ys(this.originPosition,this.anchor.position.clone().sub(this.originPosition).normalize());e.layers.set(2);const t=e.intersectObject(this.collisionMesh,!0);t.length>0?this.anchor.position.copy(t[0].point):(console.warn("No intersection found when repositioning anchor."),this.projectAnchorOntoMesh(this.collisionMesh))}projectAnchorOntoMesh(e){if(!this.collisionMesh)return;const t=new D,i=new D,n=new D;e.geometry.computeBoundingSphere();const s=e.geometry.boundingSphere.center.clone().applyMatrix4(e.matrixWorld),a=e.geometry.boundingSphere.radius*Math.max(e.scale.x,e.scale.y,e.scale.z);this.anchor.getWorldPosition(n),i.subVectors(n,s).normalize().multiplyScalar(a).add(s);const r=new ys(s,i.sub(s).normalize());r.layers.set(2);const l=r.intersectObject(e,!0);l.length>0?t.copy(l[0].point):t.copy(i),this.anchor.position.copy(t)}setAct3CollisionMesh(e){if(this.act3CollisionMesh=e,this.debug&&(this.debugAct3CollisionMesh&&this.scene.remove(this.debugAct3CollisionMesh),this.debugAct3CollisionMesh=this.act3CollisionMesh.clone(),this.debugAct3CollisionMesh.material=new qt({color:255,opacity:.1,transparent:!0,wireframe:!0}),this.scene.add(this.debugAct3CollisionMesh),!this.act3AnchorVisualization)){const t=new Wi(.5,16,16),i=new qt({color:255});this.act3AnchorVisualization=new It(t,i),this.scene.add(this.act3AnchorVisualization)}}resetAnchorPosition(e=new D(0,0,0)){this.anchor.position.copy(e),this.orbitalPosition.setFromVector3(this.camera.position.clone().sub(this.originPosition)),this.targetOrbitalPosition.copy(this.orbitalPosition),this.currentZoomDistance=this.camera.position.distanceTo(this.originPosition),this.updateFocusPosition(this.calculateFocusBlendFactor()),this.rotationVelocity.set(0,0),this.anchorVelocity.set(0,0,0),this.isDragging=!1,this.lastInteractionTime=performance.now(),this.collisionPoint.copy(e),this.interpolatedNormal.set(0,1,0),this.originToAnchorRay=new _s(this.originPosition.clone(),this.anchor.position.clone().sub(this.originPosition).normalize()),this.currentMode="radial",this.currentSkeletonPoint=null,this.collisionMesh=null,this.skeleton=null,this.camera.up.set(0,1,0),this.camera.lookAt(this.originPosition);const t=new D().setFromSpherical(this.orbitalPosition).add(this.originPosition);this.camera.position.copy(t),this.camera.updateMatrixWorld(!0)}removeCollisionMesh(){this.collisionMesh=null,this.skeleton=null,this.currentMode="pan",this.currentSkeletonPoint=null}toggleInterpolatedNormal(){this.useInterpolatedNormal=!this.useInterpolatedNormal}setRestingPosX(e){this.restingPosX=e}setRestingPosY(e){this.restingPosY=e}setRestingZoom(e){this.restingZoom=e,this.currentIdleSpeedZoom=0}getMinZoom(){return this.minZoomDistance}getMaxZoom(){return this.maxZoomDistance}getMinZoomBound(){return this.minZoomBoundDistance}getMaxZoomBound(){return this.maxZoomBoundDistance}setZoomLimits(e,t){this.minZoomDistance=e,this.maxZoomDistance=t,this.minZoomBoundDistance=e,this.maxZoomBoundDistance=t,this.setZoomFrictionToLimits(),this.setZoomSpringForceToLimits()}jumpToPosition(e,t){this.camera.position.copy(e),this.camera.lookAt(t),this.currentZoomDistance=this.camera.position.distanceTo(t)}getIdleSpeedX(){return this.idleSpeedX!==void 0?this.idleSpeedX:.01}getIdleSpeedY(){return this.idleSpeedY!==void 0?this.idleSpeedY:.01}resetMotionWithVelocity(e,t){const i=this.camera.position.length(),n=e.divideScalar(i);this.idleSpeedX=t.x!==void 0?t.x:-n.y,this.idleSpeedY=t.y!==void 0?t.y:n.x;const s=this.camera.position.clone().sub(this.originPosition);this.orbitalPosition.setFromVector3(s),this.targetOrbitalPosition.copy(this.orbitalPosition),this.lastInteractionTime=performance.now()}updateRadialPosition({theta:e,phi:t,radius:i}){this.targetOrbitalPosition.theta=e,this.targetOrbitalPosition.phi=t,this.targetOrbitalPosition.radius=i}updateCurrentPosition({theta:e,phi:t,radius:i}){this.orbitalPosition.theta=e,this.orbitalPosition.phi=t,this.orbitalPosition.radius=i}synchroniseDistanceWithCamera(){const t=this.camera.position.clone().sub(this.originPosition);this.currentZoomDistance=t.length()}synchroniseWithCamera(){const e=this.camera,t=this.currentMode,i=e.position.clone().sub(this.originPosition);this.orbitalPosition.setFromVector3(i),this.targetOrbitalPosition.copy(this.orbitalPosition),this.currentZoomDistance=i.length(),this.anchor.position.copy(e.position),this.updateFocusPosition(this.calculateFocusBlendFactor()),this.rotationVelocity.set(0,0),this.anchorVelocity.set(0,0,0),this.panVelocity&&(this.panVelocity.set(0,0,0),this.absPanVelocity.set(0,0,0)),this.isDragging=!1,this.lastInteractionTime=performance.now(),t==="pan"&&(this.currentMode="pan")}initKeyboardControls(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}updateKeyboardControls(){const e=performance.now();let t=!1;if(this.axisState.x.active){t=!0;const i=e-this.axisState.x.startTime,n=Math.min(i/this.keyboardEaseTime,1),s=kt.easeOutCubic(n);this.keyboardForce.x=this.axisState.x.targetForce*s}else Math.abs(this.keyboardForce.x)>0&&(this.keyboardForce.x*=this.keyboardDamping,Math.abs(this.keyboardForce.x)<1e-4&&(this.keyboardForce.x=0));if(this.axisState.y.active){t=!0;const i=e-this.axisState.y.startTime,n=Math.min(i/this.keyboardEaseTime,1),s=kt.easeOutCubic(n);this.keyboardForce.y=this.axisState.y.targetForce*s}else Math.abs(this.keyboardForce.y)>0&&(this.keyboardForce.y*=this.keyboardDamping,Math.abs(this.keyboardForce.y)<1e-4&&(this.keyboardForce.y=0));if(this.axisState.zoom.active){t=!0;const i=e-this.axisState.zoom.startTime,n=Math.min(i/this.keyboardEaseTime,1),s=kt.easeOutCubic(n);this.zoomForce=this.axisState.zoom.targetForce*s}else Math.abs(this.zoomForce)>0&&(this.zoomForce*=this.keyboardDamping,Math.abs(this.zoomForce)<.01&&(this.zoomForce=0));if(t&&(this.lastInteractionTime=e),this.keyboardForce.lengthSq()>0)if(this.currentMode==="pan"){const i=new et(this.keyboardForce.x*this.keyboardPanForceMultiplier,this.keyboardForce.y*this.keyboardPanForceMultiplier),n=new et(0,0);this.handlePanModeTranslation(i,n)}else{const i=this.calculateForceScalingFactor();if(this.targetOrbitalPosition.theta-=this.keyboardForce.x,this.targetOrbitalPosition.phi-=this.keyboardForce.y,this.targetOrbitalPosition.phi=Math.max(.1,Math.min(Math.PI-.1,this.targetOrbitalPosition.phi)),this.currentMode==="mesh"){const n=new D(-this.keyboardForce.x,this.keyboardForce.y,0).multiplyScalar(10*i);n.applyQuaternion(this.camera.quaternion),this.applyForceToAnchor(n)}}this.zoomForce!==0&&(this.currentZoomDistance=Et.clamp(this.currentZoomDistance+this.zoomForce,this.minZoomDistance,this.maxZoomDistance),this.currentMode==="pan"?this.handlePanModeZoom(this.zoomForce,"key"):this.targetOrbitalPosition.radius=this.currentZoomDistance,this.triggerZoomChange()),(this.keyboardForce.lengthSq()>0||this.zoomForce!==0)&&window.dispatchEvent(new CustomEvent("userInteracting",{detail:{x:this.keyboardForce.x,y:this.keyboardForce.y,zoom:this.zoomForce}}))}getOrbitalAngles(){return{theta:this.orbitalPosition.theta,phi:this.orbitalPosition.phi}}setZoomStates(e,t){typeof e=="boolean"?!t||t.length===0?(this.controlStates.zoom.in=e,this.controlStates.zoom.out=e):t.forEach(i=>{this.controlStates.zoom[i]=e}):Object.entries(e).forEach(([i,n])=>{i in this.controlStates.zoom&&(this.controlStates.zoom[i]=n)})}setRotationStates(e,t){typeof e=="boolean"?!t||t.length===0?(this.controlStates.rotation.left=e,this.controlStates.rotation.right=e,this.controlStates.rotation.up=e,this.controlStates.rotation.down=e):t.forEach(i=>{switch(i){case"x":this.controlStates.rotation.left=e,this.controlStates.rotation.right=e;break;case"y":this.controlStates.rotation.up=e,this.controlStates.rotation.down=e;break;default:this.controlStates.rotation[i]=e}}):Object.entries(e).forEach(([i,n])=>{i in this.controlStates.rotation&&(this.controlStates.rotation[i]=n)})}setAllControlStates(e){this.setZoomStates(e),this.setRotationStates(e)}setKeyboardInversion(e,t){this.keyboardInvertX=e,this.keyboardInvertY=t}dispose(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp)}calculateEasingMultiplier(){const e=this.anchorVelocity.length(),t=1,i=.1,n=Et.clamp((e-i)/(t-i),0,1);return 1-Math.pow(n,2)}setShouldApplyIdleOrbit(e){this.shouldApplyIdleOrbit=e}resetInteractionTime(){this.lastInteractionTime=performance.now()}setZoomFriction(e){this.zoomFriction.clearFrictionPoints(),e.forEach(t=>this.zoomFriction.addFrictionPoint(t))}setZoomSpringForce(e){this.zoomSpringForce.clearSpringPoints(),e.forEach(t=>this.zoomSpringForce.addSpringPoint(t))}setRotationFriction(e){this.rotationFriction.clearFrictionPoints(),e.forEach(t=>this.rotationFriction.addFrictionPoint(t))}setRotationFrictionLimits(e,t){this.setRotationFriction([{name:"bound-rotation-start-forward",position:e,radius:Math.PI/8,strength:.8,direction:"forward",beyond:!0},{name:"bound-rotation-start-back",position:e,radius:Math.PI/12,strength:.8,direction:"backward",away:!0}])}setRotation(e,t=null){if(e!==null&&(this.orbitalPosition.theta=e,this.targetOrbitalPosition.theta=e),t!==null){const s=Math.max(.1,Math.min(Math.PI-.1,t));this.orbitalPosition.phi=s,this.targetOrbitalPosition.phi=s}const i=new D().setFromSpherical(this.orbitalPosition);i.add(this.originPosition),this.camera.position.copy(i);const n=this.currentMode==="mesh"&&this.focusPosition?this.focusPosition:this.originPosition;this.camera.lookAt(n)}setRestingPositions(e,t,i){this.restingPosX=e,this.restingPosY=t,this.restingZoom=i}getPanZoomPercentage(){const e=this.panModeOrigin.worldToLocal(this.camera.position.clone());return An(e.z,this.panBounds.zMin,this.panBounds.zMax,0,1,!0)}getAbsPanVelocity(e=!1){return e?this.absPanVelocity.lengthSq():this.absPanVelocity}getPanVelocity(e=!1){return e?this.panVelocity.lengthSq():this.panVelocity}}class oS{constructor(e,t){g(this,"app");g(this,"camera");g(this,"controls");g(this,"minZoom",0);g(this,"idealZoom",400);g(this,"maxZoom",9999);g(this,"raycaster",new ys);g(this,"mouse",new et);g(this,"maxRayLength",180);g(this,"lastUpdateTime",0);g(this,"cameraController",null);g(this,"originPosition",new D(0,0,0));g(this,"focalLength",18);g(this,"sensorHeight",36);g(this,"sensorSize",36);g(this,"minFocalLength",18);g(this,"maxFocalLength",35);g(this,"minSensorHeight",0);g(this,"maxSensorHeight",50);g(this,"orbit",{radiusX:5,radiusY:5,idleSpeedX:0,idleSpeedY:-.05,speedX:0,speedY:-.05,angleX:0,angleY:0,userInteracting:!1,easing:!1,prevAnglesX:[0],prevAnglesY:[0]});g(this,"userInteractionClockwise",!0);g(this,"prevTarget",new D);g(this,"prevDistance",0);g(this,"clock",new Kh);g(this,"onControlsStart",()=>{this.prevTarget.copy(this.controls.target),this.orbit.userInteracting=!0});g(this,"onControlsChange",()=>{const e=this.getZoomPercentage();window.dispatchEvent(new CustomEvent("cameraZoomChange",{detail:{zoomPercentage:e}}))});g(this,"getZoomPercentage",()=>(this.controls.getDistance()-this.minZoom)/(this.maxZoom-this.minZoom));g(this,"onControlsEnd",()=>{const{angleX:e,angleY:t}=this.getCameraOrbitAngles();this.orbit.angleX=e,this.orbit.angleY=t;const i=this.calculateAverageAngleDiff(this.orbit.prevAnglesX),n=this.calculateAverageAngleDiff(this.orbit.prevAnglesY);this.orbit.speedX=this.userInteractionClockwise?i*5:-i*5,this.orbit.speedY=this.userInteractionClockwise?n*5:-n*5,this.orbit.userInteracting=!1,this.orbit.easing=!0});g(this,"getCameraOrbitAngles",()=>{const e=this.camera.position,t=Math.atan2(e.y,Math.sqrt(e.x*e.x+e.z*e.z)),i=Math.PI/2-t,n=Math.atan2(e.x,e.z);return{angleX:i,angleY:n}});g(this,"updateCameraOrbit",()=>{const e=this.clock.getElapsedTime(),t=e-this.lastUpdateTime;this.lastUpdateTime=e;const{angleX:i,angleY:n}=this.getCameraOrbitAngles(),s=this.camera.position.distanceTo(this.controls.target);if(this.orbit.prevAnglesX.unshift(i),this.orbit.prevAnglesY.unshift(n),this.orbit.prevAnglesX.length>10&&(this.orbit.prevAnglesX.pop(),this.orbit.prevAnglesY.pop()),this.orbit.userInteracting){const a=Math.abs(i-this.orbit.prevAnglesX[0]),r=Math.abs(n-this.orbit.prevAnglesY[0]);this.orbit.speedX=this.clamp(a/t,0,.2),this.orbit.speedY=this.clamp(r/t,0,.2)}else{let{angleX:a,angleY:r,speedX:l,speedY:c}=this.orbit;const h=Math.PI*.05,d=Math.PI*.95;if(a<h?(a=h,l=-l):a>d&&(a=d,l=-l),this.orbit.easing){const _=this.orbit.idleSpeedX,y=this.orbit.idleSpeedY,v=1-Math.pow(.1,t);l+=(_-l)*v,c+=(y-c)*v,Math.abs(l-_)<1e-4&&Math.abs(c-y)<1e-4&&(this.orbit.easing=!1)}a+=l*t,r+=c*t;const f=Math.sin(r)*Math.sin(a)*s,p=Math.cos(a)*s,b=Math.cos(r)*Math.sin(a)*s;this.camera.position.set(f,p,b),this.camera.lookAt(0,0,0),this.orbit.angleX=a,this.orbit.angleY=r,this.orbit.speedX=l,this.orbit.speedY=c}});g(this,"calculateAverageAngleDiff",e=>{let t=0,i=0,n=0;for(let a=1;a<e.length;a++){let r=e[a]-e[a-1];r>Math.PI?r-=2*Math.PI:r<-Math.PI&&(r+=2*Math.PI),t+=r,i+=Math.abs(r),n++}const s=n>0?i/n:0;return this.userInteractionClockwise=t<0,s});g(this,"clamp",(e,t,i)=>Math.max(t,Math.min(i,e)));g(this,"animate",()=>{this.cameraController?this.cameraController.update():this.updateCameraOrbit()});g(this,"getIdealZoom",()=>this.idealZoom);this.app=e;const i=this.calculateFOV(this.focalLength,this.sensorHeight);this.camera=new on(i,t,.1,2e3),this.camera.position.set(0,0,230),this.setCameraNear(.1)}initControls(e){this.controls=new tm(this.camera,e.domElement),this.controls.minDistance=this.minZoom,this.controls.maxDistance=this.maxZoom,this.controls.target.set(0,0,0),this.controls.enableRotate=!0,this.controls.enablePan=!1,this.controls.enableZoom=!0,this.controls.update(),this.controls.addEventListener("start",this.onControlsStart),this.controls.addEventListener("change",this.onControlsChange),this.controls.addEventListener("end",this.onControlsEnd);const{angleX:t,angleY:i}=this.getCameraOrbitAngles();this.orbit.angleX=t,this.orbit.angleY=i}initCameraController(){this.cameraController=new rS({camera:this.camera,cameraClass:this,scene:this.app.scene,renderer:this.app.renderer,originPosition:new D(0,0,0),initialZoomDistance:this.idealZoom,minZoomDistance:this.minZoom,maxZoomDistance:this.maxZoom,debug:!1,restingPosY:Math.PI/2,restingZoom:90}),this.controls.enabled=!1}onWindowResize(e){this.camera.aspect=e,this.updateCameraFOV(!0)}updateMousePosition(e,t){this.mouse.x=e/window.innerWidth*2-1,this.mouse.y=-(t/window.innerHeight)*2+1}checkIntersections(e){if(this.app.actManager.getAct()!==2)return null;const t=this.camera.position.distanceTo(this.originPosition);if(t>this.maxRayLength)return null;const i=this.camera.position.clone().sub(this.originPosition).normalize();this.raycaster.set(this.originPosition,i);const n=this.raycaster.intersectObjects(e,!1);if(n.length>0){const s=n[0],a=s.object;if(a.geometry.boundingBox||a.geometry.computeBoundingBox(),!a.geometry.boundingBox)return console.warn("Unable to compute bounding box for object:",a),{intersection:s,centerOffset:.5,distance:t};const r=new D;a.geometry.boundingBox.getCenter(r),a.localToWorld(r);const l=s.point.clone().sub(r),c=new D;a.getWorldDirection(c),c.cross(new D(0,1,0)).normalize();const h=l.dot(c),d=a.geometry.boundingBox.max.x-a.geometry.boundingBox.min.x,f=h/(d*a.scale.x),p=Math.max(0,Math.min(1,f+.5));return{intersection:s,centerOffset:p,distance:t}}return null}setMaxRayLength(e){this.maxRayLength=e}setCameraNear(e){this.camera.near=e}calculateFOV(e){if(!this.camera)return 0;const t=this.camera.aspect,i=this.sensorSize;let n;return t>=1?n=i/t:n=i,2*Math.atan(n/(2*e))*(180/Math.PI)}updateCameraFOV(e=!1){const t=this.calculateFOV(this.focalLength);(Math.abs(t-this.camera.fov)>.05||e)&&(this.camera.fov=t,this.camera.updateProjectionMatrix())}setFocalLength(e){this.focalLength=e,this.updateCameraFOV()}setSensorHeight(e){this.sensorHeight=e,this.updateCameraFOV()}getFocalLength(){return this.focalLength}getSensorHeight(){return this.sensorHeight}animateZoom(e,t){return new Promise(i=>{const n=this.controls.getDistance(),s=performance.now(),a=()=>{const r=performance.now()-s,l=Math.min(r/t,1),c=kt.easeInOutCubic(l),h=n+(e-n)*c;if(this.controls.minDistance=h,this.controls.maxDistance=h,this.controls.update(),l<1)requestAnimationFrame(a);else{if(this.cameraController){const d=this.cameraController.getEasingFactor();this.cameraController.setEasingFactor(1),this.cameraController.setZoom(this.controls.minDistance),setTimeout(()=>{this.cameraController.setEasingFactor(d)},10)}this.controls.minDistance=this.minZoom,this.controls.maxDistance=this.maxZoom,i()}};requestAnimationFrame(a)})}setOnBoardingControls(){this.minZoom=0,this.idealZoom=105,this.maxZoom=9999,this.orbit.idleSpeedX=0,this.orbit.idleSpeedY=-.05,this.cameraController?(this.cameraController.setZoomLimits(105,450),this.cameraController.setRestingZoom(this.idealZoom)):this.controls.enabled=!1}setAct2Controls(){this.minZoom=0,this.idealZoom=105,this.maxZoom=9999,this.orbit.idleSpeedX=0,this.orbit.idleSpeedY=-.05,this.cameraController?(this.cameraController.setZoomLimits(105,400),this.cameraController.setRestingZoom(this.idealZoom)):this.controls.enabled=!1}setAct3Controls(e){this.minZoom=1.5,this.idealZoom=100,this.maxZoom=9999,this.orbit.idleSpeedX=0,this.orbit.idleSpeedY=-.05,this.controls.enabled=!1,this.cameraController?(this.cameraController.setZoomLimits(5,200),this.cameraController.setCollisionMesh(e)):this.initCameraController(e)}resetMotion(){const{angleX:e,angleY:t}=this.getCameraOrbitAngles();this.orbit.angleX=e,this.orbit.angleY=t,this.orbit.speedX=this.orbit.idleSpeedX,this.orbit.speedY=this.orbit.idleSpeedY,this.orbit.prevAnglesX=[e],this.orbit.prevAnglesY=[t],this.lastUpdateTime=this.clock.getElapsedTime(),this.orbit.easing=!1,this.orbit.userInteracting=!1}resetMotionWithVelocity(e,t){const{angleX:i,angleY:n}=this.getCameraOrbitAngles();this.orbit.angleX=i,this.orbit.angleY=n;const s=this.camera.position.length(),a=e.divideScalar(s);this.orbit.speedX=-a.y,this.orbit.speedY=a.x,this.orbit.idleSpeedX=t.x,this.orbit.idleSpeedY=t.y,this.orbit.prevAnglesX=[i],this.orbit.prevAnglesY=[n],this.lastUpdateTime=this.clock.getElapsedTime(),this.orbit.easing=!0,this.orbit.userInteracting=!1}calculateZoomBlendFactor(e,t){const i=t-e,n=(this.getZoom()-e)/i;return Et.clamp(n,0,1)}calculateBlendedFOV(e){const t=Et.lerp(this.minFocalLength,this.maxFocalLength,e);this.focalLength=t,this.sensorHeight=this.sensorHeight,this.updateCameraFOV()}getMinZoom(){return this.controls.minDistance}getMaxZoom(){return this.controls.maxDistance}setZoom(e){const t=new D;this.camera.getWorldDirection(t);const i=this.controls.target.clone().add(t.multiplyScalar(e));this.camera.position.copy(i),this.controls.update()}getZoom(){return this.camera.position.distanceTo(this.controls.target)}jumpToPosition(e,t){this.cameraController?this.cameraController.jumpToPosition(e,t):(t=new D(0,0,0),this.camera.position.copy(e),this.camera.lookAt(t),this.controls.target.copy(t),this.controls.update());const{angleX:i,angleY:n}=this.getCameraOrbitAngles();this.orbit.angleX=i,this.orbit.angleY=n,this.orbit.speedX=0,this.orbit.speedY=0}}class lS{constructor(e,t,i,n=25,s={}){g(this,"audioManager");g(this,"audioTrackName");g(this,"duration",0);g(this,"startTime",0);g(this,"isPlaying",!1);g(this,"isPaused",!1);g(this,"pausedAt",0);g(this,"animationFrameId",null);g(this,"progressCallback",null);g(this,"subtitles",[]);g(this,"subtitleElementId",null);g(this,"currentSubtitleText","");g(this,"fps");g(this,"callbacks");g(this,"timeTriggers",[]);g(this,"playbackMonitoringTimeout",null);g(this,"lastPlaybackTime",0);g(this,"playbackMonitoringAttempts",0);g(this,"maxMonitoringAttempts",3);g(this,"isDragging",!1);g(this,"wasPlayingBeforeDrag",!1);g(this,"barClientX",0);g(this,"clearSubtitles",()=>{const e=this.subtitleElementId?document.getElementById(this.subtitleElementId):null;e&&(e.classList.add("empty"),this.currentSubtitleText="",e.innerText="")});g(this,"handleProgressBarMouseDown",e=>{var t,i;this.barClientX=e.clientX,this.isDragging=!0,this.wasPlayingBeforeDrag=this.getIsPlaying(),document.body.classList.add("isDragging"),(i=(t=this.callbacks).onDragStart)==null||i.call(t)});g(this,"handleProgressBarMouseUp",e=>{var t,i;this.isDragging&&this.wasPlayingBeforeDrag&&!this.getIsPlaying()&&this.startPlayback(),setTimeout(()=>{this.isDragging=!1},5),document.body.classList.remove("isDragging"),(i=(t=this.callbacks).onDragEnd)==null||i.call(t)});g(this,"handleProgressBarClick",e=>{const t=Math.abs(e.clientX-this.barClientX);if(this.isDragging&&t>3)return;const i=e.currentTarget,n=i.getBoundingClientRect(),a=(e.clientX-n.left)/n.width;this.setCurrentTime(this.duration*a),setTimeout(()=>{i.blur()},50)});g(this,"handleProgressBarMouseMove",e=>{if(!this.isDragging)return;const t=document.getElementById("act-three__ui-progress-bar");if(!t)return;const i=t.getBoundingClientRect(),s=(e.clientX-i.left)/i.width;this.setCurrentTime(this.duration*s),this.wasPlayingBeforeDrag&&!this.getIsPlaying()&&this.startPlayback()});g(this,"handleProgressBarTouchStart",e=>{var t,i;(i=(t=this.callbacks).onDragStart)==null||i.call(t)});g(this,"handleProgressBarTouch",e=>{const i=e.currentTarget.getBoundingClientRect(),a=((e.touches[0]||e.changedTouches[0]).clientX-i.left)/i.width;this.setCurrentTime(this.duration*a)});g(this,"handleProgressBarTouchEnd",e=>{var t,i;(i=(t=this.callbacks).onDragEnd)==null||i.call(t)});this.audioManager=e,this.audioTrackName=t,this.subtitleElementId=i||null,this.fps=n,this.callbacks=s,this.setupProgressBarInteraction()}async initialise(){var t,i;this.duration=await this.audioManager.getTrackDuration(this.audioTrackName);const e=document.getElementById("act-three__ui-time-total");e&&(e.textContent=wo(this.duration)),(i=(t=this.callbacks).onInitialised)==null||i.call(t)}async loadSubtitles(e){try{this.subtitles=await jl.fetchAndParseSRT(e,this.fps)}catch(t){console.error("Failed to load subtitles:",t)}}async startPlayback(e){var t,i;if(!this.isPlaying){if(await this.ensureAudioContextResumed(),!this.audioManager.isTrackAvailable(this.audioTrackName)&&this.callbacks.onTrackNotFound){this.callbacks.onTrackNotFound(this.audioTrackName,"play");return}this.isPlaying=!0,this.isPaused=!1,this.progressCallback=e||this.callbacks.onProgress,this.startTime=this.audioManager.getCurrentTime()-this.pausedAt,this.audioManager.playTrack(this.audioTrackName,{startTime:this.pausedAt}),this.resetTimeTriggers(),this.startPlaybackMonitoring(),this.updateProgress(),(i=(t=this.callbacks).onPlay)==null||i.call(t)}}startPlaybackMonitoring(){this.clearPlaybackMonitoring(),this.lastPlaybackTime=this.getCurrentTime(),this.playbackMonitoringAttempts=0,this.monitorPlayback()}async attemptToResumePlayback(){try{const e=this.audioManager.getAudioContext();if(e.state==="suspended"&&await e.resume(),/iPad|iPhone|iPod/.test(navigator.userAgent)){const t=e.createBuffer(1,1,22050),i=e.createBufferSource();i.buffer=t,i.connect(e.destination),i.start(0)}return this.stopPlayback(),await new Promise(t=>setTimeout(t,300)),this.startTime=this.audioManager.getCurrentTime()-this.pausedAt,this.isPlaying=!0,this.isPaused=!1,this.audioManager.playTrack(this.audioTrackName,{startTime:this.pausedAt}),setTimeout(()=>this.startPlaybackMonitoring(),500),!0}catch(e){return console.error("Failed to resume playback:",e),!1}}monitorPlayback(){this.playbackMonitoringTimeout=window.setTimeout(async()=>{if(!this.isPlaying){this.clearPlaybackMonitoring();return}const e=this.getCurrentTime();if(Math.abs(e-this.lastPlaybackTime)>.1)this.playbackMonitoringAttempts=0;else if(this.playbackMonitoringAttempts++,this.playbackMonitoringAttempts>=this.maxMonitoringAttempts){this.callbacks.onTrackNotFound&&this.callbacks.onTrackNotFound(this.audioTrackName,"stall"),this.clearPlaybackMonitoring();return}this.lastPlaybackTime=e,this.monitorPlayback()},300)}async ensureAudioContextResumed(){const e=this.audioManager.getAudioContext();if(e.state==="suspended")try{return await e.resume(),!0}catch(t){return console.warn("Failed to resume AudioContext:",t),!1}return!0}clearPlaybackMonitoring(){this.playbackMonitoringTimeout!==null&&(clearTimeout(this.playbackMonitoringTimeout),this.playbackMonitoringTimeout=null)}isTrackAvailable(){return this.audioManager.isTrackAvailable(this.audioTrackName)}setAudioTrack(e){if(this.audioTrackName=e,this.isPlaying){const t=this.getCurrentTime();this.stopPlayback(),this.audioTrackName=e,this.startPlayback(),this.setCurrentTime(t)}else this.isPaused?this.audioTrackName=e:this.audioTrackName=e}pausePlayback(){var e,t;this.isPlaying&&(this.isPlaying=!1,this.isPaused=!0,this.clearPlaybackMonitoring(),this.pausedAt=this.audioManager.getCurrentTime()-this.startTime,this.audioManager.pauseTrack(this.audioTrackName),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),(t=(e=this.callbacks).onPause)==null||t.call(e))}stopPlayback(){var e,t;(this.isPlaying||this.isPaused)&&(this.clearPlaybackMonitoring(),this.isPlaying=!1,this.isPaused=!1,this.pausedAt=0,this.audioManager.stopTrack(this.audioTrackName),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),(t=(e=this.callbacks).onStop)==null||t.call(e))}async togglePlayback(){return this.isPlaying?this.pausePlayback():this.startPlayback(),await bi(1),this.isPlaying}updateProgress(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null);const e=()=>{var a,r;const t=this.audioManager.getCurrentTime()-this.startTime,i=t/this.duration*100,n=Math.floor(t*this.fps),s=Math.floor(this.duration*this.fps);this.progressCallback&&this.progressCallback({currentTime:t,totalTime:this.duration,progress:i,currentFrame:n,totalFrames:s}),this.checkTimeTriggers(t),this.updateSubtitles(t),this.updateProgressBar(t),this.updateTimeDisplay(t),this.updateRemainingTimeDisplay(this.duration-t),this.isPlaying&&(t<this.duration?this.animationFrameId=requestAnimationFrame(e):(this.stopPlayback(),(r=(a=this.callbacks).onComplete)==null||r.call(a)))};this.animationFrameId=requestAnimationFrame(e)}updateSubtitles(e){const t=this.subtitleElementId?document.getElementById(this.subtitleElementId):null;if(t){const i=Math.floor(e*this.fps),n=this.subtitles.find(s=>i>=s.start&&i<s.end);n&&n.text!==this.currentSubtitleText?(t.classList.remove("empty"),this.currentSubtitleText=n.text,t.innerHTML=n.text):!n&&this.currentSubtitleText!==""&&this.clearSubtitles()}}setCurrentTime(e){e<0&&(e=0),e>this.getDuration()&&(e=this.getDuration()),this.audioManager.setTrackTime(this.audioTrackName,e),this.pausedAt=e,this.startTime=this.audioManager.getCurrentTime()-e,this.updateTimeDisplay(e),this.updateProgress()}updateProgressBar(e){const t=document.getElementById("act-three__ui-progress");if(document.getElementById("act-three__ui-progress-bar"),t){const i=e/this.duration*100;t.style.width=`${i}%`}}setupProgressBarInteraction(){const e=document.getElementById("act-three__ui-progress-bar");if(e){const t=i=>{switch(i.code){case"ArrowLeft":this.setCurrentTime(this.getCurrentTime()-ff);break;case"ArrowRight":this.setCurrentTime(this.getCurrentTime()+ff);break}};e.addEventListener("focusin",()=>{window.addEventListener("keyup",t)}),e.addEventListener("focusout",()=>{window.removeEventListener("keyup",t)}),e.addEventListener("pointerup",this.handleProgressBarClick),e.addEventListener("touchstart",this.handleProgressBarTouchStart),e.addEventListener("touchmove",this.handleProgressBarTouch),window.addEventListener("mousemove",this.handleProgressBarMouseMove),e.addEventListener("mousedown",this.handleProgressBarMouseDown),window.addEventListener("mouseup",this.handleProgressBarMouseUp),e.addEventListener("touchend",this.handleProgressBarTouchEnd)}}getProgressBarDragging(){return this.isDragging}getCurrentTime(){return this.isPlaying?this.audioManager.getCurrentTime()-this.startTime:this.isPaused?this.pausedAt:0}cleanup(){this.stopPlayback(),this.clearPlaybackMonitoring(),this.clearSubtitles(),this.clearTimeTriggers(),this.progressCallback=null,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.removeProgressBarInteraction()}getIsPlaying(){return this.isPlaying}addTimeTrigger(e,t,i){const n=this.timeTriggers.length;return this.timeTriggers.push({time:e,callback:t,triggered:!1,range:i}),n}removeTimeTrigger(e){e>=0&&e<this.timeTriggers.length&&this.timeTriggers.splice(e,1)}clearTimeTriggers(){this.timeTriggers=[]}resetTimeTriggers(){this.timeTriggers.forEach(e=>{e.triggered=!1})}getDuration(){return this.duration}checkTimeTriggers(e,t){this.timeTriggers.forEach(i=>{if(!i.triggered&&e>=i.time){if(i.range!==void 0&&!(e<=i.time+i.range))return;i.callback(),i.triggered=!0}})}removeProgressBarInteraction(){const e=document.getElementById("act-three__ui-progress-bar");e&&(e.removeEventListener("pointerup",this.handleProgressBarClick),e.removeEventListener("mousedown",this.handleProgressBarMouseDown),window.removeEventListener("mousemove",this.handleProgressBarMouseMove),window.removeEventListener("mouseup",this.handleProgressBarMouseUp),e.removeEventListener("touchstart",this.handleProgressBarTouchStart),e.removeEventListener("touchmove",this.handleProgressBarTouch),e.removeEventListener("touchend",this.handleProgressBarTouchEnd))}updateTimeDisplay(e){const t=document.getElementById("act-three__ui-time-current");t&&(t.textContent=wo(e));const i=document.getElementById("act-three__ui-time");i&&i.setAttribute("aria-label",`${$l(e)} of ${$l(this.getDuration())}`)}updateRemainingTimeDisplay(e){e<0&&(e=0);const t=document.getElementById("act-three__ui-time-remaining");t&&(t.textContent=`-${wo(e)}`)}}class cS{constructor(e,t){g(this,"camera");g(this,"controls");g(this,"keyframes");g(this,"positionCurve");g(this,"lookAtCurve");g(this,"isAnimating",!1);g(this,"onAnimationComplete",()=>{});g(this,"totalDuration",0);g(this,"finalVelocity",new D);g(this,"targetOrbitSpeed",new et(0,0));g(this,"onUpdateCallback",null);g(this,"userRotationX",0);g(this,"userRotationY",0);g(this,"maxRotation",15*Math.PI/180);g(this,"isDragging",!1);g(this,"lastMouseX",0);g(this,"lastMouseY",0);g(this,"animationFrameId",null);g(this,"resolveAnimation",null);g(this,"lastReachedKeyframeIndex",-1);this.camera=e,this.controls=t,this.keyframes=[],this.positionCurve=new po([]),this.lookAtCurve=new po([])}setOnUpdateCallback(e){this.onUpdateCallback=e}setupUserInteraction(){document.addEventListener("mousedown",this.handleMouseDown.bind(this)),document.addEventListener("mousemove",this.handleMouseMove.bind(this)),document.addEventListener("mouseup",this.handleMouseUp.bind(this)),document.addEventListener("touchstart",this.handleTouchStart.bind(this)),document.addEventListener("touchmove",this.handleTouchMove.bind(this)),document.addEventListener("touchend",this.handleTouchEnd.bind(this))}setOnCameraUpdate(e){this.onCameraUpdate=e}handleMouseDown(e){this.isDragging=!0,this.lastMouseX=e.clientX,this.lastMouseY=e.clientY}handleMouseMove(e){if(!this.isAnimating||!this.isDragging)return;const t=e.clientX-this.lastMouseX,i=e.clientY-this.lastMouseY;this.updateUserRotation(t,i),this.lastMouseX=e.clientX,this.lastMouseY=e.clientY}handleMouseUp(){this.isDragging=!1}handleTouchStart(e){e.touches.length===1&&(this.isDragging=!0,this.lastMouseX=e.touches[0].clientX,this.lastMouseY=e.touches[0].clientY)}handleTouchMove(e){if(!this.isAnimating||!this.isDragging||e.touches.length!==1)return;const t=e.touches[0],i=t.clientX-this.lastMouseX,n=t.clientY-this.lastMouseY;this.updateUserRotation(i,n),this.lastMouseX=t.clientX,this.lastMouseY=t.clientY}handleTouchEnd(){this.isDragging=!1}updateUserRotation(e,t){this.userRotationY+=e*.002,this.userRotationX-=t*.002,this.userRotationX=Math.max(-this.maxRotation,Math.min(this.maxRotation,this.userRotationX)),this.userRotationY=Math.max(-this.maxRotation,Math.min(this.maxRotation,this.userRotationY))}setKeyframes(e,t){this.keyframes=e,this.createCurves(t),this.calculateTotalDuration()}createCurves(e=0){const t=this.keyframes.map(n=>n.position),i=this.keyframes.map(n=>n.lookAt);this.positionCurve=new po(t,!1,"catmullrom",e),this.lookAtCurve=new po(i,!1,"catmullrom",e)}calculateTotalDuration(){this.totalDuration=this.keyframes.reduce((e,t)=>e+(t.duration||0),0)}async animatePath(e={}){const{totalDuration:t=this.totalDuration,easing:i=kt.easeInOutCubic,targetOrbitSpeed:n=new et(0,-.05)}=e;this.targetOrbitSpeed.copy(n),this.setIsAnimating(!0);const s=performance.now();return this.lastReachedKeyframeIndex=-1,new Promise(a=>{this.resolveAnimation=a;const r=()=>{const h=(performance.now()-s)/t;if(h>=1){this.updateCameraPosition(1),this.setIsAnimating(!1),this.onAnimationComplete&&this.onAnimationComplete(),this.resolveAnimation=null,this.animationFrameId=null,a();return}const d=i(h);this.updateCameraPosition(d),this.checkKeyframeCallbacks(h),this.animationFrameId=requestAnimationFrame(r)};this.animationFrameId=requestAnimationFrame(r)})}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.resolveAnimation&&(this.resolveAnimation(),this.resolveAnimation=null),this.setIsAnimating(!1),this.lastReachedKeyframeIndex=-1,this.finalVelocity.set(0,0,0)}checkKeyframeCallbacks(e){let t=0;for(let i=0;i<this.keyframes.length;i++){const n=this.keyframes[i];t+=n.duration||0;const s=t/this.totalDuration;e>=s&&i>this.lastReachedKeyframeIndex&&(n.callback&&n.callback(),this.lastReachedKeyframeIndex=i)}}getFinalCameraState(){const e=this.positionCurve.getPoint(1),t=this.lookAtCurve.getPoint(1),i=t.clone().sub(e).normalize(),n=new Ft().makeRotationFromEuler(new vn(this.userRotationX,this.userRotationY,0,"XYZ")),s=i.applyMatrix4(n),a=e.clone().add(s.multiplyScalar(e.distanceTo(t)));return{position:e,lookAt:a}}updateCameraPosition(e){const t=this.positionCurve.getPoint(e),i=this.lookAtCurve.getPoint(e),n=i.clone().sub(t).normalize(),s=new Ft().makeRotationFromEuler(new vn(this.userRotationX,this.userRotationY,0,"XYZ")),a=n.applyMatrix4(s),r=t.clone().add(a.multiplyScalar(t.distanceTo(i)));this.camera.position.copy(t),this.camera.lookAt(r);const l=t.distanceTo(r),c=this.positionCurve.getTangent(e);this.finalVelocity.copy(c).multiplyScalar(this.targetOrbitSpeed.length()*100),this.controls.target.copy(r),this.onUpdateCallback&&this.onUpdateCallback({position:t.clone(),lookAt:r.clone(),distance:l,progress:e})}resetUserRotation(){this.userRotationX=0,this.userRotationY=0}setIsAnimating(e){this.isAnimating=e,this.isAnimating?document.body.classList.add("is-animating"):document.body.classList.remove("is-animating")}isCurrentlyAnimating(){return this.isAnimating}setOnAnimationComplete(e){this.onAnimationComplete=e}getFinalVelocity(){return this.finalVelocity.clone()}getTargetOrbitSpeed(){return this.targetOrbitSpeed.clone()}getKeyframes(){return this.keyframes}dispose(){this.stop(),document.removeEventListener("mousedown",this.handleMouseDown),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("touchstart",this.handleTouchStart),document.removeEventListener("touchmove",this.handleTouchMove),document.removeEventListener("touchend",this.handleTouchEnd)}}class hS{constructor(e){g(this,"elementId");g(this,"height");g(this,"colour");g(this,"backgroundColor");g(this,"animationDuration");g(this,"contextLabelId");g(this,"autoUpdateContextLabel");g(this,"currentProgress",0);g(this,"targetProgress",0);g(this,"animationStartTime",null);g(this,"animationStartProgress",0);g(this,"totalBytes",0);g(this,"currentLabel","");g(this,"animationFrameId",null);g(this,"contextLabelElement",null);g(this,"setupContextLabel",()=>{this.contextLabelId&&(this.contextLabelElement=document.getElementById(this.contextLabelId),this.contextLabelElement||console.warn(`Context label element #${this.contextLabelId} not found`))});g(this,"initialiseLoader",()=>{const e=document.getElementById(this.elementId);if(!e)return;const t=document.createElement("div");t.className="bar-loader";const i=document.createElement("div");i.className="bar-loader-container";const n=document.createElement("div");n.className="bar-loader-container-background";const s=document.createElement("div");if(s.className="bar-loader-progress",this.currentLabel&&!this.contextLabelId){t.classList.add("with-label");const a=document.createElement("div");a.className="bar-loader-label",a.textContent=this.currentLabel,i.appendChild(a)}n.appendChild(s),i.appendChild(n),t.appendChild(i),e.appendChild(t)});g(this,"updateProgress",e=>{this.targetProgress=Math.min(Math.max(e,0),100),this.animationFrameId===null&&(this.animationStartTime=performance.now(),this.animationStartProgress=this.currentProgress,this.animate())});g(this,"updateFromLoadGroupProgress",e=>{if(this.updateProgress(e.percentage),e.totalBytes&&e.totalBytes>0&&(this.totalBytes=e.totalBytes),e.currentItem){const t=`Loading ${e.currentItem}...`;this.contextLabelId?this.autoUpdateContextLabel&&this.updateLabel(t):this.updateLabel(t)}});g(this,"animate",()=>{if(!this.animationStartTime)return;const t=performance.now()-this.animationStartTime,i=Math.min(t/this.animationDuration,1),n=kt.easeInOutCubic(i);this.currentProgress=this.animationStartProgress+(this.targetProgress-this.animationStartProgress)*n,this.updateLoaderDisplay(),i<1?this.animationFrameId=requestAnimationFrame(this.animate):(this.animationFrameId=null,this.animationStartTime=null)});g(this,"updateLoaderDisplay",()=>{const e=document.getElementById(this.elementId);if(!e)return;const t=e.querySelector(".bar-loader-progress");t instanceof HTMLElement&&(t.style.width=`${this.currentProgress}%`)});g(this,"updateLabel",e=>{var t,i;if(this.currentLabel=e,this.contextLabelId)this.contextLabelElement&&(this.contextLabelElement.textContent=e);else{const n=document.getElementById(this.elementId);if(!n)return;let s=n.querySelector(".bar-loader-label");!s&&e&&(s=document.createElement("div"),s.className="bar-loader-label",(t=n.querySelector(".bar-loader-container"))==null||t.appendChild(s),(i=n.querySelector(".bar-loader"))==null||i.classList.add("with-label")),s instanceof HTMLElement&&(s.textContent=e)}});g(this,"getCurrentProgress",()=>this.currentProgress);g(this,"getLabel",()=>this.currentLabel);g(this,"complete",()=>{this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null,this.animationStartTime=null),this.currentProgress=100,this.targetProgress=100,this.updateLoaderDisplay()});g(this,"cleanup",()=>{this.animationFrameId!==null&&cancelAnimationFrame(this.animationFrameId);const e=document.getElementById(this.elementId);e&&(e.innerHTML="")});this.elementId=e.elementId,this.height=e.height||4,this.colour=e.colour||"#ffffff",this.backgroundColor=e.backgroundColor||"rgba(255, 255, 255, 0.3)",this.animationDuration=e.animationDuration||300,this.contextLabelId=e.contextLabelId,this.autoUpdateContextLabel=e.autoUpdateContextLabel??!0,e.label&&(this.currentLabel=e.label),this.initialiseLoader(),this.setupContextLabel()}}class uS{constructor(e,t,i){g(this,"app");g(this,"camera");g(this,"menu");g(this,"uiManager");g(this,"enabled",!0);g(this,"onboardingSequenceActive",!1);g(this,"onboardingStage",null);g(this,"onboardingZoomMax",null);g(this,"onboardingRotationPhiStart",null);g(this,"onboardingRotationThetaStart",null);g(this,"triggeredEvents",[]);g(this,"onboardingListeners",[]);g(this,"triggers",[]);g(this,"ranges",[]);g(this,"updateInterval",16);g(this,"idleTimeout",5e3);g(this,"updateTimer",null);g(this,"idleTimer",null);g(this,"lastInteractionTime",0);g(this,"userStartedOnboarding",!1);g(this,"rotationScreenReaderZoomInstruction","Onboarding instructions, Moving the camera. 1. Scroll, pinch or use shift + up/down arrow keys to zoom. Current progress: ");g(this,"rotationScreenReaderRotationInstruction","Onboarding instructions, Moving the camera. 2. Click and drag or left/right arrow keys to move. Current progress: ");this.app=e,this.camera=t,this.menu=i,this.uiManager=this.app.uiManager,this.setupSequence()}setupSequence(){const e=document.getElementById("act-two__ui-bottom-zone");e&&e.style.transition,this.triggers=[{phase:"zoom",event:"announce25",percentage:.38,onTrigger:()=>{this.uiManager.makeScreenReaderAnnouncement("25%")}},{phase:"zoom",event:"halfZoom",percentage:.3,onTrigger:()=>{this.app.menu.setAllBrightness(0),this.app.menu.showAllWithOpacity(3e3,new D(0,-10,0)),setTimeout(()=>{this.app.menu.setAllBrightness(0)},100),this.app.audioManager.addLowPassFilter("objectDrone",0),this.app.audioManager.playTrack("objectDrone",{loop:!0})}},{phase:"zoom",event:"announce50",percentage:.55,onTrigger:()=>{this.uiManager.makeScreenReaderAnnouncement("50%")}},{phase:"zoom",event:"announce75",percentage:.76,onTrigger:()=>{this.uiManager.makeScreenReaderAnnouncement("75%")}},{phase:"zoom",event:"endZoom",percentage:.95,onTrigger:async()=>{this.uiManager.playUISound("release01"),this.app.audioManager.stopTrack("objectDrone"),this.app.audioManager.playTrack("secondObjectDrone",{loop:!0}),this.app.audioManager.setTrackVolume("secondObjectDrone",3),this.app.audioManager.addLowPassFilter("secondObjectDrone",0),this.app.audioManager.setPitch("secondObjectDrone",1),this.app.audioManager.setLowPassFrequency("secondObjectDrone",0),this.uiManager.updateOnboardingBarProgress(100),this.uiManager.completeOnboardingLoader(0),await bi(750),this.uiManager.updateOnboardingBarProgress(0),this.uiManager.stopOnboardingAnimation(),this.uiManager.initOnboardingLoaders(4),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(1,Li("/images/Onboard-DeathMask-S.svg")),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(2,Li("/images/Onboard-Letter-S.svg")),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(3,Li("/images/Onboard-Rifle-S.svg")),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(4,Li("/images/Onboard-Boot-S.svg"));const t=this.app.preferenceManager.getPreference("is-mobile");this.uiManager.makeScreenReaderAnnouncement("100%, Armour revealed. start next step: rotation");const i=document.getElementById("act-two__ui-bottom-zone");i&&i.setAttribute("aria-label",this.rotationScreenReaderRotationInstruction+"0%"),this.uiManager.updateOnboardingPane(t?"2. Touch and drag to move":"2. Click and drag to move",t?T_:S_),await bi(500),this.uiManager.playOnboardingAnimation(),this.transitionToRotatePhase()}},{phase:"rotate",event:"releaseMask",percentage:.2,onTrigger:()=>{this.uiManager.completeOnboardingLoader(1),this.uiManager.playUISound("release02"),this.app.audioManager.setLowPassFrequency("secondObjectDrone",0),this.app.audioManager.setPitch("secondObjectDrone",1.25)}},{phase:"rotate",event:"releaseLetter",percentage:.4,onTrigger:()=>{this.uiManager.completeOnboardingLoader(2),this.uiManager.playUISound("release03"),this.app.audioManager.setLowPassFrequency("secondObjectDrone",0),this.app.audioManager.setPitch("secondObjectDrone",1.5)}},{phase:"rotate",event:"releaseRifle",percentage:.6194,onTrigger:()=>{this.uiManager.completeOnboardingLoader(3),this.uiManager.playUISound("release04"),this.app.audioManager.setLowPassFrequency("secondObjectDrone",0),this.app.audioManager.setPitch("secondObjectDrone",1.75)}},{phase:"rotate",event:"releaseBoot",percentage:.7902,onTrigger:async()=>{this.uiManager.completeOnboardingLoader(4),this.uiManager.updateOnboardingBarProgress(100),this.uiManager.playUISound("release05"),this.app.audioManager.stopTrack("secondObjectDrone"),this.app.audioManager.setLowPassFrequency("secondObjectDrone",0),this.uiManager.hideOnboardingProgress(),this.uiManager.updateOnboardingPane(`All done!<br/><br/>You can now move to a Ned Kelly object and explore its story.<br/><br/><br/><button
              id="finish-onboarding"
              class="ui-button ui-sound-trigger ui-sound__click"
              aria-label="Finish onboarding"
              tabindex="0"
            >
              start
            </button>`,null),document.getElementById("act-two__ui-bottom-zone-upper").removeAttribute("aria-hidden");const i=document.getElementById("act-two__ui-bottom-zone");i&&i.setAttribute("aria-label","Onboarding complete"),$t("finish-onboarding",()=>{this.finishSequence(),this.uiManager.makeScreenReaderAnnouncement("Onboarding finished")});const n=document.getElementById("act-two__ui-bottom-zone");n&&n.classList.add("complete")}}],this.ranges=[{phase:"zoom",id:"mask-progress",start:.17,end:.95,updateFunction:t=>{this.uiManager.updateOnboardingBarProgress(t*100);const i=xn(t,.17,.95,0,500),n=document.getElementById("act-two__ui-bottom-zone");n&&n.setAttribute("aria-label",this.rotationScreenReaderZoomInstruction+`${(t*100).toFixed(0)}%`),this.app.audioManager.setLowPassFrequency("objectDrone",i),this.menu.setMenuItemBrightness("armour",tu(t*1.25,0,1))}},{phase:"rotate",id:"rotate-whole-progress",start:0,end:.79,updateFunction:t=>{var n;if((n=this.triggers.find(s=>s.event==="releaseBoot"))!=null&&n.triggered)return;this.uiManager.updateOnboardingBarProgress(t*100);const i=document.getElementById("act-two__ui-bottom-zone");i&&i.setAttribute("aria-label",this.rotationScreenReaderRotationInstruction+`${(t*100).toFixed(0)}%`)}},{phase:"rotate",id:"mask-progress",start:.0428,end:.2,updateFunction:t=>{var n;if((n=this.triggers.find(s=>s.event==="releaseMask"))!=null&&n.triggered)return;const i=xn(t,0,1,0,500);this.app.audioManager.setLowPassFrequency("secondObjectDrone",i),this.uiManager.makeScreenReaderAnnouncement("25% Death Mask revealed"),this.menu.setMenuItemBrightness("mask",t)}},{phase:"rotate",id:"letter-progress",start:.2571,end:.4,updateFunction:t=>{var n;if((n=this.triggers.find(s=>s.event==="releaseLetter"))!=null&&n.triggered)return;const i=xn(t,0,1,0,500);this.app.audioManager.setLowPassFrequency("secondObjectDrone",i),this.uiManager.makeScreenReaderAnnouncement("50% Jerilderie letter revealed"),this.menu.setMenuItemBrightness("letter",t)}},{phase:"rotate",id:"rifle-progress",start:.4222,end:.6194,updateFunction:t=>{var n;if((n=this.triggers.find(s=>s.event==="releaseRifle"))!=null&&n.triggered)return;const i=xn(t,0,1,0,500);this.app.audioManager.setLowPassFrequency("secondObjectDrone",i),this.uiManager.makeScreenReaderAnnouncement("75% Rifle revealed"),this.menu.setMenuItemBrightness("rifle",t)}},{phase:"rotate",id:"boot-progress",start:.6651,end:.7902,updateFunction:t=>{var n;if((n=this.triggers.find(s=>s.event==="releaseBoot"))!=null&&n.triggered)return;const i=xn(t,0,1,0,500);this.app.audioManager.setLowPassFrequency("secondObjectDrone",i),this.uiManager.makeScreenReaderAnnouncement("100% Boot revealed, onboarding success message displayed"),this.menu.setMenuItemBrightness("boot",t)}}]}beginSequence(){this.onboardingSequenceActive=!0,this.onboardingStage="zoom",this.camera.cameraController.setZoomStates(!0),this.app.environmentManager.setSplatForTransparency(),this.setupListeners(),this.lastInteractionTime=performance.now();const e=document.getElementById("act-two__ui-menu-highlight");e&&e.setAttribute("aria-hidden","true")}setupListeners(){this.clearListeners();const e=()=>{this.onboardingSequenceActive&&(this.lastInteractionTime=performance.now(),this.startUpdates())};this.onboardingListeners.push(e),window.addEventListener("userInteracting",e)}startUpdates(){this.updateTimer||(this.updateTimer=window.setInterval(()=>{this.updateProgress()},this.updateInterval)),this.resetIdleTimer()}resetIdleTimer(){this.idleTimer&&clearTimeout(this.idleTimer),this.idleTimer=window.setTimeout(()=>{this.stopUpdates()},this.idleTimeout)}stopUpdates(){this.updateTimer&&(clearInterval(this.updateTimer),this.updateTimer=null),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}clearListeners(){this.onboardingListeners.forEach(e=>{window.removeEventListener("userInteracting",e)}),this.onboardingListeners=[]}handlePhaseProgress(e,t){this.ranges.filter(i=>i.phase===e).forEach(i=>{if(t>=i.start&&t<=i.end){if(!this.enabled)return;const n=(t-i.start)/(i.end-i.start);i.updateFunction(n)}}),this.triggers.filter(i=>i.phase===e&&!i.triggered).forEach(i=>{if(t>=i.percentage){if(!this.enabled)return;i.triggered=!0,i.onTrigger(),this.triggeredEvents.push(i.event)}})}updateProgress(){if(this.onboardingStage)switch(this.onboardingStage){case"zoom":{this.onboardingZoomMax||(this.onboardingZoomMax=this.camera.cameraController.getMaxZoom()),this.onboardingRotationPhiStart||(this.onboardingRotationPhiStart=this.camera.cameraController.getOrbitalAngles().phi);const e=xn(this.camera.cameraController.getZoom(),this.camera.cameraController.getMinZoom(),this.onboardingZoomMax,0,1,!0,kt.linear);this.handlePhaseProgress("zoom",1-e);const t=xn(e,1,.1,0,1,!0,kt.easeInOutCubic),i=Et.lerp(this.onboardingRotationPhiStart,1.575,t);this.camera.cameraController.setRotation(null,i);const n=this.camera.cameraController.getZoom();n<390&&n+20<this.camera.cameraController.getMaxZoomBound()&&this.camera.cameraController.setMaxZoomBound(n+20);break}case"rotate":{const t=this.camera.cameraController.getOrbitalAngles().theta-this.onboardingRotationThetaStart;let i=Math.abs(t)/(2*Math.PI);(t>0?"counter-clockwise":"clockwise")==="clockwise"&&(i=0),this.handlePhaseProgress("rotate",i),i>=1&&this.finishSequence();break}}}transitionToRotatePhase(){this.camera.cameraController.setMaxZoomBound(this.camera.cameraController.getZoom()+5),this.camera.cameraController.setRotationStates(!0,["right","left"]),this.onboardingRotationThetaStart||(this.onboardingRotationThetaStart=this.camera.cameraController.getOrbitalAngles().theta),this.onboardingStage="rotate",this.camera.cameraController.setRotationFrictionLimits(-1.672,-1.8982)}showMenuItem(e){this.menu.showMenuItem(e)}showIcons(){document.body.classList.add("icons-ready"),this.uiManager.hideOnboardingProgress(),this.uiManager.showOnboardingPane(),this.uiManager.hideOnboardingPane(),this.uiManager.initOnboardingLoaders(5,!0),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(0,Li("/images/Onboard-Helmet-S.svg")),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(1,Li("/images/Onboard-DeathMask-S.svg")),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(2,Li("/images/Onboard-Letter-S.svg")),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(3,Li("/images/Onboard-Rifle-S.svg")),this.uiManager.loaderOnboardingGroup.setLoaderIconByIndex(4,Li("/images/Onboard-Boot-S.svg")),this.uiManager.completeOnboardingLoader(0),this.uiManager.completeOnboardingLoader(1),this.uiManager.completeOnboardingLoader(2),this.uiManager.completeOnboardingLoader(3),this.uiManager.completeOnboardingLoader(4),this.bindIcons()}bindIcons(){const e=document.getElementById("act-two__ui-bottom-zone-lower");e&&e.removeAttribute("aria-hidden");const t=document.querySelector("#act-two__ui-bottom-zone-lower .radial-loaders");t&&(t.style.overflow="unset"),this.uiManager.bindActionToLoader(0,"armour",()=>{const i=this.menu.getObjectByName("armour");this.uiManager.playUISound("click"),this.menu.jumpTo(i,{duration:this.app.preferenceManager.getPreference("reduceMotion")?1:2e3,zoomLevel:110})}),this.uiManager.bindActionToLoader(1,"death mask",()=>{const i=this.menu.getObjectByName("mask");this.uiManager.playUISound("click"),this.menu.jumpTo(i,{duration:this.app.preferenceManager.getPreference("reduceMotion")?1:2e3,zoomLevel:110})}),this.uiManager.bindActionToLoader(2,"Jerilderie letter",()=>{const i=this.menu.getObjectByName("letter");this.uiManager.playUISound("click"),this.menu.jumpTo(i,{duration:this.app.preferenceManager.getPreference("reduceMotion")?1:2e3,zoomLevel:110})}),this.uiManager.bindActionToLoader(3,"rifle",()=>{const i=this.menu.getObjectByName("rifle");this.uiManager.playUISound("click"),this.menu.jumpTo(i,{duration:this.app.preferenceManager.getPreference("reduceMotion")?1:2e3,zoomLevel:110})}),this.uiManager.bindActionToLoader(4,"boot",()=>{const i=this.menu.getObjectByName("boot");this.uiManager.playUISound("click"),this.menu.jumpTo(i,{duration:this.app.preferenceManager.getPreference("reduceMotion")?1:2e3,zoomLevel:110})})}disableOnboarding(){this.enabled=!1}async finishSequence(e=!1){document.body.classList.add("icons-ready"),this.uiManager.hideOnboardingPane(),this.camera.cameraController.setRotationFriction([]),this.onboardingStage=null,this.onboardingSequenceActive=!1,this.clearListeners(),this.app.audioManager.stopTrack("objectDrone"),e||this.bindIcons(),await bi(1500),this.app.showActTwoMenuButton(),this.camera.cameraController.setRotationStates(!0),this.camera.cameraController.setZoomStates(!0),this.camera.setAct2Controls(),this.app.environmentManager.setSplatForTransparency(),await bi(e?1:1e3),document.body.classList.remove("onboarding-active"),await bi(e?1:1e3),setTimeout(()=>{this.app.showMenuNavButtons(),this.uiManager.enableListen(),this.uiManager.animateInListenButton()},100),this.app.environmentManager.setSplatForOcclusion();const t=document.getElementById("act-two__ui-bottom-zone");t&&setTimeout(()=>{t.remove()},300);const i=document.getElementById("act-two__ui-menu-highlight");i&&i.removeAttribute("aria-hidden"),this.app.finishOnboarding()}isActive(){return this.onboardingSequenceActive}getCurrentStage(){return this.onboardingStage}initDebugKeyboardListener(){document.addEventListener("keydown",e=>{if(e.key==="n"||e.key==="N"){const t=this.camera.cameraController.getOrbitalAngles().theta,i=t-this.onboardingRotationThetaStart,n=Math.abs(i)/(2*Math.PI);console.log({onboardingPercentage:n,currentAngle:t,onboardingStartAngle:this.onboardingRotationThetaStart,normalised:{currentAngle:(t%(2*Math.PI)+2*Math.PI)%(2*Math.PI),startAngle:(this.onboardingRotationThetaStart%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},suggestedFrictionPoints:[{name:"rotation-min",position:t-Math.PI/4,radius:Math.PI/8,strength:.8,direction:"backward",beyond:!0},{name:"rotation-max",position:t+Math.PI/4,radius:Math.PI/8,strength:.8,direction:"forward",beyond:!0}]})}})}cleanup(){this.clearListeners(),this.stopUpdates(),this.onboardingSequenceActive=!1,this.onboardingStage=null}}class ru extends Dr{constructor(t,i,n){super(t,i,{callbacks:n==null?void 0:n.callbacks});g(this,"objectMappings",new Map);g(this,"objectAnimationMixers",new Map);g(this,"objectAnimationActions",new Map);g(this,"objectAnimationClips",new Map);g(this,"objectClipIndices",new Map);g(this,"objectCallbacks");g(this,"objectTracksFound",!1);g(this,"debug",!1);g(this,"segmentAnimationId",null);g(this,"isPlayingSegment",!1);this.objectCallbacks=(n==null?void 0:n.objectCallbacks)||{},this.debug=(n==null?void 0:n.debug)||!1,n!=null&&n.unitScale&&this.setUnitScale(n.unitScale),n!=null&&n.initialFPS&&this.setFPS(n.initialFPS)}registerObject(t){this.objectMappings.set(t.targetName,t),this.debug&&(Ye(`Registered object '${t.targetName}' for animation`),t.clipIndex!==void 0?Ye(`  Using animation clip index: ${t.clipIndex}`):t.clipName&&Ye(`  Using animation clip name: ${t.clipName}`))}clearObjectMappings(){this.objectMappings.clear(),this.objectAnimationMixers.clear(),this.objectAnimationActions.clear(),this.objectAnimationClips.clear(),this.objectClipIndices.clear(),this.objectTracksFound=!1}async loadAnimation(t){await super.loadAnimation(t),this.processObjectAnimations()}processObjectAnimations(){const t=this.allAnimationClips;!t||t.length===0||(this.debug&&(Ye(`Processing object animations with ${t.length} available clips...`),t.forEach((i,n)=>{Ye(`Clip #${n}: "${i.name}" - ${i.duration}s, ${i.tracks.length} tracks`)})),this.objectTracksFound=!1,this.objectMappings.forEach((i,n)=>{let s=0,a=!1;if(i.clipIndex!==void 0&&i.clipIndex<t.length)s=i.clipIndex,a=!0;else if(i.clipName){const r=t.findIndex(l=>l.name===i.clipName);r>=0?(s=r,a=!0):Ye(`Animation clip named "${i.clipName}" not found for target "${n}"`)}else for(let r=0;r<t.length;r++)if(t[r].tracks.filter(h=>h.name.startsWith(n)||h.name.includes(`.${n}.`)||h.name.includes(`${n}.`)).length>0){s=r,a=!0;break}if(a){const r=t[s],l=r.tracks.filter(c=>c.name.startsWith(n)||c.name.includes(`.${n}.`)||c.name.includes(`${n}.`));if(l.length>0){this.objectTracksFound=!0,this.objectClipIndices.set(n,s),this.debug&&(Ye(`Found ${l.length} animation tracks for target '${n}' in clip #${s}`),Ye(["Track names:",l.map(f=>f.name)]));const c=new Co(`${n}_clip`,r.duration,l);this.objectAnimationClips.set(n,c);const h=new Lr(i.sceneObject);this.objectAnimationMixers.set(n,h);const d=h.clipAction(c);this.objectAnimationActions.set(n,d),this.objectCallbacks.onObjectAnimationStart&&this.objectCallbacks.onObjectAnimationStart(n)}}}),this.objectTracksFound&&this.debug)}setFrame(t){super.setFrame(t),this.setObjectsToFrame(t),this.objectCallbacks.onObjectFrameChange&&this.objectMappings.forEach((i,n)=>{this.objectAnimationClips.has(n)&&this.objectCallbacks.onObjectFrameChange(n,t)})}setTime(t,i=!0){super.setTime(t);const n=t+this.getOffsetSeconds();this.setObjectsToTime(i?n:t)}setObjectsToFrame(t){if(!this.objectTracksFound)return;const i=this.getTotalFrames(),s=Math.max(0,Math.min(t,i-1))/this.getFPS();this.setObjectsToTime(s)}setObjectsToTime(t){if(!this.objectTracksFound)return;this.objectMappings.forEach((n,s)=>{const a=this.objectAnimationClips.get(s);a&&a.tracks.forEach(r=>{var _,y,v;const l=r.times,c=r.values,h=r.getValueSize();let d=l.findIndex(S=>S>=t);d===-1&&(d=l.length-1),d===0&&t<l[0]&&(d=0);let f=[];if(d>0&&t<l[d]){const S=d-1,A=l[S],E=l[d],O=(t-A)/(E-A),R=new Array(h),k=new Array(h);for(let U=0;U<h;U++)R[U]=c[S*h+U],k[U]=c[d*h+U],f[U]=R[U]*(1-O)+k[U]*O}else f=Array.from(c.slice(d*h,(d+1)*h));let p=r.name.split(".").pop();if(p||(p=r.name.includes("position")?"position":r.name.includes("quaternion")?"quaternion":r.name.includes("scale")?"scale":r.name.includes("rotation")?"rotation":null),!p)return;const b=n.sceneObject;switch(p){case"position":const S=new D().fromArray(f);(_=n.transformAdjustment)!=null&&_.position&&S.add(n.transformAdjustment.position),b.position.copy(S);break;case"quaternion":const A=new ai().fromArray(f);if((y=n.transformAdjustment)!=null&&y.rotation){const O=new ai().setFromEuler(n.transformAdjustment.rotation);A.multiply(O)}b.quaternion.copy(A);break;case"rotation":const E=new vn().fromArray(f);(v=n.transformAdjustment)!=null&&v.rotation&&(E.x+=n.transformAdjustment.rotation.x,E.y+=n.transformAdjustment.rotation.y,E.z+=n.transformAdjustment.rotation.z),b.rotation.copy(E);break}})});const i=new Set;this.objectMappings.forEach(n=>{const s=n.sceneObject;if(!i.has(s)){let a=s,r=s.parent;for(;r;){let l=!1;for(const[c,h]of this.objectMappings)if(h.sceneObject===r){l=!0;break}l&&(a=r),r=r.parent}a===s&&(s.updateMatrix(),s.updateMatrixWorld(!0),i.add(s))}})}getRegisteredObject(t){var i;return(i=this.objectMappings.get(t))==null?void 0:i.sceneObject}hasTracksForTarget(t){return this.objectAnimationClips.has(t)}getAnimatedTargetNames(){return Array.from(this.objectAnimationClips.keys())}getAnimationClipForTarget(t){return this.objectAnimationClips.get(t)||null}getClipIndexForTarget(t){return this.objectClipIndices.get(t)}getOriginalAnimationClip(){return this.originalAnimationClip||null}getAllAnimationClips(){return this.allAnimationClips||[]}getUnitScale(){return this.unitScale||1}setUnitScale(t){this.unitScale=t}clone(){const t=new ru(this.camera,this.scene,{debug:this.debug,callbacks:this.callbacks,objectCallbacks:this.objectCallbacks,unitScale:this.getUnitScale(),initialFPS:this.getFPS()});return this.frameOffset&&t.setFrameOffset(this.frameOffset),t.debugging=this.debugging,this.originalAnimationClip&&(t.originalAnimationClip=this.originalAnimationClip,t.animations=[...this.animations],t.animationDuration=this.animationDuration,this.allAnimationClips&&(t.allAnimationClips=this.allAnimationClips),t.mixer=new Lr(t.cameraParentGroup),t.animations.length>0&&(t.currentAction=t.mixer.clipAction(t.animations[0]))),t.currentFrameIndex=0,t.objectTracksFound=this.objectTracksFound,this.objectMappings.forEach((i,n)=>{var a,r;const s={targetName:i.targetName,sceneObject:i.sceneObject,clipIndex:i.clipIndex,clipName:i.clipName};i.transformAdjustment&&(s.transformAdjustment={position:(a=i.transformAdjustment.position)==null?void 0:a.clone(),rotation:(r=i.transformAdjustment.rotation)==null?void 0:r.clone()},i.transformAdjustment.scale!==void 0&&(typeof i.transformAdjustment.scale=="number"?s.transformAdjustment.scale=i.transformAdjustment.scale:s.transformAdjustment.scale=i.transformAdjustment.scale.clone())),t.registerObject(s)}),this.objectAnimationClips.forEach((i,n)=>{t.objectAnimationClips.set(n,i)}),this.objectClipIndices.forEach((i,n)=>{t.objectClipIndices.set(n,i)}),this.objectTracksFound&&this.allAnimationClips&&t.processObjectAnimations(),t}animateSegment(t){return new Promise(i=>{this.stopSegmentAnimation();const n=t.from/this.getFPS(),s=t.to/this.getFPS(),a=t.easing||(c=>c);this.isPlayingSegment=!0;const r=performance.now(),l=c=>{const h=c-r,d=Math.min(h/t.duration,1),f=a(d),p=n+(s-n)*f;this.setTime(p,!1),d<1?this.segmentAnimationId=requestAnimationFrame(l):(this.isPlayingSegment=!1,this.segmentAnimationId=null,t.onComplete&&t.onComplete(),i(),Ye(`animate segment complete: ${t.from} to ${t.to}`))};this.segmentAnimationId=requestAnimationFrame(l),this.debug&&Ye(`Starting segment animation: ${t.from} to ${t.to} over ${t.duration}ms`)})}stopSegmentAnimation(){this.segmentAnimationId!==null&&(cancelAnimationFrame(this.segmentAnimationId),this.segmentAnimationId=null,this.isPlayingSegment=!1,this.debug)}isAnimatingSegment(){return this.isPlayingSegment}dispose(){super.dispose(),this.objectAnimationMixers.forEach(t=>{t.stopAllAction()}),this.segmentAnimationId!==null&&(cancelAnimationFrame(this.segmentAnimationId),this.segmentAnimationId=null),this.objectAnimationMixers.clear(),this.objectAnimationActions.clear(),this.objectAnimationClips.clear(),this.objectClipIndices.clear(),this.objectMappings.clear()}}class dS{constructor(e,t,i){g(this,"skinnedMesh");g(this,"mixer");g(this,"animationClips",[]);g(this,"currentAction",null);g(this,"cameraPlayer",null);g(this,"debugging",!1);g(this,"duration");g(this,"isActive",!1);g(this,"animationStartTime",0);g(this,"previousTime",0);g(this,"fps",25);g(this,"frameOffset",0);g(this,"offsetSeconds",0);g(this,"initialFrame",0);g(this,"segmentAnimationId",null);g(this,"isPlayingSegment",!1);g(this,"additionalClips",new Map);g(this,"blendActions",new Map);g(this,"activeBlends",new Map);g(this,"transitionAnimationId",null);var n,s;this.skinnedMesh=e,this.cameraPlayer=t||null,this.debugging=(i==null?void 0:i.debug)||!1,this.fps=(i==null?void 0:i.fps)||25,this.initialFrame=(i==null?void 0:i.initialFrame)||0,this.mixer=new Lr(this.skinnedMesh),e.animations&&e.animations.length>0?this.animationClips=e.animations:((s=(n=e.parent)==null?void 0:n.animations)==null?void 0:s.length)>0&&(this.animationClips=e.parent.animations),this.duration=this.animationClips.length>0?this.animationClips[0].duration:(i==null?void 0:i.defaultDuration)||1,this.animationStartTime=(i==null?void 0:i.startTime)||0,this.debugging&&(Ye(`SkinnedAnimationController initialised with ${this.animationClips.length} clips`),this.animationClips.forEach((a,r)=>{Ye(`Animation #${r}: "${a.name}" - ${a.duration}s, ${a.tracks.length} tracks`)})),this.animationClips.length>0&&(this.initialiseActions(),this.setFrame(this.initialFrame)),t&&this.connectCameraPlayer(t)}initialiseActions(){this.currentAction=this.mixer.clipAction(this.animationClips[0]),this.currentAction.setLoop(Cl,1),this.currentAction.clampWhenFinished=!0,this.debugging&&Ye(["SkinnedAnimationController initialised with clip:",this.animationClips[0].name])}connectCameraPlayer(e){this.cameraPlayer=e,this.cameraPlayer&&(this.cameraPlayer.setCallbacks({onTimeUpdate:this.handleTimeUpdate.bind(this)}),this.debugging)}handleTimeUpdate(e){if(!this.isActive||!this.currentAction||this.isPlayingSegment)return;const t=Math.min(e-this.animationStartTime+this.offsetSeconds,this.duration);if(Math.abs(t-this.previousTime)<.001)return;const i=this.previousTime>=this.duration,n=t<this.previousTime;i&&n&&this.resetAction(),this.previousTime=t,t<=0?this.mixer.setTime(0):t>=this.duration?this.mixer.setTime(this.duration):this.mixer.setTime(t),this.debugging&&Math.floor(t*10)%10}animateSegment(e){return new Promise(t=>{this.stopSegmentAnimation();const i=e.from/this.fps,n=e.to/this.fps,s=e.easing||(c=>c),a=this.isActive;this.isActive=!0,this.isPlayingSegment=!0;const r=performance.now(),l=c=>{const h=c-r,d=Math.min(h/e.duration,1),f=s(d),p=i+(n-i)*f;this.mixer.setTime(p),this.previousTime=p,d<1?this.segmentAnimationId=requestAnimationFrame(l):(this.isPlayingSegment=!1,this.isActive=a,this.segmentAnimationId=null,e.onComplete&&e.onComplete(),t(),this.debugging&&Ye(`Segment animation complete: ${e.from} to ${e.to}`))};this.segmentAnimationId=requestAnimationFrame(l),this.softResetAction(),this.debugging&&(Ye([`Starting segment, active status: ${this.isActive}`,this.mixer]),Ye(`Starting segment animation: ${e.from} to ${e.to} over ${e.duration}ms`))})}async loadAdditionalAnimations(e){let t=[],i=e.name||`additional_${Date.now()}`;try{if(e.animations)t=e.animations,this.debugging&&Ye(`Using ${t.length} pre-parsed animation clips`,"skinned-animation");else if(e.skinnedMesh)t=this.extractAnimationsFromMesh(e.skinnedMesh),this.debugging&&Ye(`Extracted ${t.length} animations from pre-loaded mesh`,"skinned-animation");else if(e.url)t=(await new GLTFLoader().loadAsync(e.url)).animations,this.debugging&&Ye(`Loaded ${t.length} animations from URL: ${e.url}`,"skinned-animation");else throw new Error("No animation source provided. Must specify url, skinnedMesh, or animations.");if(t.length===0)throw new Error("No animations found in the provided source");this.additionalClips.set(i,t),t.forEach((n,s)=>{const a=`${i}_${s}`,r=this.mixer.clipAction(n);r.setLoop(Cl,1),r.clampWhenFinished=!0,r.time=81.1,r.enabled=!1,r.weight=0,r.stop(),this.blendActions.set(a,r),this.debugging&&Ye(`Created isolated action: ${a} for clip: ${n.name}`,"skinned-animation")}),this.currentAction&&(this.currentAction.enabled=!0,this.currentAction.weight=1,this.isActive&&this.currentAction.play(),this.debugging&&Ye("Re-established primary action control after loading additional animations","skinned-animation"),this.validateMixerState()),this.debugging&&(Ye(`Successfully loaded ${t.length} additional animations as "${i}"`,"skinned-animation"),this.debugAnimationState())}catch(n){throw console.error("Error loading additional animations:",n),n}}validateMixerState(){if(!this.mixer||!this.currentAction)return;const e=this.mixer._actions||[];let t=0,i=0;this.debugging&&Ye(`Validating mixer state with ${e.length} total actions`),e.forEach(n=>{n===this.currentAction?(t=n.weight,this.debugging&&Ye(`Primary action weight: ${n.weight}, enabled: ${n.enabled}`)):(i+=n.weight,n.weight>0&&this.debugging&&Ye(`Additional action weight: ${n.weight}, enabled: ${n.enabled}`))}),Math.abs(t+i-1)>.001&&(this.debugging,this.currentAction.weight=1,this.currentAction.enabled=!0,this.blendActions.forEach(n=>{n.weight=0,n.enabled=!1,n.stop()}),this.activeBlends.clear())}debugAnimationState(){if(!this.debugging)return;console.group("Animation State Debug"),this.currentAction&&console.log("Primary Action:",{clip:this.currentAction.getClip().name,weight:this.currentAction.weight,enabled:this.currentAction.enabled,time:this.currentAction.time,paused:this.currentAction.paused}),console.log("Additional Actions:"),this.blendActions.forEach((t,i)=>{console.log(`  ${i}:`,{weight:t.weight,enabled:t.enabled,time:t.time})}),console.log("Active Blends:",Object.fromEntries(this.activeBlends));const e=this.mixer._actions||[];console.log(`Total mixer actions: ${e.length}`),console.groupEnd()}extractAnimationsFromMesh(e){var i,n,s;let t=[];if(e.animations&&e.animations.length>0)t=e.animations,this.debugging&&Ye(`Found ${t.length} animations on mesh directly`);else if(((n=(i=e.parent)==null?void 0:i.animations)==null?void 0:n.length)>0)t=e.parent.animations,this.debugging&&Ye(`Found ${t.length} animations on mesh parent`);else{let a=e.parent;for(;a&&t.length===0;){if(((s=a.animations)==null?void 0:s.length)>0){t=a.animations,this.debugging&&Ye(`Found ${t.length} animations on ancestor: ${a.name||"unnamed"}`);break}a=a.parent}}return t.length===0&&e.userData.animations&&(t=e.userData.animations,this.debugging&&Ye(`Found ${t.length} animations in mesh userData`)),t}getAdditionalAnimationSets(){return Array.from(this.additionalClips.keys())}getAdditionalClipNames(e){const t=this.additionalClips.get(e);return t?t.map((i,n)=>`${e}_${n}`):[]}blendToAdditionalAnimation(e,t=0,i=1,n=1e3){return new Promise(s=>{var f;const a=`${e}_${t}`,r=this.blendActions.get(a);if(!r){s();return}this.stopBlendTransition(),r.enabled=!0,r.weight=0,r.play(),this.currentAction&&(r.time=this.currentAction.time);const l=r.weight,c=performance.now(),h=((f=this.currentAction)==null?void 0:f.weight)||1,d=p=>{const b=p-c,_=Math.min(b/n,1),y=kt.easeInOutCubic(_),v=l+(i-l)*y;r.weight=v,this.activeBlends.set(a,v),this.currentAction&&(this.currentAction.weight=h*(1-v)),this.mixer.update(0),_<1?this.transitionAnimationId=requestAnimationFrame(d):(this.transitionAnimationId=null,this.debugging,s())};this.transitionAnimationId=requestAnimationFrame(d)})}blendToPrimary(e=1e3){return new Promise(t=>{if(this.stopBlendTransition(),!this.currentAction){t();return}const i=Array.from(this.activeBlends.entries());if(i.length===0){t();return}const n=performance.now(),s=this.currentAction.weight,a=r=>{const l=r-n,c=Math.min(l/e,1),h=kt.easeInOutCubic(c);i.forEach(([f,p])=>{const b=this.blendActions.get(f);if(b){const _=p*(1-h);b.weight=_,this.activeBlends.set(f,_)}});const d=s+(1-s)*h;this.currentAction.weight=d,this.mixer.update(0),c<1?this.transitionAnimationId=requestAnimationFrame(a):(i.forEach(([f])=>{const p=this.blendActions.get(f);p&&(p.weight=0,p.enabled=!1,this.activeBlends.delete(f))}),this.currentAction.weight=1,this.transitionAnimationId=null,this.debugging,t())};this.transitionAnimationId=requestAnimationFrame(a)})}updateBlendWeights(e,t=!0){let i=0;if(t&&(i=Object.values(e).reduce((n,s)=>n+s,0),i===0&&(i=1)),this.currentAction&&"primary"in e){const n=t?e.primary/i:e.primary;this.currentAction.weight=Math.max(0,Math.min(1,n))}Object.entries(e).forEach(([n,s])=>{if(n==="primary")return;const a=this.blendActions.get(n);if(a){const r=t?s/i:s,l=Math.max(0,Math.min(1,r));a.weight=l,a.enabled=l>0,l>0?(this.activeBlends.set(n,l),a.isRunning()||a.play(),this.currentAction&&(a.time=this.currentAction.time)):(this.activeBlends.delete(n),a.stop())}}),this.mixer.update(0),this.debugging&&Ye(`Manual blend weights updated: ${JSON.stringify(e)}`)}stopBlendTransition(){this.transitionAnimationId!==null&&(cancelAnimationFrame(this.transitionAnimationId),this.transitionAnimationId=null)}getBlendWeights(){const e={};return this.currentAction&&(e.primary=this.currentAction.weight),this.activeBlends.forEach((t,i)=>{e[i]=t}),e}stopSegmentAnimation(){this.segmentAnimationId!==null&&(cancelAnimationFrame(this.segmentAnimationId),this.segmentAnimationId=null,this.isPlayingSegment=!1,this.debugging)}setIsActive(e){this.isActive=e,e&&this.currentAction?(this.currentAction.paused=!1,this.currentAction.enabled=!0,this.currentAction.play(),this.debugging):this.currentAction&&(this.currentAction.paused=!0,this.debugging)}setAnimationClip(e){if(!this.mixer)return!1;let t;return typeof e=="number"?t=this.animationClips[e]:t=this.animationClips.find(i=>i.name===e),t?(this.currentAction&&this.currentAction.stop(),this.currentAction=this.mixer.clipAction(t),this.currentAction.setLoop(Cl,1),this.currentAction.clampWhenFinished=!0,this.duration=t.duration,this.isActive?(this.currentAction.paused=!1,this.currentAction.enabled=!0,this.currentAction.play()):this.currentAction.paused=!0,this.debugging&&Ye(`Switched to animation clip: "${t.name}" (${t.duration}s)`),!0):!1}getAnimationClipNames(){return this.animationClips.map(e=>e.name)}setStartTime(e){this.animationStartTime=e,this.debugging}setDuration(e){this.duration=e,this.debugging}enableDebugging(e=!0){this.debugging=e}getCurrentTime(){return this.previousTime}getDuration(){return this.duration}getCurrentFrame(){return Math.floor(this.previousTime*this.fps)}getTotalFrames(){return Math.floor(this.duration*this.fps)}setFPS(e){this.fps=e}getSkinnedMesh(){return this.skinnedMesh}setTime(e){if(!this.mixer||!this.currentAction)return;const t=e+this.offsetSeconds,i=Math.max(0,Math.min(t,this.duration)),n=this.previousTime>this.duration-.1,s=i<this.previousTime-.5,a=i>this.previousTime+.5;(n||s||a)&&this.softResetAction(),this.mixer.setTime(i),this.previousTime=i}setFrameOffset(e){this.frameOffset=Math.max(0,e),this.offsetSeconds=this.frameOffset/this.fps,this.debugging&&Ye(`Frame offset set to ${this.frameOffset} frames (${this.offsetSeconds.toFixed(2)}s)`)}getFrameOffset(){return this.frameOffset}clearFrameOffset(){this.frameOffset=0,this.offsetSeconds=0,this.debugging}setFrame(e){const t=this.getTotalFrames(),i=e+this.frameOffset,s=Math.max(0,Math.min(i,t-1))/this.fps;if(!this.mixer||!this.currentAction)return;const a=Math.max(0,Math.min(s,this.duration)),r=this.previousTime>=this.duration,l=a<this.previousTime;r&&l&&this.resetAction(),this.mixer.setTime(a),this.previousTime=a,this.debugging&&Ye(`Manually set animation to frame ${e} (${a.toFixed(2)}s)`)}resetAction(){this.softResetAction()}softResetAction(){!this.currentAction||!this.mixer||(this.currentAction.enabled=!0,this.currentAction.paused=!1,this.currentAction.timeScale=1,this.currentAction.play())}dispose(){this.stopSegmentAnimation(),this.stopBlendTransition(),this.blendActions.forEach(e=>{e.stop()}),this.mixer&&(this.mixer.stopAllAction(),this.mixer.uncacheRoot(this.skinnedMesh)),this.currentAction=null,this.cameraPlayer=null,this.additionalClips.clear(),this.blendActions.clear(),this.activeBlends.clear()}isAnimatingSegment(){return this.isPlayingSegment}hasCameraPlayer(){return this.cameraPlayer!==null}}function hh(o,e,t,i){return new(t||(t=Promise))(function(n,s){function a(c){try{l(i.next(c))}catch(h){s(h)}}function r(c){try{l(i.throw(c))}catch(h){s(h)}}function l(c){var h;c.done?n(c.value):(h=c.value,h instanceof t?h:new t(function(d){d(h)})).then(a,r)}l((i=i.apply(o,[])).next())})}const fS=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function Yf(o){return o=o.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}const Em=typeof window>"u",vs=(()=>{if(Em)return;const{userAgent:o,platform:e,maxTouchPoints:t}=window.navigator,i=/(iphone|ipod|ipad)/i.test(o),n=e==="iPad"||e==="MacIntel"&&t>0&&!window.MSStream;return{isIpad:n,isMobile:/android/i.test(o)||i||n,isSafari12:/Version\/12.+Safari/.test(o),isFirefox:/Firefox/.test(o)}})();function pS(o,e,t){if(!t)return[e];const i=function(c){const h=`
    precision highp float;
    attribute vec3 aPosition;
    varying float vvv;
    void main() {
      vvv = 0.31622776601683794;
      gl_Position = vec4(aPosition, 1.0);
    }
  `,d=`
    precision highp float;
    varying float vvv;
    void main() {
      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;
      enc = fract(enc);
      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);
      gl_FragColor = enc;
    }
  `,f=c.createShader(35633),p=c.createShader(35632),b=c.createProgram();if(!(p&&f&&b))return;c.shaderSource(f,h),c.shaderSource(p,d),c.compileShader(f),c.compileShader(p),c.attachShader(b,f),c.attachShader(b,p),c.linkProgram(b),c.detachShader(b,f),c.detachShader(b,p),c.deleteShader(f),c.deleteShader(p),c.useProgram(b);const _=c.createBuffer();c.bindBuffer(34962,_),c.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const y=c.getAttribLocation(b,"aPosition");c.vertexAttribPointer(y,3,5126,!1,0,0),c.enableVertexAttribArray(y),c.clearColor(1,1,1,1),c.clear(16384),c.viewport(0,0,1,1),c.drawArrays(4,0,3);const v=new Uint8Array(4);return c.readPixels(0,0,1,1,6408,5121,v),c.deleteProgram(b),c.deleteBuffer(_),v.join("")}(o),n="801621810",s="8016218135",a="80162181161",r=vs!=null&&vs.isIpad?[["a7",a,12],["a8",s,15],["a8x",s,15],["a9",s,15],["a9x",s,15],["a10",s,15],["a10x",s,15],["a12",n,15],["a12x",n,15],["a12z",n,15],["a14",n,15],["a15",n,15],["m1",n,15],["m2",n,15]]:[["a7",a,12],["a8",s,12],["a9",s,15],["a10",s,15],["a11",n,15],["a12",n,15],["a13",n,15],["a14",n,15],["a15",n,15],["a16",n,15],["a17",n,15]];let l;return i==="80162181255"?l=r.filter(([,,c])=>c>=14):(l=r.filter(([,c])=>c===i),l.length||(l=r)),l.map(([c])=>`apple ${c} gpu`)}class Zf extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}const uh=[],Kf=[];function mS(o,e){if(o===e)return 0;const t=o;o.length>e.length&&(o=e,e=t);let i=o.length,n=e.length;for(;i>0&&o.charCodeAt(~-i)===e.charCodeAt(~-n);)i--,n--;let s,a=0;for(;a<i&&o.charCodeAt(a)===e.charCodeAt(a);)a++;if(i-=a,n-=a,i===0)return n;let r,l,c=0,h=0,d=0;for(;h<i;)Kf[h]=o.charCodeAt(a+h),uh[h]=++h;for(;d<n;)for(s=e.charCodeAt(a+d),r=d++,c=d,h=0;h<i;h++)l=s===Kf[h]?r:r+1,r=uh[h],c=uh[h]=r>c?l>c?c+1:l:l>r?r+1:l;return c}function gS(o){return o!=null}const yS=({mobileTiers:o=[0,15,30,60],desktopTiers:e=[0,15,30,60],override:t={},glContext:i,failIfMajorPerformanceCaveat:n=!1,benchmarksURL:s="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>hh(void 0,void 0,void 0,function*(){const a={};if(Em)return{tier:0,type:"SSR"};const{isIpad:r=!!(vs!=null&&vs.isIpad),isMobile:l=!!(vs!=null&&vs.isMobile),screenSize:c=window.screen,loadBenchmarks:h=O=>hh(void 0,void 0,void 0,function*(){const R=yield fetch(`${s}/${O}`).then(k=>k.json());if(parseInt(R.shift().split(".")[0],10)<4)throw new Zf("Detect GPU benchmark data is out of date. Please update to version 4x");return R})}=t;let{renderer:d}=t;const f=(O,R,k,U,C)=>({device:C,fps:U,gpu:k,isMobile:l,tier:O,type:R});let p,b="";if(d)d=Yf(d),p=[d];else{const O=i||function(k,U=!1){const C={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:U,powerPreference:"high-performance",stencil:!1};k&&delete C.powerPreference;const T=window.document.createElement("canvas"),Z=T.getContext("webgl",C)||T.getContext("experimental-webgl",C);return Z??void 0}(vs==null?void 0:vs.isSafari12,n);if(!O)return f(0,"WEBGL_UNSUPPORTED");const R=vs!=null&&vs.isFirefox?null:O.getExtension("WEBGL_debug_renderer_info");if(d=R?O.getParameter(R.UNMASKED_RENDERER_WEBGL):O.getParameter(O.RENDERER),!d)return f(1,"FALLBACK");b=d,d=Yf(d),p=function(k,U,C){return U==="apple gpu"?pS(k,U,C):[U]}(O,d,l)}const _=(yield Promise.all(p.map(function(O){var R;return hh(this,void 0,void 0,function*(){const k=(ve=>{const K=l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"];for(const se of K)if(ve.includes(se))return se})(O);if(!k)return;const U=`${l?"m":"d"}-${k}${r?"-ipad":""}.json`,C=a[U]=(R=a[U])!==null&&R!==void 0?R:h(U);let T;try{T=yield C}catch(ve){if(ve instanceof Zf)throw ve;return}const Z=function(ve){var K;const se=(ve=ve.replace(/\([^)]+\)/,"")).match(/\d+/)||ve.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return(K=se==null?void 0:se.join("").replace(/\W|amd/g,""))!==null&&K!==void 0?K:""}(O);let z=T.filter(([,ve])=>ve===Z);z.length||(z=T.filter(([ve])=>ve.includes(O)));const B=z.length;if(B===0)return;const V=O.split(/[.,()\[\]/\s]/g).sort().filter((ve,K,se)=>K===0||ve!==se[K-1]).join(" ");let Y,[J,,,,Te]=B>1?z.map(ve=>[ve,mS(V,ve[2])]).sort(([,ve],[,K])=>ve-K)[0][0]:z[0],ge=Number.MAX_VALUE;const{devicePixelRatio:fe}=window,he=c.width*fe*c.height*fe;for(const ve of Te){const[K,se]=ve,Ee=K*se,me=Math.abs(he-Ee);me<ge&&(ge=me,Y=ve)}if(!Y)return;const[,,Q,pe]=Y;return[ge,Q,J,pe]})}))).filter(gS).sort(([O=Number.MAX_VALUE,R],[k=Number.MAX_VALUE,U])=>O===k?R-U:O-k);if(!_.length){const O=fS.find(R=>d.includes(R));return O?f(0,"BLOCKLISTED",O):f(1,"FALLBACK",`${d} (${b})`)}const[,y,v,S]=_[0];if(y===-1)return f(0,"BLOCKLISTED",v,y,S);const A=l?o:e;let E=0;for(let O=0;O<A.length;O++)y>=A[O]&&(E=O);return f(E,"BENCHMARK",v,y,S)});class vS{constructor(e){g(this,"app");g(this,"gpuTier",null);g(this,"deviceInfo",null);g(this,"preset","low");g(this,"enableSplat",!0);g(this,"isMobile",!1);g(this,"isTouch",!1);g(this,"fpsLimit",null);g(this,"preferenceManager");this.app=e,this.preferenceManager=Gs.getInstance()}async performProfile(){var e,t,i,n,s;switch(this.deviceInfo=iu(),this.gpuTier=await yS(),Ye(this.deviceInfo),Ye(this.gpuTier),this.fpsLimit="60",(e=this.gpuTier)==null?void 0:e.isMobile){case!1:switch(this.isMobile=!1,this.enableSplat=!0,(t=this.gpuTier)==null?void 0:t.tier){case 3:this.preset="high",this.fpsLimit="unlimited";break;case 2:this.preset="med",this.fpsLimit="unlimited";break;default:this.preset="low",this.enableSplat=!1;break}break;case!0:switch(this.enableSplat=!1,(i=this.gpuTier)==null?void 0:i.tier){case 3:this.preset="med";break;case 1:this.preset="low",this.fpsLimit="30";break;default:this.preset="low";break}break;default:this.enableSplat=!1,this.isMobile=!0,this.isTouch=!0,this.preset="low"}(n=this.gpuTier)!=null&&n.isTablet&&(this.isTouch=!0),((s=this.gpuTier)==null?void 0:s.type)==="FALLBACK"?this.app.toastManager.addToast({message:"Unable to auto detect device settings. Graphics set to Low. Adjust via settings (gear icon).",icon:Tl}):this.app.toastManager.addToast({message:`Graphics auto-set to ${xh(this.preset)}. Adjust via settings.`,icon:Tl}),this.preferenceManager.setPreference("graphics-preset",this.preset),this.preferenceManager.setPreference("is-mobile",this.isMobile),this.preferenceManager.setPreference("is-touch",this.isTouch),this.preferenceManager.setPreference("enable-splat",this.enableSplat),this.preferenceManager.setPreference("fps-limit",this.fpsLimit)}async profileDevice(e){const t=this.preferenceManager.getPreference("graphics-preset",null),i=this.preferenceManager.getPreference("is-mobile",null),n=this.preferenceManager.getPreference("is-touch",null),s=this.preferenceManager.getPreference("enable-splat",null),a=this.preferenceManager.getPreference("fps-limit",null);if(t==null||i==null||s==null||n==null||a==null?await this.performProfile():(this.preset=t,this.enableSplat=s,this.isMobile=i,this.isTouch=n,this.fpsLimit=a),this.preferenceManager.getPreference("asset-load-start",!1)){if(console.log("checking for downgrade"),this.preferenceManager.removePreference("asset-load-start"),this.preset==="low"&&!this.enableSplat)return;this.preferenceManager.setPreference("graphics-preset","low"),this.preferenceManager.setPreference("enable-splat",!1),this.preset="low",this.enableSplat=!1,this.preferenceManager.setPreference("skip-aoc",!0),this.app.toastManager.addToast({message:"Load failed. Retrying with lower settings. Adjust graphics via settings.",icon:Tl})}this.app.sessionsManager.addSessionData("graphicsPreset",this.preset),this.app.sessionsManager.addSessionData("isMobile",this.isMobile),this.app.sessionsManager.addSessionData("isTouch",this.isTouch),this.app.sessionsManager.addSessionData("splatEnabled",this.enableSplat),e&&e()}createInitialLODConfigsForDevice(){let e=null;switch(this.preset){case"high":e=oa(["mask","rifle","boot","armour"],[{name:"low",meshQuality:"Low",materialQuality:"low"},{name:"medium",meshQuality:"High",materialQuality:"med"},{name:"high",meshQuality:"High",materialQuality:"ultra"}]),e=[...e,...oa(["letter"],[{name:"medium",meshQuality:"Low",materialQuality:"ultra"}])];break;case"med":e=oa(["mask","rifle","boot","armour"],[{name:"low",meshQuality:"Low",materialQuality:"low"},{name:"medium",meshQuality:"Low",materialQuality:"med"},{name:"high",meshQuality:"Med",materialQuality:"high"}]),e=[...e,...oa(["letter"],[{name:"medium",meshQuality:"Low",materialQuality:"high"}])];break;case"low":e=oa(["mask","rifle","boot","armour"],[{name:"low",meshQuality:"Low",materialQuality:"tiny"},{name:"medium",meshQuality:"Low",materialQuality:"low"},{name:"high",meshQuality:"Low",materialQuality:"med"}]),e=[...e,...oa(["letter"],[{name:"medium",meshQuality:"Low",materialQuality:"minimum"}])];break;default:e=oa(["mask","rifle","boot","armour"],[{name:"low",meshQuality:"Low",materialQuality:"tiny"},{name:"medium",meshQuality:"Low",materialQuality:"low"},{name:"high",meshQuality:"Low",materialQuality:"low"}]),e=[...e,...oa(["letter"],[{name:"medium",meshQuality:"Low",materialQuality:"low"}])]}return e}}class bS{constructor(e){g(this,"useSplat",!0);g(this,"splat");g(this,"scene");g(this,"skybox",null);g(this,"dimFactor",0);g(this,"minBrightness",0);g(this,"maxBrightness",0);g(this,"splatAnimationFrame",null);g(this,"skyboxAnimationFrame",null);g(this,"addSkyBox",(e,t=Math.PI/2)=>(this.useSplat=!1,new Promise((i,n)=>{const s=new Wi(350,60,40);this.skybox&&(this.scene.remove(this.skybox),this.skybox=null);const a=new nc;e.startsWith("data:image"),a.load(e,r=>{const l=new qt({map:r,side:hn,transparent:!0});this.skybox=new It(s,l),this.skybox.name="skybox",this.skybox.renderOrder=-1,this.skybox.rotation.y=t,this.skybox.rotation.y=di(94),this.skybox.rotation.x=di(2),this.scene.add(this.skybox),i(this.skybox)},r=>{},r=>{console.error("Error loading skybox texture:",r),n(r)})})));g(this,"cancelSplatBrightnessAnimation",()=>{this.splatAnimationFrame!==null&&(cancelAnimationFrame(this.splatAnimationFrame),this.splatAnimationFrame=null)});g(this,"cancelSkyboxBrightnessAnimation",()=>{this.skyboxAnimationFrame!==null&&(cancelAnimationFrame(this.skyboxAnimationFrame),this.skyboxAnimationFrame=null)});g(this,"setSplatForOcclusion",()=>{if(!this.useSplat||!this.splat)return;const e=this.splat.splatMesh.material;e.needsUpdate=!0,this.splat.renderOrder=1});g(this,"setSplatForTransparency",()=>{if(!this.useSplat||!this.splat)return;const e=this.splat.splatMesh.material;e.needsUpdate=!0,this.splat.renderOrder=0});this.scene=e}setSplat(e){this.splat=e,this.splat.rotation.x=di(.5),this.splat.renderOrder=0}show(){this.useSplat?this.showSplat():this.showSkybox()}hide(){this.useSplat?this.hideSplat():this.hideSkybox()}showSplat(){this.splat&&this.scene.add(this.splat)}hideSplat(){this.splat&&this.scene.remove(this.splat)}showSkybox(){this.skybox&&(this.skybox.visible=!0)}hideSkybox(){this.skybox&&(this.skybox.visible=!1)}setBrightness(e){this.dimFactor=e,this.useSplat?this.setSplatBrightness(e):this.setSkyboxBrightness(e)}setSplatBrightness(e){this.updateSplatBrightness()}setSkyboxBrightness(e){this.updateSkyboxBrightness()}updateBrightness(){this.useSplat?this.updateSplatBrightness():this.updateSkyboxBrightness()}updateSplatBrightness(){var i;if(!this.splat)return;const e=this.splat.splatMesh.material;if(!((i=e==null?void 0:e.uniforms)!=null&&i.dimFactor))return;const t=Et.clamp(this.dimFactor,this.minBrightness,this.maxBrightness);e.uniforms.dimFactor.value=t}updateSkyboxBrightness(){if(this.skybox&&this.skybox.material instanceof qt){const e=Et.clamp(this.dimFactor,this.minBrightness,this.maxBrightness);this.skybox.material.opacity=e,this.skybox.material.needsUpdate=!0}}setBrightnessMin(e){this.minBrightness=e}setBrightnessMax(e){this.maxBrightness=e}animateSplatBrightness(e,t){return new Promise(i=>{this.cancelSplatBrightnessAnimation();const n=this.dimFactor,s=performance.now(),a=()=>{const r=performance.now()-s,l=Math.min(r/t,1),c=kt.easeInOutCubic(l);this.dimFactor=n+(e-n)*c,this.updateSplatBrightness(),l<1?this.splatAnimationFrame=requestAnimationFrame(a):(this.splatAnimationFrame=null,i())};this.splatAnimationFrame=requestAnimationFrame(a)})}animateSkyboxBrightness(e,t){return new Promise(i=>{this.cancelSkyboxBrightnessAnimation();const n=this.dimFactor,s=performance.now(),a=()=>{const r=performance.now()-s,l=Math.min(r/t,1),c=kt.easeInOutCubic(l);this.dimFactor=n+(e-n)*c,this.updateSkyboxBrightness(),l<1?this.skyboxAnimationFrame=requestAnimationFrame(a):(this.skyboxAnimationFrame=null,i())};this.skyboxAnimationFrame=requestAnimationFrame(a)})}animateEnvironmentBrightness(e,t){return this.useSplat?this.animateSplatBrightness(e,t):this.animateSkyboxBrightness(e,t)}}const Gi=[];for(let o=0;o<256;++o)Gi.push((o+256).toString(16).slice(1));function wS(o,e=0){return(Gi[o[e+0]]+Gi[o[e+1]]+Gi[o[e+2]]+Gi[o[e+3]]+"-"+Gi[o[e+4]]+Gi[o[e+5]]+"-"+Gi[o[e+6]]+Gi[o[e+7]]+"-"+Gi[o[e+8]]+Gi[o[e+9]]+"-"+Gi[o[e+10]]+Gi[o[e+11]]+Gi[o[e+12]]+Gi[o[e+13]]+Gi[o[e+14]]+Gi[o[e+15]]).toLowerCase()}let dh;const _S=new Uint8Array(16);function MS(){if(!dh){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");dh=crypto.getRandomValues.bind(crypto)}return dh(_S)}const fh={};function xS(o,e,t){let i;{const n=Date.now(),s=MS();SS(fh,n,s),i=AS(s,fh.msecs,fh.seq,e,t)}return e??wS(i)}function SS(o,e,t){return o.msecs??(o.msecs=-1/0),o.seq??(o.seq=0),e>o.msecs?(o.seq=t[6]<<23|t[7]<<16|t[8]<<8|t[9],o.msecs=e):(o.seq=o.seq+1|0,o.seq===0&&o.msecs++),o}function AS(o,e,t,i,n=0){if(o.length<16)throw new Error("Random bytes length must be >= 16");if(!i)i=new Uint8Array(16),n=0;else if(n<0||n+16>i.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);return e??(e=Date.now()),t??(t=o[6]*127<<24|o[7]<<16|o[8]<<8|o[9]),i[n++]=e/1099511627776&255,i[n++]=e/4294967296&255,i[n++]=e/16777216&255,i[n++]=e/65536&255,i[n++]=e/256&255,i[n++]=e&255,i[n++]=112|t>>>28&15,i[n++]=t>>>20&255,i[n++]=128|t>>>14&63,i[n++]=t>>>6&255,i[n++]=t<<2&255|o[10]&3,i[n++]=o[11],i[n++]=o[12],i[n++]=o[13],i[n++]=o[14],i[n++]=o[15],i}class TS{constructor(e){g(this,"preferenceManager");g(this,"ip","");g(this,"uuid","");g(this,"sessionId","");g(this,"actions",[]);g(this,"sessionData",{});g(this,"lastDataAdd",new Date);g(this,"lastDataSync",new Date);this.preferenceManager=e}generateUuid(){return xS()}async establishSession(){this.uuid=this.preferenceManager.getPreference("uuid",null),this.uuid||(this.uuid=this.generateUuid(),this.preferenceManager.setPreference("uuid",this.uuid)),this.sessionId=await this.getSessionId()}async getSessionId(){if(this.sessionId)return this.sessionId;const e=`${Xl}/mod/session/start`;try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:this.uuid})});if(!t.ok)throw new Error(`HTTP error: ${t.status}`);const i=await t.json();return await(i==null?void 0:i.sessionId)}catch(t){throw console.error("Error starting session:",t),t}}addSessionData(e,t){this.sessionData[e]=t,this.lastDataAdd=new Date,this.syncSessionData()}async syncSessionData(){if(!this.sessionId)return;const e=`${Xl}/mod/session/update`;try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.sessionData,sessionId:this.sessionId,uuid:this.uuid})});if(!t.ok)throw new Error(`HTTP error: ${t.status}`);const i=await t.json();return await(i==null?void 0:i.sessionId)}catch(t){throw console.error("Error starting session:",t),t}}getUuid(){return this.uuid}createAction(e){return e.isActive=(e==null?void 0:e.isActive)||!1,e.params=(e==null?void 0:e.params)||{},e.uuid=this.generateUuid(),this.actions.push(e),e.uuid}updateActionParams(e,t){const i=this.actions.find(n=>n.uuid===e);i&&(i.params={...i.params,...t})}}class ES{constructor(e,t){g(this,"toastContainer",null);g(this,"toasts",[]);g(this,"nextId",1);g(this,"defaultDuration",1e4);g(this,"defaultDismissLabel","Dismiss");g(this,"animationDuration",300);g(this,"isActive",!0);g(this,"announcementFunction",null);g(this,"handleToastClick",(e,t)=>{const i=e.target,n=i.closest(".toast-dismiss");if(n){const s=n.closest(".toast");if(s){const a=parseInt(s.getAttribute("data-id")||"0",10);a&&this.dismiss(a)}}else{if(!t||!i.closest(".toast"))return;t()}});this.toastContainer=document.getElementById(e),t&&(this.announcementFunction=t),this.toastContainer?this.toastContainer.classList.add("toast-container"):(console.warn(`Toast container with id '${e}' not found. Creating one.`),this.createToastContainer(e))}setAnnouncementFunction(e){this.announcementFunction=e}createToastContainer(e){this.toastContainer=document.createElement("div"),this.toastContainer.id=e,this.toastContainer.className="toast-container",document.body.appendChild(this.toastContainer)}setIsActive(e){this.isActive=e,this.isActive&&this.processToastQueue()}processToastQueue(){this.isActive&&this.toasts.forEach(e=>{e!=null&&e.displayed||(this.renderToast(e),e!=null&&e.duration&&e.duration>0&&setTimeout(()=>{this.dismiss(e.id)},e.duration))})}addToast(e){const t={id:this.nextId++,message:e.message,title:e.title,icon:e.icon,duration:e.duration||this.defaultDuration,dismissLabel:e.dismissLabel||this.defaultDismissLabel,displayed:!1,action:e.action||null};return this.toasts.push(t),this.processToastQueue(),t.id}dismiss(e){const t=this.toasts.findIndex(s=>s.id===e);if(t===-1)return;const n=this.toasts[t].element;n?(n.classList.add("toast-exiting"),setTimeout(()=>{n.remove(),this.toasts.splice(t,1)},this.animationDuration)):this.toasts.splice(t,1)}dismissAll(){[...this.toasts].forEach(e=>{this.dismiss(e.id)})}renderToast(e){if(!this.toastContainer)return;e.displayed=!0;const t=document.createElement("div");t.className=`toast toast-entering ${e!=null&&e.action?"has-action":""}`,t.setAttribute("data-id",e.id.toString()),t==null||t.addEventListener("pointerup",a=>this.handleToastClick(a,e==null?void 0:e.action));const i=document.createElement("div");if(i.className="toast-content",e.title){const a=document.createElement("div");a.className="toast-title",a.textContent=e.title,i.appendChild(a)}const n=document.createElement("div");n.className="toast-message",n.innerHTML=e.message,i.appendChild(n);const s=document.createElement("button");if(s.className="toast-dismiss",s.innerHTML=`<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
	<rect x="7" y="8" width="2" height="28" transform="rotate(-45 7 8)" fill="white"/>
	<rect x="27" y="7" width="2" height="28" transform="rotate(45 27 7)" fill="white"/>
	</svg>`,e.icon){const a=document.createElement("div");a.className="toast-icon",a.innerHTML=`<img src="${e.icon}" />`,t.appendChild(a)}t.appendChild(i),t.appendChild(s),this.toastContainer.appendChild(t),e.element=t,setTimeout(()=>{t.classList.remove("toast-entering"),this.announcementFunction&&setTimeout(()=>{this.announcementFunction(`Notification: ${e!=null&&e.title?e.title+",":""} ${e.message}`)},1e3)},10)}setDefaultDuration(e){this.defaultDuration=e}setDefaultDismissLabel(e){this.defaultDismissLabel=e}}class CS{constructor(e){g(this,"basePath","");g(this,"preferenceManager");g(this,"queryParams","");this.basePath=e,this.preferenceManager=Gs.getInstance()}setRoute(e,t=!1){window.history.pushState({},"",`/${this.basePath}/${e&&e+"/"}${this==null?void 0:this.queryParams}`),e&&this.preferenceManager.setPreference("route",e),t&&this.apply()}apply(){window.location.href=`/${this.basePath}/${this.getRoute().join("/")}${this==null?void 0:this.queryParams}`}getRoute(){var n,s;let e=window.location.href;const t=new URL(e);this.queryParams=t!=null&&t.searchParams.size?`?${t.searchParams}`:"";let i=t.origin+t.pathname;return i.endsWith("/")||(i+="/"),((s=(n=i.split(`${this.basePath}/`))==null?void 0:n[1])==null?void 0:s.split("/"))??[]}}class PS{constructor(e){g(this,"scene");g(this,"keyframes");g(this,"timeIndex",[]);g(this,"asset");this.scene=e}setAsset(e){var t,i,n;this.asset=e,(n=(i=(t=this.asset)==null?void 0:t.params)==null?void 0:i.lighting)!=null&&n.lightingKeyframes&&this.setKeyframes(this.asset.params.lighting.lightingKeyframes)}getAsset(){return this.asset}setKeyframes(e){this.keyframes=e,this.sortKeyframesByTime(),this.buildTimeIndex()}sortKeyframesByTime(){this.keyframes.sort((e,t)=>e.time-t.time)}buildTimeIndex(){this.keyframes=[...this.keyframes].sort((e,t)=>e.time-t.time),this.timeIndex=this.keyframes.map(e=>e.time)}clearKeyframes(){this.keyframes=[]}getLightingAtTime(e,t=!1){performance.now();let i=null,n=0,s=this.timeIndex.length-1,a=this.timeIndex.length;for(;n<=s&&i===null;){const c=Math.floor((n+s)/2);this.timeIndex[c]===e?i=this.keyframes[c]:this.timeIndex[c]<e?n=c+1:(a=c,s=c-1)}const r=a>0?this.keyframes[a-1]:null,l=a<this.keyframes.length?this.keyframes[a]:null;if(performance.now(),r&&!l&&!i&&(i=r),!r&&l&&!i&&(i=l),i)return t&&(this.updateHdriRotation(i.rotation),this.asset.updateBrightness(i.brightness)),i;if(l&&r){const c=G_(r.time,l.time,e),h=H_(r.rotation,l.rotation,c),d=Sh(r.brightness,l.brightness,c);return t&&(this.updateHdriRotation(h),this.asset.updateBrightness(d)),{time:e,rotation:h,brightness:d}}}updateHdriRotation(e,t,i){typeof e=="number"?(this.scene.environmentRotation.x=di(e),this.scene.environmentRotation.y=di(t),this.scene.environmentRotation.z=di(i)):(this.scene.environmentRotation.x=di(e.x),this.scene.environmentRotation.y=di(e.y),this.scene.environmentRotation.z=di(e.z))}animateAssetBrightness(e,t=2e3,i=kt.smoothstep){this.asset.animateBrightness(e,t,i)}animateHdriRotation(e,t,i,n=1e3,s=kt.smoothstep){return new Promise(a=>{const r=performance.now(),l={x:th(this.scene.environmentRotation.x),y:th(this.scene.environmentRotation.y),z:th(this.scene.environmentRotation.z)},c=h=>{const d=h-r,f=Math.min(d/n,1),p=s(f),b=l.x+(e-l.x)*p,_=l.y+(t-l.y)*p,y=l.z+(i-l.z)*p;this.updateHdriRotation(b,_,y),f<1?requestAnimationFrame(c):a()};requestAnimationFrame(c)})}animateToAssetCinemaState(e=2e3){if(!this.asset)return;const t=this.asset.params.lighting.manual;this.asset.animateBrightness(parseFloat(t.brightness)),this.animateHdriRotation(t.rotation.x,t.rotation.y,t.rotation.z,e)}animateToAssetManualState(e=2e3){var i,n,s;if(!this.asset||!((s=(n=(i=this.asset)==null?void 0:i.params)==null?void 0:n.lighting)!=null&&s.manual))return;const t=this.asset.params.lighting.manual;this.asset.animateBrightness(parseFloat(t.brightness)),this.animateHdriRotation(t.rotation.x,t.rotation.y,t.rotation.z,e)}}const Qf="data:image/svg+xml,%3csvg%20width='36'%20height='36'%20viewBox='0%200%2036%2036'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M18%204.58106L33.2476%2030.3846H2.75245L2.75245%2030.3846L18%204.58106Z'%20stroke='white'%20stroke-width='2'/%3e%3crect%20x='17'%20y='25.5'%20width='2'%20height='2'%20fill='white'/%3e%3crect%20x='17'%20y='13.5'%20width='2'%20height='9'%20fill='white'/%3e%3c/svg%3e",kS="data:image/svg+xml,%3csvg%20width='45'%20height='45'%20viewBox='0%200%2045%2045'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M20.2464%2032.6779L37.9592%2029.1271M42.1727%2026.8628C42.1727%2026.8628%2035.091%2023.4837%2030.5262%2020.4975C25.9614%2017.5113%2021.3217%2012.6881%2021.3217%2012.6881L4.12753%2023.6521C4.12753%2023.6521%2013.7125%2034.4258%2020.6329%2032.5888C24.1657%2031.651%2025.0952%2029.8305%2026.3091%2027.9128C27.4299%2026.1424%2027.9716%2025.3316%2027.9716%2025.3316C27.9716%2025.3316%2029.8644%2026.5254%2031.1216%2027.2128C32.8514%2028.1587%2034.562%2028.964%2035.7152%2029.1815C39.0638%2029.8133%2042.1727%2026.8628%2042.1727%2026.8628Z'%20stroke='white'%20stroke-width='1.5'%20stroke-linecap='round'/%3e%3c/svg%3e",IS="data:image/svg+xml,%3csvg%20width='45'%20height='45'%20viewBox='0%200%2045%2045'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M24.1365%209.18729L11.8374%206.51357C11.2141%206.37807%2010.625%206.85289%2010.625%207.49075V14.375V23.75V27.0474C10.625%2027.1404%2010.6121%2027.2328%2010.5865%2027.3222L10.0513%2029.1956C10.0174%2029.3142%2010.0057%2029.438%2010.0169%2029.5608L10.5922%2035.8894C10.6134%2036.1224%2010.7156%2036.3406%2010.881%2036.506L13.4571%2039.0821C13.6446%2039.2696%2013.899%2039.375%2014.1642%2039.375H17.9501C18.3919%2039.375%2018.75%2039.0169%2018.75%2038.5751C18.75%2038.0393%2019.2665%2037.655%2019.7798%2037.8089L24.8594%2039.3328C24.9526%2039.3608%2025.0494%2039.375%2025.1468%2039.375H33.132C33.5107%2039.375%2033.857%2039.161%2034.0264%2038.8222L34.5032%2037.8685C34.7688%2037.3375%2034.5158%2036.6934%2033.9599%2036.485L30.1492%2035.0559C30.0503%2035.0189%2029.958%2034.9664%2029.8756%2034.9005L26.875%2032.5L23.6201%2030.33C23.315%2030.1267%2023.1457%2029.7726%2023.1789%2029.4075L24.92%2010.255C24.9657%209.75239%2024.6297%209.2945%2024.1365%209.18729Z'%20stroke='white'%20stroke-width='1.5'/%3e%3c/svg%3e",LS="data:image/svg+xml,%3csvg%20width='45'%20height='45'%20viewBox='0%200%2045%2045'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M31.8958%2023.4726L32.4328%2023.3779C32.9724%2023.2828%2033.4235%2023.7887%2033.2673%2024.3139C33.1954%2024.5555%2033.252%2024.817%2033.4172%2025.0073L35.8191%2027.7739C35.8612%2027.8224%2035.9079%2027.8667%2035.9584%2027.9062L42.5921%2033.0914C43.0549%2033.4532%2043.1077%2034.1342%2042.706%2034.5629L39.4828%2038.0037C39.0268%2038.4905%2038.231%2038.4028%2037.8919%2037.8284L32.8551%2029.2968C32.5817%2028.8336%2031.9908%2028.6697%2031.5178%2028.9258L31.1416%2029.1295C30.704%2029.3665%2030.1588%2029.2456%2029.8623%2028.8459L29.5681%2028.4493C29.4756%2028.3246%2029.4134%2028.1801%2029.3865%2028.0272L29.1273%2026.5573C29.0812%2026.2961%2028.9333%2026.0639%2028.7161%2025.9118L11.0402%2013.535C10.8529%2013.4038%2010.7253%2013.2036%2010.6856%2012.9784C10.6459%2012.7532%2010.5184%2012.553%2010.331%2012.4219L4.27901%208.1842C3.76209%207.82225%203.70552%207.07787%204.16183%206.64197L4.55878%206.26276C4.89915%205.93761%205.42021%205.89385%205.81004%206.1577L31.1616%2023.316C31.3767%2023.4615%2031.64%2023.5177%2031.8958%2023.4726Z'%20stroke='white'%20stroke-width='1.5'/%3e%3c/svg%3e",RS="data:image/svg+xml,%3csvg%20width='45'%20height='45'%20viewBox='0%200%2045%2045'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M31.5%2018.125H13.5C12.9477%2018.125%2012.5%2018.5727%2012.5%2019.125V25.4627C12.5%2025.5702%2012.4827%2025.677%2012.4487%2025.779L11.3064%2029.2058C11.2691%2029.3177%2011.2123%2029.4221%2011.1386%2029.5143L8.96913%2032.2261C8.82728%2032.4034%208.75%2032.6237%208.75%2032.8508V36.4608C8.75%2036.726%208.85536%2036.9804%209.04289%2037.1679L10.3321%2038.4571C10.5196%2038.6446%2010.774%2038.75%2011.0392%2038.75H33.9608C34.226%2038.75%2034.4804%2038.6446%2034.6679%2038.4571L35.9571%2037.1679C36.1446%2036.9804%2036.25%2036.726%2036.25%2036.4608V34.375V32.8508C36.25%2032.6237%2036.1727%2032.4034%2036.0309%2032.2261L33.8614%2029.5143C33.7877%2029.4221%2033.7309%2029.3177%2033.6936%2029.2058L32.5513%2025.779C32.5173%2025.677%2032.5%2025.5702%2032.5%2025.4627V19.125C32.5%2018.5727%2032.0523%2018.125%2031.5%2018.125Z'%20stroke='white'%20stroke-width='1.5'%20class='svg-icon-hover'/%3e%3cmask%20id='path-2-inside-1_1417_4451'%20fill='white'%3e%3crect%20x='11.875'%20y='6.25'%20width='21.25'%20height='8.75'%20rx='1'%20/%3e%3c/mask%3e%3crect%20x='11.875'%20y='6.25'%20width='21.25'%20height='8.75'%20rx='1'%20stroke='white'%20stroke-width='3'%20mask='url(%23path-2-inside-1_1417_4451)'%20class='svg-icon-hover'/%3e%3cpath%20d='M13.125%2014.375V18.125'%20stroke='white'%20stroke-width='1.5'/%3e%3cpath%20d='M31.875%2014.375V18.125'%20stroke='white'%20stroke-width='1.5'/%3e%3c/svg%3e",DS="/mouthful-of-dust/assets/Onboard-DeathMask-S-CIgYn1Ru.svg";class FS{constructor(){g(this,"aocVisible",!0);g(this,"preferenceManager");g(this,"scene");g(this,"camera");g(this,"renderer");g(this,"composer");g(this,"clock");g(this,"fxaaPass");g(this,"renderPass");g(this,"toneMappingPass",null);g(this,"actManager");g(this,"audioManager");g(this,"assetManager");g(this,"performanceManager");g(this,"sessionsManager");g(this,"toastManager");g(this,"letterOverlayManager");g(this,"routeManager");g(this,"initRouting",!1);g(this,"lightingManager");g(this,"environmentManager");g(this,"onboardingManager");g(this,"cameraPathAnimator");g(this,"textureLoader");g(this,"uiManager");g(this,"audioPlayer");g(this,"menu");g(this,"benchmarker");g(this,"keyboardEventListener",null);g(this,"animationMultiplyFactor",1);g(this,"shouldRender",!1);g(this,"transitionInProgress",!1);g(this,"loader");g(this,"loaderGroup");g(this,"mainLoader");g(this,"introLoaderGroup");g(this,"deviceInfo",null);g(this,"act3ManualPos",null);g(this,"act3ManualLookAt",null);g(this,"profileTimeout");g(this,"initialiseStarted",!1);g(this,"initialLodConfigs",null);g(this,"cameraMode","cinema");g(this,"cameraModeTransitioning",!1);g(this,"ambientLight",null);g(this,"introTimeouts",[]);g(this,"mode","quality");g(this,"targetFrameRate",nm);g(this,"introSequence");g(this,"stats");g(this,"frames",0);g(this,"prevTime",performance.now());g(this,"lastPlaybackTime",0);g(this,"resumePlaybackTime",0);g(this,"renderFrameInterval",1e3/30);g(this,"renderLastFrameTime",0);g(this,"postProcessingInitalised",!1);g(this,"baseFogNear",50);g(this,"baseFogFar",200);g(this,"audioContext");g(this,"masterGainNode");g(this,"currentObject",null);g(this,"assetLoaderEstimateElement",null);g(this,"capturedKeyframes",[]);g(this,"userInteractionTimeout");g(this,"userInteractionDuration",0);g(this,"userInteractionCallback",null);g(this,"menuActive",!1);g(this,"letterPapers",null);g(this,"letterCastTimeout",!1);g(this,"cameraPlayer",null);g(this,"skinnedAnimationController",null);g(this,"deviceProfiled",!1);g(this,"constructorComplete",!1);g(this,"isTitleAnimating",!1);g(this,"titleWantsToPlay",!1);g(this,"assetsBeingProccessed",!1);g(this,"experienceStarted",!1);g(this,"actThreeStarted",!1);g(this,"setupThreeScene",()=>{var n;this.scene=new Id,this.lightingManager=new PS(this.scene);let e=f_;(n=this.deviceInfo)!=null&&n.isMobile&&(e=p_),this.renderer=new Vb({...e}),this.renderer.toneMapping=Rl,this.scene.environmentRotation.y+=1,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.ambientLight=new Ew(4210752),this.ambientLight.intensity=30,this.scene.add(this.ambientLight),this.renderer.domElement.setAttribute("aria-hidden","true");const t=document.getElementById("app-root");t&&t.appendChild(this.renderer.domElement),this.camera.initControls(this.renderer);const i=document.getElementById("act-two__photo-plane-img");i.src=Un("slv-a-mouthful-of-dust/media/images/173741834b4cf/28.png",1200,0),window.addEventListener("resize",this.onWindowResize,!1),this.onWindowResize(),setTimeout(()=>{this.onWindowResize()},100)});g(this,"initPostProcessing",()=>{this.renderer.toneMapping=Rl,this.renderer.toneMappingExposure=.25,this.composer=new Yw(this.renderer),this.renderPass=new Zw(this.scene,this.camera.camera),this.composer.addPass(this.renderPass),this.fxaaPass=new eu(Kw);const e=this.renderer.getPixelRatio();this.fxaaPass.material.uniforms.resolution.value.set(1/(window.innerWidth*e),1/(window.innerHeight*e)),this.composer.addPass(this.fxaaPass);const t=new e_;this.composer.addPass(t),this.toneMappingPass=t;const i=new Jw;this.composer.addPass(i),Ye({toneMapping:this.renderer.toneMapping,exposure:this.renderer.toneMappingExposure,passes:this.composer.passes.map(n=>n.constructor.name)}),this.postProcessingInitalised=!0});g(this,"onWindowResize",()=>{const e=document.getElementById("loading-card__awards");e&&(e.clientWidth>window.innerWidth?e.classList.add("ticker"):e.classList.remove("ticker"));const t=window.innerWidth/window.innerHeight;if(this.camera.onWindowResize(t),this.renderer.setSize(window.innerWidth,window.innerHeight),this.composer&&this.composer.setSize(window.innerWidth,window.innerHeight),this.fxaaPass){const i=this.renderer.getPixelRatio();this.fxaaPass.material.uniforms.resolution.value.set(1/(window.innerWidth*i),1/(window.innerHeight*i))}});g(this,"addLights",async()=>{});g(this,"calculateFrameRate",()=>{this.frames++;const e=performance.now();let t=0;return e>=this.prevTime+1e3&&(t=Math.round(this.frames*1e3/(e-this.prevTime)),this!=null&&this.benchmarker&&this.actManager.act2Ready&&this.benchmarker.checkPerformance(t),this.frames=0,this.prevTime=e),t});g(this,"render",e=>{if(!this.shouldRender||e-this.renderLastFrameTime<=this.renderFrameInterval)return;if(this.renderLastFrameTime=e-(e-this.renderLastFrameTime)%this.renderFrameInterval,this.actManager.getAct()===3&&this.actThreeStarted&&this.cameraPlayer&&this.audioPlayer&&!this.audioPlayer.getIsPlaying()&&this.cameraPlayer.syncCameraWithTarget(),this.actManager.getAct()===3&&this.camera.cameraController.currentMode==="pan"&&this.cameraMode==="manual"&&!this.cameraModeTransitioning&&!this.letterCastTimeout){this.letterCastTimeout=!0,setTimeout(()=>{this.letterCastTimeout=!1},100),this.letterPapers||(this.letterPapers=this.skinnedAnimationController.getSkinnedMesh().children.find(n=>n.name==="Paper_Clone"));const i=this.letterOverlayManager.raycastFromCenter(this.camera.camera,this.letterPapers.children,{rings:[{radius:0,points:1}],distance:15});i&&this.letterOverlayManager.handlePageDetection(i.object.parent.parent.parent)}this.adjustSaturation(1.35),this.calculateFrameRate();const t=this.clock.getDelta();if(this.assetManager.assets.forEach(i=>{i.update(t)}),!!this.postProcessingInitalised&&(this.composer&&this.postProcessingInitalised?this.composer.render():console.warn("Composer not ready. Skipping render."),this.cameraPathAnimator.isCurrentlyAnimating()||this.camera.animate(),this.menuActive)){const i=this.camera.checkIntersections(this.menu.menuColliders);if(i){const{intersection:n,centerOffset:s,distance:a}=i,r=n.object,l=1-Math.abs(s-.5)*2,c=.9,h=.3;let d;l>=1-h?d=1:l<=1-c?d=0:d=xn(l,1-c,1-h,0,1,!0,kt.easeInOutCubic);const b=xn(a,179,130,0,1,!0,kt.easeInOutCubic),_=Math.min(d,b);this.showItemInfo(r,_)}else this.hideItemInfo()}});g(this,"handleActChange",async e=>{this.unbindKeyboardControls(),e===1&&this.preferenceManager.getPreference("skip-aoc",!1)&&(this.toastManager.setIsActive(!0),document.getElementById("aoc-inner")&&(document.body.classList.add("skip-aoc"),this.aocVisible=!1,this.preferenceManager.removePreference("skip-aoc"),await bi(600),this.titleWantsToPlay=!0,this.playTitleAnimation(),this.uiManager.setActiveElement("loading-card"))),e===2&&(this.audioManager.hasLowPassFilter("act2Ambient")||this.audioManager.addLowPassFilter("act2Ambient",0),this.audioManager.hasLowPassFilter("act3Ambient")||this.audioManager.addLowPassFilter("act3Ambient",0),this.camera.cameraController.triggerZoomChange(),this.audioManager.isTrackPlaying("act2Ambient")||(this.audioManager.playTrack("act2Ambient",{loop:!0}),this.audioManager.playTrack("act3Ambient",{loop:!0}),this.audioManager.setTrackVolume("act2Ambient",1e-4),this.audioManager.setTrackVolume("act3Ambient",1e-4)),setTimeout(()=>{this.audioManager.fadeTrack("act2Ambient",{duration:1e3,targetVolume:1})},100),this.bindKeyboardControls(2)),e===3&&this.bindKeyboardControls(3)});g(this,"initialiseAssetLoad",async(e="full")=>{var b;if(this.initialiseStarted||(this.initialiseStarted=!0,this.sessionsManager.addSessionData("initialiseStarted",!0),this.sessionsManager.addSessionData("buildVer",ql),this.introSequence))return;const t=this.audioManager.getGroupGainNode("voice");let i=null;e==="full"&&(i=await this.generateIntroSequenceAssetManifest(t,"full"));const n=[],s=this.createAudioLoadGroupConfig("ui-audio",m_,20);n.push(s),await this.assetManager.loadAssetData(Li("data.json")),this.initialLodConfigs=this.performanceManager.createInitialLODConfigsForDevice();const a=this.assetManager.getRequiredCameraAnimations(),r=this.assetManager.getRequiredFilesForLODConfigs(this.initialLodConfigs);r.push({type:"model",id:"letter_Letter_Viewer",url:"https://d38p9xpr4rdpkc.cloudfront.net/slv-a-mouthful-of-dust/media/3d-models/175008306b6bf/letter.viewer.glb",options:{meshQuality:"Viewer",modelName:"Letter",assetKey:"letter"}});const c=this.preferenceManager.getPreference("graphics-preset","low")==="low"?"audioFilesSharedTiny":"audioFilesSharedFull",{[c]:h}=await ep(async()=>{const{[c]:_}=await import("./index-AoDRuvkX.js");return{[c]:_}},[]),d=this.createAudioLoadGroupConfig("experience-audio-shared",h,4);n.push(d),this.assetManager.assets.forEach(_=>{if([_.key,"full","menu","rifle","boot","mask","letter","armour"].includes(e)){let y=null;switch(_.key){case"mask":y=g_;break;case"rifle":y=v_;break;case"armour":y=b_;break;case"letter":y=w_;break;case"boot":y=y_;break}const v=this.createAudioLoadGroupConfig(`experience-audio-${_.key}`,y,4);n.push(v)}});let f={name:"splat-assets",manualComplete:!0,priority:2,assets:[{id:"splat-data",type:Ii.SPLAT,url:u_}],onProgress:_=>{this.mainLoader.updateLabel("Fetching splat...")},onComplete:async(_,y)=>{this.processSplat(_,y)}};(b=this.performanceManager)!=null&&b.enableSplat||(f={name:"splat-assets",manualComplete:!0,priority:2,assets:[{id:"splat-data",type:Ii.IMAGE,url:Un(d_,2e3,0)}],onProgress:_=>{this.mainLoader.updateLabel("Fetching environment...")},onComplete:async(_,y)=>{var S;this.isTitleAnimating&&await bi(500),this.mainLoader.updateLabel("Processing environment...");const v=_.find(A=>A.id==="splat-data");v&&(await this.assetManager.loadSplatFromBuffer(null),this.environmentManager.addSkyBox((S=v==null?void 0:v.data)==null?void 0:S.src),this.environmentManager.show(),this.environmentManager.setBrightness(0),y.markAsComplete(),y.cleanup(1))}});const p={name:"main-app-assets",children:[i,...n,{name:"hdri-assets",priority:3,manualComplete:!0,assets:[{id:"hdri",type:Ii.HDRI,url:`${ti}/slv-a-mouthful-of-dust/media/other/1743993493999/env.hdr`}],onProgress:_=>{this.mainLoader.updateLabel("Fetching HDRI...")},onComplete:async(_,y)=>{this.processHdri(_,y)}},{name:"camera-animations",priority:5,assets:a,manualComplete:!0,onProgress:_=>{a.length>0&&this.mainLoader.updateLabel("Fetching camera animations...")},onComplete:async(_,y)=>{this.processCameraAssets(_,y)}},f,{name:"model-assets",priority:6,assets:r,manualComplete:!0,onProgress:_=>{(_==null?void 0:_.percentage)<50?this.mainLoader.updateLabel("Fetching meshes..."):this.mainLoader.updateLabel("Fetching textures...")},onComplete:async(_,y)=>{this.processModelAssets(_,y)}}],onProgress:_=>{const y=N_(_.stableEstimatedTimeRemaining);this.assetLoaderEstimateElement||(this.assetLoaderEstimateElement=document.getElementById("loader-estimate")),this.assetLoaderEstimateElement&&(this.assetLoaderEstimateElement.innerHTML=y);const v=document.getElementById("loader-wrapper");v&&v.setAttribute("aria-label",`Loading time remaining: ${y}`),this.mainLoader.updateFromLoadGroupProgress({loaded:_.loaded,total:_.total,percentage:_.percentage,currentItem:_.currentAsset,bytesLoaded:_.bytesLoaded,totalBytes:_.totalBytes,currentSpeed:_.currentSpeed,averageSpeed:_.averageSpeed,estimatedTimeRemaining:_.estimatedTimeRemaining})},onComplete:async()=>{this.finaliseAssetLoad()},onError:_=>{console.error("Errors in main-app-assets load group:",_)}};this.preferenceManager.setPreference("asset-load-start",!0),this.assetManager.loadQueueManager.addGroup(p),this.mainLoader.updateLabel("Fetching intro audio...")});g(this,"updateSoundIcons",()=>{document.querySelectorAll(".sound-button").forEach(t=>{if(t instanceof HTMLElement){t.classList.toggle("sound-enabled",!this.audioManager.isMuted());const i=this.audioManager.isMuted()?"Unmute sound":"Mute sound";t.setAttribute("aria-label",i)}})});g(this,"toggleIntroSequenceTracks",()=>{const e=document.getElementById("intro-sequence-toggle-ad");e&&(this.introSequence.getCurrentTrackType()==="default"?(this.sessionsManager.addSessionData("playActOneAd",!0),this.introSequence.switchAudioTrack("audio-description"),e.classList.add("active"),this.uiManager.playUISound("click"),this.uiManager.makeScreenReaderAnnouncement("Audio description playing"),e.setAttribute("aria-label","Stop audio description")):(this.introSequence.switchAudioTrack("default"),e.classList.remove("active"),this.uiManager.playUISound("clack"),this.uiManager.makeScreenReaderAnnouncement("Audio description stopped"),e.setAttribute("aria-label","Audio describe slideshow images")))});g(this,"toggleActTwoAudioDescriptionPlayback",e=>{const t=document.getElementById("act-two__ui-toggle-ad");if(t)if(this.audioManager.isTrackPlaying("act2Ad"))this.audioManager.stopTrack("act2Ad",!0),t.classList.remove("active"),this.uiManager.playUISound("clack");else{if(this.sessionsManager.addSessionData("playActTwoAd",!0),e)return;this.audioManager.playTrack("act2Ad"),this.uiManager.playUISound("click"),this.audioManager.addEventListener("act2Ad","complete",this.onActTwoAudioDescriptionComplete),t.classList.add("active")}});g(this,"onActThreeAudioDescriptionComplete",e=>{this.audioManager.removeEventListener(e,"complete",this.onActThreeAudioDescriptionComplete);const t=document.getElementById("act-three__ui-toggle-ad");t&&(this.audioManager.stopTrack(e),t.classList.remove("active"))});g(this,"onActTwoAudioDescriptionComplete",()=>{this.audioManager.removeEventListener("act2Ad","complete",this.onActTwoAudioDescriptionComplete);const e=document.getElementById("act-two__ui-toggle-ad");e&&(this.audioManager.stopTrack("act2Ad"),e.classList.remove("active"))});g(this,"toggleActThreeAudioDescriptionPlayback",e=>{var s,a,r;const t=document.getElementById("act-three__ui-toggle-ad");if(!t)return;const n=`${`act3${O_((r=(a=(s=this.currentObject)==null?void 0:s.userData)==null?void 0:a.asset)==null?void 0:r.key)}`}Ad`;if(this.audioManager.isTrackPlaying(n))this.audioManager.stopTrack(n,!0),t.classList.remove("active"),this.uiManager.playUISound("clack"),(this.camera.cameraController.currentMode!=="pan"||this.cameraMode!=="manual")&&this.audioPlayer.startPlayback(),this.updatePlayPauseButton();else{if(this.sessionsManager.addSessionData("playActThreeAd",!0),e)return;this.uiManager.playUISound("click"),this.audioPlayer.pausePlayback(l=>{}),this.updatePlayPauseButton(),this.audioManager.playTrack(n),this.audioManager.addEventListener(n,"complete",()=>{this.onActThreeAudioDescriptionComplete(n)}),t.classList.add("active")}});g(this,"handleIntroSequenceReady",()=>{this.enableRender(),this.uiManager.makeScreenReaderAnnouncement("Loading complete. Experience ready to start."),this.assetLoaderEstimateElement||(this.assetLoaderEstimateElement=document.getElementById("loader-estimate")),this.assetLoaderEstimateElement&&(this.assetLoaderEstimateElement.innerHTML="0 sec");const e=document.getElementById("loading-card"),t=document.getElementById("start-button"),i=document.getElementById("loading-card__tip"),n=document.getElementById("intro-sequence"),s=document.getElementById("loader-wrapper");e&&t&&n&&s&&i&&(t.style.opacity="0",i.style.opacity="0",s.style.opacity="0",setTimeout(()=>{t.style.opacity="1",i.style.opacity="1",t.style.pointerEvents="auto",t.style.cursor="pointer",t.removeAttribute("aria-hidden"),s.classList.add("hidden")},1200),document.body.classList.add("ready"),$t(["start-button"],async()=>{var r,l;if(this.experienceStarted)return;this.experienceStarted=!0,this.sessionsManager.addSessionData("experienceStarted",!0),this.uiManager.hideSplashSubtitle(),await bi(100),this.uiManager.stopSplashAnimation(),this.uiManager.playSplashAnimationSegment();const a=this.actManager.getAct();if(a===2||a===3){const c=((r=this.routeManager.getRoute())==null?void 0:r[0])==="death-mask"?"mask":(l=this.routeManager.getRoute())==null?void 0:l[0];this.uiManager.screenWipeUp();const h=this.audioManager.getMasterVolume();W_({value:0,target:h,duration:4e3,updateFunc:f=>{this.audioManager.setMasterVolume(f)}}),this.prepareActTwo(),this.finishIntroSequence(!1),this.uiManager.hideTriggerWarning();const d=document.getElementById("splash-screen");d&&d.remove(),setTimeout(()=>{this.skipOnboarding(),setTimeout(()=>{this.enableRender(),setTimeout(()=>{a===3?(this.routeManager.setRoute(`${c==="mask"?"death-mask":c}`),this.resumePlaybackTime=parseInt(this.preferenceManager.getPreference("lastPlayback","0")),setTimeout(()=>{this.transitionToAct3(c)},2e3)):setTimeout(()=>{this.removeSceneLoader(),this.uiManager.screenWipeDown()},2e3)},100)},200)},100);return}this.clearLastPlayback(),this.routeManager.setRoute("intro"),this.uiManager.uiAnimExit("splash-screen",()=>{e.style.display="none",this.uiManager.updateFocusableElements("content-warning"),this.uiManager.showTriggerWarning(),setTimeout(()=>{this.uiManager.hideTriggerWarning(),this.uiManager.updateFocusableElements("intro-sequence"),this.uiManager.setActiveElement("act-one")},5e3),setTimeout(()=>{this.uiManager.uiAnimEnter("intro-sequence",()=>{})},5e3)}),setTimeout(()=>{setTimeout(()=>{const h=document.getElementById("splash-screen");h&&h.remove()},2e3);const c=this.sessionsManager.createAction({label:"act-one-sequence",isActive:!0,params:{time:0,progress:0}});this.introSequence.startPlayback(h=>{this.sessionsManager.updateActionParams(c,{time:h.currentTime,progress:h.progress});const d=document.getElementById("intro-sequence-progress");if(d.style.width=`${h.progress}%`,h.progress>88){if(!this.audioManager.isTrackPlaying("act1Transition")){const f=h.totalTime*.88,p=h.currentTime-f;this.audioManager.playTrack("act1Transition",{startTime:p,fadeIn:{duration:1e3},fadeOut:{duration:2e3}})}}else this.audioManager.isTrackPlaying("act1Transition")&&this.audioManager.stopTrack("act1Transition")})},5010)}))});g(this,"showSkipButton",()=>{setTimeout(()=>{const e=document.getElementById("intro-sequence-skip"),t=document.getElementById("intro-sequence-loader");this.prepareActTwo(),e&&t&&(t.style.display="none",e.style.display="flex",$t("intro-sequence-skip",()=>{this.finishIntroSequence(),this.introSequence.stopPlayback(),this.uiManager.makeScreenReaderAnnouncement("Intro sequence skipped")}))},10)});g(this,"finishIntroSequence",async(e=!0)=>{document.body.classList.remove("isDragging"),e&&this.routeManager.setRoute("menu"),this.enableRender(),this.setupGlobalInteractionListeners(),this.introTimeouts.forEach(s=>clearTimeout(s)),this.introTimeouts=[];const t=document.getElementById("splash-screen"),i=document.getElementById("act-one"),n=document.getElementById("act-two");this.actManager.changeAct(2),this.uiManager.updateFocusableElements("act-two"),this.introTimeouts.push(setTimeout(async()=>{n&&(n.classList.remove("hidden"),this.uiManager.setActiveElement("act-two"),this.introSequence&&this.introSequence.cleanup(),this.introSequence=null),await bi(10),i&&(i.style.display="none"),t&&(t.style.display="none"),await bi(10),i&&i.remove()},1)),this.introTimeouts.push(setTimeout(()=>{this.environmentManager.setBrightness(0),this.environmentManager.setBrightnessMax(1),this.environmentManager.animateEnvironmentBrightness(1,4e3)},2e3/this.animationMultiplyFactor)),this.menu.hideAll(10),this.introTimeouts.push(setTimeout(async()=>{var a,r;this.introTimeouts.push(setTimeout(async()=>{document.getElementById("act-two__photo-plane").classList.add("hide")},1500/this.animationMultiplyFactor));const s=new et(((a=this.camera.cameraController)==null?void 0:a.getIdleSpeedX())||0,((r=this.camera.cameraController)==null?void 0:r.getIdleSpeedY())||0);this.introTimeouts.push(setTimeout(async()=>{var c,h;this.menuActive=!0,(c=this.camera.cameraController)==null||c.resetMotionWithVelocity(new et(0,0),s);const l=new D().subVectors(this.camera.camera.position,new D(0,0,0)).normalize();(h=this.camera.cameraController)==null||h.initialiseAnchorPosition(l),this.cameraPathAnimator.stop(),this.camera.cameraController.synchroniseWithCamera(),this.beginOnboardingSequence()},3e3))},5e3/this.animationMultiplyFactor))});g(this,"beginOnboardingSequence",()=>{this.uiManager.initOnboarding(),this.onboardingManager.beginSequence(),setTimeout(()=>{this.uiManager.showOnboardingSkipButton()},2e3)});g(this,"enableHideUI",()=>{this.setUserInteractionTimeout(5e3,()=>{this.uiManager.hideUI()})});g(this,"disableHideUi",()=>{this.resetUserInteractionTimeout()});g(this,"finishOnboarding",()=>{this.removePhotoPlane(),this.camera.cameraController.setMaxRotationSpeed(10),this.preferenceManager.setPreference("onboarding-complete",!0),this.onboardingManager.cleanup(),this.enableHideUI()});g(this,"showActTwoMenuButton",()=>{const e=document.getElementById("act-two__sequence-skip");e&&e.classList.add("hidden");const t=document.getElementById("act-two__ui-open-menu");t&&t.classList.remove("hidden")});g(this,"skipOnboarding",async()=>{var t;this.removePhotoPlane(),this.onboardingManager.disableOnboarding(),this.environmentManager.cancelSplatBrightnessAnimation(),this.environmentManager.cancelSkyboxBrightnessAnimation(),this.environmentManager.setBrightness(.1),this.introTimeouts.forEach(i=>clearTimeout(i)),this.introTimeouts=[],this.camera.camera.position.copy(h_),this.camera.camera.lookAt(hf);const e=new D().subVectors(this.camera.camera.position,new D(0,0,0)).normalize();(t=this.camera.cameraController)==null||t.initialiseAnchorPosition(e),this.camera.cameraController.synchroniseWithCamera(),this.onboardingManager.finishSequence(!0),this.uiManager.hideOnboardingPane(null,!0),this.camera.cameraController.resetInteractionTime(),this.camera.cameraController.setShouldApplyIdleOrbit(!0),this.showActTwoMenuButton(),this.cameraPathAnimator.stop(),this.camera.setAct2Controls(),await this.menu.setAllBrightness(1),await this.menu.showAllWithOpacity(1),this.environmentManager.setBrightnessMax(1),this.camera.cameraController.triggerZoomChange(),this.environmentManager.setSplatForTransparency(),await bi(100),setTimeout(async()=>{this.menuActive=!0,this.showMenuNavButtons()},100),this.environmentManager.setSplatForOcclusion(),this.onboardingManager.showIcons(),this.finishOnboarding()});g(this,"onUserInteraction",()=>{this.resetUserInteractionTimeout()});g(this,"showMenuNavButtons",()=>{const e=document.getElementById("act-two__ui-right-zone"),t=document.getElementById("act-two__ui-left-zone");!t||!e||(e.classList.remove("hidden"),t.classList.remove("hidden"))});g(this,"createAudioLoadGroupConfig",(e,t,i=1)=>{const n=Object.entries(t).map(([s,a])=>({type:Ii.AUDIO,id:s,url:a.url,options:{...a.options,group:a.group},priority:i}));return{name:e,priority:i,assets:n,onProgress:s=>{},onComplete:async(s,a)=>{try{for(const r of s)await this.audioManager.loadTrack(r.id,r.data,r.options);Ye(`All ${e} loaded successfully`)}catch(r){console.error(`Error processing ${e}:`,r)}finally{this.assetManager.loadQueueManager.cleanupGroup(e)}},onError:s=>{s.forEach(a=>{console.error(`Failed to load audio track ${a.assetId}:`,a.error)})}}});g(this,"loadAudioAssets",(e,t,i=1)=>{const n=Object.entries(t).map(([s,a])=>({type:Ii.AUDIO,id:s,url:a.url,options:{...a.options,group:a.group}}));this.assetManager.createLoadGroup({name:e,priority:i,assets:n,onProgress:s=>{},onComplete:async s=>{try{for(const a of s)await this.audioManager.loadTrack(a.id,a.data,a.options);console.log(`All ${e} loaded successfully`),Ye(`All ${e} loaded successfully`)}catch(a){console.error(`Error processing ${e}:`,a)}finally{this.assetManager.loadQueueManager.cleanupGroup(e)}},onError:s=>{s.forEach(a=>{console.error(`Failed to load audio track ${a.assetId}:`,a.error)})}})});g(this,"initObjectSelectMenu",()=>{this.addLights(),this.menu.createObjectSelectMenu(this.assetManager.assets)});g(this,"initThreeControls",(e,t)=>{const i=new tm(e,t.domElement);return i.minDistance=0,i.maxDistance=200,e.position.set(0,0,5),i.target.set(0,0,0),i.update(),i});g(this,"setAssetQuality",e=>{let t="",i="";switch(e){case"tiny":t="low",i="low";break;case"low":t="low",i="medium";break;case"med":t="medium",i="high";break;default:t="medium",i="high";break}this.assetManager.assets.forEach(n=>{n.updateViewStateQuality("menuView",t),n.updateViewStateQuality("detailView",i)})});g(this,"applyQueryParamSettings",()=>{const e=k_();if(Object.keys(e).length!==0&&"mode"in e)if(e.mode==="performance"||e.mode==="quality"||e.mode==="impossible"){this.mode=e.mode;const t=I_(this.mode);this.targetFrameRate=t,Ye(`Mode set to: ${this.mode} [${this.targetFrameRate}fps]`)}else Ye(`Invalid mode: ${e.mode}. Using default mode: ${this.mode}`)});g(this,"handleBlur",()=>{this.actManager&&this.disableRender()});g(this,"handleFocus",()=>{this.actManager&&this.actManager.getAct()!==1&&this.enableRender()});g(this,"onCameraZoomChange",e=>{var r,l,c;let t=(r=e==null?void 0:e.detail)==null?void 0:r.zoomPercentage;if(!t||((l=this==null?void 0:this.actManager)==null?void 0:l.getAct())===3)return;let i;t<=0?i=.1:t>=.7?i=1:i=xn(t,0,.9,.1,1,!0,kt.easeOutCubic);const n=.2,s=.65;if(t<=.2)document.body.style.setProperty("--dot-opacity",s.toString());else if(t>=.7)document.body.style.setProperty("--dot-opacity",n.toString());else{const h=xn(t,.2,.7,s,n,!1,kt.easeOutCubic);document.body.style.setProperty("--dot-opacity",h.toString())}this.environmentManager.setBrightness(i);const a=this.camera.calculateZoomBlendFactor(this.camera.cameraController.getMinZoom()+5,this.camera.cameraController.getMaxZoom());if(this.camera.calculateBlendedFOV(1-a),((c=this==null?void 0:this.actManager)==null?void 0:c.getAct())===2){const h=Et.smoothstep(t,.13,1),d=Et.smoothstep(t,0,.19),f=Math.sqrt(h),p=Math.sqrt(1-d),b=.05;this.audioManager.setTrackVolume("act2Ambient",Math.max(b,f)),this.audioManager.setTrackVolume("act3Ambient",Math.max(b,p));const _=An(t,.12,1,200,2e4,!0,kt.easeInOutQuad),y=An(t,0,.2,2e4,200,!0,kt.easeInOutQuad);this.audioManager.setLowPassFrequency("act2Ambient",_),this.audioManager.setLowPassFrequency("act3Ambient",y)}});g(this,"transitionToAct3",async e=>{var y,v,S,A,E,O,R,k,U,C,T,Z,z,B,V;if(this.transitionInProgress||(this.actThreeStarted=!1,this.clearLastPlayback(),this.camera.controls.target.set(0,0,0),this.transitionInProgress=!0,this.toggleActTwoAudioDescriptionPlayback(!0),this.cameraMode="cinema",this.currentObject=this.menu.getColliderByName(e)||this.menu.getHighlightedItem(!0),!this.currentObject))return;const t=(y=this.currentObject.userData.asset.params)==null?void 0:y.audioTrack;this.audioManager.isTrackAvailable(t)||await this.reloadAudioTrack(t),this.camera.cameraController.setIdleForceMultiplier(5),this.uiManager.updateFocusableElements("act-three"),this.uiManager.uiAnimExit("act-two"),this.uiManager.removeLetterScreenReaderDescriptions(),this.actManager.changeAct(3);const n=e?1:4e3,{position:s,intersectionPoint:a}=this.menu.calculateCameraPositionForMenuItem(this.currentObject,((E=(A=(S=(v=this.currentObject)==null?void 0:v.userData)==null?void 0:S.asset)==null?void 0:A.params)==null?void 0:E.defaultZoom)||85,!0);this.menu.hideAllExcept(this.currentObject,n),this.uiManager.makeScreenReaderAnnouncement("Starting transition");const r=this.menu.getCameraCollisionMeshForItem(this.currentObject);this.camera.setAct3Controls(r),this.camera.cameraController.setRestingPositions(null,Math.PI/2,null);const l=this.currentObject.userData.asset;this.routeManager.setRoute(`${l.key==="mask"?"death-mask":l.key}`);const c=document.getElementById("act-three__object-description");c&&((O=l==null?void 0:l.params)!=null&&O.alt)&&c.setAttribute("aria-label",`Object description: ${l.params.alt}`),(k=(R=l==null?void 0:l.params)==null?void 0:R.lighting)!=null&&k.lightingKeyframes&&this.lightingManager.setAsset(l);const h=this.lightingManager.getLightingAtTime(0);if(this.lightingManager.animateHdriRotation(h.rotation.x,h.rotation.y,h.rotation.z,n),this.lightingManager.animateAssetBrightness(h.brightness,n),this.sessionsManager.addSessionData(`enterActThree${xh(l==null?void 0:l.key)}`,!0),(l==null?void 0:l.key)==="letter"?(this.uiManager.hideCameraMode(),this.camera.cameraController.removeCollisionMesh()):this.uiManager.showCameraMode(),(U=l==null?void 0:l.params)!=null&&U.cameraAnimation)switch(((T=(C=l==null?void 0:l.params)==null?void 0:C.cameraAnimation)==null?void 0:T.type)||"basic"){case"basic":case"adaptive-fov":this.cameraPlayer=l.cameraAnimationPlayer.clone();break;case"built-in":this.cameraPlayer=l.cameraAnimationPlayer.clone(),this.skinnedAnimationController||(this.skinnedAnimationController=l.skinnedAnimationController),this.skinnedAnimationController.connectCameraPlayer(this.cameraPlayer),this.skinnedAnimationController.animateSegment({from:0,to:100,duration:n,easing:kt.easeInOutCubic,onComplete:()=>{this.skinnedAnimationController.softResetAction()}});break;case"multi-object":this.cameraPlayer=l.multiObjectAnimationPlayer.clone(),this.cameraPlayer.animateSegment({from:0,to:100,duration:n,easing:kt.easeInOutCubic});break}this.cameraPlayer&&this.setCameraAnimationPlayerKeyboardInversion(),this.camera.cameraController.setShouldApplyIdleOrbit(!1),setTimeout(()=>{l.setQualityState("detailView"),this.camera.setCameraNear(.01)},n/2);const d=new ri;d.up.copy(this.camera.camera.up),d.position.copy(s),d.lookAt(new D(0,0,0)),d.rotateY(Math.PI),this.cameraPlayer&&this.cameraPlayer.calibrateAnimation(d.quaternion);const f=this.cameraPlayer?this.cameraPlayer.getCameraTargetWorldPosition():null,p=this.cameraPlayer?this.cameraPlayer.getCameraTargetWorldQuaternion():null,b=f&&p?mf(f,p):new D(0,0,0);f&&b&&(this.act3ManualPos=f,this.act3ManualLookAt=b),this.cameraPlayer&&(this.camera.cameraController.setEnabled(!1),this.camera.controls.enabled=!1);const _=(Z=this.currentObject.userData.asset.params)==null?void 0:Z.audioTransitionTrack;if(_&&!e&&this.audioManager.playTrack(_,{createInstance:!0}),await Promise.all([this.menu.moveItemToOrigin(this.currentObject,n),l.key!=="armour"?this.menu.animateAssetViewTransforms(l,n):null,this.environmentManager.animateEnvironmentBrightness(0,n),new Promise(Y=>{this.menu.animateCameraToPosition(f||s,b||new D(0,0,0),n),setTimeout(Y,n)}),this.audioManager.fadeTrack("act2Ambient",{duration:n,targetVolume:1e-4})]),Ye(["Camera position after animation start:",{position:{x:this.camera.camera.position.x.toFixed(2),y:this.camera.camera.position.y.toFixed(2),z:this.camera.camera.position.z.toFixed(2)},rotation:{x:Et.radToDeg(this.camera.camera.rotation.x).toFixed(2),y:Et.radToDeg(this.camera.camera.rotation.y).toFixed(2),z:Et.radToDeg(this.camera.camera.rotation.z).toFixed(2)},lookingAt:a}]),this.environmentManager.hide(),this.audioPlayer=new lS(this.audioManager,(z=this.currentObject.userData.asset.params)==null?void 0:z.audioTrack,"act-three__subtitle-container",25,{onTrackNotFound:async(Y,J)=>{J==="stall"&&this.toastManager.addToast({message:"Browser tab was suspended. Unable to restore. Please refresh the page.",icon:Qf})},onProgress:Y=>{if(this.cameraPlayer){this.cameraPlayer.setTime(Y.currentTime),this.cameraMode==="cinema"&&!this.cameraModeTransitioning&&this.lightingManager.getLightingAtTime(Y.currentTime,!0);const J=Y.currentTime.toFixed(0);Math.abs(J-this.lastPlaybackTime)>1&&(this.lastPlaybackTime=J,this.preferenceManager.setPreference("lastPlayback",J)),this.updatePlayPauseButton()}},onPlay:()=>{this.audioManager.fadeTrack("act3Ambient",{duration:2e3,targetVolume:.001}),this.toggleActThreeAudioDescriptionPlayback(!0),this.updatePlayPauseButton()},onDragStart:()=>{var Y,J;this.uiManager.isModalOpen||((Y=this==null?void 0:this.cameraPlayer)==null||Y.setUserOffset(!1),(J=this==null?void 0:this.cameraPlayer)==null||J.setControlsActive(!1))},onDragEnd:()=>{var Y,J;this.uiManager.isModalOpen||((Y=this==null?void 0:this.cameraPlayer)==null||Y.setUserOffset(!0),(J=this==null?void 0:this.cameraPlayer)==null||J.setControlsActive(!0))},onPause:()=>{this.audioManager.fadeTrack("act3Ambient",{duration:2e3,targetVolume:1})},onComplete:()=>{this.audioManager.fadeTrack("act3Ambient",{duration:2e3,targetVolume:1}),this.updatePlayPauseButton(!0)},onInitialised:()=>{this.audioPlayer.addTimeTrigger(this.audioPlayer.getDuration()-2,()=>{this.sessionsManager.addSessionData(`finishPlayback${xh(l==null?void 0:l.key)}`,!0),this.onUserInteraction(),this.forceCameraModeUI(),this.uiManager.forceUILabels(),setTimeout(()=>{this.removeForceCameraModeUI(),this.onUserInteraction()},4500)},2)}}),await this.audioManager.decodeTrack(t),await this.audioPlayer.initialise(),(B=this.currentObject.userData.asset.params)!=null&&B.captions&&await this.audioPlayer.loadSubtitles(Li(`captions/${this.currentObject.userData.asset.params.captions}`)),this.audioPlayer.setCurrentTime(this.resumePlaybackTime?this.resumePlaybackTime:0),this.cameraPlayer&&(this.cameraPlayer.setIsActive(!0),this.cameraPlayer.setTime(this.resumePlaybackTime?this.resumePlaybackTime:0)),this.lightingManager.getLightingAtTime(this.resumePlaybackTime?this.resumePlaybackTime:0,!0),this.resumePlaybackTime=0,this.uiManager.screenWipeDown(),e&&this.removeSceneLoader(),this.uiManager.setActiveElement("act-three"),setTimeout(()=>{this.audioPlayer.startPlayback(),this.actThreeStarted=!0},e?2e3:1e3),e&&(this.audioPlayer.pausePlayback(),this.updatePlayPauseButton()),this.uiManager.uiAnimEnter("act-three"),this.bindAct3AudioControls(),this.transitionInProgress=!1,this.resetUserInteractionTimeout(),this.forceCameraModeUI(),this.uiManager.forceUILabels(),e&&this.removeSceneLoader(),setTimeout(()=>{this.removeForceCameraModeUI(),this.uiManager.forceUILabels(!1),this.resetUserInteractionTimeout()},3e3),(V=this.currentObject.userData.asset.params)!=null&&V.blendSettings){const Y=this.currentObject.userData.asset.params.blendSettings;Y!=null&&Y.focus&&this.camera.cameraController.setFocusBlendRange(Y.focus.min,Y.focus.max),Y!=null&&Y.mode&&this.camera.cameraController.setModeBlendRange(Y.mode.min,Y.mode.max),Y!=null&&Y.normal&&this.camera.cameraController.setNormalBlendRange(Y.normal.min,Y.normal.max)}});g(this,"forceCameraModeUI",()=>{document.body.classList.add("force-camera-mode-ui")});g(this,"removeForceCameraModeUI",()=>{document.body.classList.remove("force-camera-mode-ui")});g(this,"snapshotCamera",()=>{const e=this.camera.camera.position.clone(),t=this.camera.camera.quaternion.clone(),i=new D(0,1,0).applyQuaternion(t),n=new D(0,0,-1).applyQuaternion(t),s=e.clone().add(n.multiplyScalar(100));this.camera.camera.position.copy(e),this.camera.camera.up.copy(i),this.camera.camera.lookAt(s),this.camera.controls.target.copy(s),this.camera.controls.update()});g(this,"clearCameraSnapshot",()=>{this.camera.camera.up.set(0,1,0),this.camera.cameraController&&this.camera.cameraController.synchroniseWithCamera(),this.camera.camera.updateMatrix(),this.camera.camera.updateMatrixWorld(!0)});g(this,"setActThreeCameraMode",(e,t=4e3)=>{var n,s,a;if(!this.cameraPlayer)return;this!=null&&this.letterOverlayManager&&this.letterOverlayManager.disableLetterManualMode(t<10),this.resetCamera(e?"cinema":"manual");const i=(s=(n=this.currentObject)==null?void 0:n.userData)==null?void 0:s.asset;if(this.uiManager.cameraModeRadial.getState()!=="active"&&this.uiManager.cameraModeRadial.setState("active"),this.uiManager.cameraModeRadial.updateProgress(0),this.uiManager.cameraModeRadial.setAnimationDuration(1),e){this.snapshotCamera();const r=((a=this.audioPlayer)==null?void 0:a.getIsPlaying())||!1;this.camera.camera.position.clone();const l=this.camera.camera.quaternion.clone(),c=this.camera.getFocalLength();this.camera.cameraController.currentMode==="pan"&&document.body.classList.add("pan-mode-transition-c");let h,d,f;const p=this.audioPlayer.getCurrentTime(),b=r?p+t/1e3:p;this.cameraPlayer.setIsActive(!1),this.cameraPlayer.setTime(b);const _=this.lightingManager.getLightingAtTime(b),y=_.brightness,v=_.rotation;h=this.cameraPlayer.getCameraTargetWorldPosition(),d=this.cameraPlayer.getCameraTargetWorldQuaternion(),f=this.cameraPlayer.getCameraTargetFocalLength()||35,r&&this.cameraPlayer.setTime(p);const S=mf(h,d),A=d.clone(),E=new D(0,1,0).applyQuaternion(l),O=new D(0,1,0),R=this.act3ManualPos??new D(50,0,50),k=new D(0,0,0),U=new D().subVectors(k,R).normalize(),C=E.clone().projectOnPlane(U).normalize(),T=O.clone().projectOnPlane(U).normalize(),Z=new ai().setFromUnitVectors(C,T),z=B=>{var V,Y,J,Te;if(B.progress!==void 0){const ge=kt.smootherstep(B.progress),fe=B.progress,he=kt.smootherstep(fe),Q=ge,pe=new ai().slerpQuaternions(new ai,Z,Q),ve=l.clone().multiply(pe),K=new ai().slerpQuaternions(ve,A,he);this.camera.camera.quaternion.copy(K);const se=Et.lerp(c,f,ge);((Y=(V=i==null?void 0:i.params)==null?void 0:V.cameraAnimation)==null?void 0:Y.type)!=="basic"&&this.camera.setFocalLength(se);const Ee=new D(0,0,-1).applyQuaternion(this.camera.camera.quaternion),me=this.camera.camera.position.distanceTo(S),Oe=this.camera.camera.position.clone().add(Ee.multiplyScalar(me));this.camera.controls.target.copy(Oe),this.uiManager.cameraModeRadial.updateProgress(B.progress*100),B.progress>=.99&&(((Te=(J=i==null?void 0:i.params)==null?void 0:J.cameraAnimation)==null?void 0:Te.type)!=="basic"&&this.camera.setFocalLength(f),this.camera.cameraController.currentMode==="pan"&&(document.body.classList.remove("pan-mode-transition-c"),this.uiManager.removeLetterScreenReaderDescriptions()),this.cameraModeTransitioning=!1,document.body.classList.remove("camera-mode-transition"),this.cameraPlayer.setIsActive(!0),this.cameraMode="cinema",this.uiManager.makeScreenReaderAnnouncement("Camera mode transition complete"),setTimeout(()=>{this.uiManager.cameraModeRadial.updateProgress(0)},10))}};this.cameraPathAnimator.setOnUpdateCallback(z),this.menu.animateCameraToPosition(h,S,t,.05),this.lightingManager.animateHdriRotation(v.x,v.y,v.z,t),this.lightingManager.animateAssetBrightness(y,t),this.camera.cameraController.currentMode==="pan"&&setTimeout(()=>{this.letterOverlayManager.letterMaterialManager.applyCinemaModeMaterials()},t/2),this.cameraModeTransitioning=!0,document.body.classList.add("camera-mode-transition")}else{this.snapshotCamera(),this.camera.camera.position.clone();const r=this.camera.camera.quaternion.clone(),l=this.camera.getFocalLength(),c=35;this.camera.cameraController.currentMode==="pan"&&(document.body.classList.add("pan-mode","pan-mode-transition"),setTimeout(()=>{document.body.classList.add("pan-mode-half")},t/2));const h=new D(0,1,0),d=new D(0,0,0),f=this.act3ManualPos??new D(50,0,50),p=new ai,b=new Ft;b.lookAt(f,d,h),p.setFromRotationMatrix(b);const _=new ai,y=new Ft;y.lookAt(f,d,h),_.setFromRotationMatrix(y),this.cameraPlayer.setIsActive(!1);const v=S=>{var A,E,O,R;if(S.progress!==void 0){const k=kt.smootherstep(S.progress),U=S.progress,C=kt.smootherstep(U),T=k,Z=new ai().slerpQuaternions(r,p,C),z=new ai().slerpQuaternions(Z,_,T);this.camera.camera.quaternion.copy(z);const B=Et.lerp(l,c,k);((E=(A=i==null?void 0:i.params)==null?void 0:A.cameraAnimation)==null?void 0:E.type)!=="basic"&&this.camera.setFocalLength(B);const V=new D(0,0,-1).applyQuaternion(this.camera.camera.quaternion),Y=this.camera.camera.position.distanceTo(d),J=this.camera.camera.position.clone().add(V.multiplyScalar(Y));this.camera.controls.target.copy(J),this.uiManager.cameraModeRadial.updateProgress(S.progress*100),S.progress>=1&&(((R=(O=i==null?void 0:i.params)==null?void 0:O.cameraAnimation)==null?void 0:R.type)!=="basic"&&this.camera.setFocalLength(c),this.camera.cameraController.synchroniseWithCamera(),this.camera.cameraController.setEnabled(!0),this.camera.cameraController.currentMode==="pan"&&(this.camera.cameraController.snapShotPanModeOrigin(),this.letterOverlayManager.enableLetterManualMode(),document.body.classList.remove("pan-mode-transition"),this.uiManager.addLetterScreenReaderDescriptions()),this.cameraModeTransitioning=!1,document.body.classList.remove("camera-mode-transition"),this.cameraMode="manual",this.uiManager.makeScreenReaderAnnouncement("Camera mode transition complete"),setTimeout(()=>{this.uiManager.cameraModeRadial.updateProgress(0)},10))}};this.cameraPathAnimator.setOnUpdateCallback(v),this.camera.cameraController.currentMode==="pan"&&(this.audioPlayer.pausePlayback(),this.updatePlayPauseButton()),this.menu.animateCameraToPosition(this.act3ManualPos?this.act3ManualPos:new D(50,0,50),this.act3ManualLookAt?new D(0,0,0):new D(0,0,0),t,.05),this.camera.cameraController.currentMode==="pan"&&setTimeout(()=>{this.letterOverlayManager.letterMaterialManager.applyManualModeMaterials()},t/2),this.lightingManager.animateToAssetManualState(t),this.cameraModeTransitioning=!0,document.body.classList.add("camera-mode-transition")}});g(this,"transitionToAct2",async()=>{var n,s,a,r;if(this.transitionInProgress)return;const e=this.currentObject,t=(n=e==null?void 0:e.userData)==null?void 0:n.asset;this.transitionInProgress=!0,this.routeManager.setRoute("menu"),this.uiManager.makeScreenReaderAnnouncement("Starting transition to menu"),this.cameraPathAnimator.setOnUpdateCallback(null),this.camera.cameraController.setIdleForceMultiplier(.1),this.uiManager.updateFocusableElements("act-two"),this.toggleActThreeAudioDescriptionPlayback(!0),this.uiManager.uiAnimExit("act-three"),this.environmentManager.setSplatForTransparency(),this.menu.setLetterForOcclusion();const i=2e3;this.uiManager.screenWipeUp(),this.uiManager.removeLetterScreenReaderDescriptions(),this.audioManager.addLowPassFilter((s=e.userData.asset.params)==null?void 0:s.audioTrack,5e3),this.audioManager.animateLowPassFrequency((a=e.userData.asset.params)==null?void 0:a.audioTrack,100,i*2,()=>{var l;this.audioManager.removeLowPassFilter((l=e.userData.asset.params)==null?void 0:l.audioTrack)}),await bi(i),await this.menu.hideAll(1),this.camera.setAct2Controls(),this.camera.cameraController.removeCollisionMesh(),this.camera.cameraController.resetAnchorPosition(new D(0,0,0)),e&&(await Promise.all([setTimeout(()=>{this.menu.moveItemToOriginalPosition(e,1)},i*.3),this.resetAsset(t),this.environmentManager.animateEnvironmentBrightness(.3,i),this.menu.jumpTo(e,{duration:1,zoomLevel:this.camera.getIdealZoom()-15}),this.audioManager.fadeTrack((r=e.userData.asset.params)==null?void 0:r.audioTrack,{duration:i,targetVolume:1e-4,onComplete:()=>{var c;const l=(c=t.params)==null?void 0:c.audioTrack;this.audioManager.setTrackVolume(l,1),this.audioManager.resetTrack(l),this.audioManager.clearTrackBuffer(l)}}),this.audioManager.fadeTrack("act3Ambient",{duration:2e3,targetVolume:1})]),t.setQualityState("menuView"),this.currentObject=null,this.menu.showAll(i/2),setTimeout(()=>{this.environmentManager.setSplatForOcclusion()},i)),this.environmentManager.setBrightnessMax(.1),this.environmentManager.show(),this.camera.setFocalLength(35),this.uiManager.forceUILabels(!1),this.camera.setCameraNear(.1),this.camera.controls.target.set(0,0,0),this.lightingManager.animateHdriRotation(eh.x,eh.y,eh.z,1),document.body.classList.remove("camera-mode-transition"),this.uiManager.screenWipeDown(),this.uiManager.setActiveElement("act-two"),this.updatePlayPauseButton(),this.audioPlayer&&(this.audioPlayer.cleanup(),this.audioPlayer=null),(t==null?void 0:t.key)==="letter"&&this.letterOverlayManager&&(document.body.classList.contains("letter-overlays")&&this.letterOverlayManager.toggleLetterOverlay(),this!=null&&this.letterOverlayManager&&this.letterOverlayManager.disableLetterManualMode(!0),this.setLetterCameraMode(!0,1)),this.uiManager.setCameraMode(!1,1),this.camera.cameraController.synchroniseWithCamera(),this.camera.cameraController.setEnabled(!0),this.actManager.changeAct(2),this.uiManager.uiAnimEnter("act-two"),this.transitionInProgress=!1,this.environmentManager.setBrightnessMax(1),this.environmentManager.setBrightness(.1),this.environmentManager.updateBrightness(),this.camera.cameraController.setFocusBlendRange(5,10),this.camera.cameraController.setModeBlendRange(10,15),this.camera.cameraController.setNormalBlendRange(5,7),this.camera.cameraController.setShouldApplyIdleOrbit(!0)});g(this,"resetAsset",async e=>{await this.menu.resetAssetViewTransforms(e),this.skinnedAnimationController&&this.skinnedAnimationController.setTime(0),e!=null&&e.multiObjectAnimationPlayer&&e.multiObjectAnimationPlayer.setTime(0,!1),this.cameraPlayer&&(this.cameraPlayer.detachCamera(),this.cameraPlayer.dispose(),this.cameraPlayer=null)});g(this,"toggleMute",()=>{const e=this.audioManager.toggleMute();this.preferenceManager.setPreference("muted",e),this.uiManager.makeScreenReaderAnnouncement(e?"Sound muted":"Sound unmuted"),e||this.uiManager.playUISound("click"),this.updateSoundIcons()});g(this,"updateLoader",(e,t)=>{const i=document.getElementById(e);if(!i){console.warn(`Loader with id "${e}" not found`);return}const n=i.querySelector(".loader-progress");if(n){const s=2*Math.PI*18,a=s-t/100*s;n.style.strokeDashoffset=a.toString()}else console.warn(`Required elements not found in loader with id "${e}"`)});g(this,"handleProgressBarClick",e=>{const i=e.currentTarget.getBoundingClientRect(),s=(e.clientX-i.left)/i.width,a=this.audioPlayer.getDuration()*s;this.audioPlayer.setCurrentTime(a)});g(this,"handlePlayPauseClick",async()=>{await this.audioPlayer.togglePlayback()?(this.uiManager.playUISound("click"),this.uiManager.makeScreenReaderAnnouncement("Sequence playing")):(this.uiManager.playUISound("clack"),this.uiManager.makeScreenReaderAnnouncement("Sequence paused")),this.updatePlayPauseButton()});g(this,"bindAct3AudioControls",()=>{document.getElementById("act-three__ui-toggle-playback")&&$t("act-three__ui-toggle-playback",()=>{this.handlePlayPauseClick()})});g(this,"disableRender",()=>{this.shouldRender=!1});g(this,"enableRender",()=>{this.shouldRender=!0});g(this,"updatePlayPauseButton",e=>{const t=document.getElementById("act-three__ui-toggle-playback");if(t){if(t.classList.remove("playing"),t.classList.remove("replay"),t.classList.remove("paused"),e){t.classList.add("replay"),t.setAttribute("aria-label","Replay sequence");return}this.audioPlayer.getIsPlaying()?(t.classList.add("playing"),t.setAttribute("aria-label","Pause sequence")):(t.classList.add("paused"),t.setAttribute("aria-label","Play sequence"))}});g(this,"setGraphicsProfile",async e=>{const t=graphicsProfiles[e];if(!t){console.warn(`Graphics profile '${e}' not found.`);return}this.currentGraphicsProfile=e,await this.updateLODConfigurations(t.lodConfigurations)});g(this,"updateLODConfigurations",async e=>{for(const t of e){const i=this.assetManager.getAssetByKey(t.assetKey);if(!i){console.warn(`Asset '${t.assetKey}' not found.`);continue}for(const n of t.lods)if(i.hasLODLevel(n.name))await i.updateLODLevel(n.name,{distance:n.distance});else{const{meshQuality:a,materialQuality:r}=F_(n.name);await i.addLODLevel(n.name,a,r,n.distance)}}});g(this,"updateReducedMotion",()=>{var t;const e=this.uiManager.getReduceMotion();(t=this.camera)!=null&&t.cameraController&&this.camera.cameraController.updateMotionPreference(e),this.introSequence&&this.introSequence.updateReducedMotion(e)});g(this,"initialisePreferences",()=>{this.initialiseAudioFromPreferences(),this.initialiseStatePreferences(),this.initialiseSubtitlePreference(),this.initialiseMotionPreference(),this.initialiseHighContrastPreference()});g(this,"initialiseStatePreferences",()=>{const e=this.preferenceManager.getPreference("fps-limit","30");this.setRenderFps(e==="unlimited"?999:parseInt(e));const t=this.preferenceManager.getPreference("onboarding-complete",!1);this.uiManager.getShowOnscreenControls(),this.uiManager.getOnscreenControlsLeft(),this.uiManager.getOnscreenControlsTop(),t&&this.uiManager.showOnboardingSkipButton()});console.log(`v${ql}`),this.toastManager=new ES("toast-centre"),this.toastManager.setIsActive(!1),this.preferenceManager=Gs.getInstance(),this.sessionsManager=new TS(this.preferenceManager),this.routeManager=new CS("mouthful-of-dust"),this.performanceManager=new vS(this),this.performanceManager.profileDevice(()=>{this.deviceProfiled=!0,this.sessionsManager.establishSession(),this.readyActManager()}),this.applyQueryParamSettings(),this.uiManager=new tx(this),this.uiManager.prefetchModalContent(),this.uiManager.bindUiActions(),this.uiManager.bindSplashScreenActions(),this.uiManager.setupKeyboardShortcuts(),this.uiManager.updateFocusableElements("aoc"),this.audioManager=new q_({groups:["voice","background","ui"],initialGroupVolumes:{voice:1,background:1,ui:1}}),this.toastManager.setAnnouncementFunction(e=>{this.uiManager.makeScreenReaderAnnouncement(e)}),this.initialisePreferences(),this.initialiseAudio(),this.camera=new oS(this,window.innerWidth/window.innerHeight),this.setupThreeScene(),this.setupTouchZoomPrevention(),this.camera.initCameraController(),this.initialiseKeyboardInversion(),this.assetManager=new RM(this),this.clock=new Kh,this.cameraPathAnimator=new cS(this.camera.camera,this.camera.controls),this.menu=new Kx(this,{radius:50,globalScale:.5,debug:!1}),this.setupBenchmarker(),window.addEventListener("cameraZoomChange",this.onCameraZoomChange),window.addEventListener("blur",this.handleBlur),window.addEventListener("focus",this.handleFocus),this.onboardingManager=new uS(this,this.camera,this.menu),this.uiManager.getReduceMotion(),this.environmentManager=new bS(this.scene),this.initialiseMainLoadGroups(),this.uiManager.initUi(),this.constructorComplete=!0,this.readyActManager()}readyActManager(){!this.deviceProfiled||!this.constructorComplete?this.profileTimeout=window.setTimeout(()=>{this.performanceManager.profileDevice(()=>{this.deviceProfiled=!0,this.sessionsManager.establishSession(),this.readyActManager()})},100):(window.clearTimeout(this.profileTimeout),setTimeout(()=>{this.handleInitialRouting()},100))}showSceneLoader(){const e=document.getElementById("scene-loader"),t=document.getElementById("splash-screen");e&&(e.style.display="flex"),t&&(t.style.display="none");const i=document.getElementById("loading-card__actions"),n=document.getElementById("scene-loader-progress");if(n&&i&&n.appendChild(i),document.body.classList.add("scene-loader"),!this.preferenceManager.getPreference("aoc",!1)){const a=document.getElementById("aoc-wrapper");a&&e.appendChild(a)}}removeSceneLoader(){const e=document.getElementById("scene-loader");e&&e.remove(),document.body.classList.remove("scene-loader")}handleInitialRouting(){if(this.initRouting)return;if(this.initRouting=!0,this.preferenceManager.getPreference("has-started",!1)&&iu().browser.toLowerCase()==="safari"){this.preferenceManager.getPreference("asset-load-start",!1)&&(this.preferenceManager.setPreference("skip-aoc",!0),this.preferenceManager.removePreference("asset-load-start")),this.preferenceManager.removePreference("has-started");const n=`https://refresh.slv.vic.gov.au/?r=${window.location.href}`;window.location.replace(`${n}`);return}const t=this.routeManager.getRoute();if(["armour","death-mask","letter","rifle","boot","menu"].includes(t[0]))if(this.uiManager.setActiveElement("scene-loader"),t[0]==="menu")this.routeManager.setRoute("menu"),this.showSceneLoader(),this.actManager=new nh({startingAct:2,onActChange:this.handleActChange}),this.initialiseAssetLoad("menu");else{const i=this.preferenceManager.getPreference("route",null);if(i){const n=i.split("/");t[0]!==(n==null?void 0:n[0])&&this.clearLastPlayback()}this.showSceneLoader(),this.actManager=new nh({startingAct:3,onActChange:this.handleActChange}),this.initialiseAssetLoad(t[0]==="death-mask"?"mask":t[0]),this.routeManager.setRoute(`${t[0]}`);return}else{let i=[];const n=this.preferenceManager.getPreference("route");n&&(i=n.split("/"));let s="Menu",a=kS;if(i!=null&&i[1]){switch(i[0]){case"boot":s="The Boot",a=IS;break;case"rifle":s="The Rifle",a=LS;break;case"mask":s="The Deathmask",a=DS;break;case"armour":s="The Armour",a=RS;break;case"letter":s="The Jerilderie Letter";break}this.toastManager.addToast({title:s,message:"tap to resume previous session",icon:a,action:()=>{this.routeManager.setRoute(`${i}`,!0)}})}this.routeManager.setRoute(""),this.actManager=new nh({onActChange:this.handleActChange}),this.initialiseAssetLoad("full")}}async initialiseMainLoadGroups(){this.mainLoader=new hS({elementId:"loader-container",colour:"#ffffff",contextLabelId:"loader-label",autoUpdateContextLabel:!1})}initialiseAudio(){this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.connect(this.audioContext.destination)}setUserInteractionTimeout(e,t){this.userInteractionDuration=e,this.userInteractionCallback=t,this.clearUserInteractionTimeout(),this.userInteractionTimeout=window.setTimeout(()=>{this.userInteractionCallback&&this.userInteractionCallback()},this.userInteractionDuration)}resetUserInteractionTimeout(){this.userInteractionDuration>0&&this.userInteractionCallback&&(this.clearUserInteractionTimeout(),this.uiManager.showUI(),this.userInteractionTimeout=window.setTimeout(()=>{this.userInteractionCallback&&this.userInteractionCallback()},this.userInteractionDuration))}clearUserInteractionTimeout(){this.userInteractionTimeout&&(window.clearTimeout(this.userInteractionTimeout),this.userInteractionTimeout=void 0)}async playTitleAnimation(){if(this.assetsBeingProccessed){await bi(100),this.playTitleAnimation();return}this.isTitleAnimating=!0,this.titleWantsToPlay=!1,this.uiManager.playSplashAnimation(),await bi(500),this.uiManager.showSplashSubtitle(),this.isTitleAnimating=!1}async generateIntroSequenceAssetManifest(e,t){this.introSequence=new j_({onSequenceFinished:()=>this.finishIntroSequence(),imageElement:"intro-image-viewer",subtitleElement:"subtitle-container",fadeInFirstSlide:!0,audioTracks:[{url:t=="tiny"?`${ti}/slv-a-mouthful-of-dust/media/audio/1758870572978/introsequence-tn.mp3`:t=="low"?`${ti}/slv-a-mouthful-of-dust/media/audio/175887144fd9c/introsequence-sm.mp3`:`${ti}/slv-a-mouthful-of-dust/media/audio/1743994461538/introsequence.mp3`,type:"default"},{url:t=="tiny"?`${ti}/slv-a-mouthful-of-dust/media/audio/17588708267c1/introsequence-ad-tn.mp3`:t=="low"?`${ti}/slv-a-mouthful-of-dust/media/audio/1758871392cc4/introsequence-ad-sm.mp3`:`${ti}/slv-a-mouthful-of-dust/media/audio/1751540898df0/introsequence-ad.mp3`,type:"audio-description"}],onPlaybackToggle:a=>{a?this.uiManager.playUISound("click"):this.uiManager.playUISound("clack"),this.uiManager.makeScreenReaderAnnouncement(a?"Sequence playing":"Sequence paused")},autoLoadAssets:!1},this.audioManager.getAudioContext(),this.audioManager.getMasterGainNode(),e);const i=await this.introSequence.getAudioRequirements(),n=await this.introSequence.getImageRequirements();return{name:"intro-sequence-assets",priority:10,assets:[...i.map(a=>({type:Ii.AUDIO,id:a.type,url:a.url})),...n.map(a=>({type:Ii.IMAGE,id:a.key,url:a.src}))],onProgress:a=>{(a==null?void 0:a.percentage)>50&&this.mainLoader.updateLabel("Fetching intro images...")},onComplete:async a=>{var d;const r=this.introSequence.getAudioContext(),l={},c={},h=a.filter(f=>f.type===Ii.IMAGE);Ye(["Image assets received:",h.map(f=>{var p,b;return{id:f.id,url:f.url,hasData:!!f.data,dataType:(b=(p=f.data)==null?void 0:p.constructor)==null?void 0:b.name}})]),await Promise.all(a.map(async f=>{if(f.type===Ii.AUDIO&&r){const p=await r.decodeAudioData(f.data);c[f.id]=p}else f.type===Ii.IMAGE&&(l[f.id]=f.data)})),Ye(["Final images object:",{keys:Object.keys(l),count:Object.keys(l).length,sampleSrc:(d=l[Object.keys(l)[0]])==null?void 0:d.src}]),Object.keys(c).length>0&&r&&this.introSequence.setAudioBuffers(c),Object.keys(l).length>0&&this.introSequence.setPreloadedImages(l)}}}async setLetterCameraMode(e,t=2e3){e?(this.audioPlayer&&(this.audioPlayer.getIsPlaying()?this.skinnedAnimationController.setTime(this.audioPlayer.getCurrentTime()+7.5):this.skinnedAnimationController.setTime(this.audioPlayer.getCurrentTime()+4)),this.skinnedAnimationController.blendToPrimary(t)):this.skinnedAnimationController.blendToAdditionalAnimation("secondary",0,1,t)}async finaliseAssetLoad(){if(this.isTitleAnimating||this.titleWantsToPlay){await bi(100),this.finaliseAssetLoad();return}this.disableRender(),this.preferenceManager.removePreference("asset-load-start"),this.mainLoader.complete(),this.handleIntroSequenceReady(),this.assetManager.initialiseAssetsCameraAnimations(),this.showSkipButton(),this.actManager.act2Ready=!0,this.initPostProcessing(),this.assetManager.loadQueueManager.cleanupGroup("main-app-assets"),this.assetManager.loadQueueManager=null,this.actManager.getAct()!==1&&this.uiManager.updateFocusableElements("scene-loader",!1)}async processCameraAssets(e,t){if(this.isTitleAnimating||this.titleWantsToPlay){await bi(100),this.processCameraAssets(e,t);return}this.assetsBeingProccessed=!0;for(const i of e){const n=i.options.assetKey,s=this.assetManager.getAssetByKey(n);if(s&&i.data instanceof ArrayBuffer){const a=await this.assetManager.parseGLBFromBuffer(i.data,!0);s.setCameraAnimation(a,s.params.cameraAnimation.file,s.params.cameraAnimation.type||"basic")}}t.markAsComplete(),t.cleanup(1),this.assetsBeingProccessed=!1}async processModelAssets(e,t){if(this.isTitleAnimating||this.titleWantsToPlay){await bi(100),this.processModelAssets(e,t);return}const i=e==null?void 0:e.find(a=>a.id==="letter_Letter_Viewer"),n=await this.assetManager.parseGLBFromBuffer(i.data,!0);this.assetsBeingProccessed=!0,this.mainLoader.updateLabel("Creating materials..."),await this.assetManager.loadMeshesWithMaterials(this.initialLodConfigs,e),this.initObjectSelectMenu(),await this.preWarmAssets(),this.menu.getMenuAssets().forEach(a=>{var r;if(a.updateViewStateQuality("menuView","medium"),a.key==="letter"){const l=a.getActiveQuality().mesh,c=l==null?void 0:l.getObjectByName("Paper_Clone");a.skinnedAnimationController=new dS(l,null,{debug:!1,fps:25}),c.children.forEach(async h=>{var _,y,v,S,A,E,O;const d=Nn.getPageGeo(h);if(!d)return;const f=(y=(_=a==null?void 0:a.params)==null?void 0:_.pages)==null?void 0:y[h.name],p=await Nn.generateLetterPageMaterial((v=f==null?void 0:f.front)==null?void 0:v.low),b=await Nn.generateLetterPageMaterial((S=f==null?void 0:f.back)==null?void 0:S.low);if(this.letterOverlayManager||(this.letterOverlayManager=new Nn(this.camera,a.skinnedAnimationController,a)),this.createGeometryBackfaces(d.geometry),p.userData.name=`${h.name}__front__low`,b.userData.name=`${h.name}__back__low`,this.letterOverlayManager.letterMaterialManager.setMaterial(h.name,"front","low",p),this.letterOverlayManager.letterMaterialManager.setMaterial(h.name,"back","low",b),d.material=[p,b],h.name.includes("-CU")){let R=null,k=null;switch(h.name){case"Paper_43-CU1":R="Paper_4",k="front";break;case"Paper_31-CU2":R="Paper_23",k="front";break}if(!R||!k)return;const U=(E=(A=a==null?void 0:a.params)==null?void 0:A.pages)==null?void 0:E[R],C=await Nn.generateLetterPageMaterial((O=U==null?void 0:U[k])==null?void 0:O.high,"cinema");this.letterOverlayManager.letterMaterialManager.setMaterial(h.name,k,"cinema",C,d)}}),a.skinnedAnimationController.loadAdditionalAnimations({skinnedMesh:n,name:"secondary",weight:0}),a.skinnedAnimationController.setIsActive(!0),a.skinnedAnimationController.setTime(0),this.menu.updateLetterBrightness((r=a.params)==null?void 0:r.brightness),this.skinnedAnimationController=a.skinnedAnimationController}if(a.key==="armour"){a.multiObjectAnimationPlayer=new ru(this.camera.camera,this.scene,{debug:!0,unitScale:50,callbacks:{onFocalLengthChange:b=>{this.camera.setFocalLength(b)}}});const l=a.modelContainers.get("Helmet").container;a.multiObjectAnimationPlayer.registerObject({targetName:"Helmet_Ani",sceneObject:l});const c=a.modelContainers.get("Back").container;a.multiObjectAnimationPlayer.registerObject({targetName:"Back_Ani",sceneObject:c});const h=a.modelContainers.get("Front").container;a.multiObjectAnimationPlayer.registerObject({targetName:"Front_Ani",sceneObject:h});const d=a.modelContainers.get("FrontSkirt").container;a.multiObjectAnimationPlayer.registerObject({targetName:"FrontSkirt_Ani",sceneObject:d});const f=a.modelContainers.get("ShoulderR").container;a.multiObjectAnimationPlayer.registerObject({targetName:"ShoulderR_Ani",sceneObject:f});const p=a.modelContainers.get("ShoulderL").container;a.multiObjectAnimationPlayer.registerObject({targetName:"ShoulderL_Ani",sceneObject:p})}}),t.markAsComplete(),t.cleanup(1),this.assetsBeingProccessed=!1}async processSplat(e,t){if(this.isTitleAnimating||this.titleWantsToPlay){await bi(100),this.processSplat(e,t);return}this.assetsBeingProccessed=!0,this.mainLoader.updateLabel("Processing splat...");const i=e.find(s=>s.id==="splat-data"),n=window.setTimeout(()=>{window.location.reload()},1e4);if(i){const s=await this.assetManager.loadSplatFromBuffer(i.data);clearTimeout(n),this.environmentManager.setSplat(s),this.environmentManager.show(),this.environmentManager.setBrightness(0),t.markAsComplete(),t.cleanup(1),this.assetsBeingProccessed=!1}}async processHdri(e,t){if(this.isTitleAnimating||this.titleWantsToPlay){await bi(100),this.processHdri(e,t);return}this.assetsBeingProccessed=!0,this.mainLoader.updateLabel("Processing HDRI...");const i=e.find(n=>n.id==="hdri");if(i&&i.data instanceof ArrayBuffer){const n=await this.assetManager.loadHDRI("",i.data);this.assetManager.applyHDRIToScene(n)}t.markAsComplete(),t.cleanup(1),this.assetsBeingProccessed=!1}preWarmAssets(){return this.enableRender(),new Promise(e=>{const t=this.menu.getMenuAssets(),i=new Id;t.forEach(l=>{l.setQualityState("menuView");const c=l.container.clone();i.add(c),l.updateViewStateQuality("detailView","high")});const n=new Hs(256,256,{minFilter:wi,magFilter:wi,format:Bn}),s=this.renderer.getRenderTarget(),a=this.camera.camera.clone();(async()=>{this.renderer.setRenderTarget(n),this.renderer.render(i,a),await new Promise(l=>requestAnimationFrame(l)),t.forEach(l=>{l.setQualityState("menuView")}),this.renderer.render(this.scene,this.camera.camera),await new Promise(l=>requestAnimationFrame(l)),t.forEach(l=>{l.setQualityState("detailView")}),this.renderer.render(this.scene,this.camera.camera),await new Promise(l=>requestAnimationFrame(l)),t.forEach(l=>{l.setQualityState("menuView")}),this.renderer.render(this.scene,this.camera.camera),this.renderer.setRenderTarget(s),n.dispose(),i.clear(),this.preferenceManager.setPreference("has-started",!0),e()})()})}createGeometryBackfaces(e){const t=e.attributes.position,i=e.attributes.normal,n=e.attributes.uv,s=e.index,a=t.array,r=i.array,l=n?n.array:null,c=s?s.array:null,h=new Float32Array(a.length*2),d=new Float32Array(r.length*2),f=l?new Float32Array(l.length*2):null;h.set(a,0),d.set(r,0),f&&l&&f.set(l,0);const p=a.length/3;for(let y=0;y<p;y++){const v=y*3,S=p*3;if(h[S+v]=a[v],h[S+v+1]=a[v+1],h[S+v+2]=a[v+2],d[S+v]=-r[v],d[S+v+1]=-r[v+1],d[S+v+2]=-r[v+2],f&&l){const A=y*2,E=p*2;f[E+A]=1-l[A],f[E+A+1]=l[A+1]}}let b;if(c){b=new Uint32Array(c.length*2),b.set(c,0);for(let y=0;y<c.length;y+=3){const v=c.length;b[v+y]=c[y+2]+p,b[v+y+1]=c[y+1]+p,b[v+y+2]=c[y]+p}}else{const y=p/3;b=new Uint32Array(p*2);for(let v=0;v<p;v++)b[v]=v;for(let v=0;v<y;v++){const S=v*3,A=p+S;b[A]=p+S+2,b[A+1]=p+S+1,b[A+2]=p+S}}if(e.setAttribute("position",new Ei(h,3)),e.setAttribute("normal",new Ei(d,3)),f&&e.setAttribute("uv",new Ei(f,2)),e.setIndex(new Ei(b,1)),e.attributes.skinIndex){const y=e.attributes.skinIndex.array,v=new Float32Array(y.length*2);v.set(y,0),v.set(y,y.length),e.setAttribute("skinIndex",new Ei(v,4))}if(e.attributes.skinWeight){const y=e.attributes.skinWeight.array,v=new Float32Array(y.length*2);v.set(y,0),v.set(y,y.length),e.setAttribute("skinWeight",new Ei(v,4))}const _=c?c.length:p;return e.clearGroups(),e.addGroup(0,_,0),e.addGroup(_,_,1),e}prepareActTwo(){this.enableRender(),this.camera.setAct2Controls(),this.camera.controls.enabled=!1,this.camera.cameraController.setAllControlStates(!1),this.cameraPathAnimator.setIsAnimating(!0),this.camera.cameraController.setShouldApplyIdleOrbit(!1),setTimeout(()=>{this.camera.camera.position.copy(c_),this.camera.camera.lookAt(hf),this.environmentManager.setBrightnessMax(0),this.uiManager.disableListen(),this.camera.setOnBoardingControls(),this.camera.cameraController.triggerZoomChange()},10),setTimeout(()=>{this.disableRender()},100)}removePhotoPlane(){const e=document.getElementById("act-two__photo-plane");e&&e.remove()}setupGlobalInteractionListeners(){document.addEventListener("mousedown",this.onUserInteraction),document.addEventListener("mousemove",this.onUserInteraction),document.addEventListener("mouseup",this.onUserInteraction),document.addEventListener("click",this.onUserInteraction),document.addEventListener("touchstart",this.onUserInteraction),document.addEventListener("touchmove",this.onUserInteraction),document.addEventListener("touchend",this.onUserInteraction),document.addEventListener("keydown",this.onUserInteraction),document.addEventListener("wheel",this.onUserInteraction)}removeGlobalInteractionListeners(){document.removeEventListener("mousedown",this.onUserInteraction),document.removeEventListener("mousemove",this.onUserInteraction),document.removeEventListener("mouseup",this.onUserInteraction),document.removeEventListener("click",this.onUserInteraction),document.removeEventListener("touchstart",this.onUserInteraction),document.removeEventListener("touchmove",this.onUserInteraction),document.removeEventListener("touchend",this.onUserInteraction),document.removeEventListener("keydown",this.onUserInteraction),document.removeEventListener("wheel",this.onUserInteraction)}createChunkedAudioLoadGroups(e){const t=Object.entries(e),i=5,n=[];for(let s=0;s<t.length;s+=i){const a=t.slice(s,s+i);n.push(Object.fromEntries(a))}return n.map((s,a)=>this.createAudioLoadGroupConfig(`audio-chunk-${a}`,s,20+a))}async loadObjects(e,t,i){Ye(`Starting mesh load for qualities: ${e.join(", ")}`);try{await this.assetManager.loadMeshes(e),Ye(`${e.join(", ")} quality meshes loaded.`),Ye(`Starting texture load for qualities: ${t.join(", ")}`),await this.assetManager.loadTextures(t),Ye(`${t.join(", ")} quality textures loaded.`),i&&i()}catch(n){console.error("Error loading meshes or textures:",n)}}async loadAdditionalQuality(e,t){await this.loadObjects([e],t)}rotateMenu(e){this.menu.rotateObjects(e)}setupBenchmarker(){this.benchmarker=new Qx(this.renderer,this.scene,this.camera.camera,{targetFrameRate:this.targetFrameRate,checkInterval:5e3,maxUpgradeAttempts:3,debug:!0}),this.benchmarker.addPerformanceCallback({activate:()=>(this.toggleFXAA(!1),"FXAA disabled."),deactivate:()=>(this.toggleFXAA(!0),"FXAA enabled.")}),this.benchmarker.addPerformanceCallback({activate:()=>(this.setAssetQuality("low"),"Downgrade asset qualities (low)."),deactivate:()=>(this.setAssetQuality("medium"),"Upgrade asset qualities (med).")}),this.benchmarker.addPerformanceCallback({activate:()=>(this.setAssetQuality("tiny"),"Downgrade asset qualities (tiny)."),deactivate:()=>(this.setAssetQuality("low"),"Upgrade asset qualities (low).")}),this.benchmarker.addPerformanceCallback({activate:()=>(this.preferenceManager.getPreference("enable-splat",!1),this.environmentManager.hide(),"Splat disabled."),deactivate:()=>(this.environmentManager.show(),"Splat enabled.")}),this.benchmarker.addPerformanceCallback({activate:()=>{const e=this.preferenceManager.getPreference("graphics-preset",!1),t=this.preferenceManager.getPreference("enable-splat",!1),i=this.preferenceManager.getPreference("fps-limit","30");return e!=="low"||t||i!=="30"?(this.preferenceManager.setPreference("graphics-preset","low"),this.preferenceManager.setPreference("enable-splat",!1),this.preferenceManager.setPreference("fps-limit","30"),this.toastManager.addToast({message:"Low device performance detected. Graphics settings reduced. Please refresh your browser for changes to take effect.",icon:Qf}),"Settings lowered and refresh recommended."):"Settings already lowest."},deactivate:()=>"End"})}toggleFXAA(e){this.fxaaPass&&(this.fxaaPass.enabled=e)}showItemInfo(e,t){!this.menu.fadeInProgress||this.menu.getHighlightedItem()!==e?this.menu.setHighlightedItem(e,t):this.menu.updateHighlightedItemOpacity(t)}hideItemInfo(){this.menu.fadeInProgress||this.menu.unsetHighlightedItem()}updateFog(e){if(!this.scene.fog)return;const t=Math.min(Math.max(e-.1,0),2.9)/2.9,i=Et.lerp(this.baseFogNear,this.baseFogFar,t),n=Et.lerp(this.baseFogFar,this.baseFogFar*10,t);this.scene.fog.near=i,this.scene.fog.far=n}async reloadAudioTrack(e){var t;return document.body.classList.add("buffering"),await this.audioManager.reloadTrack(e,(t=audioFiles[e])==null?void 0:t.url),document.body.classList.remove("buffering"),!0}resetCamera(e){if(this.camera.orbit.speedX=0,this.camera.orbit.speedY=0,this.camera.orbit.easing=!1,this.camera.orbit.userInteracting=!1,this.camera.cameraController){const t=this.camera.cameraController;t.resetMotionWithVelocity(new D(0,0,0),new et(0,0)),e==="cinema"?(this.camera.controls.enabled=!1,t.setEnabled(!1),this.camera.camera.up.set(0,1,0),this.cameraPathAnimator&&this.cameraPathAnimator.stop()):e==="manual"&&(this.camera.camera.up.set(0,1,0),this.cameraPlayer&&this.cameraPlayer.setIsActive(!1),this.camera.camera.updateMatrix(),this.camera.camera.updateMatrixWorld(!0))}this.camera.camera.updateProjectionMatrix()}clearLastPlayback(){this.preferenceManager.setPreference("lastPlayback",0)}getAudioContext(){return this.audioContext}getMasterGainNode(){return this.masterGainNode}setupCameraPositionLogging(){document.addEventListener("keydown",e=>{(e.key==="l"||e.key==="L")&&this.logCameraPosition(),(e.key==="k"||e.key==="K")&&this.outputCapturedKeyframes(),(e.key==="h"||e.key==="H")&&(this.environmentManager.setSplatForTransparency(),this.menu.hideAll(2e3),setTimeout(()=>{},2100)),(e.key==="j"||e.key==="J")&&(this.environmentManager.setSplatForTransparency(),this.menu.showAll(2e3,new D(0,-2.5,0)),setTimeout(()=>{},2100))})}logCameraPosition(){const e=this.camera.camera.position.clone(),t=this.camera.controls.target.clone(),i=this.camera.cameraController.getZoom();console.log(`Camera Position: ${this.vectorToString(e)}`),console.log(`Look At: ${this.vectorToString(t)}`),console.log(`cam Zoom Level: ${i.toFixed(2)}`),console.log(`cam max zoom: ${this.camera.getMaxZoom()}`),this.capturedKeyframes.push({position:e,lookAt:t,zoomLevel:i}),console.log(`Keyframe ${this.capturedKeyframes.length} captured`)}outputCapturedKeyframes(){console.log("Captured Keyframes:");const e=this.capturedKeyframes.map((t,i)=>`
  {
  position: new Vector3${this.vectorToString(t.position)},
  lookAt: new Vector3${this.vectorToString(t.lookAt)},
  zoomLevel: ${t.zoomLevel.toFixed(2)},
  },`).join("");console.log(`const keyframes = [${e}
  ]`)}vectorToString(e){return`(${e.x.toFixed(2)}, ${e.y.toFixed(2)}, ${e.z.toFixed(2)})`}navigateMenu(e){let t=this.menu.lastHighlightedItem;const i=e==="next"?this.menu.getNextMenuItem(t):this.menu.getPreviousMenuItem(t);this.menu.jumpTo(i,{duration:this.preferenceManager.getPreference("reduceMotion")?1:2e3,zoomLevel:110}),this.menu.setHighlightedItem(i)}setControlsActive(e=!0){var t;this.cameraMode==="manual"?this.camera.cameraController.setEnabled(e):(t=this.cameraPlayer)==null||t.setControlsActive(e)}bindKeyboardControls(e){this.keyboardEventListener=t=>{switch(e){case 1:break;case 2:this.handleAct2KeyboardControls(t);break;case 3:this.handleAct3KeyboardControls(t);break}},document.addEventListener("keydown",this.keyboardEventListener)}unbindKeyboardControls(){this.keyboardEventListener&&(document.removeEventListener("keydown",this.keyboardEventListener),this.keyboardEventListener=null)}handleAct2KeyboardControls(e){if(this.uiManager.isModalOpen)return;const t=document.activeElement,i=t&&(t.classList.contains("ui-no-button")||t.tagName.toLowerCase()==="button");switch(e.key){case"ArrowRight":e.shiftKey&&this.navigateMenu("previous");break;case"ArrowLeft":e.shiftKey&&this.navigateMenu("next");break;case"Enter":!i&&this.menu.getHighlightedItem()&&this.transitionToAct3();break}}handleAct3KeyboardControls(e){switch(e.key){case"Escape":if(document.body.classList.contains("scene-loader")||this.uiManager.isModalOpen)return;const t=document.getElementById("modal-wrapper");if(!t)return;if(![...t==null?void 0:t.classList].includes("anim-exit-start")){this.transitionToAct2();break}}}updateToneMapping(e){this.renderer.toneMappingExposure=e}setRenderFps(e){this.renderFrameInterval=1e3/e}adjustBrightness(e){this.toneMappingPass&&this.toneMappingPass.setBrightness(e)}adjustSaturation(e){this.toneMappingPass&&this.toneMappingPass.setSaturation(e)}initialiseKeyboardInversion(){var i;const e=this.uiManager.getKeyboardInvertX(),t=this.uiManager.getKeyboardInvertY();(i=this.camera)!=null&&i.cameraController&&this.camera.cameraController.setKeyboardInversion(e,t)}updateKeyboardInversion(){var i;const e=this.uiManager.getKeyboardInvertX(),t=this.uiManager.getKeyboardInvertY();(i=this.camera)!=null&&i.cameraController&&this.camera.cameraController.setKeyboardInversion(e,t),this.cameraPlayer&&this.cameraPlayer.setKeyboardInversion(e,t)}setCameraAnimationPlayerKeyboardInversion(){const e=this.uiManager.getKeyboardInvertX(),t=this.uiManager.getKeyboardInvertY();this.cameraPlayer&&this.cameraPlayer.setKeyboardInversion(e,t)}initialiseSubtitlePreference(){this.uiManager.getShowSubtitles()}initialiseHighContrastPreference(){this.uiManager.getHighContrast()}initialiseMotionPreference(){var e;if(!this.uiManager.getReduceMotion()){const t=((e=window.matchMedia)==null?void 0:e.call(window,"(prefers-reduced-motion: reduce)").matches)??!1;this.uiManager.setReduceMotion(t)}this.updateReducedMotion()}initialiseAudioFromPreferences(){const e=this.preferenceManager.getPreference("volume-master",1),t=this.preferenceManager.getPreference("volume-voice",1),i=this.preferenceManager.getPreference("volume-background",1),n=this.preferenceManager.getPreference("volume-ui",1);this.audioManager.setMasterVolume(e),this.audioManager.setGroupVolume("voice",t),this.audioManager.setGroupVolume("background",i),this.audioManager.setGroupVolume("ui",n),this.preferenceManager.getPreference("muted",!1)&&this.toggleMute()}setupTouchZoomPrevention(){document.addEventListener("touchstart",t=>{t.touches.length>1&&t.preventDefault()},{passive:!1}),document.addEventListener("touchmove",t=>{t.touches.length>1&&t.preventDefault()},{passive:!1});let e=0;document.addEventListener("touchend",t=>{const i=Date.now();i-e<300&&t.preventDefault(),e=i},{passive:!1}),document.addEventListener("wheel",t=>{(t.ctrlKey||t.metaKey)&&t.preventDefault()},{passive:!1}),document.addEventListener("gesturestart",t=>{t.preventDefault()},{passive:!1}),document.addEventListener("gesturechange",t=>{t.preventDefault()},{passive:!1}),document.addEventListener("gestureend",t=>{t.preventDefault()},{passive:!1}),window.addEventListener("DOMMouseScroll",t=>{(t.ctrlKey||t.metaKey)&&t.preventDefault()},{passive:!1}),document.addEventListener("MozMousePixelScroll",t=>{(t.ctrlKey||t.metaKey)&&t.preventDefault()},{passive:!1})}}document.addEventListener("DOMContentLoaded",()=>{const o=new FS,e=t=>{requestAnimationFrame(e),o.render(t)};e(0)});export{qt as $,w_ as A,HS as B,__ as C,M_ as D,GS as E,x_ as F,S_ as G,A_ as H,T_ as I,E_ as J,df as K,ff as L,C_ as M,Yo as N,Ft as O,Wt as P,ui as Q,ai as R,_s as S,ha as T,ya as U,D as V,ir as W,nr as X,Mh as Y,et as Z,fi as _,a_ as a,Id as a0,on as a1,ec as a2,Vb as a3,Dt as a4,Et as a5,cn as a6,Wi as a7,It as a8,Hs as a9,ma as aA,Bs as aB,Bn as aa,Rp as ab,Pr as ac,Nr as ad,as as ae,_g as af,ph as ag,mh as ah,ba as ai,$p as aj,ri as ak,Ai as al,va as am,zn as an,Hn as ao,Wh as ap,yp as aq,Tn as ar,mp as as,Ib as at,ic as au,Cr as av,Ei as aw,Cw as ax,Vl as ay,US as az,ql as b,r_ as c,Xl as d,gs as e,nm as f,l_ as g,c_ as h,ms as i,h_ as j,eh as k,uf as l,zS as m,u_ as n,hf as o,VS as p,d_ as q,f_ as r,ti as s,o_ as t,p_ as u,m_ as v,g_ as w,y_ as x,v_ as y,b_ as z};
